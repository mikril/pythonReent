(()=>{"use strict";var e,t,o,r,n,i,s={685701:(e,t,o)=>{o.d(t,{MAX_STORY_VIDEO_DURATION:()=>s,getStoryUploadUrl:()=>a,uploadStoryBlobToServer:()=>d,saveStoryOnServer:()=>l});var r=o(570655),n=o(733164),i=o(961540),s=16;function a(e){return new Promise((function(t,o){window.ajax.post((0,i.isMvk)()?"stories.php":"al_stories.php",(0,r.__assign)({act:"get_upload_url"},e),{onDone:t,onError:o,onFail:o})}))}function d(e,t){var o=new FormData,r=encodeURIComponent("edited_"+(0,n.irand)(0,99999)+".jpg");return o.append("file0",e,r),fetch(t,{method:"POST",body:o}).then((function(e){return e.json()}))}function l(e,t){return new Promise((function(o,r){window.ajax.post((0,i.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:o,onError:r,onFail:r})}))}},613499:(e,t,o)=>{o.d(t,{Publisher:()=>m});var r=o(570655),n=o(785893),i=o(667294),s=o(146143),a=o(501389),d=o(359284),l=o(70162),u=o(685701),c=o(66433),p=o(961540),h=o(109082),f=o(463005),v=o(117709),g=o(99656),b=o(86894),y=o(936297),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorHandler=function(e,t){var o=e||(0,l.getLang)("global_error");(0,s.showFastBox)({title:(0,l.getLang)("global_error")},o,(0,l.getLang)("global_close"),(function(){t(),(0,a.curBox)().hide()}))},t.save=function(e,o,r){var n;void 0===r&&(r={}),t.props.onClickSave(),t.saveStory(e,{attachment:JSON.stringify(t.props.attachment),clickable_stickers:r.clickableStickers,mini_app_id:t.props.miniAppId,question_id:t.props.questionId,situational_suggest_id:null===(n=t.props.serviceInfo)||void 0===n?void 0:n.situational_suggest_id,analytics:r.analytics,mediaEditorAnalytics:r.mediaEditorAnalytics,hash:r.storyUploadUrlHash,entry_point:t.props.entrypoint,ref:window.cur.module},r.storySaveHash).then((function(e){t.onClose(!0,!1,e),o()})).catch((function(e){return t.errorHandler(e,o),!0}))},t.onClose=function(e,o,r){var n,i;if(o)t.props.onClose(!1);else if(e)window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose(!0,r);else{(null===(i=null===(n=window.cur.photoEditorStore)||void 0===n?void 0:n.getState())||void 0===i?void 0:i.past.length)>1?(0,s.showFastBox)({title:(0,l.getLang)("photos_pe_story_editor_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},(0,l.getLang)("photos_pe_story_editor_close_text"),(0,l.getLang)("box_yes"),(function(){(0,a.curBox)().hide(),t.props.onClose(!1)}),(0,l.getLang)("box_no"),(function(){(0,a.curBox)().hide()})):t.props.onClose(!1)}},t}return(0,r.__extends)(t,e),t.prototype.render=function(){var e=this,t=Math.min(900,window.innerHeight-100),o=t/1.78,i=(0,f.getPhotoEditorLangMap)();return(0,n.jsx)(g.AppRootProvider,(0,r.__assign)({mode:"embedded",platform:b.Platform.VKCOM,viewWidth:b.ViewWidth.DESKTOP},{children:(0,n.jsx)(d.default,(0,r.__assign)({disableBodyScroll:!0,onClose:function(){return e.onClose()},className:"Publisher PhotoEditorTheme"},{children:(0,n.jsx)(y.PhotoEditor,{context:"story",photoUrl:this.props.photoUrl,backgroundId:this.props.backgroundId,artboardWidth:o,artboardHeight:t,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers,serviceInfo:this.props.serviceInfo,showStatusActions:!0,helpers:{showErrorBox:function(e,t){return(0,s.showFastBox)({title:e},t)},logError:function(e){return(0,c.logError)(e,{environment:"photoEditor"})},getHostName:p.getHostName,prepareStat:h.prepareStat,prepareMediaEditorStat:h.prepareMediaEditorStat,sendStat:h.sendStat,showStickerShop:v.showStickerShop,fetchStickers:v.fetchStickers,getPhotoEditorData:v.getPhotoEditorData},langMap:i,locked:this.props.locked,storeInit:function(e){return window.cur.photoEditorStore=e},onDestroy:function(){delete window.cur.photoEditorStore,delete window.cur.storyPublishContext}},void 0)}),void 0)}),void 0)},t.prototype.saveStory=function(e,t,o){return(0,u.getStoryUploadUrl)(t).then((function(t){return(0,u.uploadStoryBlobToServer)(e,t)})).then((function(e){var t=e.response;return(0,u.saveStoryOnServer)(t&&t.upload_result,o)}))},t}(i.Component)},969209:(e,t,o)=>{o.d(t,{StoryPublisher:()=>c});var r=o(785893),n=o(973935),i=o(613499),s=o(501389),a=o(70162),d=o(146143),l=o(109082),u=o(463005),c={init:function(e,t,o){var r=this;this.onClickSave=t||function(){},this.cb=o,Promise.all([this.loadStatic(),(0,u.loadPhotoEditorLangs)()]).then((function(){r.render(e)})).catch((function(){(0,d.showFastBox)({title:(0,a.getLang)("global_error")},(0,a.getLang)("global_error"),(0,a.getLang)("global_close"),(function(){(0,s.curBox)().hide()}))}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var t=(null==e?void 0:e.entrypoint)||"",o=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?(0,l.sendStat)(l.EVENTS.ADD_STORY_FROM_SHARING):(0,l.sendStat)(l.EVENTS.ADD_STORY);var s=document.querySelector(".StoryPublisher");s||((s=document.createElement("div")).classList.add("StoryPublisher"),document.body.appendChild(s)),n.render((0,r.jsx)(i.Publisher,{entrypoint:t,miniAppId:o,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers,serviceInfo:null==e?void 0:e.serviceInfo,questionId:null==e?void 0:e.questionId,backgroundId:null==e?void 0:e.backgroundId,locked:null==e?void 0:e.locked},void 0),s)},destroy:function(e,t){var o=document.querySelector(".StoryPublisher");o&&n.unmountComponentAtNode(o),this.cb&&this.cb(e,t),delete window.cur.photoEditorStore,delete window.cur.renderImageFromState,e&&(0,s.showDoneBox)((0,a.getLang)("photos_pe_story_published"))}}},629497:(e,t,o)=>{var r=o(969209);window.StoryPublisher=r.StoryPublisher;try{window.stManager.done(window.jsc("web/story_publisher.js"))}catch(e){}}},a={};function d(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={id:e,loaded:!1,exports:{}};return s[e].call(o.exports,o,o.exports,d),o.loaded=!0,o.exports}d.m=s,e=[],d.O=(t,o,r,n)=>{if(!o){var i=1/0;for(u=0;u<e.length;u++){for(var[o,r,n]=e[u],s=!0,a=0;a<o.length;a++)(!1&n||i>=n)&&Object.keys(d.O).every((e=>d.O[e](o[a])))?o.splice(a--,1):(s=!1,n<i&&(i=n));if(s){e.splice(u--,1);var l=r();void 0!==l&&(t=l)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[o,r,n]},d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},o=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,d.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var n=Object.create(null);d.r(n);var i={};t=t||[null,o({}),o([]),o(o)];for(var s=2&r&&e;"object"==typeof s&&!~t.indexOf(s);s=o(s))Object.getOwnPropertyNames(s).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,d.d(n,i),n},d.d=(e,t)=>{for(var o in t)d.o(t,o)&&!d.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},d.f={},d.e=e=>Promise.all(Object.keys(d.f).reduce(((t,o)=>(d.f[o](e,t),t)),[])),d.u=e=>9375===e?"voice_message_player.1ca99e7ec51aef6df7b5.js":28762===e?"speech.ec5bb88b79217da0bc5d.js":57468===e?"SilentModeForms.710e5d0929fe4e8d2b72.js":75980===e?"menu_settings.0f17151bd588fe6a5267.js":void 0,d.miniCssF=e=>e+"."+{57468:"28053bce032a9da83885",75980:"95eccc249ab38cb1e901"}[e]+".css",d.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),d.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},d.l=(e,t,o,n)=>{if(r[e])r[e].push(t);else{var i,s;if(void 0!==o)for(var a=document.getElementsByTagName("script"),l=0;l<a.length;l++){var u=a[l];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")=="vk:"+o){i=u;break}}i||(s=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,d.nc&&i.setAttribute("nonce",d.nc),i.setAttribute("data-webpack","vk:"+o),i.src=e),r[e]=[t];var c=(t,o)=>{i.onerror=i.onload=null,clearTimeout(p);var n=r[e];if(delete r[e],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach((e=>e(o))),t)return t(o)},p=setTimeout(c.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=c.bind(null,i.onerror),i.onload=c.bind(null,i.onload),s&&document.head.appendChild(i)}},d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="/dist/",n=e=>new Promise(((t,o)=>{var r=d.miniCssF(e),n=d.p+r;if(((e,t)=>{for(var o=document.getElementsByTagName("link"),r=0;r<o.length;r++){var n=(s=o[r]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(n===e||n===t))return s}var i=document.getElementsByTagName("style");for(r=0;r<i.length;r++){var s;if((n=(s=i[r]).getAttribute("data-href"))===e||n===t)return s}})(r,n))return t();((e,t,o,r)=>{var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onerror=n.onload=i=>{if(n.onerror=n.onload=null,"load"===i.type)o();else{var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.href||t,d=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");d.code="CSS_CHUNK_LOAD_FAILED",d.type=s,d.request=a,n.parentNode.removeChild(n),r(d)}},n.href=t,document.head.appendChild(n)})(e,n,t,o)})),i={55198:0},d.f.miniCss=(e,t)=>{i[e]?t.push(i[e]):0!==i[e]&&{57468:1,75980:1}[e]&&t.push(i[e]=n(e).then((()=>{i[e]=0}),(t=>{throw delete i[e],t})))},(()=>{var e={55198:0};d.f.j=(t,o)=>{var r=d.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else if(75980!=t){var n=new Promise(((o,n)=>r=e[t]=[o,n]));o.push(r[2]=n);var i=d.p+d.u(t),s=new Error;d.l(i,(o=>{if(d.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var n=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+n+": "+i+")",s.name="ChunkLoadError",s.type=n,s.request=i,r[1](s)}}),"chunk-"+t,t)}else e[t]=0},d.O.j=t=>0===e[t];var t=(t,o)=>{var r,n,[i,s,a]=o,l=0;for(r in s)d.o(s,r)&&(d.m[r]=s[r]);if(a)var u=a(d);for(t&&t(o);l<i.length;l++)n=i[l],d.o(e,n)&&e[n]&&e[n][0](),e[i[l]]=0;return d.O(u)},o=self.webpackChunkvk=self.webpackChunkvk||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var l=d.O(void 0,[76429,75514,24509,56990,98066,76400,40885,68592,25901],(()=>d(629497)));l=d.O(l)})();