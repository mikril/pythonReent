(self.webpackChunkvk=self.webpackChunkvk||[]).push([[550],{565573:(e,t,r)=>{"use strict";function i(){return{icon:'<svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.93 15.39A1.5 1.5 0 0 1 4 14v-1.5c-.23 0-.47 0-.68-.02-.26-.02-.6-.07-.95-.25a2.5 2.5 0 0 1-1.35-2.05 10206.9 10206.9 0 0 0 0-6.36c.02-.26.07-.6.25-.95a2.5 2.5 0 0 1 2.05-1.35c.23-.02.5-.02.74-.02h7.88c.24 0 .51 0 .74.02.26.02.6.07.96.25a2.5 2.5 0 0 1 1.34 2.05 13234.83 13234.83 0 0 0 0 6.36c-.02.26-.07.6-.25.96a2.5 2.5 0 0 1-2.05 1.34c-.23.02-.5.02-.74.02H9.12l-2.56 2.56a1.5 1.5 0 0 1-1.63.33zM5.5 14v-2.2c0-.28 0-.42-.05-.53a.5.5 0 0 0-.22-.22C5.12 11 4.98 11 4.7 11h-.6c-.56 0-.84 0-1.05-.1a1 1 0 0 1-.44-.45c-.11-.21-.11-.49-.11-1.05V4.6c0-.56 0-.84.1-1.05a1 1 0 0 1 .45-.44C3.26 3 3.54 3 4.1 3h7.8c.56 0 .84 0 1.05.1a1 1 0 0 1 .44.45c.11.21.11.49.11 1.05v4.8c0 .56 0 .84-.1 1.05a1 1 0 0 1-.45.44c-.21.11-.49.11-1.05.11H9.16c-.24 0-.36 0-.48.03a1 1 0 0 0-.29.12c-.1.06-.19.15-.36.32z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"comment_outline_16"}}r.d(t,{getIcon16CommentOutline:()=>i})},892237:(e,t,r)=>{"use strict";function i(){return{icon:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.74 3.76c.35.34.35.9 0 1.23l-7.31 7.25a.88.88 0 0 1-1.25 0L2.26 9.36a.87.87 0 0 1 0-1.23.88.88 0 0 1 1.24 0l2.3 2.26 6.7-6.63a.88.88 0 0 1 1.24 0Z" fill="currentColor"/></svg>',name:"done_16"}}r.d(t,{getIcon16Done:()=>i})},729805:(e,t,r)=>{"use strict";function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" fill="none" viewBox="0 0 16 12"><path fill="currentColor" d="M4.45 3.7a.9.9 0 0 0-1.1 1.4l4.1 3.21a.9.9 0 0 0 1.1 0l4.1-3.2a.9.9 0 1 0-1.1-1.42L8 6.46 4.45 3.7Z"/></svg>',name:"dropdown_16"}}r.d(t,{getIcon16Dropdown:()=>i})},273293:(e,t,r)=>{"use strict";function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M13 6.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"/></svg>',name:"more_horizontal_16"}}r.d(t,{getIcon16MoreHorizontal:()=>i})},788382:(e,t,r)=>{"use strict";function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M14 11a5 5 0 1 0 0-10 5 5 0 0 0 0 10Zm.75-7.25a.75.75 0 1 0-1.5 0v1.5h-1.5a.75.75 0 0 0 0 1.5h1.5v1.5a.75.75 0 1 0 1.5 0v-1.5h1.5a.75.75 0 0 0 0-1.5h-1.5v-1.5ZM7.25 2.5H6.22c-.62 0-1.33 0-1.67.02-.47.04-.9.14-1.3.33a3.15 3.15 0 0 0-1.4 1.4c-.2.39-.3.83-.33 1.3-.03.33-.03.73-.02 1.19v4.04c0 .67 0 1.22.04 1.67.03.47.11.89.31 1.28a3.25 3.25 0 0 0 1.42 1.41c.4.2.81.28 1.28.32.27.03.59.03.95.04v1.6c0 .28 0 .53.02.73.01.19.17.46.4.72a1.52 1.52 0 0 0 1.92.19 6.91 6.91 0 0 0 .5-.45l2.79-2.79H15c2.35 0 3.38-1.5 3.5-3.12.03-.46-.18-.81-.56-.9-.31-.06-.86.03-.94.75-.12 1.13-.64 1.77-2 1.77h-4.14a.86.86 0 0 0-.58.22l-3.2 3.2-.04.04a8.76 8.76 0 0 1-.04.04v-2.75a.75.75 0 0 0-.75-.75c-.71 0-1.2 0-1.58-.03a1.86 1.86 0 0 1-.71-.16 1.75 1.75 0 0 1-.77-.77 1.87 1.87 0 0 1-.16-.7C3 11.94 3 11.45 3 10.74V6.81c0-.48 0-.85.02-1.14.03-.37.1-.58.17-.72.17-.33.43-.6.76-.77.14-.07.35-.13.72-.16.3-.03 1-.02 1.63-.02h.95a.75.75 0 0 0 0-1.5Z"/></svg>',name:"comment_add_badge_outline_20"}}r.d(t,{getIcon20CommentAddBadgeOutline:()=>i})},929222:(e,t,r)=>{"use strict";function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M11.53 4.26a.9.9 0 0 1 .1 1.18l-.09.1-5.49 5.56H20.1a.9.9 0 0 1 .11 1.8H6.05l5.5 5.57a.9.9 0 0 1 .06 1.18l-.08.1a.9.9 0 0 1-1.18.06l-.1-.08-7-7.1a.9.9 0 0 1-.07-1.17l.08-.1 7-7.1a.9.9 0 0 1 1.27 0Z"/></svg>',name:"arrow_left_outline_24"}}r.d(t,{getIcon24ArrowLeftOutline:()=>i})},22028:(e,t,r)=>{"use strict";function i(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12.47 4.26a.9.9 0 0 0-.1 1.18l.09.1 5.49 5.56H3.9a.9.9 0 0 0-.11 1.8h14.16l-5.5 5.57a.9.9 0 0 0-.06 1.18l.08.1a.9.9 0 0 0 1.18.06l.1-.08 7-7.1a.9.9 0 0 0 .07-1.17l-.08-.1-7-7.1a.9.9 0 0 0-1.27 0z" fill="currentColor"/></svg>',name:"arrow_right_outline_24"}}r.d(t,{getIcon24ArrowRightOutline:()=>i})},427053:(e,t,r)=>{"use strict";function i(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M5.26 5.26a.9.9 0 0 1 1.28 0L12 10.73l5.46-5.47a.9.9 0 0 1 1.28 1.28L13.27 12l5.47 5.46a.9.9 0 1 1-1.28 1.28L12 13.27l-5.46 5.47a.9.9 0 1 1-1.28-1.28L10.73 12 5.26 6.54a.9.9 0 0 1 0-1.28z" fill="currentColor"/></svg>',name:"cancel_outline_24"}}r.d(t,{getIcon24CancelOutline:()=>i})},281983:(e,t,r)=>{"use strict";function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M14.96 9.26a.9.9 0 0 1 1.28 1.28l-4.6 4.6a.9.9 0 0 1-1.28 0l-2.6-2.6a.9.9 0 0 1 1.28-1.28L11 13.23l3.96-3.97Z"/><path fill-rule="evenodd" d="M12 2.1a9.9 9.9 0 1 1 0 19.8 9.9 9.9 0 0 1 0-19.8Zm0 1.8A8.1 8.1 0 0 0 3.9 12a8.1 8.1 0 0 0 8.1 8.1 8.1 8.1 0 0 0 8.1-8.1A8.1 8.1 0 0 0 12 3.9Z" clip-rule="evenodd"/></svg>',name:"check_circle_outline_24"}}r.d(t,{getIcon24CheckCircleOutline:()=>i})},606126:(e,t,r)=>{"use strict";function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M17 3a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 1.5a.83.83 0 0 0-.83.74V7.17h-1.84a.83.83 0 0 0-.1 1.66H16.18v1.84a.83.83 0 0 0 1.66.1V8.82h1.84a.83.83 0 0 0 .1-1.66H17.82V5.33A.83.83 0 0 0 17 4.5ZM7.86 4c-.67 0-1.22 0-1.68.04a3.5 3.5 0 0 0-1.32.33 3.4 3.4 0 0 0-1.49 1.49c-.21.41-.3.85-.33 1.32C3 7.64 3 8.2 3 8.87v4.28c0 .66 0 1.22.04 1.67.04.48.12.92.33 1.33a3.4 3.4 0 0 0 1.49 1.49c.41.21.85.3 1.32.33.27.03.58.03.92.04v1.18c0 .42 0 .79.03 1.08.02.27.08.69.36 1.02.34.4.85.62 1.38.58.44-.03.77-.28.98-.45.23-.19.5-.45.8-.74L13.36 18h3.86c.41 0 1.64 0 2.62-.88a3.14 3.14 0 0 0 1-1.73v-.01l.01-.02a.9.9 0 0 0-1.71-.54 1.82 1.82 0 0 0-.05.15V15a1.45 1.45 0 0 1-.08.28 1.34 1.34 0 0 1-.37.5c-.44.4-1.04.42-1.45.42H13a.9.9 0 0 0-.63.26l-2.96 2.9-.5.49a27.38 27.38 0 0 1-.01-.7V17.1a.9.9 0 0 0-.9-.9h-.1c-.72 0-1.2 0-1.57-.03a1.77 1.77 0 0 1-.66-.14 1.6 1.6 0 0 1-.7-.7c-.06-.12-.11-.3-.14-.66-.03-.37-.03-.85-.03-1.57V8.9c0-.71 0-1.2.03-1.57.03-.36.08-.54.14-.65a1.6 1.6 0 0 1 .7-.7c.12-.06.3-.12.66-.15.37-.03.85-.03 1.57-.03H10A.9.9 0 1 0 10 4H7.86Z"/></svg>',name:"comment_add_badge_outline_24"}}r.d(t,{getIcon24CommentAddBadgeOutline:()=>i})},953590:(e,t,r)=>{"use strict";function i(){return{icon:'<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 0a12 12 0 1 1 0 24 12 12 0 0 1 0-24zm4.74 7.26a.9.9 0 0 0-1.28 0L12 10.73 8.54 7.26l-.1-.08a.9.9 0 0 0-1.18.08l-.08.1a.9.9 0 0 0 .08 1.18L10.73 12l-3.47 3.46a.9.9 0 1 0 1.28 1.28L12 13.27l3.46 3.47.1.08a.9.9 0 0 0 1.18-.08l.08-.1a.9.9 0 0 0-.08-1.18L13.27 12l3.47-3.46a.9.9 0 0 0 0-1.28z" fill="currentColor"/></svg>',name:"dismiss_substract_24"}}r.d(t,{getIcon24DismissSubstract:()=>i})},980767:(e,t,r)=>{"use strict";function i(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="send_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="send_24__send_24"><path id="send_24__Rectangle-76" d="M0 0h24v24H0z"/><path d="M5.74 15.75a39.14 39.14 0 0 0-1.3 3.91c-.55 2.37-.95 2.9 1.11 1.78 2.07-1.13 12.05-6.69 14.28-7.92 2.9-1.61 2.94-1.49-.16-3.2C17.31 9.02 7.44 3.6 5.55 2.54c-1.89-1.07-1.66-.6-1.1 1.77.17.76.61 2.08 1.3 3.94a4 4 0 0 0 3 2.54l5.76 1.11a.1.1 0 0 1 0 .2L8.73 13.2a4 4 0 0 0-3 2.54Z" id="send_24__Mask" fill="currentColor"/></g></g></svg>',name:"send_24"}}r.d(t,{getIcon24Send:()=>i})},450558:(e,t,r)=>{"use strict";function i(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" fill="currentColor" viewBox="0 0 56 56"><path fill-rule="evenodd" d="M5.44 5.44a1.5 1.5 0 0 1 2.12 0l42 42a1.5 1.5 0 0 1-2.12 2.12L40.88 43H30.12l-9.14 9.14A2.92 2.92 0 0 1 16 50.07V43h-.96c-1.63 0-2.94 0-4-.09a7.7 7.7 0 0 1-2.95-.73 7.5 7.5 0 0 1-3.27-3.27 7.71 7.71 0 0 1-.73-2.95C4 34.9 4 33.6 4 31.96V19.05c0-1.63 0-2.94.09-4 .09-1.1.27-2.06.73-2.94a7.5 7.5 0 0 1 2.4-2.76L5.44 7.56a1.5 1.5 0 0 1 0-2.12Zm3.96 6.08a4.5 4.5 0 0 0-1.91 1.94c-.2.4-.34.91-.41 1.82C7 16.21 7 17.4 7 19.1v12.8c0 1.7 0 2.9.08 3.82.07.9.2 1.43.41 1.82a4.5 4.5 0 0 0 1.97 1.97c.4.2.91.34 1.82.41.93.08 2.12.08 3.82.08h2.4a1.5 1.5 0 0 1 1.5 1.5v8.38l9.44-9.44A1.5 1.5 0 0 1 29.5 40h8.38L9.4 11.52Zm35.32-.44C43.79 11 42.6 11 40.9 11H18a1.5 1.5 0 0 1 0-3h22.96c1.63 0 2.94 0 4 .09 1.1.09 2.06.28 2.95.73a7.5 7.5 0 0 1 3.27 3.28c.46.89.64 1.85.73 2.94.09 1.06.09 2.37.09 4v12.93c0 1.62 0 2.93-.09 4a7.71 7.71 0 0 1-.73 2.94 7.5 7.5 0 0 1-1.72 2.22 1.5 1.5 0 1 1-1.99-2.25 4.5 4.5 0 0 0 1.04-1.34c.2-.4.34-.91.41-1.82.08-.92.08-2.11.08-3.82V19.1c0-1.7 0-2.9-.08-3.82a4.8 4.8 0 0 0-.41-1.82 4.5 4.5 0 0 0-1.97-1.97c-.4-.2-.91-.34-1.82-.41Z" clip-rule="evenodd"/></svg>',name:"comment_slash_outline_56"}}r.d(t,{getIcon56CommentSlashOutline:()=>i})},622858:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});r(140561);var i=r(927766),a=r(67328),n=r(873589),o=r(342269),s=r(152278);function l(e,t,r){if((0,o.isObject)(t)?r=t:this._dragElClass=t,this.options=(0,o.extend)({dragThreshold:l.DRAG_THRESHOLD_DIST},r),this._contEl=(0,n.ge)(e),this._contEl){this._excludedCount=0;for(var i=0;i<this._contEl.children.length;i++)this._contEl.children[i].getAttribute("nodrag")&&this._excludedCount++;(0,s.addEvent)(this._contEl,"mousedown",this._ev_mousedown_handler=this._onMouseDown.bind(this)),(0,n.setStyle)(this._contEl,"position","relative"),this._inited=!0,this._updateScrollbar=this._initUpdaterScrollbar()}}l.AUTO_SCROLL_DY=10,l.DRAG_THRESHOLD_DIST=0,l.AUTO_SCROLL_DISTANCE_THRESHOLD=300,l.AUTO_SCROLL_GAP=300,l.prototype.destroy=function(){this._inited&&(this._inited=!1,this._deinitEvents(!0))},l.prototype._getParentDragItemEl=function(e){for(var t,r=e;r&&(t=(0,n.domPN)(r))!==this._contEl;)r=t;return r===this._curPlaceholderEl&&(r=null),r},l.prototype._onKey=function(e){e.keyCode===s.KEY.ESC&&this.isCurrentlyDragging()&&this._onMouseUp()},l.prototype._onMouseDown=function(e){if(!(this._disabled||0!=e.button||this._curDragEl||(0,n.attr)(e.target,"nodrag")||this._dragElClass&&!(0,n.domClosest)(this._dragElClass,e.target))){for(var t=e.target;t&&t!==window.document;){if((0,o.intval)((0,n.domData)(t,"nodrag")))return;t=(0,n.domPN)(t)}var r=this._getParentDragItemEl(e.target);if(r&&!(0,n.attr)(r,"nodrag")&&((0,n.re)((0,n.geByClass1)("ui_gridsorter_placeholder"),this._contEl),this._contInfo=this._contInfo||{prevSize:(0,n.getSize)(this._contEl)},this._ensureGridIsActual(),!(this._grid.length<=1))){var i=window.getComputedStyle(r),a=(0,n.getXY)(r);this._initial={candidateEl:r,x:e.clientX,y:e.clientY,itemMargin:{x:parseInt(i.marginLeft),y:parseInt(i.marginTop)},shift:{x:e.pageX-a[0],y:e.pageY-a[1]}},(0,s.addEvent)(document,"mousemove",this._ev_mousemove_handler=this._onMouseMove.bind(this)),(0,s.addEvent)(document,"mouseup",this._ev_mouseup_handler=this._onMouseUp.bind(this)),(0,s.addEvent)(document,"keydown",this._ev_keydown_handler=this._onKey.bind(this)),cur.cancelClick=!1,(0,s.cancelEvent)(e)}}},l.prototype._dist=function(e){return Math.abs(e.clientX-this._initial.x)+Math.abs(e.clientY-this._initial.y)},l.prototype._onMouseUp=function(e){var t=this._curDragEl,r=!e;if(this._curDragEl){this._curDragEl=null,(0,n.removeClass)(t,"ui_gridsorter_moveable_notrans"),this._curOverCell||(this._curOverCell={el:this._curPlaceholderEl,pos:(0,n.getXY)(this._curPlaceholderEl),size:(0,n.getSize)(this._curPlaceholderEl)});var i=this._curOverCell.pos,a=this._curOverCell.el,o=this._grid[this._curDragCellIndex],l=o&&o.size;(0,n.gpeByClass)("_ape_item_list",t)&&(i[0]+=20,i[1]+=20),l&&this._isShiftToLeft&&(i[1]-=l[1]-this._curOverCell.size[1]),setTimeout((()=>{if(r){for(var e=0,a=this._grid.length;e<a;e++){var n=this._grid[e];n.dirty&&this._setPos(n.el,{left:0,top:0})}this._setPos(t,this._initialCurDragPos)}else this._setPos(t,{left:i[0],top:i[1]})})),setTimeout((()=>{if((0,n.re)(this._curPlaceholderEl),(0,n.removeClass)(this._contEl,"ui_gridsorter_cont"),this.options.dragCls&&(0,n.removeClass)(t,this.options.dragCls),this._inited){var e;if(r){for(var i=this._grid.length,o=0;o<i;o++){var s=this._grid[o];s.dirty&&this._setPos(s.el,{left:null,top:null})}this._setPos(t,{left:null,top:null,width:null,height:null})}else{var l;e=this._isShiftToLeft?(0,n.domNS)(a):a,this._contEl.insertBefore(t,e);var d=-1,c=this._initial.hasInlineSize;this._setPos(t,{left:null,top:null}),c||(0,n.setStyle)(t,{width:null,height:null});for(var h=this._grid.length,p=0;p<h;p++){var u=this._grid[p];(u.dirty||u.el===t)&&(this._setPos(u.el,{left:null,top:null}),c||(0,n.setStyle)(u.el,{width:null,height:null}),u.pos=this._calcElementPos(u.el),u.dirty=!1),u.el===t?l=p:u.el===a&&(d=p)}if(d>=0){var g=this._grid.splice(l,1);this._grid.splice(d,0,g[0])}}(0,n.removeClass)(t,"ui_gridsorter_moveable"),this._curOverCell=this._curPlaceholderEl=null,r&&this.update(),this.options.onDragFinish&&this.options.onDragFinish(t),a!==t&&!r&&this.options.onReorder&&this.options.onReorder(t,e,(0,n.domPS)(t))}}),210),e&&this._dist(e)>5&&((0,s.cancelEvent)(e),cur.cancelClick=!0)}this._updateScrollbar(),this._deinitEvents(),t&&this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,t),r||t&&this._overEl&&this.options.onDragDrop&&(r=this.options.onDragDrop(this._overEl,t)),this._overEl=null},l.prototype._deinitEvents=function(e){e&&(this._onMouseUp(),(0,s.removeEvent)(this._contEl,"mousedown",this._ev_mousedown_handler)),clearTimeout(this._autoScrollTO),this._autoScrollTO=!1,this._ev_mousemove_handler&&(0,s.removeEvent)(document,"mousemove",this._ev_mousemove_handler),this._ev_mouseup_handler&&(0,s.removeEvent)(document,"mouseup",this._ev_mouseup_handler),this._ev_keydown_handler&&(0,s.removeEvent)(document,"keydown",this._ev_keydown_handler)},l.prototype._setPos=function(e,t){this.options.noPosTransform||!this._hasTranslateFeauture&&!(this._hasTranslateFeauture=window.getComputedStyle(e).getPropertyValue("transform"))?(0,n.setStyle)(e,(0,o.extend)({transform:null},t)):null===t.left||null===t.top?(0,n.setStyle)(e,{transform:null,top:null,left:null}):(0,n.setStyle)(e,{transform:"translate("+t.left+"px, "+t.top+"px)",top:null,pos:null})},l.prototype._recalc=function(){var e=this._curDragEl,t=this._curOverCell.el;if(this._initGrid(),t!==e){for(var r=0,i=!1,a=!1,n=this._grid.length,o=0;o<n;o++){var s=this._grid[o];if(s.el===e){i=!0;break}if(s.el===t){i=!1;break}}this._isShiftToLeft=i;for(var l=i?0:this._grid.length-1,d=i?this._grid.length:-1,c=i?1:-1,h=[0,0];l!==d;l+=c){var p=this._grid[l];if(2!==r)if(p.el!==e){if(p.el===t&&r++,1===r||2===r){var u=0,g=0;i?(u=a.pos[0]+h[0],g=a.pos[1]+h[1],h[0]+=p.size[0]-a.size[0],h[1]+=p.size[1]-a.size[1]):(h[0]+=a.size[0]-p.size[0],h[1]+=a.size[1]-p.size[1],u=a.pos[0]+h[0],g=a.pos[1]+h[1]),this._setPos(p.el,{left:u-p.pos[0],top:g-p.pos[1]}),p.dirty=!0}else p.dirty&&(this._setPos(p.el,{left:null,top:null}),p.dirty=!1);a=p}else r++,a=p;else p.dirty&&(this._setPos(p.el,{left:null,top:null}),p.dirty=!1),a=p}}else for(var m=this._grid.length,v=0;v<m;v++){var _=this._grid[v];_.el!==e&&_.dirty&&(_.dirty=!1,this._setPos(_.el,{left:null,top:null}))}},l.prototype.disable=function(){this._disabled=!0},l.prototype.enable=function(){this._disabled=!1,this._initGrid(!0)},l.prototype.update=function(){this._disabled||this._initGrid(!0)},l.prototype._ensureGridIsActual=function(){this._initGrid()},l.prototype._needGridUpdate=function(){if(!this._grid)return 1;this._contInfo.prevSize=this._contInfo.prevSize||(0,n.getSize)(this._contEl);var e=0,t=this._contEl.children.length-this._excludedCount-(0,o.intval)(!!this._curPlaceholderEl);if(t!==this._grid.length)e=t>this._grid.length?2:1,this._contInfo.prevSize=(0,n.getSize)(this._contEl);else{var r=(0,n.getSize)(this._contEl),i=this._contInfo.prevSize;(Math.abs(i[0]-r[0])>5||Math.abs(i[1]-r[1])>5)&&(e=1),this._contInfo.prevSize=r}return e},l.prototype._initGrid=function(e){var t=e?1:this._needGridUpdate();if(t){1===t&&(this._grid=[],this._contInfo&&(delete this._contInfo.pos,delete this._contInfo.size));var r=this._grid?this._grid[this._grid.length-1]:null;this._grid=this._grid||[];var i,a=!!r,o=this._contEl.children;if(o.length)for(var s=this._getItemMargins(),l=this._curDragEl?this._grid.length:0,d=o.length;l<d;l++){var c=o[l];r&&c===r.el?a=!1:a||c===this._curPlaceholderEl||c.getAttribute("nodrag")||((i=(0,n.getSize)(c))[0]+=s[0],i[1]+=s[1],this._grid.push({el:c,size:i,pos:this._calcElementPos(c)}))}}},l.prototype._getRelativeMousePos=function(e){var t=this._getContPos(),r=this._getContShift();return{left:e.clientX-t[0]-r[0],top:e.clientY-t[1]-r[1]}},l.prototype._updateDraggablePosition=function(e){if(this._curDragEl){var t=this._getRelativeMousePos(e),r=this._getItemShift(),i=this._getContShift(),a=this._getContSize(),o=t.top-this._initial.shift.y-r[1]+i[1];this.options.limitBottomMove&&(o=Math.min(o,a[1]+30)),(0,n.hasClass)(this._contEl,"_ape_item_list")&&(o+=this._contEl.scrollTop),this._setPos(this._curDragEl,{left:t.left-this._initial.shift.x-r[0]+i[0],top:o}),window.AudioPage&&window.AudioPage.onUpdateDraggablePosition&&window.AudioPage.onUpdateDraggablePosition()}},l.prototype._getContShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.shift){var e=window.getComputedStyle(this._contEl);this._contInfo.shift=[parseFloat(e.paddingLeft),parseFloat(e.paddingTop)]}return this._contInfo.shift},l.prototype._getContSize=function(){return this._contInfo=this._contInfo||{},this._contInfo.size=(0,n.getSize)(this._contEl),this._contInfo.size},l.prototype._getContPos=function(){return this._contInfo=this._contInfo||{},this._contInfo.pos=(0,n.getXY)(this._contEl),this._contInfo.pos[1]-=(0,i.scrollGetY)(),this._contInfo.pos},l.prototype._getItemShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemShift){var e=window.getComputedStyle((0,n.domFC)(this._contEl));this._contInfo.itemShift=[parseFloat(e.marginLeft),parseFloat(e.marginTop)]}return this._contInfo.itemShift},l.prototype._getItemMargins=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemMargins){var e=window.getComputedStyle((0,n.domFC)(this._contEl));this._contInfo.itemMargins=[parseFloat(e.marginLeft)+parseFloat(e.marginRight),parseFloat(e.marginTop)+parseFloat(e.marginBottom)]}return this._contInfo.itemMargins},l.prototype._calcElementPos=function(e){var t=this._getContShift(),r=this._getItemShift();return[e.offsetLeft-t[0]-r[0],e.offsetTop-t[1]-r[1]]},l.prototype.isCurrentlyDragging=function(){return!!this._curDragEl},l.prototype._initUpdaterScrollbar=function(){return(0,a.throttle)((e=>{var t=this.options.wrapNode||e,r=(0,n.data)(t,"sb");r&&r.update(!1,!0)}),500)},l.prototype._onMouseMove=function(e){var t=()=>this.options.wrapNode?this.options.wrapNode.scrollTop:(0,i.scrollGetY)(),r=e=>{this.options.wrapNode?this.options.wrapNode.scrollTop=e:(0,i.scrollToY)(e,0,!1,!0)};if(this._curDragEl){this._ensureGridIsActual(),!e&&(e={clientX:this._lastMousePos.x,clientY:this._lastMousePos.y}),this._lastMousePos={x:e.clientX,y:e.clientY},this._updateDraggablePosition(e);var a=this._getContSize(),o=this._getRelativeMousePos(e),l=!1;if((0,n.hasClass)(this._contEl,"_ape_item_list")&&(o.top+=this._contEl.scrollTop),o.left>0&&o.left<a[0]&&o.top>0&&o.top<a[1])for(var d=0,c=this._grid.length-1,h=50;h;){var p=d+Math.floor((c-d)/2),u=this._grid[p];if(o.left>u.pos[0]&&o.top>u.pos[1]&&o.left<u.pos[0]+u.size[0]&&o.top<u.pos[1]+u.size[1]){l=u;break}if(d===c)break;o.top<u.pos[1]||o.left<u.pos[0]&&o.top<u.pos[1]+u.size[1]?c=c===p?c-1:p:d=d===p?d+1:p,h--}else{for(var g,m,v,_=this._grid.length,f=999999,y=0;y<_;y++){var b=this._grid[y],C=(m=o.left-(b.pos[0]+b.size[0]/2))*m+(v=o.top-(b.pos[1]+b.size[1]/2))*v;f>C&&(f=C,g=b)}l=g}!l||this._curOverCell&&this._curOverCell.el===l.el||(this._curOverCell=l,this._recalc());var w,E,P,S,A=0;if(this.options.wrapNode)w=S=this.options.wrapNode,E=(0,n.getSize)(w),(P=(0,n.getXY)(w))[1]-=(0,i.scrollGetY)(),A=e.clientY;else{var I=window,L=document.documentElement,T=document.body,x=I.innerWidth||L.clientWidth||T.clientWidth,M=I.innerHeight||L.clientHeight||T.clientHeight;S=I.bodyNode,E=[x,M],P=[0,0],A=e.clientY}var B=Math.max(20,E[1]/10),O=P[1]+B-A,k=B-(P[1]+E[1]-A);if(k>0||O>0){var R=Math.min(1,O/B),D=Math.min(1,k/B);this._autoScrollTO||(this._autoScrollTO=setTimeout((()=>{this._autoScrollTO=!1;var e=t();r(e+16*(R>0?-R:D)),e!==S.scrollTop&&(this._updateScrollbar(S),this._onMouseMove())}),20))}if(this.options.onDragOverElClass){var H=e.target;(0,n.hasClass)(H,this.options.onDragOverElClass)||(H=(0,n.gpeByClass)(this.options.onDragOverElClass,H))?this._overEl!==H&&(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this.options.onDragEnter&&this.options.onDragEnter(H,this._curDragEl),this._overEl=H):(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this._overEl=null)}}else if(this._dist(e)>this.options.dragThreshold){this._curDragEl=this._initial.candidateEl;for(var j=this._grid.length,W=0;W<j;W++)if(this._grid[W].el===this._curDragEl){this._curDragCellIndex=W;break}this.options.dragCls&&(0,n.addClass)(this._curDragEl,this.options.dragCls);var N=(0,n.getSize)(this._curDragEl),z=(0,n.getXY)(this._curDragEl),F=window.getComputedStyle(this._curDragEl),U=this._getContPos();this._initial.hasInlineSize=!(!this._curDragEl.style.width&&!this._curDragEl.style.height),(0,n.setStyle)(this._curDragEl,{width:N[0],height:N[1]}),this._initialCurDragPos={left:z[0]-U[0],top:z[1]-U[1]-document.body.scrollTop},this._curPlaceholderEl=(0,n.ce)("div",{className:"ui_gridsorter_placeholder"}),(0,n.setStyle)(this._curPlaceholderEl,{width:N[0]+parseFloat(F.marginLeft)+parseFloat(F.marginRight),height:N[1]+parseFloat(F.marginTop)+parseFloat(F.marginBottom)}),this._contEl.insertBefore(this._curPlaceholderEl,this._curDragEl),(0,n.addClass)(this._curDragEl,"ui_gridsorter_moveable"),(0,n.addClass)(this._curDragEl,"ui_gridsorter_moveable_notrans"),(0,n.addClass)(this._contEl,"ui_gridsorter_cont"),this._onMouseMove(e),this._updateDraggablePosition(e),this.options.onDragStart&&this.options.onDragStart(this._curDragEl)}(0,s.cancelEvent)(e)};const d=l},650588:(e,t,r)=>{"use strict";r.d(t,{ParagraphType:()=>o,ResizableObjectTypes:()=>s,ObjectResizeType:()=>l,ArticleStatsEvents:()=>d,getAppropriateImage:()=>c,preloadImage:()=>p,mailruStatsPixel:()=>u,getUrlParam:()=>g,changeHeightInstagramEmbed:()=>m,ALLOWED_FILE_TYPES_FOR_PASTE:()=>v,isArticleEditorAvailable:()=>_});var i=r(733164),a=r(840060),n=r(961540),o={Text:1,Header1:2,Header2:3,Header3:4,Code:5,NumericList:6,BulletList:7,Quote:8,Quote2:9,Table:10,TableRow:11,TableCell:12,ObjectAudioPlaylist:100,ObjectPhoto:101,ObjectVideo:102,ObjectGIF:103,ObjectPodcast:104,ObjectAudio:105,ObjectTwitter:106,ObjectFacebook:107,ObjectInstagram:108,ObjectVK:109,ObjectTelegram:110,ObjectPoll:111,ObjectMarketItem:112,ObjectAliExpressProduct:113},s=[o.ObjectPhoto,o.ObjectGIF,o.ObjectVideo,o.ObjectTwitter,o.ObjectFacebook,o.ObjectInstagram,o.ObjectVK,o.ObjectTelegram],l={Normal:0,Float:1,Medium:2,Large:3},d={clickOnVideo:"click_on_video",clickOnAudio:"click_on_audio",clickOnPhoto:"click_on_photo",clickOnExternalLink:"external_link_click",clickOnCarouselNext:"click_on_carousel_next",clickOnCarouselPrev:"click_on_carousel_prev",clickOnMentions:"click_on_mentions",nightModeOn:"night_mod_on",nightModeOff:"night_mod_off",close:"close"};function c(e,t,r){var a=[];if((0,i.each)(e,(function(e,t){r&&!["w","z","y","x","m","s"].includes(e)||a.push(t)})),!a.length)return[!1];a.sort((function(e,t){return e[1]-t[1]})),t*=window.devicePixelRatio>=2?2:1;var n=a[a.length-1];return(0,i.each)(a,(function(e,r){if(r[1]>=t)return n=r,!1})),n}var h={};function p(e,t){if(!0===h[e])return t&&t(),!0;if(Array.isArray(h[e]))return h[e].push(t),!1;h[e]=[t];var r=new Image;return r.onload=function(){var t=h[e];h[e]=!0,(0,i.each)(t,(function(e,t){t&&t()}))},r.src=e,!1}function u(e,t){if((0,i.isObject)(t)&&!(0,i.isEmpty)(t)){var r="https://vk-callback.go.mail.ru/longread_pxl?action="+e;(0,i.each)(t,(function(e,t){r+="&"+e+"="+t})),(new Image).src=r}}function g(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t||location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function m(e){if(/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(e.origin)){var t=function(e){for(var t,r=document.getElementsByTagName("iframe"),i=r.length-1;i>=0;i--){var a=r[i];if(a.contentWindow===e.source){t=a;break}}return t}(e);if(t){try{e=JSON.parse(e.data)}catch(e){}"object"==typeof e&&"string"==typeof e.type&&"object"==typeof e.details&&setTimeout((function(){if("MEASURE"===e.type){var r=e.details.height;t.setAttribute("height",r)}}),100)}}}var v="*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF";function _(){return!(0,n.isMvk)()&&!(a.browser.msie&&parseInt(a.browser.version)<=11)}},614537:(e,t,r)=>{"use strict";r.d(t,{Scroll:()=>a});var i=r(570655),a=function(){function e(e){var t;this.xScrollBarContainer=null,this.xScrollBarOuter=null,this.xScrollBarInner=null,this.handleMouseDownX=this.handleMouseDownX.bind(this),this.handleMouseMoveX=this.handleMouseMoveX.bind(this),this.handleMouseUpX=this.handleMouseUpX.bind(this),this.handleScrollContent=this.handleScrollContent.bind(this),this.handleClickXOuter=this.handleClickXOuter.bind(this),e.articleScroll=this,this.container=e,this.container.classList.add("ArticleScrollWrapper"),this.content=document.createElement("div"),this.content.classList.add("ArticleScrollContent"),this.content.setAttribute("contenteditable","false"),this.content.addEventListener("scroll",this.handleScrollContent),(t=this.content).append.apply(t,(0,i.__spreadArray)([],(0,i.__read)(Array.from(this.container.children)),!1)),this.container.append(this.content),this.update()}return e.prototype.handleMouseDownX=function(e){this.scrollLeft=this.content.scrollLeft,this.mouseX=e.clientX,document.addEventListener("mousemove",this.handleMouseMoveX),document.addEventListener("mouseup",this.handleMouseUpX),this.onDragStart&&this.onDragStart()},e.prototype.handleMouseMoveX=function(e){var t=e.clientX-this.mouseX;this.content.scrollLeft=this.scrollLeft+t/this.scrollXRatio},e.prototype.handleMouseUpX=function(){document.removeEventListener("mousemove",this.handleMouseMoveX),document.removeEventListener("mouseup",this.handleMouseMoveX),this.onDragEnd&&this.onDragEnd()},e.prototype.handleScrollContent=function(){var e=this;requestAnimationFrame((function(){e.xScrollBarInner&&(e.onScrollX&&e.onScrollX(e.content.scrollLeft),e.xScrollBarInner.style.left=100*e.content.scrollLeft/e.content.scrollWidth+"%")}))},e.prototype.handleClickXOuter=function(e){if(this.xScrollBarOuter&&this.content&&e.target!==this.xScrollBarInner){var t=this.xScrollBarOuter.getBoundingClientRect(),r=(e.clientX-t.left)/t.width;this.content.scrollLeft=r*(this.content.scrollWidth-this.content.offsetWidth)}},e.prototype.updateXScrollBar=function(){var e,t=this.content;if(t.offsetWidth>=t.scrollWidth)return null===(e=this.xScrollBarContainer)||void 0===e||e.remove(),this.xScrollBarContainer=null,this.xScrollBarOuter=null,void(this.xScrollBarInner=null);this.xScrollBarContainer||(this.xScrollBarContainer=document.createElement("div"),this.xScrollBarContainer.classList.add("ArticleScrollBarContainer","ArticleScrollBarContainer--horizontal"),this.xScrollBarOuter=document.createElement("div"),this.xScrollBarOuter.classList.add("ArticleScrollBarOuter"),this.xScrollBarInner=document.createElement("div"),this.xScrollBarInner.classList.add("ArticleScrollBarInner"),this.xScrollBarInner.addEventListener("mousedown",this.handleMouseDownX),this.xScrollBarOuter.addEventListener("click",this.handleClickXOuter),this.xScrollBarContainer.append(this.xScrollBarOuter),this.xScrollBarOuter.append(this.xScrollBarInner),this.container.append(this.xScrollBarContainer)),this.scrollXRatio=this.content.offsetWidth/this.content.scrollWidth,this.xScrollBarInner&&(this.xScrollBarInner.style.width=100*this.scrollXRatio+"%")},e.prototype.update=function(){this.updateXScrollBar()},e.prototype.setScrollX=function(e){this.content.scrollLeft=e},e.prototype.hideScrollX=function(){this.xScrollBarContainer&&(this.xScrollBarContainer.style.visibility="hidden")},e.prototype.showScrollX=function(){this.xScrollBarContainer&&(this.xScrollBarContainer.style.visibility="visible")},e}()},859456:(e,t,r)=>{"use strict";r.d(t,{TOP_DOMAINS:()=>n,OUR_DOMAINS:()=>s,VK_DOMAIN:()=>l,RE_DOMAIN_PATTERN:()=>d});var i=r(570655),a=r(961540),n=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)("aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,ibm,icbc,ice,icu,id,ie,ieee,ifm,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,loan,loans,local,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,vermögensberater,vermögensberatung,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yu,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw".split(",")),!1),(0,i.__read)("бг,бел,дети,ею,католик,ком,мкд,мон,москва,онлайн,орг,рус,рф,сайт,срб,укр".split(",")),!1),(0,i.__read)("qxam,90ae,90ais,d1acj3b,e1a4c,80aqecdr1a,j1aef,d1alf,l1acc,80adxhks,80asehdb,c1avg,p1acf,p1ai,80aswg,90a3ac,j1amh,80ao21a,y9a3aq,9dbq2a,mgbca7dzdo,mgba3a3ejt,mgbayh7gpa,lgbbat1ad8j,mgberp4a5d4ar,mgba7c0bbn0a,mgbc0a9azcg,mgb2ddes,mgbaam7a8h,mgba3a4f16a,mgbbh1a,mgbab2bd,ngbe9e0a,mgbbh1a71e,pgbs0dh,mgbpl2fh,ogbpf8fl,ngbc5azd,mgbtx2b,mgb9awbf,ygbi2ammx,wgbl6a,mgbi4ecexp,fhbei,wgbh1c,mgbx4cd0ab,mgbb9fbpob,4gbrim,mgbt3dhd,mgbai9azgqp6j,mgbgu82a,11b4c3d,c2br7g,h2brj9c,h2breg3eve,h2brj9c8c,i1b6b1a6a2e,54b7fta0cc,45brj9c,45br5cyl,s9brj9c,gecrj9c,3hcrj9c,xkc2dl3a5ee0h,xkc2al3hye2a,clchc0ea0b2g2a9gcd,fpcrj9c3d,2scrj9c,rvc1e0am3e,fzc2c9e2c,42c2d9a,o3cw4h,node,q9jyb4c,gckr3f0f,qcka1pmc,tckwe,cck2b3b,1ck2e1b,bck1b9a5dre4c,eckvdtc9d,rhqv96g,fiq64b,fiqs8s,fiqz9s,fiq228c5hs,vhquv,1qqw23a,vuq861b,nyqy26a,45q11c,55qx5d,55qw42g,kprw13d,kpry57d,czru2d,czrs0t,czr694b,w4rs40l,w4r85el8fhu5dnra,3ds443g,3oq18vl8pn36a,pssy2u,tiq49xqyj,fjq720a,fct429k,estv75g,xhq521b,9krt00a,30rr7y,6qq986b3xl,kput3i,kpu716f,zfr164b,mxtq1m,yfro4i67o,efvy88h,9et52u,rovu88b,nqv7f,b4w605ferd,unup4y,mix891f,mix082f,3pxu8k,pbt977c,6frz82g,nqv7fs00ema,ses554g,hxt814e,5tzm5g,io0a7i,8y0a063a,jlq61u9w7b,flw351e,g2xx48c,gk3at1e,3bst00m,fzys8d69uvgm,kcrx77d1x4a,jvr189m,imr513n,5su34j936bgsg,j6w193g,t60b56a,mk1bu44c,cg4bki,3e0b707e".split(",").map((function(e){return"xn--"+e}))),!1),o=a.VK_HOST_REGEX_GROUP_UNSAFE.source,s=new RegExp("^([a-zA-Z0-9\\.\\_\\-]+\\.)?("+o+"|vk\\.cc)$"),l=new RegExp("^(?:https?:\\/\\/)?(?:"+a.VK_SITES_REGEX_SOURCE_UNSAFE+")?\\/([a-zA-Z0-9\\._]+)\\??$"),d="((?:[a-z0-9_]*[a-z0-9])?(?:(?:\\.[a-z](?:[a-z0-9_]+[a-z0-9])?)*\\.[a-z][a-z0-9_]{2,40}[a-z0-9])?)"},474212:(e,t,r)=>{"use strict";r.d(t,{RE_URL_DOMAIN_NAME:()=>i,RE_URL_DOMAIN_TOP:()=>a,RE_URL_PATTERN:()=>n});var i="((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})",a="([A-Za-zа-яА-Я\\-\\d]{2,22})",n="(https?:\\/\\/)?"+("("+i+a+"(?:\\:(\\d{2,5}))?)")+"(([\\/?#])(?:\\&amp;|\\&#\\d{2,6};|,[_%]|!|,*[\\wА-Яа-я\\xa8\\xb8\\xc0-\\xffєЄҐґЇїІіЈј\\—\\-\\_@#%?+\\/\\$.~=;:'ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢄᢇ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞮꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ　-〿＀-￯*]+|(?:\\(|\\[)[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\d&#%;,]+(?:\\)|\\])){0,200})?"},820929:(e,t,r)=>{"use strict";r.d(t,{replaceHyperLinks:()=>d,linksReplacer:()=>c});var i=r(733164),a=r(474212),n=r(859456);function o(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,r=e[6].length-1;return"."===e[0][t]&&"."===e[6][r]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,r)),e}function s(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function l(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function d(e,t){for(var r,i=new RegExp(a.RE_URL_PATTERN,"ig"),l=n.TOP_DOMAINS.reduce((function(e,t){return Math.max(e,t.length)}),0),d=0,c=e;null!==(r=i.exec(e));){var h=(r=o(r))[0].length,p=r.index+h,u=e[r.index-1],g=e[p-1];if("@"!==e[p]||r[0]&&(!r[0]||r[0].toLowerCase().includes("http"))){var m=void 0!==u&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(u),v=void 0!==g&&/([:;$])/i.test(g);if(!m&&!v){var _=s(r),f=_.domain.toLowerCase();if(f.length<=l&&n.TOP_DOMAINS.includes(f)){var y=t(_);c=c.slice(0,r.index+d)+y+c.slice(p+d),d+=y.length-h}}}}return c}function c(e,t){void 0===t&&(t=55);var r=e.full,a=e.url,o=e.protocol,s=e.query;try{r=decodeURIComponent(r)}catch(e){}r.length>t&&(r=r.substr(0,t-2)+".."),r=l(r).replace(/\n/g," ");var d=(0,i.replaceEntities)(a+s);if(n.OUR_DOMAINS.test(a)){var c="",h=r.match(n.VK_DOMAIN);if(h)c=' mention_id="'+h[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"';return'<a href="'+l(o+a+s)+'" target="_blank" rel="noopener"'+c+">"+r+"</a>"}return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(o+d))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+(0,i.clean)((o+a+s).replace(/'/g,"\\'"))+"', {}, event);")+'">'+r+"</a>"}},985535:(e,t,r)=>{"use strict";r.d(t,{cleanParagraph:()=>s,getCleanedParagraph:()=>l,expandParagraphFields:()=>d});var i=r(570655),a=r(650588),n=r(83178),o=r(36534);function s(e,t){var r={type:a.ParagraphType.Text,lines:[],children:[]};for(var s in e)if(e.hasOwnProperty(s)){if(s.startsWith("_")){if("_uuid"!==s||!t)continue}else if(["id","parentId"].includes(s)&&!t)continue;var l=e[s];r[s]=(0,n.isObject)(l)||Array.isArray(l)?(0,o.clone)(l):l}return(0,n.isMediaParagraph)(e)&&e._object&&(r.mediaId=e._object.getMediaId()),e.sep&&(r.sep=1),r.lines.forEach((function(e){var t,r;if(e){if(void 0!==e.decorations){var a=!0;try{for(var n=(0,i.__values)(Object.entries(e.decorations)),o=n.next();!o.done;o=n.next()){var s=(0,i.__read)(o.value,2),l=s[0];0==s[1].length?delete e.decorations[l]:a=!1}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}a&&delete e.decorations}e.brs&&0==e.brs.length&&delete e.brs}})),r}function l(e,t,r){return r&&!(0,n.isMediaParagraph)(e)&&(0,n.isParagraphEmpty)(e)&&![a.ParagraphType.Code,a.ParagraphType.Header1].includes(e.type)?null:(0,o.clone)(s(e,t))}function d(e){return e.type=e.type||a.ParagraphType.Text,e.lines.forEach((function(e){e.brs=e.brs||[],e.decorations=e.decorations||{}})),e}},201240:(e,t,r)=>{"use strict";r.d(t,{Decorations:()=>i,DecorationTypes:()=>n});var i=[{type:"strong",tag:"strong"},{type:"em",tag:"em"},{type:"strike",tag:"strike"},{type:"link",tag:"a",attributes:[{name:"href",index:0,needClean:!0}]},{type:"code",tag:"code"},{type:"comment",tag:"span",attributes:[{name:"comment-id",index:0},{name:"class",value:"ArticleComments__text ArticleComments__text--hide"}]}],a={};i.forEach((function(e){a[e.tag]=e}));var n={};i.forEach((function(e){n[e.type]=e}))},563214:(e,t,r)=>{"use strict";r.d(t,{ArticleEditor:()=>ye});var i=r(570655),a=r(501389),n=r(601306),o=r(432158),s=r(790301),l=r(656682),d=r(621118),c=r(964104),h=r(650839),p=r(157853),u=r(892158),g=r(119162),m=r(641239),v=r(60014),_=r(24904),f=r(671981),y=r(746546),b=r(882206),C=r(560949),w=r(892318),E=r(83178),P=r(201240),S=r(650588),A=r(783898),I=r(595800),L=r(435030),T=r(985535),x=r(611460),M=r(219652),B=r(506127),O=r(265242),k=r(887560),R=r(325499),D=r(840374),H=r(387685),j=r(713137),W=r(275419),N=r(563365),z=r(826383),F=r(118593),U=r(154313),q=r(361865),V=r(316178),G=r(262004),X=r(980889),K=r(861626),Z=r(60726),Y=r(669783),Q=r(298484),$=r(222105),J=r(300426),ee=r(162129),te=r(310469),re=r(455877),ie=r(390237),ae=r(36534),ne=r(70162),oe=r(274642),se=r(146143),le=r(517920),de=r(961540),ce=r(82160),he=r(333773),pe=r(606126),ue=r(659397),ge=r(489313),me=r(191381),ve=r(844142),_e=1;function fe(){return _e+++"-"+Date.now()%1e6+"-"+Math.floor((0,ae.rand)(0,99999))}var ye=function(){function e(e,t,r,a){var l=this;window.cur.lang=Object.assign({},window.cur.lang,a.lang),this._options=a;var d="string"==typeof e?document.querySelector("#"+e):e;if(d instanceof HTMLElement){if(this._els={editor:d,canvas:(0,ie.createElement)('<div class="article_editor_canvas article_edit article" contenteditable="true"></div>'),photoUpload:(0,ie.createElement)('<div class="article_photo_upload"></div>')},this._els.editor.appendChild(this._els.canvas),this._els.editor.appendChild(this._els.photoUpload),this._els.editor.classList.add("article_editor"),this.selection=new n.SelectionManager(this,this._els),this.cursor=new o.CursorManager(this,this._els),this.history=new s.HistoryManager(this,100),this.getOptions().modules.comments&&(this.comments=new he.ArticleComments(this,this._els)),this._dirty=[],this.store={},this._ps=[],this._objects={},this.floatedObjects=[],(0,L.initLimits)(a.limits),a.postData){var c=[];c.push(this.buildParagraph({type:S.ParagraphType.Header1})),(a.postData.text||"").replace(/❤/g,"❤️").split("\n").forEach((function(e){e.trim()&&c.push(l.buildParagraph({type:S.ParagraphType.Text,lines:[{text:(0,ae.clean)(e)}]}))})),r=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(c),!1),(0,i.__read)(r),!1)}0==r.length&&r.push(this.buildParagraph({type:this._options.noTitle?S.ParagraphType.Text:S.ParagraphType.Header1})),this.traverseModelTree(r,(function(e){a.needIndexCorrection&&(0,E.correctRealIndexes)(e,1),e.lines.forEach((function(e){e.text=(0,E.replaceParagraphEntities)(e.text),e.brs&&(0,E.isObject)(e.brs)&&(e.brs=(0,E.convertBRsToArray)(e.brs))}))})),this.isLocked()||(this.drag=new ce.ArticleEditorDrag(this,this._els)),this.initParagraphs(r),this._updateTextPlaceholders(),a.postData&&this._ps.length?n.SelectionManager.setCaretAtElement(this.getParagraphElById(this._ps[0])):this.cursor.restoreLastCursor(),this.saveDraft(!1,!0),a.coverPhoto&&this.setCoverPhoto(a.coverPhoto,!1),(this._options.isPublished||this._options.wasPublished)&&this.setPublishName(t.name),this.updateWarnInfos(),this._publishNameCandidate=a.name||this._getName(),this.history.saveUndoState(),this.wasPublishedInCurrentSession=!1,this._openTime=Date.now(),window.stManager.add([window.jsc("web/audio.js")]).catch((function(){}))}}return e.prototype.getState=function(){return{ps:this._ps,store:this.store}},e.prototype.getModelTree=function(){var e=this,t=function(r){var a=e.store[r];if(!a)return null;var n=(0,E.paragraphHasChildren)(a)?a.children:[];return(0,i.__assign)((0,i.__assign)({},a),{children:n.reduce((function(e,r){var a=t(r);return a?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e),!1),[a],!1):e}),[])})};return this._ps.reduce((function(e,r){var a=t(r);return a?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e),!1),[a],!1):e}),[])},e.prototype.traverseModelTree=function(e,t,r){var a,n;void 0===r&&(r=null);try{for(var o=(0,i.__values)(e),s=o.next();!s.done;s=o.next()){var l=s.value,d=void 0;if(void 0!==(d=t(l,r)))return d;if(void 0!==(d=this.traverseModelTree(l.children||[],t,l)))return d}}catch(e){a={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}},e.prototype.mapModelTree=function(e,t){var r=this;return e.reduce((function(e,a){var n=function(e){var a=t(e);return a?(0,i.__assign)((0,i.__assign)({},a),{children:r.mapModelTree(e.children||[],t)}):null}(a);return n?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e),!1),[n],!1):e}),[])},e.prototype.setState=function(e,t){this._ps=e,this.store=t},e.prototype.updateWarnInfos=function(){this.showWarningInfo(),this.showEditLockInfo(),this.showRevEditInfo()},e.prototype._setEventListener=function(e,t,r){this._events=this._events||[],this._events.push({el:e,event:t,handler:r}),e.addEventListener(t,r)},e.prototype.setCoverPhoto=function(e,t){void 0===t&&(t=!0),this._coverPhoto=e,this._options.isPublished||this.saveDraft(t)},e.prototype.getCoverPhoto=function(){return!1!==this._coverPhoto&&(this._coverPhoto?this._coverPhoto:void 0)},e.prototype.getFirstCoverPhotoFromParagraphs=function(){var e=!1;return this.traverseParagraphs((function(t){if(!e&&(0,E.isPhotoParagraph)(t)&&t._object){var r=t._object.getMediaId(0);e={id:r,data:I.ArticleEditorPreparedData.get(S.ParagraphType.ObjectPhoto,r)}}})),e},e.prototype.getPublishName=function(){return this._publishName||this._publishNameCandidate||this._getName()},e.prototype.getTimeSpent=function(){return Math.round((Date.now()-this._openTime)/1e3)},e.prototype.setPublishName=function(e){this._publishName=e,this._options.isPublished||this.saveDraft(!0)},e.prototype._updateTextPlaceholders=function(){if(!this._options.noTitle){var e=this._els.editor.querySelector("h1.article_paragraph"),t=this._els.editor.querySelector(".article_editor_canvas > p.article_paragraph:first-of-type"),r=this.getOptions(),a=r.placeholderTitle,n=r.placeholderParagraph;if(e)e.hasAttribute("data-placeholder")||e.setAttribute("data-placeholder",(0,ue.decodeHTMLEntities)(a)),(0,E.isParagraphEmpty)(this.getParagraphById(this._ps[0]))?e.classList.remove("article_paragraph--placeholderHidden"):e.classList.add("article_paragraph--placeholderHidden");if(t){t.hasAttribute("data-placeholder")||t.setAttribute("data-placeholder",(0,ue.decodeHTMLEntities)(n));var o=this.getParagraphById(this._ps[1]),s=!!o&&o.sep,l=(0,i.__read)(this.getCurrentParagraphId(),1)[0],d=this.getParagraphIndexById(l);(0,E.isParagraphEmpty)(o)&&(!o||!(0,E.isCodeParagraph)(o))&&"number"==typeof d&&d<2&&this._ps.length<=2&&!s?t.classList.remove("article_paragraph--placeholderHidden"):t.classList.add("article_paragraph--placeholderHidden")}}},e.prototype.destroy=function(){this._els.editor.innerHTML="",this._els.editor.classList.remove("article_editor"),this._formatTooltip&&this._formatTooltip.destroy(),this.resizeTooltip&&this.resizeTooltip.destroy(),this._objectPickerTooltip&&this._objectPickerTooltip.destroy(),this._events=this._events||[],this._events.forEach((function(e){e.el.removeEventListener(e.event,e.handler)})),delete window.cur.docsCurFilter},e.prototype.getLimits=function(){return this._options.limits},e.prototype.getOptions=function(){return this._options},e.prototype.getWidth=function(e){return void 0===e&&(e=!1),(0,ie.getSize)(this._els.canvas)[0]+(e?2*this._options.figureSideMargin:0)},e.prototype.getPhotoUploadOptions=function(){return this._options.photoUploadOptions},e.prototype.getPhotoUploadEl=function(){return this._els.photoUpload},e.prototype.getCanvasEl=function(){return this._els.canvas},e.prototype.getEditorEl=function(){return this._els.editor},e.prototype.removeObject=function(e){var t=this;this.traverseParagraphs((function(r){var i;if((0,E.isMediaParagraph)(r)&&r._object==e){var a=t.getParagraphElById(t.getNextParagraphIdById(r.id));return n.SelectionManager.setCaretAtElement(a),null===(i=t.getParagraphElById(r.id))||void 0===i||i.remove(),t.deleteParagraphById(r.id),t.setAllParagraphsDirty(),t._triggerInputEvent(),!1}}))},e.prototype._processPastedUrl=function(e,t){var r=this;if((0,E.isArticleParagraphId)(e)){var i=this.getParagraphById(e);i&&(0,E.isTextParagraph)(i)&&setTimeout((function(){r._processMatchingEmbeds(e,t)||(r._els.shareParseForm&&r._els.shareParseForm.remove(),r._els.shareIFrame&&r._els.shareIFrame.remove(),r._els.shareIFrame=r._els.editor.appendChild((0,ie.createElement)('<iframe class="editor__share_parse_iframe" name="editor__share_parse_iframe"></iframe>')),r._els.shareParseForm=r._els.editor.appendChild((0,ie.createElement)('<form action="share.php?act=url_attachment" method="post" target="editor__share_parse_iframe">\n                    <input type="hidden" name="hash" value="'+r._options.shareHash+'">\n                    <input type="hidden" name="url" value="'+t+'">\n                    <input type="hidden" name="index" value="1">\n                    <input type="hidden" name="force_media" value="1">\n                    <input type="hidden" name="from" value="article">\n                    <input type="hidden" name="owner_id" value="'+window.cur.oid+'">\n                  </form>')),window.onUploadFail=function(){},window.onUploadDone=function(t){var i;if(t){var a=t[2];if(a){var n,o=!1,s={};switch(t[0]){case"audio_playlist":o=S.ParagraphType.ObjectAudioPlaylist,s={accessHash:a.accessHash},t[1]=a.ownerId+"_"+a.id+(a.accessHash?"_"+a.accessHash:"");break;case"podcast":o=S.ParagraphType.ObjectPodcast,s={};break;case"poll":o=S.ParagraphType.ObjectPoll,s={editable:!1,snippet:a.snippet};break;case"doc":"gif"!=a.ext&&3!=a.type||(o=S.ParagraphType.ObjectGIF,(s={size:a.video_preview_size,video:a.video_preview,href:a.href||a.editable.href}).video||s.href||(o=!1));break;case"photo":o=S.ParagraphType.ObjectPhoto,s={size:(0,E.getPhotoSize)(a.editable.sizes),sizes:a.editable.sizes};break;case"video":o=S.ParagraphType.ObjectVideo,s={editable:a.editable,duration:a.editable.duration,platform:a.editable.platform}}if(o){var l=r.buildParagraph({type:o,mediaId:t[1],sep:(0,E.hasSeparator)(r.getParagraphById(e)),fromExtPage:Number(a.from_ext_page)});(0,E.isMediaParagraph)(l)&&(I.ArticleEditorPreparedData.add(o,l.mediaId,s),r._linkTooltip&&r._linkTooltip.hide(),(n=r.getParagraphById(r.getNextParagraphIdById(e)))&&(0,E.isMediaParagraph)(n)&&(null===(i=n._object)||void 0===i?void 0:i._mediaId)===l.mediaId||(r.getOrCreateParagraphObject(l),r.insertParagraphIdAfter(e,l.id),r._els.canvas.normalize(),r.redraw(!0,!0),r.history.saveUndoState(),setTimeout((function(){r.onObjectStateLoaded()}),10)))}}}},r._els.shareParseForm instanceof HTMLFormElement&&r._els.shareParseForm.submit())}),0)}},e.prototype._processMatchingEmbeds=function(e,t){var r,i,a,n=new RegExp("^(?:https?:\\/\\/)?(?:[a-z0-9\\_\\.-]*\\.)?(?:www.)?(?:"+de.VK_HOST_REGEX_GROUP_UNSAFE.source+")\\/(?:[a-z0-9\\_\\.-?]*w=)?wall(-?\\d+)_(\\d+)");if(r=t.match(/^https?:\/\/(?:www.)?twitter\.com\/(?:#!\/)?(?:\w+)\/status(?:es)?\/(\d+)$/))i=S.ParagraphType.ObjectTwitter,a=r[1];else if(r=t.match(/^https?:\/\/(?:www.)?instagram\.com\/p\/([a-zA-Z0-9_-]+)(?:\/embed)?(?:\/)?/))i=S.ParagraphType.ObjectInstagram,a=r[1];else if(r=t.match(/^https?:\/\/(?:www.)?facebook\.com\/(\w.+)\/posts\/(\d+)\/?$/))i=S.ParagraphType.ObjectFacebook,a=r[1]+";"+r[2];else if(r=t.match(n))i=S.ParagraphType.ObjectVK,a=r[1]+";"+r[2];else if(r=t.match(/^https?:\/\/(?:www.)?t\.me\/(\w.+)\/(\d+)/)){if(document.querySelector("#telegram-post-"+r[1]+"-"+r[2]))return!1;i=S.ParagraphType.ObjectTelegram,a=r[1]+";"+r[2]}if(!i||!a)return!1;var o=this.buildParagraph({_uuid:fe(),type:i,mediaId:a}),s=this.getParagraphById(this.getNextParagraphIdById(e));return s&&(0,E.isMediaParagraph)(s)&&s._object&&s._object._mediaId===o.mediaId||(this.getOrCreateParagraphObject(o),this.insertParagraphIdAfter(e,o.id),this._els.canvas.normalize(),this.redraw(!0,!0),this.history.saveUndoState()),!0},e.prototype._handleObjectPaste=function(e){var t,r,a=e.clipboardData||(null===(t=e.originalEvent)||void 0===t?void 0:t.clipboardData),n=null==a?void 0:a.getData("text/plain");if(n){var o=(0,i.__read)(n.split(":"),2),s=o[0],l=o[1];if("uuid"==s&&l){var d=document.querySelector('[data-uuid="'+l+'"]');if(d){var c=d.cloneNode(!0);c instanceof HTMLElement&&(c.setAttribute("data-force-update","1"),c.removeAttribute("data-id"));var h=(0,i.__read)(this.getCurrentParagraphId(),1)[0];null===(r=this.getParagraphElById(h))||void 0===r||r.after(c),e.preventDefault(),this.setAllParagraphsDirty(),this._triggerInputEvent()}}}},e.prototype._handlePlainTextPaste=function(e){var t,r,a,o=e.clipboardData,s=(0,i.__read)(this.getCurrentParagraphId(),1)[0],l=this.getParagraphIndexById(s),d=this.getParagraphById(s),c=(0,i.__read)(n.SelectionManager.getRange(),3),h=c[0],p=c[2];if(1===(null==o?void 0:o.types.length)&&"text/plain"===(null==o?void 0:o.types[0])&&h&&p&&d&&(0,E.isTextParagraph)(d)){var u=o.getData("text/plain").split("\n");if(u.length>1){this.history.saveUndoState();var g=u.shift();document.execCommand("insertText",!1,g),document.execCommand("insertParagraph");var m="number"==typeof l?this.getParagraphElByIndex(l+1):null;if(m)try{for(var v=(0,i.__values)(u),_=v.next();!_.done;_=v.next()){var f=_.value,y=document.createElement("p");y.innerHTML=f,null===(a=null==m?void 0:m.parentElement)||void 0===a||a.insertBefore(y,m)}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}return this._triggerInputEvent(),(0,ie.cancelEvent)(e)}}},e.prototype._handleLinkPasteToSelectedText=function(e){var t=window.getSelection(),r=null==t?void 0:t.getRangeAt(0),a=(0,i.__read)(this.getCurrentParagraphId(),2),n=a[0],o=a[1],s=e.clipboardData;if(t&&r&&!r.collapsed&&t.toString().trim()&&n===o&&1===(null==s?void 0:s.types.length)&&"text/plain"===(null==s?void 0:s.types[0])){if(n&&(0,E.isListParagraph)(this.getParagraphById(n)))if((0,ie.findClosestElementWithSelector)("li",r.startContainer)!==(0,ie.findClosestElementWithSelector)("li",r.endContainer))return;var l=s.getData("text/plain"),d=(0,ae.extractUrls)(l,!0);if(1===d.length){var c=d[0].url;this._setLinkToSelectedText(c),(0,ie.cancelEvent)(e)}}},e.prototype._handleLinkPaste=function(e){var t,r,a=this,o=(null===(r=e.clipboardData||(null===(t=e.originalEvent)||void 0===t?void 0:t.clipboardData))||void 0===r?void 0:r.items)||[];Array.from(o).forEach((function(e){if("string"===e.kind){var t=(0,i.__read)(a.getCurrentParagraphId(),1)[0];e.getAsString((function(e){var r=e.replace(/(<([^>]+)>)/gi,""),i=(0,ae.extractUrls)(r,!0);if(1===i.length){var o=(0,ae.replaceSpecialCharsInVkUrl)(i[0].url);a._processPastedUrl(t,o);var s=a.getParagraphElById(t);if(!s)return;(0,E.traverseTree)(s,(function(e){if(e.nodeType==Node.TEXT_NODE&&e.textContent&&e.textContent.includes(o)){var r=(0,ie.traverseParent)(e,(function(e){return e.tagName&&"a"==e.tagName.toLowerCase()}),3);if(r&&r instanceof HTMLElement&&r.getAttribute("href")!==o&&(r.setAttribute("href",o),a._setParagraphDirty(t),a._triggerInputEvent()),!r){a.cursor.saveCursorMarker();var i=e.textContent.indexOf(o);n.SelectionManager.setRange(e,i,e,i+o.length),a._setParagraphDirty(t||void 0),document.execCommand("createLink",!1,o),a.cursor.restoreCursorFromMarker()}}}),!1)}}))}}))},e.prototype._handlePhotoPaste=function(e){var t,r,a=this;this.photoPasteUploadingProcess=!1;var n=(null===(r=e.clipboardData||(null===(t=e.originalEvent)||void 0===t?void 0:t.clipboardData))||void 0===r?void 0:r.items)||[];for(var o in n)if("file"===n[o].kind&&!(0,E.checkFileType)(n[o].type))return(0,se.showFastBox)((0,ne.getLang)("global_error"),(0,ne.getLang)("pages_article_ed_paste_photo_file_error")),void e.preventDefault();Array.from(n).forEach((function(e){if("file"===e.kind){a.photoPasteUploadingProcess=!0;var t=e.getAsFile(),r=new FileReader;r.onload=function(){var e;a.photoPasteUploadingProcess=!1;var n=(0,i.__read)(a.getCurrentParagraphId(),1)[0];n=n||a._ps[0];var o,s=a.buildParagraph({type:S.ParagraphType.ObjectPhoto});a.getOrCreateParagraphObject(s),t&&(null===(e=s._object)||void 0===e||e.setBLOB(t,(function(){}),(function(){a.removeObject(a.getOrCreateParagraphObject(s)),a.forgetParagraphById(s.id)}))),(0,E.isParagraphEmpty)(a.getParagraphById(n))&&n!==a._ps[0]?(o=n,(0,E.hasSeparator)(a.getParagraphById(o))&&(s.sep=1),a.setParagraphById(o,s)):(o=a.getNextParagraphIdById(n),a.insertParagraphIdBefore(o,s.id)),a.redraw(!0,!0);var l=new Image;l.onload=function(){a.focusParagraph(a.getNextParagraphIdById(o)),a.showObjectPicker()},r.result&&(l.src=r.result.toString())},t&&r.readAsDataURL(t)}}))},e.prototype._hideFormatTooltip=function(){this._formatTooltip&&this._formatTooltip.isShown()&&this._formatTooltip.hide()},e.prototype._showFormatTooltip=function(){if(!this.isLocked()){clearTimeout(this._doShowFormatTooltipTO);try{var e=window.getSelection();if(e){if(e.focusNode instanceof HTMLElement&&(e.focusNode.classList.contains("article_set_link")||"input"==e.focusNode.nodeName.toLowerCase()))return;var t=!e.isCollapsed;this._doShowFormatTooltipTO=setTimeout(this._doShowFormatTooltip.bind(this,t),1)}}catch(e){}}},e.prototype._doShowFormatTooltip=function(e){var t=this;if(!this._formatTooltip){var r,a=(0,ie.createElement)('\n        <div>\n          <div class="article_format_btns clear_fix"></div>\n          <div class="article_set_link"><input type="text" placeholder="'+(0,ne.getLang)("pages_articles_enter_link")+'"/><div class="article_set_link_delete">'+(0,F.getIcon24CloseFilled)().icon+"</div></div>\n        </div>");this._formatTooltip=new le.ElementTooltip(this._els.editor,{cls:"article_format_tt",content:a,customShow:!0,offset:[0,2],onShow:function(){var e,r=t.selection.getCurrentSelectionState(),i=[];if(r){var n=r.header1||r.object&&!r.captionFocused||!(null===(e=r.selectedText)||void 0===e?void 0:e.length)||r.hasTable||r.hasRow||r.hasCell;n||(r&&r.inTable&&(i.push(["numeric_list","cur.articleEditor.setNumericList("+Number(!r.numericList)+")",!!r.numericList]),i.push(["bullet_list","cur.articleEditor.setBulletList("+Number(!r.bulletList)+")",!!r.bulletList])),r.justHeaders||i.push(["strong","cur.articleEditor.setStrong()",!!r.decorations.strong]),r.blockquote||r.justHeaders||i.push(["em","cur.articleEditor.setEm()",!!r.decorations.em]),i.push(["strike","cur.articleEditor.setStrike()",!!r.decorations.strike]),r.decorations.link?i.push(["link","cur.articleEditor.clearLink()",r.decorations.link]):i.push(["link","cur.articleEditor.setLinkMode(true)",r.decorations.link]),r.object||r.header1||r.list||r.inTable||(i.push(["header1","cur.articleEditor.setHeader1("+Number(r.header2)+")",r.header2]),i.push(["header2","cur.articleEditor.setHeader2("+Number(r.header3)+")",r.header3]),i.push(["quote","cur.articleEditor.setQuote()",r.blockquote||r.citequote]))),t.comments&&(!n||r.header1)&&r.selectedText&&i.push(["comment","cur.articleEditor.setComment(false, 'format')",!1])}if(0!=i.length){var o=a.querySelector(".article_format_btns");o?(o.innerHTML="",i.forEach((function(e,t){t>0&&["header1","comment"].includes(e[0])&&o.appendChild((0,ie.createElement)('<div class="article_format_divider"></div>'));var r=e[2]?"article_format_btn_active":"",a="";switch(e[0]){case"numeric_list":a=(0,x.getIcon24ListNumberFilled)().icon;break;case"bullet_list":a=(0,M.getIcon24ListBulletFilled)().icon;break;case"strong":a=(0,B.getIcon24BoldFilled)().icon;break;case"strike":a=(0,O.getIcon24CrossedFilled)().icon;break;case"em":a=(0,k.getIcon24ItalicFilled)().icon;break;case"header1":a=(0,R.getIcon24Header1Filled)().icon;break;case"header2":a=(0,D.getIcon24Header2Filled)().icon;break;case"quote":a=(0,H.getIcon24QuoteFilled)().icon;break;case"link":a=(0,U.getIcon24LinkFilled)().icon;break;case"comment":a=(0,pe.getIcon24CommentAddBadgeOutline)().icon}o.appendChild((0,ie.createElement)('<button class="article_format_btn '+r+" article_format_btn_"+e[0]+'" onclick="'+e[1]+'">'+a+"</button>")),"bullet_list"===e[0]&&i.length>2&&o.appendChild((0,ie.createElement)('<div class="article_format_divider"></div>'))})),t.setLinkMode(!1)):t._formatTooltip.hide()}else t._formatTooltip.hide()},getTargetBoundingBox:function(){if(t._formatTooltip.linkMode)return r;var e=(0,i.__read)(n.SelectionManager.getRange(),3),a=e[0],o=e[1],s=e[2];if(!s||!s.rangeCount||!a)return r;var l=(0,i.__read)(t.getCurrentParagraphId(),1)[0],d=t.getParagraphById(l),c=0;if(a&&!o&&d&&(0,E.isHeader1Paragraph)(d)&&a.startContainer instanceof Text&&a.startOffset===a.startContainer.data.length){var h=t.getParagraphElById(l),p=t.getParagraphElById(t.getNextParagraphIdById(l));h instanceof Element&&p instanceof Element&&(c=p.getBoundingClientRect().top-h.getBoundingClientRect().top)}var u=a.getBoundingClientRect();if(!u.left){var g=a.startContainer.nodeType==Node.ELEMENT_NODE?a.startContainer:a.startContainer.parentNode;if(!(g&&g instanceof HTMLElement))return r;var m=(0,ie.getXY)(g),v=(0,ie.getSize)(g);return r={top:m[1]+(0,ie.scrollGetY)()+c,left:m[0]+v[0]/2,width:u.width,height:u.height}}return r={top:u.top+(0,ie.scrollGetY)()+c,left:u.left,width:u.width,height:u.height}}}),this._formatTooltip.linkMode=!1;var o=a.querySelector("input");o.addEventListener("keypress",(function(e){if(e.keyCode==E.Key.Enter)return t._setLinkToSelectedText(o.value.trim()),t._formatTooltip.hide(),(0,ie.cancelEvent)(e)}));var s=a.querySelector(".article_set_link_delete");null==s||s.addEventListener("click",(function(e){return t._setLinkToSelectedText(),(0,ie.cancelEvent)(e)}))}e?(this._linkTooltip&&this._linkTooltip.isShown()&&this._linkTooltip.hide(),this._formatTooltip.show(),this._formatTooltip.getOptions().onShow(),this._formatTooltip.updatePosition()):(this._formatTooltip.hide(),this._formatTooltip.linkMode&&this.setLinkMode(!1,!0))},e.prototype._setLinkToSelectedText=function(e){e&&(e=(e=e.substr(0,1500)).replace(/%E2%80%AE/i,"").replace("&#8238;","").replace(/&#x202E;/i,""),e=encodeURIComponent((0,E.urlWithProtocol)(e))),this.setLinkMode(!1,!1),this.cursor.restoreCursor(this.cursor.linkSelectedCursor),this.setAllParagraphsDirty(),e&&document.execCommand("createLink",!1,e),!window.browser.msie&&e||this._triggerInputEvent(),e?this.cursor.restoreCursor(this.cursor.linkSelectedCursor):this.cursor.restoreCursor(this.cursor.linkCursor)},e.prototype.clearLink=function(){this.setLinkMode(!1);var e=(0,i.__read)(n.SelectionManager.getRange(),3),t=e[0],r=e[2];if(t){var a=(0,ie.findClosestElementWithSelector)("a",t.startContainer);if(a){var o=(0,ie.findClosestElementWithSelector)("a",t.endContainer)||a;this.cursor.saveCursorMarker(),r&&r.setBaseAndExtent(a,0,o,Math.max(1,o.childNodes.length))}this._setCurrentParagraphDirty(),document.execCommand("unlink",!1)}},e.prototype.setLinkMode=function(e,t){var r=!1;e&&(r=this.cursor.getCursor(),window.browser.msie||document.execCommand("superscript",!1,""));var i=this._formatTooltip.getContent();if(this._formatTooltip.linkMode!=!!e)if(e){var a=i.querySelector("input");a.value="",i.classList.add("article_editor_format_tt_set_link"),this.cursor.linkCursor=r,this.cursor.linkSelectedCursor=this.cursor.getCursor(),a.focus(),this._formatTooltip.linkMode=!0,this._formatTooltip.updatePosition()}else i.style.width=null,i.classList.remove("article_editor_format_tt_set_link"),this._formatTooltip.linkMode=!1,t&&(this.cursor.saveCursorMarker(),this.setAllParagraphsDirty(),this._triggerInputEvent())},e.prototype.setHeader1=function(e){this._setHeader(S.ParagraphType.Header2,!e)},e.prototype.setHeader2=function(e){this._setHeader(S.ParagraphType.Header3,!e)},e.prototype.setQuote=function(){var e,t,r,a,n=this.cursor.getCursor();if(!1!==(0,i.__read)(this.getCurrentParagraphId(),1)[0]){var o=S.ParagraphType.Text;try{for(var s=(0,i.__values)(this.getSelectedParagraphs()),l=s.next();!l.done;l=s.next()){if(u(h=l.value)){o=h.type==S.ParagraphType.Quote?S.ParagraphType.Quote2:h.type==S.ParagraphType.Quote2?S.ParagraphType.Text:S.ParagraphType.Quote;break}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}try{for(var d=(0,i.__values)(this.getSelectedParagraphs()),c=d.next();!c.done;c=d.next()){var h;if(u(h=c.value)){var p=this.buildParagraph({type:o,lines:[h.lines[0]],sep:(0,E.hasSeparator)(h)});this.setParagraphById(h.id,p),this._setParagraphDirty(h.id)}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(a=d.return)&&a.call(d)}finally{if(r)throw r.error}}this.redraw(!0),this.cursor.restoreCursor(n),this.saveUndoStateAndDraft()}function u(e){return!(0,E.isMediaParagraph)(e)&&!(0,E.isListParagraph)(e)&&!(0,E.isTableParagraph)(e)}},e.prototype.setNumericList=function(e){this._setList(S.ParagraphType.NumericList,!!e)},e.prototype.setBulletList=function(e){this._setList(S.ParagraphType.BulletList,!!e)},e.prototype._setList=function(e,t){var r,a,o,s,l,d=(0,i.__read)(n.SelectionManager.getRange(),1)[0];if(d){var c=(0,i.__read)(this._getCurrentLiIndex(),2),h=(0,i.__read)(c[0],2),p=h[0],u=h[1],g=(0,i.__read)(c[1],2),m=g[0],v=g[1];if((0,E.isArticleParagraphId)(p)&&(0,E.isArticleParagraphId)(m)){var _="number"==typeof u?this._getLiElByIndex(p,u):this.getParagraphElById(p),f="number"==typeof v?this._getLiElByIndex(m,v):this.getParagraphElById(m);if(_&&f){var y,b,C=(0,E.getPathFromNodeToNode)(_,d.startContainer),w=(0,E.getPathFromNodeToNode)(f,d.endContainer),P=d.startOffset,A=d.endOffset,I=!1,L=new Set,T=0;try{for(var x=(0,i.__values)(this.getSelectedParagraphs()),M=x.next();!M.done;M=x.next()){var B=M.value;if((0,E.isListParagraph)(B)&&B.id===m?T+=(v||0)+1:T+=B.lines.length,B.type!==e||t)if(t&&B.type!==e){I=!0;var O=this.getParagraphById(this.getPrevParagraphIdById(B.id));O&&L.has(O.id)?((l=O.lines).push.apply(l,(0,i.__spreadArray)([],(0,i.__read)(B.lines),!1)),this.deleteParagraphById(B.id),L.add(B.id),b=O.id):(e===S.ParagraphType.BulletList?(0,E.convertParagraphToBulletList)(B):e===S.ParagraphType.NumericList&&(0,E.convertParagraphToNumericList)(B,E.MIN_LIST_START),L.add(B.id),b=B.id),y||(y=B.id)}else y||(y=B.id),b=B.id;else{var k=[];try{for(var R=(o=void 0,(0,i.__values)(B.lines)),D=R.next();!D.done;D=R.next()){var H=D.value;delete H.level,k.push(this.buildParagraph({parentId:B.parentId,lines:[H],type:S.ParagraphType.Text}))}}catch(e){o={error:e}}finally{try{D&&!D.done&&(s=R.return)&&s.call(R)}finally{if(o)throw o.error}}I=!0,this.replaceParagraphId.apply(this,(0,i.__spreadArray)([B.id],(0,i.__read)(k.map((function(e){return e.id}))),!1)),y||"number"!=typeof u||(y=k[u].id),"number"==typeof v&&(b=k[v].id)}}}catch(e){r={error:e}}finally{try{M&&!M.done&&(a=x.return)&&a.call(x)}finally{if(r)throw r.error}}if(I&&this.redraw(!0),(0,E.isArticleParagraphId)(y)&&(0,E.isArticleParagraphId)(b)){var j,W=(0,E.getNodeByPath)((0,E.isListParagraph)(this.getParagraphById(y))?this._getLiElByIndex(y,u||0):this.getParagraphElById(y),C);j=(0,E.isListParagraph)(this.getParagraphById(b))?t?(0,E.getNodeByPath)(this._getLiElByIndex(b,T-1),w):(0,E.getNodeByPath)(this._getLiElByIndex(b,v||0),w):(0,E.getNodeByPath)(this.getParagraphElById(b),w),n.SelectionManager.setRange(W,P,j,A),this.saveUndoStateAndDraft()}}}}},e.prototype._setHeader=function(e,t){var r,a,n=this.cursor.getCursor();if(!1!==(0,i.__read)(this.getCurrentParagraphId(),1)[0]){try{for(var o=(0,i.__values)(this.getSelectedParagraphs()),s=o.next();!s.done;s=o.next()){var l=s.value;d=l,(0,E.isMediaParagraph)(d)||(0,E.isListParagraph)(d)||(0,E.isTableParagraph)(d)||(l.type=t?e:S.ParagraphType.Text,this._setParagraphDirty(l.id))}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}var d;this.redraw(!0),this.cursor.restoreCursor(n),this.saveUndoStateAndDraft()}},e.prototype.setStrong=function(){this.setAllParagraphsDirty(),document.execCommand("bold"),window.browser.msie&&this._triggerInputEvent()},e.prototype.setEm=function(){this.setAllParagraphsDirty(),document.execCommand("italic"),window.browser.msie&&this._triggerInputEvent()},e.prototype.setStrike=function(){this._setCurrentParagraphDirty(),document.execCommand("strikeThrough"),window.browser.msie&&this._triggerInputEvent()},e.prototype.setComment=function(e,t){var r=this;if(this._hideFormatTooltip(),this.resizeTooltip&&this.resizeTooltip.isShown()&&this.resizeTooltip.hide(),this.comments){switch(t){case"drag":this.comments.store.sendCommentsStats(me.ArticleCommentsStatsEventType.createCommentFromDragTooltip);break;case"format":this.comments.store.sendCommentsStats(me.ArticleCommentsStatsEventType.createCommentFromFormatTooltip);break;case"resize":this.comments.store.sendCommentsStats(me.ArticleCommentsStatsEventType.createCommentFromResizeTooltip)}if(e){var i=this.getParagraphById(e),a=this.getParagraphElByIndex(this.getParagraphIndexById(e));if(i&&a&&a instanceof HTMLElement)return this.comments.addCommentAtParagraph(i),this.comments.createTooltip.showCreateTooltip(a),this.setParagraphDirty(e),this.redraw(),this.comments.addHoverEditComment(0),void this.comments.createTooltip.focusCreateInput()}this.comments.createTooltip.showCreateTooltip(),this.setDecorationForSelectParagraphs("comment",[0],"add",(function(e){var t;null===(t=r.comments)||void 0===t||t.addCommentAtParagraph(e)})),this.comments.createTooltip.focusCreateInput(),this.comments.addHoverEditComment(0)}},e.prototype.saveUndoStateAndDraft=function(){this.history.saveUndoState(),this.saveDraft()},e.prototype.initParagraphs=function(e){var t,r,a=this,n=function(e,t){var r=a.getNewParagraphId(),o=(0,i.__assign)((0,i.__assign)({},e),{id:r,parentId:t,children:(e.children||[]).map((function(e){return n(e,r).id}))});return a.store[r]=o,o};try{for(var o=(0,i.__values)(e),s=o.next();!s.done;s=o.next()){var l=s.value;this._ps.push(n(l,null).id)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}this.traverseParagraphs((function(e){if((0,T.expandParagraphFields)(e),(0,E.isMediaParagraph)(e)){var t=e._preparedData,r=e.mediaId;if(t&&r){((0,E.isEmbedType)(e.type)?[r]:r.split(",")).forEach((function(r,i){I.ArticleEditorPreparedData.add(e.type,r,t[i])})),delete e._preparedData}}})),this._cleanParagraphsBRs(),this._init()},e.prototype._getParagraphFromHTML=function(e,t,r,a,n){var o=this;void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===n&&(n=null);var s=function(t,r){if(t.nodeType==Node.TEXT_NODE){var a=t.data.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");r.text+="pre"==e?a:(0,E.cleanTextSpaces)(a)}else(0,E.isBR)(t)&&r.text.length>0&&r.brs&&r.brs.push(r.text.length);t.childNodes.forEach((function(e){var t,a,n,l=[r.text.length];if(!(0,E.isListEl)(e)){s(e,r),l.push(r.text.length);var d=(e instanceof Element?e.tagName:"").toLowerCase(),c=e instanceof HTMLElement?e.style:null,h=[d];"a"!==d&&c&&("bold"==c.fontWeight||parseInt(c.fontWeight)>400)&&h.push("strong"),c&&"line-through"===c.textDecorationLine&&h.push("strike");var p=function(t){var i=void 0;switch(t){case"b":case"strong":i=P.DecorationTypes.strong;break;case"em":case"i":i=P.DecorationTypes.em;break;case"s":case"strike":case"del":i=P.DecorationTypes.strike;break;case"a":i=P.DecorationTypes.link;var a=e.getAttribute("href")||"",s=(0,ae.replaceSpecialCharsInVkUrl)((0,E.urlWithProtocol)((0,E.decodeURL)(a)));l.push(s);break;case"code":i=P.DecorationTypes.code;break;case"font":var d=e.getAttribute("face");("monospace"===d||"times"===d)&&(i=P.DecorationTypes.code);break;case"span":if(e instanceof HTMLElement&&e.classList.contains(E.ArticleCommentsBackgroundClass)){var c=Number(e.getAttribute("comment-id"))||0;if(!(null===(n=o.comments)||void 0===n?void 0:n.store.getCommentsList().find((function(e){return e.id===c}))))break;l.push(c),i=P.DecorationTypes.comment}}if(i&&r.decorations){var h=r.decorations[i.type]||[];l[0]<l[1]&&h.push(l),r.decorations[i.type]=(0,E.mergeRanges)(h)}};try{for(var u=(0,i.__values)(h),g=u.next();!g.done;g=u.next()){p(g.value)}}catch(e){t={error:e}}finally{try{g&&!g.done&&(a=u.return)&&a.call(u)}finally{if(t)throw t.error}}}}))},l="div";if(this.getOptions().modules.tables)switch(e){case"table":l="table";break;case"tr":l="tr";break;case"td":l="td";break;default:l="div"}var d=document.createElement(l);d.innerHTML=t;var c="ol"==e||"ul"==e,h=[],p=S.ParagraphType.Text,u={id:n||this.getNewParagraphId(),type:S.ParagraphType.Text,lines:[]};if(c){switch(e){case"ol":p=S.ParagraphType.NumericList;break;case"ul":p=S.ParagraphType.BulletList}var g=[],m=[d];(0,E.traverseTree)(d,(function(e){if(e instanceof HTMLElement){var t=e.tagName.toLowerCase();if(["ul","ol"].includes(t))m.push(e);else if("li"===t){for(;m.length&&!m[m.length-1].contains(e);)m.pop();var r={text:"",decorations:{},brs:[],level:Math.min(E.MAX_LISTS_LEVEL,m.length)};g.push([e,r])}}}));for(var v=0,_=g.length;v<_;v++){var f=g[v][0],y=g[v][1];s(f,y),y.brs=(0,E.cleanBRs)(y.brs||[],y.text.length),h.push(y)}}else{switch(e){case"h1":p=S.ParagraphType.Header1;break;case"h2":case"header":p=S.ParagraphType.Header2;break;case"h3":case"h4":p=S.ParagraphType.Header3;break;case"blockquote":p=S.ParagraphType.Quote;break;case"cite":p=S.ParagraphType.Quote2;break;case"pre":p=S.ParagraphType.Code;break;case"table":p=this.getOptions().modules.tables?S.ParagraphType.Table:S.ParagraphType.Text;break;case"tr":p=S.ParagraphType.TableRow;break;case"td":p=S.ParagraphType.TableCell;break;default:p=S.ParagraphType.Text}var b=d.firstElementChild;if(b&&(0,E.isObjectParagraphEl)(b)){var C=parseInt(b.dataset.type||""),w=b.dataset.mediaId;C&&w&&(d=b.querySelector("figure"),p=C,u.mediaId=w)}if(p===S.ParagraphType.Table&&this.getOptions().modules.tables){var A=d.querySelector("tr"),I=[],L=[];if(A){var T=Array.from(A.querySelectorAll("td, th"));I=T.map((function(e){return e instanceof HTMLElement&&parseInt(e.style.width||e.style.minWidth,10)||E.TABLE_CELL_DEFAULT_WIDTH})),L=T.map((function(e){return e.hasAttribute("data-was-resized")}))}u.table_columns_count=Math.max.apply(Math,(0,i.__spreadArray)([],(0,i.__read)(Array.from((null==d?void 0:d.querySelectorAll("tr"))||[]).map((function(e){return e.childElementCount}))),!1)),u.table_has_row_header=null!==d.querySelector("thead, [data-table-header]"),u.table_columns_width=I,u.table_columns_resized=L;var x=Array.from(d.querySelectorAll("tr")).map((function(e){var t=o._getParagraphFromHTML("tr",e.innerHTML||"",!1,(0,E.isAlienParagraphEl)(e),e.getAttribute("data-id"));return t.parentId=u.id,t}));u.children=x.map((function(e){return e.id}))}else if(p===S.ParagraphType.TableRow&&this.getOptions().modules.tables){var M=Array.from(d.querySelectorAll("td, th")).map((function(e){var t=o._getParagraphFromHTML("td",e.innerHTML||"",!1,(0,E.isAlienParagraphEl)(e),e.getAttribute("data-id"));return t.parentId=u.id,t}));u.children=M.map((function(e){return e.id}))}else if(p===S.ParagraphType.TableCell&&this.getOptions().modules.tables){var B=d.querySelector("[data-table-cell-content]")||d,O=Array.from((null==B?void 0:B.childNodes)||[]).map((function(e){var t=e instanceof Element?e.tagName.toLowerCase():"p",r=e instanceof Element?e.innerHTML:e.textContent,i=o._getParagraphFromHTML(t,r||"",!1,!(e instanceof HTMLElement)||(0,E.isAlienParagraphEl)(e),e instanceof HTMLElement?e.getAttribute("data-id"):null);return i.parentId=u.id,i}));O.length||O.push(ge.model.buildTextParagraph(this,u.id)),u.children=O.map((function(e){return e.id}));var k=((null==B?void 0:B.getAttribute("data-bg-color-row"))||"").toLowerCase(),R=((null==B?void 0:B.getAttribute("data-bg-color-column"))||"").toLowerCase();E.TABLE_CELL_BG_COLORS.includes(k)&&(u.table_bg_color_row=k),E.TABLE_CELL_BG_COLORS.includes(R)&&(u.table_bg_color_column=R)}else{s(d,y={text:"",decorations:{},brs:[]}),y.brs=(0,E.cleanBRs)(y.brs||[],y.text.length),h.push(y),p==S.ParagraphType.Code&&y.decorations&&delete y.decorations.code,r||p!=S.ParagraphType.Text||"```"!=y.text||0!=y.brs.length||(y.text="",p=S.ParagraphType.Code),y.brs=y.brs.filter((function(e){return e>0}))}}return u.lines=h,u.type=p,(0,E.isHeaderParagraph)(u)||!a||r||(0,E.isDummyList)(u)&&this.convertTextParagraphToList(u),this.buildParagraph(u)},e.prototype._removeParagraphLineTextPart=function(e,t,r){e.text=e.text.substring(0,t)+e.text.substring(r);var a=r-t;e.brs&&(e.brs=e.brs.reduce((function(e,n){return n>t&&n<r?e:n>t&&n>=r?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e),!1),[n-a],!1):e}),[])),Object.entries(e.decorations||[]).forEach((function(n){var o=(0,i.__read)(n,2),s=o[0],l=o[1];e.decorations&&l&&(l.forEach((function(e){e[0]<=t&&e[1]<=t||(e[0]<=t&&e[1]<=r?e[1]=t:e[0]>=t&&e[1]<=r?e[0]=e[1]=1/0:e[0]>=t&&e[1]>r&&e[0]<r?(e[0]=t,e[1]-=a):(e[0]-=a,e[1]-=a))})),e.decorations[s]=l.filter((function(e){return e[0]!==1/0})))}))},e.prototype._renderObjectParagraph=function(e,t){var r,i=this.getOrCreateParagraphObject(e),a=i.el();i.onRender();var n=0;return"string"==typeof t&&(t=[t]),(0,E.isPhotoParagraph)(e)&&e._object?(n=e._object.getImageIndex(),i.setCaptionElHtml(t[n]||"")):i.setCaptionElHtml(t[0]||""),a.dataset.paragraphLines=JSON.stringify(e.lines),a.dataset.uuid=e._uuid,a.dataset.type=""+e.type,a.dataset.mediaId=null===(r=e._object)||void 0===r?void 0:r.getMediaId(),a.dataset.mode=e.mode?String(e.mode):"0",(0,E.isVideoParagraph)(e)&&(a.dataset.autoplay=String(e.autoplay)),a.dataset.id=e.id,a.classList.add(E.ArticleEditorParagraphClass),a},e.prototype._renderParagraphLines=function(e,t){if(!e.lines)return["",""];var r="",i="",a="",n=Number(e.type);switch(n){case S.ParagraphType.NumericList:r="ol",i="li";break;case S.ParagraphType.BulletList:r="ul",i="li";break;case S.ParagraphType.Header1:i="h1";break;case S.ParagraphType.Header2:i="h2";break;case S.ParagraphType.Header3:i="h3";break;case S.ParagraphType.Quote:i="blockquote";break;case S.ParagraphType.Quote2:i="cite";break;case S.ParagraphType.Code:i="pre";break;default:r="p"}var o=[];return(0,E.isListParagraph)(e)&&(0,E.normalizeLineLevels)(e.lines),e.lines.forEach((function(s,l){if(s){var d=s.text,c=s.decorations,h=[];P.Decorations.forEach((function(t){if(!(0,E.isHeaderParagraph)(e)&&!(0,E.isCodeParagraph)(e)||"code"!=t.type){var r=null==c?void 0:c[t.type];if(r)for(var i=0,a=r.length;i<a;i++){var n=r[i];(h[n[0]]=h[n[0]]||{open:[],close:[]}).open.push([t.type,!(n.length>2)||n.slice(2)]),(h[n[1]]=h[n[1]]||{open:[],close:[]}).close.push([t.type,!(n.length>2)||n.slice(2)])}}})),P.Decorations.forEach((function(e){if(!(0,E.isHeaderParagraph)(n)&&n!=S.ParagraphType.Code||"code"!=e.type){var t=null==c?void 0:c[e.type];if(t)for(var r=function(e,r){var i=t[e],a=function(e,t){for(var r=[],i=e;i<=t;i++){var a=h[i];a&&a.open.length>0&&i!==t&&a.open.forEach((function(e){r.push(e)})),i!==e&&a&&a.close.length>0&&a.close.forEach((function(e){var t=r.findIndex((function(t){return t[0]===e[0]&&!0!==t[1]&&!0!==e[1]&&t[1].join(",")===e[1].join(",")||t[1]===e[1]}));-1!==t&&r.splice(t,1)}))}return r}(i[0],i[1]);a.forEach((function(e){h[i[1]].close.push(e)})),a.forEach((function(e){h[i[1]].open.push(e)}))},i=0,a=t.length;i<a;i++)r(i)}}));var p=0,u=[];h.forEach((function(t,r){if(t){var i=!1,a=t.close.find((function(e){return"link"===e[0]}))&&1==t.close.length;r>0&&(i=(0,E.prepareLineText)(d,p,r,s.brs||[],e.type==S.ParagraphType.Code),a||u.push(i));var n=0;a&&(i&&i.endsWith("<br/>")&&(n++,i=i.replace(/<br\/>$/,"")),i&&i.endsWith("<br/>")&&(n++,i=i.replace(/<br\/>$/,"")),!1!==i&&u.push(i)),t.close.reverse().forEach((function(e){var t=P.Decorations.find((function(t){return t.type===e[0]}));t&&u.push("</"+t.tag+">")})),u.push("<br/>".repeat(n)),t.open.forEach((function(e){var t=P.Decorations.find((function(t){return t.type===e[0]}));if(t){var r="";t.attributes&&t.attributes.forEach((function(t){void 0!==t.index&&!0!==e[1]?r+=t.name+'="'+(t.needClean?(0,ae.clean)(e[1][t.index].toString()):e[1][t.index])+'"':void 0!==t.value&&(r+=t.name+'="'+t.value+'"')})),u.push("<"+t.tag+" "+r+">")}})),p=r}})),u.push((0,E.prepareLineText)(d,p,void 0,s.brs||[],e.type==S.ParagraphType.Code));var g="";if("li"===i){var m=l>0?e.lines[l-1]:null;if(m&&Number(null==s?void 0:s.level)>Number(null==m?void 0:m.level)){var v=Number(null==s?void 0:s.level);g+="<"+r+' type="'+(v%2==0?"a":v%3==0?"i":"1")+'">'}}if(i&&(g+="<"+i+(a=a?" "+a:"")+">"),(0,E.isQuoteParagraph)(e)&&(g+="<p>"),(0,E.isQuote2Paragraph)(e)&&(g+="<span>"),g+=u.join("")||(t?"":"<br/>"),(0,E.isQuoteParagraph)(e)&&(g+="</p>"),(0,E.isQuote2Paragraph)(e)&&(g+="</span>"),"li"===i){var _=e.lines[l+1],f=Number(s.level)-(Number(null==_?void 0:_.level)||E.MIN_LISTS_LEVEL);0===f?g+="</"+i+">":f>0&&(g+="</"+i+">",g+=("</"+r+"></"+i+">").repeat(f))}else i&&(g+="</"+i+">");o.push(g)}})),[r,o]},e.prototype.renderParagraph=function(e){var t,r,a,n,o,s,l;if((0,E.isTableParagraph)(e))l=new ge.Table(e,this).render();else if((0,E.isTableRowParagraph)(e))l=new ge.Row(e,this).render();else if((0,E.isTableCellParagraph)(e))l=new ge.Cell(e,this).render();else{var d=(0,E.isMediaParagraph)(e),c=(0,i.__read)(this._renderParagraphLines(e,d),2),h=c[0],p=c[1];if(d)l=this._renderObjectParagraph(e,p);else{var u=Array.isArray(p)?p.join(""):p;if(h){if(l=(0,ie.createElement)("<"+h+">"+u+"</"+h+">"),(0,E.isListParagraph)(e)){l.setAttribute("start",String(e.start));var g=Array.from(l.querySelectorAll("ol, ul"));try{for(var m=(0,i.__values)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(g),!1),[l],!1)),v=m.next();!v.done;v=m.next()){v.value.classList.add("article-list")}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}var _=Array.from(l.querySelectorAll("li"));try{for(var f=(0,i.__values)(_),y=f.next();!y.done;y=f.next()){y.value.classList.add("article-list__item")}}catch(e){a={error:e}}finally{try{y&&!y.done&&(n=f.return)&&n.call(f)}finally{if(a)throw a.error}}}}else l=(0,ie.createElement)(u)}}l.setAttribute("data-id",e.id),(0,E.hasSeparator)(e)?l.dataset.sep=String((0,E.genSepatorId)()):delete l.dataset.sep,l.classList.add(E.ArticleEditorParagraphClass),l.classList.add("article_paragraph");var b=document.createElement("span");return b.classList.add(E.ArticleEditorParagraphToolsClass),b.setAttribute("contenteditable","false"),e.parentId||(0,E.isHeader1Paragraph)(e)||null===(o=this.drag)||void 0===o||o.addDragButton(l,e,b),b.childElementCount>0&&l.prepend(b),Array.isArray(e.comment_ids)&&(l.setAttribute("comment-id",null===(s=e.comment_ids)||void 0===s?void 0:s.join(",")),l.classList.add(E.ArticleCommentsBackgroundClass)),l},e.prototype.getParagraphElById=function(e){return(0,E.isArticleParagraphId)(e)&&this._els.canvas.querySelector('[data-id="'+e+'"]')||null},e.prototype.getParagraphElByIndex=function(e){return!1===e?null:this._els.canvas.childNodes[e]||null},e.prototype._decorateParagraphEls=function(){var e=this;this.traverseParagraphs((function(t){var r=e.getParagraphById(e.getPrevParagraphIdById(t.id))||!1,i=e.getParagraphById(e.getNextParagraphIdById(t.id))||!1,a=!1,n=!1,o=!1;r&&(null==t?void 0:t.type)==r.type||(a=!0),i&&(null==t?void 0:t.type)==i.type||(n=!0),i&&(S.ResizableObjectTypes.includes(+i.type)||i.sep)&&(o=!0);var s=e.getParagraphElById(t.id);null==s||s.classList.toggle("article_decoration_first",a),null==s||s.classList.toggle("article_decoration_last",n),null==s||s.classList.toggle("article_decoration_before",o)}))},e.prototype.redraw=function(e,t){var r,i=this,a=this.cursor.getCursor();if(e){var n=this._checkCarouselEditorScroll();this._els.canvas.innerHTML="",this._ps.forEach((function(e){var t,r=i.getParagraphById(e);if(r){var a=i.renderParagraph(r);i._els.canvas.appendChild(a),null===(t=a.connectedCallback)||void 0===t||t.call(a)}})),n&&this._setCarouselEditorScroll(n)}else this._dirty.forEach((function(e){var t,r=i.getParagraphElById(e);if(r){var a=i.getParagraphById(e);if(a){var n=i.renderParagraph(a);if(!(r instanceof Element)||n.outerHTML!=r.outerHTML||window.browser.mozilla&&r instanceof HTMLElement&&!r.onmouseenter){r.replaceWith(n),null===(t=n.connectedCallback)||void 0===t||t.call(n);var o=r[window.vkExpand];o&&(n[window.vkExpand]=o)}}}}));t&&this.cursor.restoreCursor(a),this._decorateParagraphEls(),this._dirty=[],this._updateTextPlaceholders(),null===(r=this.comments)||void 0===r||r.updateCommentElements()},e.prototype.getContainingParagraphEl=function(e){for(;e&&!(0,E.isParagraphEl)(e);)e=e.parentElement;var t=e instanceof HTMLElement&&e.getAttribute("data-id")||!1;return[e instanceof HTMLElement?e:null,t,t?this.getParagraphById(t):null]},e.prototype.getCurrentParagraphId=function(){return this.selection.getCurrentParagraphId()},e.prototype.setAllParagraphsDirty=function(){var e,t;this._dirty=[];try{for(var r=(0,i.__values)(this._ps),a=r.next();!a.done;a=r.next()){var n=a.value;this._dirty.push(n)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype._setCurrentParagraphDirty=function(){var e=(0,i.__read)(this.getCurrentParagraphId(),2),t=e[0],r=e[1];this._setParagraphDirty(t,r)},e.prototype.setParagraphDirty=function(e,t){this._setParagraphDirty(e,t)},e.prototype._setParagraphDirty=function(e,t){if(!(0,E.isArticleParagraphId)(e))throw new Error("Invalid paragraph id");t=t||e;for(var r=e;(0,E.isArticleParagraphId)(r)&&(this._dirty.includes(r)||this._dirty.push(r),r!==t);)r=this.getNextParagraphIdById(r)},e.prototype._expandDoubleBRs=function(){var e=this,t=function(t,r,i){void 0===i&&(i=void 0);var a=t.lines[0];void 0===i&&(i=a.text.length);var n=[];return a.brs&&a.brs.forEach((function(e){i&&e<i&&e>r&&n.push(e-r)})),e.buildParagraph({type:t.type,lines:[{text:a.text.substr(r,i-r),decorations:(0,E.decorationsSlice)(a.decorations,r,i),brs:n}]})},r=!1;return this.traverseParagraphs((function(a){if(a.lines.length>1)a.lines.forEach(E.cleanLineBRs);else{var n=a.lines[0];if(!n||!n.brs||!n.brs.length)return;for(var o=n.brs,s=[],l=0,d=0,c=o.length;d<c;d++)if(l!=o[d]&&d>0&&o[d-1]==o[d]){var h=t(a,l,o[d]);(0,E.isParagraphEmpty)(h)||s.push(h),l=o[d]}s.push(t(a,l)),s.length>1&&(e.insertParagraphIdAfter.apply(e,(0,i.__spreadArray)([a.id],(0,i.__read)(s.map((function(e){return e.id}))),!1)),r=!0)}})),r},e.prototype._processEmojiImgs=function(){for(var e,t=Array.prototype.slice.call(this._els.canvas.children);e=t.shift();)for(var r=Array.from(e.querySelectorAll("img")),i=void 0;i=r.shift();)(0,E.isEmojiImg)(i)&&(i.replaceWith(document.createTextNode(i.alt)),i.remove())},e.prototype._processAlienPhotos=function(){var e,t=this;if(!this.photoPasteUploadingProcess)for(var r,i=Array.prototype.slice.call(this._els.canvas.children);r=i.shift();)if(!(0,E.isObjectParagraphEl)(r)||!this._isTrackedObjectEl(r))for(var a=Array.from(r.querySelectorAll("img")),n=void 0,s=function(){if(!n.src||!r.parentNode||"none"===n.style.display)return"continue";var i=(0,ie.traverseParent)(n,(function(e){return e==t._els.canvas||"FIGURE"==e.tagName}),10),a=null,s=null;i&&i instanceof HTMLElement&&i!=l._els.canvas&&(a=i.querySelector("figcaption"),i.querySelector(".article_ed__extra_controls")?s=i.querySelector(".article_ed__extra_controls"):i.querySelector(".article_photo_carousel__controls")&&(s=i.querySelector(".article_photo_carousel__controls")));var d=l.buildParagraph({type:S.ParagraphType.ObjectPhoto}),c=l._renderObjectParagraph(d,a?a.innerHTML:"");o.CursorManager.justCursorInString(r.textContent||"")?(r.replaceWith(c),null==s||s.remove(),n.remove(),c.after((0,ie.createElement)("<p>"+E.CURSOR_MARKER_START+"</p>"))):(null===(e=n.parentElement)||void 0===e||e.after(c),null==s||s.remove(),null==a||a.remove(),n.remove()),(0,ie.traverseParent)(c,(function(e){if(e==t._els.canvas)return!0;e.classList.remove(E.ArticleEditorParagraphClass)}));var h=r.getAttribute("data-mode"),p=function(){c.remove(),t.forgetObject(d._uuid||""),t.forgetParagraphById(d.id),t.setAllParagraphsDirty(),t._triggerInputEvent()};(0,E.queuePhotoProcess)(n.src,(function(e,r,i){var a;e||!r?(p(),i()):(t.getOrCreateParagraphObject(d),null===(a=d._object)||void 0===a||a.setBLOB(r,i,p),h&&t.setModeObject(d.id,Number(h)))}))},l=this;n=a.shift();)s()},e.prototype.processH1=function(){var e,t;if(0===this._pasteCurrentIndex)try{for(var r=(0,i.__values)(Array.from(this._els.canvas.children)),a=r.next();!a.done;a=r.next()){var n=a.value;"h1"!==n.tagName.toLowerCase()||n.childElementCount<=1||n.replaceWith.apply(n,(0,i.__spreadArray)([],(0,i.__read)(Array.from(n.childNodes)),!1))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.processAlienTables=function(){if(this._fromPasteEvent)for(var e,t=Array.prototype.slice.call(this._els.canvas.children);e=t.shift();)if(!(0,E.isParagraphEl)(e)){var r=(0,E.isTableEl)(e)?e:e.querySelector("table");if(r){e.replaceWith(r);for(var i=r.querySelectorAll("tr"),a=0;a<i.length;a++)for(var n=i[a].querySelectorAll("td, th"),o=0;o<n.length;o++){for(var s=n[o],l=(Number(s.getAttribute("colspan"))||0)-1,d=(Number(s.getAttribute("rowspan"))||0)-1;l>0;){(h=s.cloneNode()).removeAttribute("colspan"),s.after(h),l--}for(var c=a;d>0;){var h;(h=s.cloneNode()).removeAttribute("rowspan");var p=i[c+1],u=p.children[o-1];u?u.after(h):p.prepend(h),c++,d--}}}}},e.prototype._flattenAlienParagraphs=function(){var e;if(this._fromPasteEvent){var t,r=Array.prototype.slice.call(this._els.canvas.children),a=this._fromPasteEvent,n=this._pasteCurrentIndex,o=(0,i.__read)(this.getCurrentParagraphId(),1)[0],s=this.getParagraphIndexById(o);this.removeAllParagraphTools();for(var l=-1,d=function(){if(l++,a&&!(null===(e=t.textContent)||void 0===e?void 0:e.trim())&&"number"==typeof n&&"number"==typeof s&&l>n&&l<=s)return t.remove(),"continue";var r=t;(0,E.isQuoteEl)(t)&&!(0,E.isAlienParagraphEl)(t)&&t.firstChild&&(r=t.firstChild);var i=!1;(function e(a){if(a&&a instanceof HTMLElement&&!(0,E.isBR)(a)&&!(0,E.isTableEl)(a)&&!a.hasAttribute("data-table-wrapper")&&t)if((0,E.hasBlockElements)(a))if(this._isTrackedObjectEl(a))a!=r&&(t.before(a),i=!0);else for(var n,o=Array.prototype.slice.call(a.childNodes);n=o.shift();)e.call(this,n);else a!=r&&(a.innerHTML.trim()&&t.before(a),i=!0)}).call(c,r),i&&t.remove()},c=this;t=r.shift();)d();this.setAllParagraphsDirty()}},e.prototype._correctCaptionSelection=function(){var e=(0,i.__read)(n.SelectionManager.getRange(),3),t=e[0],r=e[1],a=e[2];if(t&&!r){var o=(0,ie.traverseParent)(t.startContainer,(function(e){return"FIGCAPTION"==e.tagName}),5);if(o&&o instanceof HTMLElement&&t.endContainer!=t.startContainer&&t.endContainer.nodeType==Node.ELEMENT_NODE&&(0,E.isParagraphEl)(t.endContainer)&&0==t.endOffset&&0==t.startOffset){var s=o.querySelector(".article_ed__figcaption_edit");if(!s)return;var l=t.cloneRange();l.selectNodeContents(s),a&&(a.removeAllRanges(),a.addRange(l))}}},e.prototype.cancelSaveDraft=function(){clearTimeout(this._draftSaveTO)},e.prototype.saveDraft=function(e,t,r){var i=this;if(!this.isLocked()){clearTimeout(this._draftSaveTO);var a=JSON.stringify({paragraphs:this.mapModelTree(this.getModelTree(),(function(e){return(0,T.getCleanedParagraph)(e,!1)}))});t?this._lastSavedDraft=a:this._lastSavedDraft!=a||e?(this._options.onDraftNotSaved&&this._options.onDraftNotSaved(),this._draftSaveTO=setTimeout((function(){if(i._lastSavedDraft=a,0!=i._ps.length){var e=(0,L.checkLimits)(i);e?i._options.onDraftNotSaved&&i._options.onDraftNotSaved(e):i.save(!1,(function(e,t){i._initDraftSave=!0,i._options.onDraftSaved&&i._options.onDraftSaved(e,t),i.comments&&i.comments.textCreate&&(i.comments.sendCreateComment(i.comments.textCreate),i.comments.textCreate=void 0)}))}}),r?0:1e3*this._options.draftSaveDelay)):!t&&this._initDraftSave&&this._options.onDraftSaved&&this._options.onDraftSaved("",this.getArticleId())}},e.prototype._getName=function(){if(this._publishName)return this._publishName;var e=this.mapModelTree(this.getModelTree(),(function(e){return(0,T.getCleanedParagraph)(e,!1)})),t=e.length?e[0].lines[0].text:"";return(0,E.generateLatinizedName)(t,this._options.maxNameLength)},e.prototype.getTitle=function(){var e=this.getParagraphById(this._ps[0]);return e?e.lines[0].text:""},e.prototype.isLimitsExceeded=function(){return!!(0,L.checkLimits)(this)},e.prototype.save=function(e,t,r){var a=this;void 0===r&&(r={});var n=this.mapModelTree(this.getModelTree(),(function(e){var t=a.getParagraphById(e.parentId);return t&&(0,E.isTableCellParagraph)(t)&&1===(t.children||[]).length?(0,T.cleanParagraph)(e,!1):(0,T.getCleanedParagraph)(e,!1,!0)}));this.traverseModelTree(n,(function(t){e&&(0,E.correctRealIndexes)(t,-1)}));var o=this._getName(),s=this.getCoverPhoto();void 0===s&&e&&(s=this.getFirstCoverPhotoFromParagraphs()),this.getOptions().postData&&(r.from_post_convert=1),r.session_duration=this.getTimeSpent(),A.ArticleEditorSaver.save(this.getArticleOwnerId(),this.getArticleId(),n,e,o,s?s.id:"",this._getSaveDraftHash(),this._options.limits.maxSymbolsPerChunk,r,(function(r,n,s,l,d){if("string"==typeof r&&r.startsWith("locked "))return a.getOptions().editLockMessage=r.slice("locked ".length),a.showEditLockInfo(),void(t&&t(!0));r||(n&&(a._options.articleId=n),"al_articles.php"!=window.nav.objLoc[0]||window.nav.objLoc.article_id||window.nav.setLoc((0,i.__assign)((0,i.__assign)({},window.nav.objLoc),{article_id:a.getArticleOwnerId()+"_"+a.getArticleId()})),a._publishNameCandidate=o,e&&(a._options.isPublished=!0,a.wasPublishedInCurrentSession=!0),a._replaceVideos(d)),t&&t(r,n,s,l)}))},e.prototype._replaceVideos=function(e){var t=this;void 0===e&&(e=[]);var r=!1;try{e.forEach((function(e){var a=(0,i.__read)(e,4),n=a[0],o=a[1],s=a[2],l=a[3];t.traverseParagraphs((function(e){if((0,E.isVideoParagraph)(e)){var a=(0,i.__read)((e.mediaId||"").split("_"),3),d=a[0],c=a[1];a[2]||d!=n||c!=o||(e.mediaId=s+"_"+l,t._setParagraphDirty(e.id),r=!0)}}))}))}catch(e){}r&&this._redrawModel()},e.prototype.focus=function(){this.cursor.restoreLastCursor()},e.prototype.focusLastParagraph=function(){n.SelectionManager.setCaretAtElement(this.getParagraphElById(this._ps[this._ps.length-1]))},e.prototype.getArticleId=function(){return this._options.articleId},e.prototype.getArticleOwnerId=function(){return this._options.articleOwnerId},e.prototype._getSaveDraftHash=function(){return this._options.saveDraftHash},e.prototype._expandBlockquoteParagraphs=function(e){for(var t,r=Array.prototype.slice.call(this._els.canvas.children);t=r.shift();)if((0,E.isQuoteEl)(t)){var i=t.tagName,a=Array.prototype.slice.call(t.children);a&&a[0]&&(0,E.isParagraphToolsEl)(a[0])&&a.shift();var n=a[0];if(1==a.length&&n&&n.tagName&&["H1","H2","H3"].includes(n.tagName)){t.replaceWith(n);continue}if(a.shift(),a.length)for(var o=void 0;o=a.shift();){if(this.cursor.saveCursorMarker(),e)t.after(o);else{if(["span","strong","br","a","strike"].includes(o.tagName.toLowerCase()))continue;var s=(0,ie.createElement)("<"+i+"></"+i+">");s.appendChild(o),t.after(s)}this.cursor.restoreCursorFromMarker()}}},e.prototype._expandCiteParagraphs=function(){for(var e,t=Array.from(this._els.canvas.children);e=t.shift();){var r=e.children[0];(0,E.isCiteEl)(r)&&e.replaceWith(r)}},e.prototype._ensureDummyParagraphs=function(){if(this._els.canvas){if(window.browser.safari&&!this._els.canvas.lastChild){var e=this.buildParagraph({});this._els.canvas.appendChild(this.renderParagraph(e)),this._ps.push(e.id)}var t=this._els.canvas.lastChild;if(t){var r=t instanceof HTMLElement?(0,E.findParagraphToolsEl)(t):null,i=r?r.outerHTML:"";if(t instanceof HTMLElement&&t.innerHTML.trim()&&"<br>"!=t.innerHTML&&t.innerHTML!=i+"<br>"&&"&nbsp;"!=t.innerHTML||t.nodeType==Node.TEXT_NODE&&""!==t.textContent||t instanceof HTMLElement&&"H1"==t.tagName){e=this.buildParagraph({});this._els.canvas.appendChild(this.renderParagraph(e)),this._ps.push(e.id),this._updateTextPlaceholders()}}}},e.prototype._ensureAtLeastOneParagraph=function(){if(0==this._ps.length){var e=this.buildParagraph({type:S.ParagraphType.Text});this._ps=[e.id]}},e.prototype._ensureTitleParagraph=function(){var e=this;if(!this._options.noTitle){var t=this.getParagraphById(this._ps[0]);if(t)if((0,E.isMediaParagraph)(t)||(0,E.isTableParagraph)(t)){var r=this.buildParagraph({type:S.ParagraphType.Header1});this._ps.unshift(r.id)}else t.type=S.ParagraphType.Header1,t.lines[0].decorations={},t.lines[0].brs=[],delete t.sep;else{r=this.buildParagraph({type:S.ParagraphType.Header1});this._ps[0]=r.id}}this.traverseParagraphs((function(t){if(!t.parentId){var r=e.getParagraphIndexById(t.id);(e._options.noTitle||0!=r)&&(1==r&&(0,E.isHeader1Paragraph)(t)&&(t.type=S.ParagraphType.Text),(0,E.isHeader1Paragraph)(t)&&(t.type=S.ParagraphType.Header2))}}))},e.prototype.insertParagraphAt=function(e){for(var t,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];(t=this._ps).splice.apply(t,(0,i.__spreadArray)([e,0],(0,i.__read)(r),!1))},e.prototype.deleteParagraphById=function(e){if((0,E.isArticleParagraphId)(e)){var t=this.getParagraphById(e);if(t){var r=this.getParagraphIndexById(e);if("number"==typeof r){if(t.parentId){var i=this.getParagraphById(t.parentId);if(!i||!(0,E.paragraphHasChildren)(i))return;i.children.splice(r,1)}else this._ps.splice(r,1);this.forgetParagraphById(e)}}}},e.prototype.moveParagraphs=function(e,t,r){var a;void 0===r&&(r=1),(a=this._ps).splice.apply(a,(0,i.__spreadArray)([t,0],(0,i.__read)(this._ps.splice(e,r)),!1))},e.prototype.focusParagraph=function(e,t){(0,E.isArticleParagraphId)(e)&&n.SelectionManager.setCaretAtElement(this.getParagraphElById(e),t)},e.prototype._init=function(){this._correctEmptyParagraphAfterFloatObjects(),this.redraw(!0),this._initEvents(),this._initLinksHrefTooltip(),this._initResizeTooltip()},e.prototype._redrawModel=function(){this.cursor.saveCursorMarker(),this.redraw(!0),this.cursor.restoreCursor()},e.prototype.addObjectMarketProduct=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),1)[0];(0,oe.showAttachProductBox)(null,(function(r){if(t){if(!(0,E.isParagraphEmpty)(e.getParagraphById(t))){var i=e.buildParagraph();e.insertParagraphIdBefore(t,i.id)}var o={type:S.ParagraphType.ObjectMarketItem,mediaId:r.id};"link"===r.type&&(o.type=S.ParagraphType.ObjectAliExpressProduct,o.mediaId=r.url);var s=e.buildParagraph(o);"link"===r.type?I.ArticleEditorPreparedData.addRaw(o.type,o.mediaId,{product:r}):I.ArticleEditorPreparedData.add(o.type,o.mediaId,{product:r}),e.getOrCreateParagraphObject(s),e.setParagraphById(t,s),(0,a.curBox)().hide(),e._redrawModel();var l=e.getParagraphElById(t);n.SelectionManager.setCaretAtElement(l),e.saveUndoStateAndDraft(),t=e.getNextParagraphIdById(t)}}))},e.prototype.addObjectAudio=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),1)[0];ve.Ranges.isGroupId(this.getArticleOwnerId())&&(window.cur.audioAttachOriginalOwnerId=this.getArticleOwnerId(),window.cur.audioAttachSwitchOwnerId=window.vk.id),window.AudioPage.showAttachBox(this.getArticleOwnerId(),{canPlaylistAttach:!0,onAudioChoose:function(r,i,o,s){if(t){if(!(0,E.isParagraphEmpty)(e.getParagraphById(t))){var l=e.buildParagraph();e.insertParagraphIdBefore(t,l.id)}var d=e.buildParagraph({type:S.ParagraphType.ObjectAudio,mediaId:o.fullId});I.ArticleEditorPreparedData.add(S.ParagraphType.ObjectAudio,o.fullId,{audio:s}),e.getOrCreateParagraphObject(d),e.setParagraphById(t,d),r.shiftKey||(0,a.curBox)().hide(),e._redrawModel();var c=e.getParagraphElById(t);n.SelectionManager.setCaretAtElement(c),e.saveUndoStateAndDraft(),t=e.getNextParagraphIdById(t)}},onPlaylistChoose:function(r,i){if(t){var o=i.getOwnerId()+"_"+i.getPlaylistId()+(i.getAccessHash()?"_"+i.getAccessHash():""),s=e.buildParagraph({type:S.ParagraphType.ObjectAudioPlaylist,mediaId:o});I.ArticleEditorPreparedData.add(S.ParagraphType.ObjectAudioPlaylist,o,{accessHash:i.getAccessHash()}),e.getOrCreateParagraphObject(s),e.setParagraphById(t,s),(0,a.curBox)().hide(),e._redrawModel();var l=e.getParagraphElById(t);n.SelectionManager.setCaretAtElement(l),e.saveUndoStateAndDraft()}}})},e.prototype.closeAllCarouselEditors=function(){this.traverseParagraphs((function(e){var t;(0,E.isPhotoParagraph)(e)&&(null===(t=e._object)||void 0===t||t.cancelCarouselEditor())}))},e.prototype.setMediaUploadMode=function(e){this._isUploading=!!e,this._els.editor.classList.toggle("article_ed__uploading",this._isUploading)},e.prototype.isMediaUploadMode=function(){return this._isUploading},e.prototype.addObjectVideo=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),1)[0],r=this.getParagraphById(t);if(t&&r){var o=(0,E.hasSeparator)(r);delete r.sep,(0,se.showBox)("al_video.php",{act:"a_choose_video_box",from:"article",to_id:this.getArticleOwnerId(),blockPersonal:1});var s={};window.cur.onMediaUploadStarted=function(r){var i=e.buildParagraph({type:S.ParagraphType.ObjectVideo}),a=r.ind+"_"+r.fileName;s[a]=i.id,e.insertParagraphIdBefore(t,i.id),e.redraw(!0);var o=e.getParagraphElById(t);n.SelectionManager.setCaretAtElement(o),e.setMediaUploadMode(!0)},window.cur.onMediaUploadFail=function(t){var r=t.ind+"_"+t.fileName,i=s[r];i&&(e.deleteParagraphById(i),e.redraw(!0),delete s[r]),Object.keys(s).length||(delete window.cur.onMediaUploadStarted,delete window.cur.onMediaUploadFail,delete window.cur.chooseMedia,e.setMediaUploadMode(!1))},window.cur.chooseMedia=function(r,i,n,l,d){var c;d=d||!1;var h=s[n.upload_ind];delete s[n.upload_ind];var p=e.getParagraphById(h);if(Object.keys(s).length||(delete window.cur.onMediaUploadStarted,delete window.cur.onMediaUploadFail,e.setMediaUploadMode(!1)),I.ArticleEditorPreparedData.add(S.ParagraphType.ObjectVideo,i,n),p)p.mediaId=i,p.sep=o,p._uuid&&e.forgetObject(p._uuid),e.setParagraphDirty(p.id),e.redraw(),e.saveUndoStateAndDraft(),e.focusParagraph(p.id);else{var u=e.buildParagraph({type:S.ParagraphType.ObjectVideo,mediaId:i,sep:o});e.insertParagraphIdBefore(t,u.id),e.redraw(!0),e.saveUndoStateAndDraft(),e.focusParagraph(u.id)}o=!1,!d&&(0,a.curBox)()&&(null===(c=(0,a.curBox)())||void 0===c||c.hide())},window.cur.hasChosenMedia=function(e,t){var r,a,n=!1;if(!window.cur.chosenMedias)return!1;try{for(var o=(0,i.__values)(window.cur.chosenMedias),s=o.next();!s.done;s=o.next()){var l=s.value;if(l[0]===e&&l[1]===t){n=!0;break}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return n}}},e.prototype.addObjectDoc=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),1)[0],r=this.getParagraphById(t);if(t&&r){var a=(0,E.hasSeparator)(r);delete r.sep,window.cur.docsCurFilter="gif";var o=(0,se.showBox)("docs.php",{act:"a_choose_doc_box",from:"article",ext_filter:"gif",to_id:this.getArticleOwnerId()},{stat:["docs.css"]}),s={};window.cur.onMediaUploadStarted=function(r){var i=e.buildParagraph({type:S.ParagraphType.ObjectGIF}),a=r.ind+"_"+r.fileName;s[a]=i.id,e.insertParagraphIdBefore(t,i.id),e.redraw(!0);var o=e.getParagraphElById(t);n.SelectionManager.setCaretAtElement(o),e.setMediaUploadMode(!0)},window.cur.onMediaUploadFail=function(t){var r=t.ind+"_"+t.fileName,i=s[r];i&&(e.deleteParagraphById(i),e.redraw(!0),delete s[r]),Object.keys(s).length||(delete window.cur.onMediaUploadStarted,delete window.cur.onMediaUploadFail,delete window.cur.chooseMedia,e.setMediaUploadMode(!1))},window.cur.chooseMedia=function(r,i,n){var l=s[n.upload_ind];delete s[n.upload_ind];var d=e.getParagraphById(l);if(Object.keys(s).length||(delete window.cur.onMediaUploadStarted,delete window.cur.onMediaUploadFail,e.setMediaUploadMode(!1)),I.ArticleEditorPreparedData.add(S.ParagraphType.ObjectGIF,i,{video:n.video_preview,size:n.video_preview_size,href:n.href}),d)d.mediaId=i,d.sep=a,d._uuid&&e.forgetObject(d._uuid),e.getOrCreateParagraphObject(d),e.setParagraphDirty(d.id),e.redraw(),e.saveUndoStateAndDraft(),e.focusParagraph(d.id);else{var c=e.buildParagraph({type:S.ParagraphType.ObjectGIF,mediaId:i,sep:a});e.getOrCreateParagraphObject(c),e.insertParagraphIdBefore(t,c.id),e.redraw(!0),e.saveUndoStateAndDraft(),e.focusParagraph(c.id)}o.hide()},window.cur.showMediaProgress=function(){}}},e.prototype.addObjectPhoto=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),1)[0],r=this.getParagraphById(t),a=(0,se.showBox)("al_photos.php",{to_id:this.getArticleOwnerId(),act:"choose_photo",max_files:200,article:1},{cache:1,stat:[window.jsc("web/photos.js"),"photos.css",window.jsc("web/upload.js")]}),o={};window.cur.onMediaUploadStarted=function(r){var i=null==r?void 0:r.file1;if(i){var a=e.buildParagraph({type:S.ParagraphType.ObjectPhoto}),s=i.ind+"_"+i.fileName;o[s]=a.id,e.insertParagraphIdBefore(t,a.id),e.redraw(!0);var l=e.getParagraphElById(t);n.SelectionManager.setCaretAtElement(l),e.setMediaUploadMode(!0)}},window.cur.onMediaUploadFail=function(t){var r=null==t?void 0:t.file1;if(r){var i=r.ind+"_"+r.fileName,a=o[i];a&&(e.deleteParagraphById(a),e.redraw(!0),delete o[i]),Object.keys(o).length||(delete window.cur.onMediaUploadStarted,delete window.cur.onMediaUploadFail,delete window.cur.chooseMedia,e.setMediaUploadMode(!1))}},window.cur.chooseMedia=function(i,n,s,l){var d=o[s.upload_ind];delete o[s.upload_ind];var c=e.getParagraphById(d);if(Object.keys(o).length||(delete window.cur.onMediaUploadStarted,delete window.cur.onMediaUploadFail,e.setMediaUploadMode(!1)),I.ArticleEditorPreparedData.add(S.ParagraphType.ObjectPhoto,n,{size:(0,E.getPhotoSize)(s.editable.sizes),sizes:s.editable.sizes}),c)c.mediaId=n,c.sep=null==r?void 0:r.sep,c._uuid&&e.forgetObject(c._uuid),e.setParagraphDirty(c.id),e.redraw(),e.saveUndoStateAndDraft(),e.focusParagraph(c.id);else{var h=e.buildParagraph({type:S.ParagraphType.ObjectPhoto,mediaId:n,sep:null==r?void 0:r.sep});e.insertParagraphIdBefore(t,h.id),e.redraw(!0),e.saveUndoStateAndDraft(),e.focusParagraph(h.id)}return void 0===l&&a.hide(),!1},window.cur.showMediaProgress=function(){}},e.prototype.addSeparator=function(){var e=(0,i.__read)(this.getCurrentParagraphId(),1)[0];if(e){var t=this.getParagraphById(this.getPrevParagraphIdById(e)),r=this.getParagraphById(e),a=this.getParagraphById(this.getNextParagraphIdById(e));if(r&&!r.parentId){var o=(0,E.hasSeparator)(r),s=null!==a?(0,E.hasSeparator)(a):void 0,l=this.getParagraphIndexById(e);if("number"==typeof l&&(!o&&!s&&l<this._ps.length-1&&this.deleteParagraphById(e),(r=this.getParagraphById(this._ps[l]))&&(r.sep=1),t&&(0,E.isObjectResize)(t)&&1===t.mode)){var d=this.buildParagraph();this.insertParagraphAt(l,d.id)}if(this.redraw(!0,!0),t&&(0,E.isObjectResize)(t)&&1===t.mode){var c=this.getParagraphElById(this.getNextParagraphIdById(e));n.SelectionManager.setCaretAtElement(c)}this.history.saveUndoState()}}},e.prototype.addTable=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),1)[0],r=this.getParagraphById(t);if((0,E.isArticleParagraphId)(t)&&r){var a=ge.model.buildDefaultTable(this);(0,E.hasSeparator)(r)&&(a.sep=1),this.insertParagraphIdAfter(t,a.id),this.deleteParagraphById(t),this._redrawModel(),this._ensureDummyParagraphs(),this.history.saveUndoState(),setTimeout((function(){e.getParagraphElById(a.id).setCaret()}))}},e.prototype.addObjectPoll=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),1)[0],r=this.getParagraphById(t);if(t&&r){var a=(0,E.hasSeparator)(r);(0,se.showBox)("al_voting.php",{act:"box",owner_id:this.getArticleOwnerId(),ref:"article"},{containerClass:"article_poll_creation"}),window.cur.chooseMedia=function(r,i){if(r&&i){var n=e.buildParagraph({type:S.ParagraphType.ObjectPoll,mediaId:r,sep:a});I.ArticleEditorPreparedData.add(S.ParagraphType.ObjectPoll,r,{editable:!0,snippet:i}),a=!1,e.getOrCreateParagraphObject(n),e.insertParagraphIdBefore(t,n.id),e._redrawModel(),e.saveUndoStateAndDraft()}}}},e.prototype.editObjectPoll=function(e){var t=this,r=(0,i.__read)(e.getMediaId().split("_"),2),a=r[0],n=r[1],o=e.el(),s=(0,i.__read)(this.getContainingParagraphEl("boolean"==typeof o?null:o),3),l=s[1],d=s[2];if(l&&d){var c=(0,E.hasSeparator)(d);(0,se.showBox)("al_voting.php",{act:"box",voting_id:n,owner_id:a,ref:"article"},{containerClass:"article_poll_creation"}),window.cur.chooseMedia=function(r,i){var a=e.getCaptionEl(),n=!!a&&a.innerHTML;t.deleteParagraphById(l),(0,E.isMediaParagraph)(d)&&d._uuid&&t.forgetObject(d._uuid);var o=t.buildParagraph({type:S.ParagraphType.ObjectPoll,mediaId:r,sep:c});I.ArticleEditorPreparedData.add(S.ParagraphType.ObjectPoll,r,{editable:!0,snippet:i}),c=!1;var s=t.getOrCreateParagraphObject(o);t.insertParagraphIdBefore(l,o.id),t._redrawModel(),t.saveUndoStateAndDraft(),n&&s.setCaptionElHtml(n)}}},e.prototype.onObjectStateLoaded=function(){var e;this.saveDraft(),this.showObjectPicker(),null===(e=this.comments)||void 0===e||e.updateCommentElements()},e.prototype._hideObjectPicker=function(){this._objectPickerTooltip&&this._objectPickerTooltip.hide()},e.prototype.showObjectPicker=function(){if(!this.isLocked()&&window.cur.articleEditor){if(!this._objectPickerEl){var e=(0,q.getIcon24Cancel)().icon,t=(0,V.getIcon28PictureOutline)().icon,r=(0,ie.createElement)('<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_photo" onclick="cur.articleEditor.addObjectPhoto()" data-tooltip="'+(0,ne.getLang)("pages_article_object_picker_picture")+'">'+t+"</button>"),a=(0,G.getIcon28VideoCircleOutline)().icon,n=(0,ie.createElement)('<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_video" onclick="cur.articleEditor.addObjectVideo()" data-tooltip="'+(0,ne.getLang)("pages_article_object_picker_video")+'">'+a+"</button>"),o=(0,X.getIcon28MusicOutline)().icon,s=(0,ie.createElement)('<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_audio" onclick="cur.articleEditor.addObjectAudio()" data-tooltip="'+(0,ne.getLang)("pages_article_object_picker_music")+'">'+o+"</button>"),l=(0,K.getIcon28PollSquareOutline)().icon,d=(0,ie.createElement)('<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_poll" onclick="cur.articleEditor.addObjectPoll()" data-tooltip="'+(0,ne.getLang)("pages_article_object_picker_poll")+'">'+l+"</button>"),c=(0,Z.getIcon28MarketOutline)().icon,h=(0,ie.createElement)('<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_product" onclick="cur.articleEditor.addObjectMarketProduct()" data-tooltip="'+(0,ne.getLang)("pages_article_object_picker_market")+'">'+c+"</button>"),p=(0,Y.getIcon28GifOutline)().icon,u=(0,ie.createElement)('<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_doc" onclick="cur.articleEditor.addObjectDoc()" data-tooltip="'+(0,ne.getLang)("pages_article_object_picker_gif")+'">'+p+"</button>"),g=(0,Q.getIcon28QuoteOutline)().icon,m=(0,ie.createElement)('<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_sep" onclick="cur.articleEditor.addSeparator()" data-tooltip="'+(0,ne.getLang)("pages_article_object_picker_separator")+'">'+g+"</button>"),v=(0,ee.getIcon28TablecellsOutline)().icon,_=(0,ie.createElement)('<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_table" onclick="cur.articleEditor.addTable()" data-tooltip="'+(0,ne.getLang)("pages_article_object_picker_table")+'">'+v+"</button>");this._objectPickerEl=(0,ie.createElement)('<div class="article_editor_object_picker"><div class="article_editor_object_picker_icon">'+e+"</div></div>"),this._els.editor.appendChild(this._objectPickerEl);var f=window.SAKIntegration&&window.SAKIntegration.isIntegrated,y=(0,ie.createElement)('<div class="article_editor_object_picker_btns_wrap clear_fix"></div>');y.appendChild(r),!f&&y.appendChild(n),!f&&y.appendChild(s),y.appendChild(d),!f&&window.cur.articleEditor.getOptions().marketAttachProductEnabled&&y.appendChild(h),!f&&y.appendChild(u),y.appendChild(m),this.getOptions().modules.tables&&y.appendChild(_),this._objectPickerTooltip=new le.ElementTooltip(this._objectPickerEl,{content:y,forceSide:"right",cls:"article_editor_object_picker_tt",autoShow:!1,elClassWhenShown:"article_editor_object_picker_tt_shown",offset:[-4,0]}),this._objectPickerEl.addEventListener("mousedown",(function(e){return(0,ie.cancelEvent)(e)}))}var b=(0,i.__read)(this.getCurrentParagraphId(),2),C=b[0],w=b[1],P=this.traverseParentParagraph(C,(function(e){return e.type===S.ParagraphType.Table})),A=this.getParagraphById(C);if(!this.isMediaUploadMode()&&!1!==C&&C==w&&(0,E.isParagraphEmpty)(A,!0)&&A&&[E.isTextParagraph,E.isHeader2Paragraph,E.isHeader3Paragraph].some((function(e){return e(A)}))&&!P){var I=this.getParagraphElById(C);if(!I)return void(this._objectPickerEl.style.display="none");this._objectPickerEl.style.display="block";var L=(0,ie.getXY)(this._els.editor),T=(0,ie.getXY)(I)[1]-L[1],x=!1;this.uploadFloatList(),this.floatedObjects.forEach((function(e){e.startY<=T+15&&e.endY+30>=T&&(x=!0)})),this._objectPickerEl.style.left=(x?355:-40)+"px",this._objectPickerEl.style.top=T+"px"}else this._objectPickerEl.style.display="none"}},e.prototype._initLinksHrefTooltip=function(){var e=this;this._els.canvas.addEventListener("mouseover",(function(t){if("a"==t.target.tagName.toLowerCase()){if(e._linkTooltip&&e._linkTooltip.destroy(),e._formatTooltip&&e._formatTooltip.isShown())return;var r=t.target,i=(0,ae.clean)(r.getAttribute("href")||""),a=(0,E.decodeURL)(i);(0,E.isVKUrl)(i)||(i="/away.php?to="+encodeURIComponent(i)+"&utf=1"),e._linkTooltip=new le.ElementTooltip(r,{cls:"article_editor_link_show_tt",appendTo:e._els.editor,content:(0,ie.createElement)('<a target="_blank" rel="noopener" href="'+i+'" class="article_editor_link">'+a+"</a>"),getTargetBoundingBox:function(){var e=r.getBoundingClientRect();return{top:e.top+(0,ie.scrollGetY)(),left:e.left,width:e.width,height:e.height}}})}}))},e.prototype._isTrackedObjectEl=function(e){var t=e.dataset.uuid;return!!t&&!!this.getObject(t)},e.prototype._cloneObjectParagraphs=function(){var e=this,t={};(0,E.traverseTree)(this._els.canvas,(function(r){if(r&&(0,E.isObjectParagraphEl)(r)){var i=r.getAttribute("data-uuid")||"",a=parseInt(r.getAttribute("data-type")||"");if(t[i]){var n=e.getObject(i);i=fe(),e.getOrCreateParagraphObject(e.buildParagraph({type:a,_uuid:i,mediaId:n.getMediaId()})),r.dataset.uuid=i}t[i]=!0}}))},e.prototype._correctCursorToBeWithinCanvas=function(){var e=(0,i.__read)(n.SelectionManager.getRange(),2),t=e[0];e[1]&&t&&t.startContainer==this._els.canvas&&this.focusParagraph(this._ps[0])},e.prototype._triggerInputEvent=function(){this._els.canvas.dispatchEvent(new Event("input"))},e.prototype._toggleCodeBlocks=function(){var e,t,r;try{for(var a=(0,i.__values)(this.getSelectedParagraphs()),n=a.next();!n.done;n=a.next()){var o=n.value;void 0===r&&(r=!(0,E.isCodeParagraph)(o)),o.type=r?S.ParagraphType.Code:S.ParagraphType.Text}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}this.redraw(!0,!0)},e.prototype._removeExtraSeparators=function(){var e;(0,E.traverseTree)(this._els.canvas,(function(t){if(t instanceof HTMLElement){var r=t.dataset.sep;r&&(void 0!==e&&r==e&&delete t.dataset.sep,e=r)}}))},e.prototype._replaceAlienInlineTags=function(){var e=this,t=!1,r={b:"strong",i:"em"},i=function(a){var n=a.tagName.toLowerCase();if(r[n]){t||(e.cursor.saveCursorMarker(),t=!0);var o=document.createElement(r[n]);o.innerHTML=a.innerHTML,a.replaceWith(o)}else for(var s=Array.prototype.slice.call(a.childNodes),l=void 0;l=s.shift();)l.nodeType==Node.ELEMENT_NODE&&i(l)};return i(this._els.canvas),t&&this.cursor.restoreCursorFromMarker(),t},e.prototype._cleanParagraphsBRs=function(){this.traverseParagraphs((function(e){e.lines.forEach(E.cleanLineBRs)}))},e.prototype._initEvents=function(){var e=this;if(!this.isLocked()){this._setEventListener(window,"scroll",(function(){var t=(0,ie.scrollGetY)(),r=window.innerHeight;e.traverseParagraphs((function(i){var a,n;if((0,E.isMediaParagraph)(i)){var o=e.getParagraphElById(i.id);if(o){var s=(0,ie.getSize)(o),l=(0,ie.getXY)(o),d=l[1]<t+r&&l[1]+s[1]>t;null===(n=null===(a=i._object)||void 0===a?void 0:a.onViewport)||void 0===n||n.call(a,d)}}}))}));var t,r=0;this._setEventListener(document,"selectionchange",(function(){var a,o,l=(0,i.__read)(n.SelectionManager.getRange(),3),d=l[0],c=l[1],h=l[2];if(d&&!(0,ie.traverseParent)(d.commonAncestorContainer,(function(t){return t==e._els.canvas})))return void e.showObjectPicker();var p=(0,i.__read)(e.getCurrentParagraphId(),1)[0];if(!1!==p){if(!c&&d&&d.startContainer instanceof HTMLElement&&d.startContainer.classList.contains("article")){var u=e.getParagraphById(e._ps[r]);if(u&&(0,E.isMediaParagraph)(u))return void((m=null===(a=u._object)||void 0===a?void 0:a.getCaptionEl())&&n.SelectionManager.setCaretAtElement(m))}var g=d?d.startContainer:null;if(window.browser.msie&&g&&c&&(0,ie.findClosestElementWithSelector)(".article_ed__extra_controls",g))if("BUTTON"!==(g instanceof Element?g.tagName:null)){var m,v=e.getParagraphById(p);if(v&&(0,E.isMediaParagraph)(v))return void((m=null===(o=v._object)||void 0===o?void 0:o.getCaptionEl())&&m.focus())}d&&d.endContainer instanceof HTMLElement&&d.endContainer.hasAttribute("data-table-wrapper")?d.setEndAfter(d.endContainer):d&&d.startContainer instanceof HTMLElement&&d.startContainer.hasAttribute("data-table-wrapper")&&0!==d.startOffset&&(null==h||h.extend(d.startContainer.parentElement,(0,E.childNodeIndex)(d.startContainer))),r=e.getParagraphIndexById(p),e._highlightParagraphsInCurrentSelection(),e.showObjectPicker(),e._correctCaptionSelection(),e._ensureDummyParagraphs(),0==s&&e._showFormatTooltip(),e.cursor.saveLastCursor();var _=e.getParagraphById(p);(0,E.isMediaParagraph)(_)&&S.ResizableObjectTypes.includes(Number(null==_?void 0:_.type))?e.resizeTooltip&&(clearTimeout(t),t=setTimeout((function(){e._showResizeTooltip()}),100)):e.resizeTooltip&&e.resizeTooltip.isShown()&&e.resizeTooltip.hide()}else e.showObjectPicker()}));var a=!1,o=!1,s=!1;this._els.canvas.addEventListener("mousedown",(function(){var t;s=!0,e._setEventListener(window,"mouseup",t=function(r){s=!1,r.target instanceof Element&&r.target.classList.contains("article_format_btn_link")||(e._showFormatTooltip(),t&&window.removeEventListener("mouseup",t))})})),this._els.canvas.addEventListener("selectstart",(function(){e._hideFormatTooltip()})),this._els.canvas.addEventListener("copy",(function(t){var r,a,o=(0,i.__read)(n.SelectionManager.getRange(),3),s=o[0],l=o[1],d=o[2];if(s){if(l){var c=(0,i.__read)(e.getContainingParagraphEl(s.commonAncestorContainer),1)[0];c&&(0,E.isObjectParagraphEl)(c)&&(null===(r=t.clipboardData)||void 0===r||r.setData("text/plain","uuid:"+c.getAttribute("data-uuid")),t.preventDefault())}if(d){var h=(0,i.__read)(e.getContainingParagraphEl(s.startContainer),1)[0];if(h&&(0,E.isQuoteEl)(h))h.innerText.replace(/\n/g,"")===d.toString().replace(/\n/g,"")&&(null===(a=t.clipboardData)||void 0===a||a.setData("text/html",h.outerHTML),t.preventDefault())}}})),this._els.canvas.addEventListener("paste",(function(t){var r=(0,i.__read)(e.getCurrentParagraphId(),1)[0],a=e.getParagraphById(r);a&&!1!==r&&(e._handleLinkPasteToSelectedText(t),e._handleObjectPaste(t),e._handleLinkPaste(t),e._handlePhotoPaste(t),e._handlePlainTextPaste(t),e._fromPasteEvent=!0,a.parentId||(e._pasteCurrentIndex=e.getParagraphIndexById(r)))})),this._els.canvas.addEventListener("click",(function(e){var t,r;if(e.target instanceof Element&&"A"==e.target.tagName)return(0,ie.cancelEvent)(e);if(3===e.detail){var a=(0,i.__read)(n.SelectionManager.getRange(),1)[0];if(a&&(0,E.isParagraphEl)(a.endContainer)&&0===a.endOffset){var o=null===(t=a.endContainer.previousSibling)||void 0===t?void 0:t.lastChild;if(o){var s=0!==o.childNodes.length?o.childNodes.length:null===(r=o.textContent)||void 0===r?void 0:r.length;s&&n.SelectionManager.setRange(a.startContainer,a.startOffset,o,s)}}}})),this._els.canvas.addEventListener("dblclick",(function(){var t;if(window.browser.safari){var r=(0,i.__read)(n.SelectionManager.getRange(),1)[0];if(r&&r.startOffset===r.endOffset){var a=(0,i.__read)(e.getContainingParagraphEl(r.startContainer),1)[0],o=null===(t=null==a?void 0:a.textContent)||void 0===t?void 0:t.indexOf(" ");!o||-1!==o&&o!==r.endOffset||n.SelectionManager.setRange(a,0,r.endContainer,r.endOffset)}}}));var l=!1;this._els.canvas.addEventListener("input",(function(t){var r,s,d=!1;if(t.data===E.Space){var c=(0,i.__read)(e.getCurrentParagraphId(),1)[0],p=e.getParagraphById(c),u=(0,i.__read)(n.SelectionManager.getRange(),2),g=u[0],m=u[1];if(g&&m&&p){var v=void 0;if((0,E.isDummyNumericList)(p,!1)?v=E.NUMERIC_LIST_START:(0,E.isDummyBulletList)(p,!1)&&(v=E.BULLET_LIST_START),v){var _=p.lines[0].text.match(v);_&&g.startOffset===_[0].length+1&&(d=!0)}}}d&&e.cursor.saveLastCursor(),e._hideObjectPicker(),e.processH1(),e._deleteEmptyParagraph(),e.processAlienTables(),e._flattenAlienParagraphs(),e._expandBlockquoteParagraphs(h),e._expandCiteParagraphs(),e._removeExtraSeparators(),e._ensureDummyParagraphs();var f=e._replaceAlienInlineTags();window.browser.safari||e._els.canvas.normalize();var y=!1;if(e._fromPasteEvent||f||e.cursor.checkMarkerCursor()||t.data===E.Space&&!d||window.browser.mozilla&&e._els.canvas.firstChild&&e._els.canvas.firstChild.nodeType==Node.TEXT_NODE){var b=(0,i.__read)(n.SelectionManager.getRange(),2);g=b[0],m=b[1];if(g)if(m&&g.startContainer===e._els.canvas&&g.endContainer===e._els.canvas&&g.startOffset===g.endOffset&&(0,E.isTableEl)(e._els.canvas.children[g.startOffset])){var C=e._els.canvas.children[g.startOffset].querySelector("p");C&&n.SelectionManager.setCaretAtElement(C)}e.cursor.saveCursorMarker()}else y=e.cursor.getCursor();e._processEmojiImgs(),e._processAlienPhotos(),e._cloneObjectParagraphs(),e.removeDuplicateParagraphIds();var w=!1;if(e._ps.length>0&&e._ps.length!==e._els.canvas.children.length||e._fromPasteEvent?(w=!0,e.setAllParagraphsDirty(),e._ps=[],e.forgetAllParagraphIds(),Array.from(e._els.canvas.childNodes).forEach((function(t,r){var i=e._updateLineData(t);i&&(e._ps[r]=i.id)}))):e._dirty.map((function(t){return e.getParagraphElById(t)})).forEach(e._updateLineData.bind(e)),d){c=(0,i.__read)(e.getCurrentParagraphId(),1)[0];(p=e.getParagraphById(c))&&(e.history.saveUndoState(),e.convertTextParagraphToList(p))}if(l&&(e._cleanParagraphsBRs(),l=!1),e._ensureAtLeastOneParagraph(),e._ensureTitleParagraph(),e._fromPasteEvent)try{w=w||e._expandDoubleBRs()}catch(e){console.error(e)}e.redraw(w),e.cursor.restoreCursor(y),e._correctCursorToBeWithinCanvas(),e._dirty=[],o?e.history.saveUndoStateDelayed():e.history.saveUndoState(),a=o=!1,e._fromPasteEvent=!1,e.saveDraft(),e.history.undoable=!0,null===(s=(r=e.getOptions()).onUndoRedo)||void 0===s||s.call(r)})),this._setEventListener(window,"keydown",(function(t){var r=t.keyCode;if((t.metaKey||t.ctrlKey)&&r==E.Key.KeyA&&!(t.target instanceof HTMLInputElement)&&!(t.target instanceof HTMLTextAreaElement))return n.SelectionManager.selectElContents(e._els.canvas),(0,ie.cancelEvent)(t)}));var d,c=[],h=!1,p=1;this._els.canvas.addEventListener("keydown",(function(t){var r,s,u,g,m,_,f,y,b,C,w,P,A,I,L,T,x,M,B,O,k,R=t.keyCode,D=t.metaKey||t.ctrlKey,H=t.shiftKey,j=(0,i.__read)(n.SelectionManager.getRange(),2),W=j[0],N=j[1];if(W){var z=(0,i.__read)(e.getCurrentParagraphId(),2),F=z[0],U=z[1],q=e.getParagraphById(F);if(R==E.Key.Tab){var V=(0,i.__read)(e._getCurrentLiIndex(),2),G=(0,i.__read)(V[0],2),X=G[0],K=G[1],Z=(0,i.__read)(V[1],2),Y=Z[0],Q=Z[1];if((0,E.isArticleParagraphId)(Y)||(Y=X,Q=K),(0,E.isArticleParagraphId)(X)&&(0,E.isArticleParagraphId)(Y)&&"number"==typeof K&&"number"==typeof Q){var $=!0;if(e.traverseParagraphs(X,Y,(function(e){if(!e||!(0,E.isListParagraph)(e))return $=!1,!0})),$){e.history.saveUndoState();var J=!1;if(e.traverseParagraphs(X,Y,(function(t){for(var r=!1,i=t.id===X?K:0,a=t.id===Y?Q:t.lines.length-1,n=i;n<=a;n++){var o=e._getLineByIndex(t.id,n),s=e._getLineByIndex(t.id,n-1);o&&s&&(H?(o.level=Math.max(E.MIN_LISTS_LEVEL,Number(o.level)-1),r=!0,J=!0):(o.level=Math.min(E.MAX_LISTS_LEVEL,Number(null==s?void 0:s.level)+1,Number(o.level)+1),r=!0,J=!0))}r&&((0,E.normalizeLineLevels)(t.lines),e._setParagraphDirty(t.id))})),J){var ee=(0,E.getPathFromNodeToNode)(e._getLiElByIndex(X,K),W.startContainer),te=(0,E.getPathFromNodeToNode)(e._getLiElByIndex(Y,Q),W.endContainer),re=W.startOffset,ne=W.endOffset;e.redraw(),e.history.saveUndoState();var oe=(0,E.getNodeByPath)(e._getLiElByIndex(X,K),ee),se=(0,E.getNodeByPath)(e._getLiElByIndex(Y,Q),te);return n.SelectionManager.setRange(oe,re,se,ne),(0,ie.cancelEvent)(t)}}}}var le=!1;if((0,E.isMediaParagraph)(q))if(null===(y=null==q?void 0:q._object)||void 0===y?void 0:y.isCaptionFocused())le=Boolean(0==W.startOffset&&N);else le=(0,i.__read)(e.getContainingParagraphEl(W.startContainer),1)[0]==(null===(b=null==q?void 0:q._object)||void 0===b?void 0:b.el());if(le&&N&&window.browser.mozilla){if(R==E.Key.Up){var de=e.getParagraphById(e.getPrevParagraphIdById(F));return de&&e.focusParagraph(de.id,!0),(0,ie.cancelEvent)(t)}if(R==E.Key.Down){var ce=e.getParagraphById(e.getNextParagraphIdById(F));return ce&&e.focusParagraph(ce.id,!0),(0,ie.cancelEvent)(t)}}if((R==E.Key.Delete||R==E.Key.Backspace)&&e.resizeTooltip&&e.resizeTooltip.isShown()&&e.resizeTooltip.hide(),R==E.Key.Tab&&N&&F==e._ps[0])return n.SelectionManager.setCaretAtElement(e.getParagraphElById(e._ps[1])),(0,ie.cancelEvent)(t);if(D&&R==E.Key.KeyA)if((0,E.isMediaParagraph)(q))if(null===(C=null==q?void 0:q._object)||void 0===C?void 0:C.isCaptionFocused())return(gt=q._object.getCaptionEl())&&n.SelectionManager.selectElContents(gt),(0,ie.cancelEvent)(t);if(D)switch(R){case E.Key.KeyB:return e.setStrong(),(0,ie.cancelEvent)(t);case E.Key.KeyI:var he=e.selection.getCurrentSelectionState();return he&&!he.blockquote&&e.setEm(),(0,ie.cancelEvent)(t);case E.Key.KeyS:return e.saveDraft(!1,!1,!0),(0,ie.cancelEvent)(t);case E.Key.KeyZ:return H?e.history.redo():e.history.undo(),(0,ie.cancelEvent)(t);case E.Key.KeyY:return e.history.redo(),(0,ie.cancelEvent)(t)}var pe=R==E.Key.KeyC&&t.altKey,ue=q?q.type:S.ParagraphType.Text,ge=(0,ie.findClosestElementWithSelector)("pre",W.startContainer),me=!!(ge||(0,ie.findClosestElementWithSelector)("pre",W.endContainer)||W.startContainer instanceof Element&&"PRE"==W.startContainer.tagName);if(pe){if(ue===S.ParagraphType.Header1)return(0,ie.cancelEvent)(t);if(N)return e._toggleCodeBlocks(),(0,ie.cancelEvent)(t);if(!me&&[S.ParagraphType.Text,S.ParagraphType.NumericList,S.ParagraphType.BulletList].includes(ue)){e._setCurrentParagraphDirty();var ve=(0,ie.findClosestElementWithSelector)("code",W.startContainer)||(0,ie.findClosestElementWithSelector)("code",W.endContainer);if(ve){e.cursor.saveCursorMarker();var _e=(0,ie.createElement)("<span></span>");_e.innerHTML=ve.innerHTML,ve.replaceWith(_e),e._triggerInputEvent()}else document.execCommand("fontName",!1,"monospace"),window.browser.msie&&e._triggerInputEvent();return(0,ie.cancelEvent)(t)}}if(R==E.Key.Tab&&me&&ue==S.ParagraphType.Code)return document.execCommand("insertText",!1,"  "),(0,ie.cancelEvent)(t);var fe=!1;if(R==E.Key.Backspace){if(c.length)return c[0].textContent=c[1],e.cursor.restoreCursor(c[2]),c=[],(0,ie.cancelEvent)(t);if(F&&le){var ye=e.buildParagraph({sep:(0,E.hasSeparator)(q)});return e._correctEmptyParagraphAfterFloatObjects(),e.setParagraphById(F,ye),e.setParagraphDirty(F),e.redraw(),e.focusParagraph(F),e.saveUndoStateAndDraft(),(0,ie.cancelEvent)(t)}if(W&&(0==W.startOffset||""===W.startContainer.textContent&&1==W.startOffset)&&W.collapsed){var be=(0,i.__read)(e._getCurrentLiIndex(),1),Ce=(0,i.__read)(be[0],2),we=Ce[0],Ee=Ce[1],Pe=(0,E.isArticleParagraphId)(we)&&"number"==typeof Ee?e._getLiElByIndex(we,Ee):null,Se=(0,E.isArticleParagraphId)(we)&&"number"==typeof Ee?e._getLineByIndex(we,Ee):null;if("number"==typeof Ee&&(0,E.isArticleParagraphId)(we)&&e.hasTextContent(Pe)&&e.selection.atTheStart(Pe))if((null==Se?void 0:Se.level)===E.MIN_LISTS_LEVEL){e.history.saveUndoState();var Ae=e.getParagraphById(we);if(Ae){var Ie=(0,ae.clone)(Ae);delete Ie.id;var Le=e.buildParagraph(Ie),Te=e.buildParagraph(Ie);Le.lines=Le.lines.slice(0,Ee);var xe=e.buildParagraph({lines:[(0,ae.clone)(Ae.lines[Ee])]});Te.lines=Te.lines.slice(Ee+1),(0,E.normalizeLineLevels)(Te.lines);var Me=[Le,xe,Te].filter((function(e){return e.lines.length}));e.replaceParagraphId.apply(e,(0,i.__spreadArray)([we],(0,i.__read)(Me.map((function(e){return e.id}))),!1)),e.redraw(!0);var Be=e.getParagraphElById(xe.id);return n.SelectionManager.setCaretAtElement(Be),e.history.saveUndoState(),(0,ie.cancelEvent)(t)}}else if(Se&&Ee>0){var Oe=e._getLineByIndex(we,Ee-1),ke=e._getLiElByIndex(we,Ee-1);if(Oe&&ke){e.history.saveUndoState();var Re=Oe.text.length;Oe.text+=Se.text;try{for(var De=(0,i.__values)(Object.values(Se.decorations||{})),He=De.next();!He.done;He=De.next()){var je=He.value;try{for(var We=(u=void 0,(0,i.__values)(je||[])),Ne=We.next();!Ne.done;Ne=We.next()){var ze=Ne.value;ze[0]+=Re,ze[1]+=Re}}catch(e){u={error:e}}finally{try{Ne&&!Ne.done&&(g=We.return)&&g.call(We)}finally{if(u)throw u.error}}}}catch(e){r={error:e}}finally{try{He&&!He.done&&(s=De.return)&&s.call(De)}finally{if(r)throw r.error}}Oe.brs=Oe.brs||[],(m=Oe.brs).push.apply(m,(0,i.__spreadArray)([],(0,i.__read)((Se.brs||[]).map((function(e){return e+Re}))),!1)),Oe.decorations=Oe.decorations||{};try{for(var Fe=(0,i.__values)(["code","link","strong","strike","em"]),Ue=Fe.next();!Ue.done;Ue=Fe.next()){var qe=Ue.value;Oe.decorations[qe]=Oe.decorations[qe]||[],null===(w=Oe.decorations[qe])||void 0===w||w.push.apply(w,(0,i.__spreadArray)([],(0,i.__read)((null===(P=Se.decorations)||void 0===P?void 0:P[qe])||[]),!1))}}catch(e){_={error:e}}finally{try{Ue&&!Ue.done&&(f=Fe.return)&&f.call(Fe)}finally{if(_)throw _.error}}var Ve=e.getParagraphById(we);null==Ve||Ve.lines.splice(Ee,1),(0,E.normalizeLineLevels)((null==Ve?void 0:Ve.lines)||[]),e.history.saveUndoState(),e._setCurrentParagraphDirty();var Ge=e._getLiElByIndex(we,Ee);e.redraw();var Xe=(0,i.__read)(n.SelectionManager.getRange(),1)[0],Ke=e._getLiElByIndex(we,Ee-1);if(Xe&&Ke&&Ge){var Ze=Array.from(ke.childNodes).filter((function(e){return!(0,E.isBR)(e)})),Ye=Ze.findIndex((function(e){return(0,E.isListEl)(e)||(0,E.isLiEl)(e)})),Qe=-1===Ye?Ze.length:Ye,$e=Array.from(Ke.childNodes).filter((function(e){return!(0,E.isBR)(e)}));Qe=(0,E.isListEl)(ke.childNodes[Qe])||!$e[Qe]?Qe-1:Qe;var Je=Ke.childNodes[Qe],et=Ge.firstChild,tt=0;Je instanceof Element&&et instanceof Element&&(null===(A=Je.textContent)||void 0===A?void 0:A.length)!==(null===(I=et.textContent)||void 0===I?void 0:I.length)?tt=((null===(L=Je.textContent)||void 0===L?void 0:L.length)||0)-((null===(T=et.textContent)||void 0===T?void 0:T.length)||0):Je instanceof Text&&et instanceof Text&&Je.data.length!==et.data.length&&(tt=Je.data.length-et.data.length),n.SelectionManager.setRange(Ke.childNodes[Qe],tt,Ke.childNodes[Qe],tt)}return(0,ie.cancelEvent)(t)}}if("LI"!==W.startContainer.nodeName){var rt=(0,i.__read)(e.getCurrentParagraphId(),1)[0],it=e.getParagraphIndexById(rt),at=e.getParagraphById(e.getPrevParagraphIdById(rt));if(at&&((0,E.isMediaParagraph)(at)||(0,E.isTableParagraph)(at))){"number"==typeof it&&(0,E.isParagraphEmpty)(e.getParagraphById(rt))&&(e.deleteParagraphById(rt),e.redraw(!0));var nt=e.getParagraphElById(at.id);if((0,E.isMediaParagraph)(at))n.SelectionManager.setCaretAtElement(nt);else if((0,E.isTableParagraph)(at)){var ot=at.children.length,st=at.table_columns_count;nt.setCaret(ot-1,st-1,!0)}return(0,ie.cancelEvent)(t)}var lt=e.getParagraphById(rt),dt=e.getParagraphElById(rt);if(lt&&((0,E.isQuoteParagraph)(lt)||(0,E.isQuote2Paragraph)(lt))&&e.selection.atTheStart(dt))return lt.type=S.ParagraphType.Text,e.history.saveUndoState(),e._setCurrentParagraphDirty(),e.redraw(),(0,ie.cancelEvent)(t)}else if((0,E.isArticleParagraphId)(we)&&"number"==typeof Ee){if(0===Ee){e.history.saveUndoState();var ct=e.getParagraphById(we);e.history.saveUndoState(),null==ct||ct.lines.splice(Ee,1);ye=e.buildParagraph();return e.insertParagraphIdBefore(we,ye.id),0===(null==ct?void 0:ct.lines.length)&&e.deleteParagraphById(we),e.history.saveUndoState(),e.redraw(!0),e.focusParagraph(ye.id),(0,ie.cancelEvent)(t)}var ht=e.getParagraphById(we);return e.history.saveUndoState(),null==ht||ht.lines.splice(Ee,1),(0,E.normalizeLineLevels)((null==ht?void 0:ht.lines)||[]),e.history.saveUndoState(),e._setCurrentParagraphDirty(),e.redraw(),e._focusLiElByIndex(we,Ee-1,!0),(0,ie.cancelEvent)(t)}if((0,E.isArticleParagraphId)(we)&&window.browser.mozilla)if(dt=e.getParagraphElById(we)){var pt=(0,E.findDragButtonEl)(dt);pt&&pt.remove()}}var ut=e.traverseParentParagraph(F,(function(e){return e.type===S.ParagraphType.TableCell}));ut?e.setParagraphDirty(ut.id):e.setAllParagraphsDirty(),window.browser.msie&&setTimeout((function(){e._triggerInputEvent()}))}if(R==E.Key.Delete){var gt,mt=e.getParagraphById(F),vt=e.getParagraphById(e.getNextParagraphIdById(F)),_t=(0,i.__read)(n.SelectionManager.getCaretCharacterOffsetWithin(W.startContainer),1)[0],ft=(null===(x=W.startContainer.textContent)||void 0===x?void 0:x.length)==_t;if(F&&mt&&le)if(!((0,E.isMediaParagraph)(mt)&&(null===(M=null==mt?void 0:mt._object)||void 0===M?void 0:M.isCaptionFocused())&&!!mt.lines[0].text)){ye=e.buildParagraph();return e.setParagraphById(F,ye),e.setParagraphDirty(F),e.redraw(),e.focusParagraph(F),e.saveUndoStateAndDraft(),(0,ie.cancelEvent)(t)}if(N&&(0,E.hasSeparator)(vt)&&ft)return e._setParagraphDirty(e.getNextParagraphIdById(F)),null==vt||delete vt.sep,e.redraw(!1,!0),(0,ie.cancelEvent)(t);if(N&&ft&&(0,E.isMediaParagraph)(vt))return(0,E.isParagraphEmpty)(mt)&&!(0,E.isHeader1Paragraph)(mt)&&(e.deleteParagraphById(F),e.redraw(!0,!0)),(gt=null===(B=null==vt?void 0:vt._object)||void 0===B?void 0:B.getCaptionEl())&&n.SelectionManager.setCaretAtElement(gt),(0,ie.cancelEvent)(t);vt&&(0,E.isParagraphEmpty)(mt)&&((0,E.isHeader2Paragraph)(vt)||(0,E.isHeader3Paragraph)(vt))&&(mt&&(mt.type=vt.type),e._setParagraphDirty(F),e.redraw()),e.setAllParagraphsDirty(),(window.browser.msie&&0==W.startOffset&&F==e._ps[0]||H)&&setTimeout((function(){e._setCurrentParagraphDirty(),e._triggerInputEvent()}))}else if(R==E.Key.Enter){if(me&&ge&&ge.textContent&&ue==S.ParagraphType.Code&&N){var yt=ge.textContent.search(/[^\s]/);return-1==yt&&(yt=ge.textContent.length),document.execCommand("insertText",!1,"\n"+" ".repeat(yt)),(0,ie.cancelEvent)(t)}if(e._isWithinObjectParagraphEl(n.SelectionManager.getFocusedElement())){var bt=(0,i.__read)(e.getContainingParagraphEl(n.SelectionManager.getFocusedElement()),2)[1],Ct=e.buildParagraph({type:S.ParagraphType.Text,lines:[{brs:[],decorations:{},text:""}]}),wt=null===(O=e.getParagraphById(bt))||void 0===O?void 0:O._object;return!wt||wt.isCaptioned&&!wt.isCaptionFocused()?e.insertParagraphIdBefore(bt,Ct.id):e.insertParagraphIdAfter(bt,Ct.id),e.redraw(!0),e.focusParagraph(Ct.id),(0,ie.cancelEvent)(t)}var Et=(0,i.__read)(e.getContainingParagraphEl(n.SelectionManager.getFocusedElement()),3),Pt=(dt=Et[0],Et[2]);if(!Pt||!dt)return(0,ie.cancelEvent)(t);if((0,E.isArticleParagraphId)(F)&&(0,E.isListParagraph)(Pt)&&W&&N&&0==W.startOffset){var St=(0,i.__read)(e._getCurrentLiIndex(),1);if("number"==typeof(Mt=(0,i.__read)(St[0],2)[1]))if((Se=e._getLineByIndex(F,Mt))&&!Se.text&&Se.level&&1!==Se.level)return e.history.saveUndoState(),Se.level=Math.max(E.MIN_LISTS_LEVEL,Se.level-1),e.history.saveUndoState(),e._setCurrentParagraphDirty(),e.redraw(),e._focusLiElByIndex(F,Mt),(0,ie.cancelEvent)(t)}var At=(0,i.__read)(n.SelectionManager.getCaretCharacterOffsetWithin(dt),2)[1];if(t.shiftKey||t.ctrlKey&&window.browser.safari){for(var It=(0,i.__read)(n.SelectionManager.getCaretCharacterOffsetWithin(dt),2)[1],Lt=(0,i.__read)(e._getCurrentLiIndex(),1),Tt=(0,i.__read)(Lt[0],2),xt=Tt[0],Mt=Tt[1],Bt=((0,E.isArticleParagraphId)(xt)&&"number"==typeof Mt?e._getLiElByIndex(xt,Mt):null)&&"number"==typeof Mt?Mt:0,Ot=!1,kt=Pt.lines||[],Rt=0;Rt<kt.length;Rt++){var Dt=kt[Rt],Ht=Dt.brs,jt=Dt.text.length;if(0==It||It<=jt&&(null==Ht?void 0:Ht.includes(It))){Ot=!0;break}if((It-=jt)<=0&&Rt==Bt)break}if(Ot)return l=!0,(0,E.isArticleParagraphId)(xt)&&(0,E.isArticleParagraphId)(U)&&e._setParagraphDirty(xt,U),document.execCommand("insertParagraph"),(Te=null==dt?void 0:dt.nextSibling)&&Te instanceof HTMLElement&&(n.SelectionManager.setCaretAtElement(Te),Te.focus()),e._triggerInputEvent(),(0,ie.cancelEvent)(t);if(window.browser.msie&&0==It&&W.insertNode((0,ie.createElement)("<br>")),window.browser.safari&&t.shiftKey)return e.history.saveUndoState(),document.execCommand("insertLineBreak"),e._setCurrentParagraphDirty(),e._triggerInputEvent(),(0,ie.cancelEvent)(t)}var Wt=e.getParagraphById(Pt.parentId||!1);(0,E.isTableCellParagraph)(Wt)&&e.setParagraphDirty(Wt.id);var Nt=N&&W.startContainer.nodeType==Node.TEXT_NODE&&!W.startContainer.nextSibling&&At==(null===(k=dt.textContent)||void 0===k?void 0:k.length);h=Boolean(Nt&&!(0,E.isListParagraph)(Pt)&&!t.shiftKey&&((0,E.isQuoteParagraph)(Pt)||(0,E.isQuote2Paragraph)(Pt))),window.browser&&window.browser.msie&&setTimeout(e._triggerInputEvent.bind(e)),(0,E.isArticleParagraphId)(F)&&(0,E.isArticleParagraphId)(U)&&e._setParagraphDirty(F,U)}else t.key&&1==t.key.length?((0,E.isArticleParagraphId)(F)&&e._setParagraphDirty(F),(0,E.isArticleParagraphId)(U)&&e._setParagraphDirty(U),t.metaKey||(fe=!0,t.key&&((0,E.isCyrillicChar)(t.key)?p+=1:(0,E.isLatinChar)(t.key)&&(p-=1),p=Math.min(Math.max(p,-5),5))),a=(0,E.isWhiteSpaceChar)(t.key),fe&&!a&&(o=!0),setTimeout((function(){var t=(0,i.__read)(n.SelectionManager.getRange(),2),r=t[0],a=t[1],o=e.getParagraphById(F);if(o&&!((0,E.isCodeParagraph)(o)||r&&!!((0,ie.findClosestElementWithSelector)("code",r.startContainer)||r.startContainer instanceof Element&&"CODE"==r.startContainer.tagName))){var s=function(t,r,i,a,n){var o=e.cursor.getCursor(),s=(r.textContent||"").substring(0,t-i.length),l=(r.textContent||"").substring(t);n||(c=[r,s+i+l,o]),r.textContent=s+a+l,e.cursor.restoreCursor(o),e._setParagraphDirty(F),e._triggerInputEvent()};if(d=d||p>0,a&&r){var l=r.startContainer;if(l.nodeType==Node.TEXT_NODE&&r.startOffset>0)for(var h=(l.textContent||"").substring(r.startOffset-5,r.startOffset),u=0,g=v.Sequences.length;u<g;u++){var m=v.Sequences[u];if(void 0===m.cyrillic||m.cyrillic===d)if(m.pattern instanceof RegExp){var _=(h||"").match(m.pattern);if(_){var f=m.substitution;_.length>1&&(f=f.replace("$1",_[1])),s(r.startOffset,l,_[0],f,!!m.noUndo);break}}else if(null==h?void 0:h.endsWith(m.pattern)){s(r.startOffset,l,m.pattern,m.substitution,!!m.noUndo);break}}}}}),0)):!1;c=[]}})),this._setEventListener(window,"resize",(function(){e.resizeTooltip&&e.resizeTooltip.isShown()&&e._updatePositionResizeTooltip()}))}},e.prototype._getLiNodesFromParagraph=function(e){if(!(0,E.isArticleParagraphId)(e))return!1;var t=this.getParagraphById(e),r=this.getParagraphElById(e);if(!r||!t||!(0,E.isListParagraph)(t))return null;var i=[];return(0,E.traverseTree)(r,(function(e){e instanceof HTMLElement&&(0,E.isLiEl)(e)&&i.push(e)})),i},e.prototype._focusLiElByIndex=function(e,t,r){var a,o;if(!(0,E.isArticleParagraphId)(e))return!1;var s=this._getLiElByIndex(e,t);if(s)if(r){var l=null;try{for(var d=(0,i.__values)(Array.from(s.childNodes)),c=d.next();!c.done;c=d.next()){var h=c.value;if((0,E.isListEl)(h))break;l=h}}catch(e){a={error:e}}finally{try{c&&!c.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}n.SelectionManager.setCaretAtElement(l,r)}else n.SelectionManager.setCaretAtElement(s)},e.prototype._getLiElByIndex=function(e,t){if(!(0,E.isArticleParagraphId)(e))return null;var r=this._getLiNodesFromParagraph(e);return r&&t>=0?r[t]:null},e.prototype._getLineByIndex=function(e,t){if(!(0,E.isArticleParagraphId)(e))return null;var r=this.getParagraphById(e);return t>=0&&r?r.lines[t]:null},e.prototype._getCurrentLiIndex=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),2),r=t[0],a=t[1],o=(0,i.__read)(n.SelectionManager.getRange(),1)[0];if(!o)return[[!1,!1],[!1,!1]];var s=function(t,r){var i=e._getLiNodesFromParagraph(t);if(!i)return!1;var a="li"===(r instanceof Element?r.tagName.toLowerCase():"")?r:(0,ie.findClosestElementWithSelector)("li",r),n=i.findIndex((function(e){return e===a}));return-1!==n&&n},l=[[r,s(r,o.startContainer)],[a,s(a,o.endContainer)]];return!o.collapsed&&0===o.endOffset&&(0,E.isLiEl)(o.endContainer)&&"number"==typeof l[1][1]&&(0,E.isArticleParagraphId)(r)&&(0,E.isArticleParagraphId)(a)&&l[1][1]>0&&(l[1][1]=l[1][1]-1),l},e.prototype._isWithinObjectParagraphEl=function(e){var t=(0,i.__read)(this.getContainingParagraphEl(e),1)[0];return t&&(0,E.isObjectParagraphEl)(t)},e.prototype._highlightParagraphsInCurrentSelection=function(){this._highlightObjectsInCurrentSelection(),this._highlightTablesInCurrentSelection()},e.prototype._highlightObjectsInCurrentSelection=function(){var e=this,t=(0,i.__read)(this.getCurrentParagraphId(),2),r=t[0],a=t[1],n=this.getParagraphIndexById(r),o=this.getParagraphIndexById(a),s=this.getParagraphDepth(r);!1!==r&&!1!==a&&this.traverseParagraphs((function(t){var i=e.getParagraphIndexById(t.id);if((0,E.isMediaParagraph)(t)&&t._object){var l=r!=a,d=e.getParagraphDepth(t.id)===s;t._object.highlight(i>=n&&i<=o&&d,l)}}))},e.prototype._highlightTablesInCurrentSelection=function(){var e,t;try{for(var r=(0,i.__values)(this._ps),a=r.next();!a.done;a=r.next()){var n=a.value,o=this.getParagraphById(n);if((0,E.isTableParagraph)(o)){var s=this.getParagraphElById(n);s.handleSelectionChange&&s.handleSelectionChange()}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.getOrCreateParagraphObject=function(e){e._uuid||(e._uuid=fe());var t=this.getObject(e._uuid);if(!t){var r=e.mediaId||"";switch(Number(e.type)){case S.ParagraphType.ObjectPhoto:t=new d.ParagraphPhotoObject(r,this,e);break;case S.ParagraphType.ObjectVideo:t=new c.ParagraphVideoObject(r,this);break;case S.ParagraphType.ObjectGIF:t=new h.ParagraphGIFObject(r,this);break;case S.ParagraphType.ObjectAudio:t=new u.ParagraphAudioObject(r,this);break;case S.ParagraphType.ObjectAudioPlaylist:t=new l.ParagraphAudioPlaylistObject(r,this);break;case S.ParagraphType.ObjectPodcast:t=new p.ParagraphPodcastObject(r,this);break;case S.ParagraphType.ObjectTwitter:t=new _.ParagraphTwitterObject(r,this);break;case S.ParagraphType.ObjectInstagram:t=new y.ParagraphInstagramObject(r,this);break;case S.ParagraphType.ObjectFacebook:t=new f.ParagraphFacebookObject(r,this);break;case S.ParagraphType.ObjectVK:t=new b.ParagraphVKObject(r,this);break;case S.ParagraphType.ObjectTelegram:t=new C.ParagraphTelegramObject(r,this);break;case S.ParagraphType.ObjectPoll:t=new w.ParagraphPollObject(r,this);break;case S.ParagraphType.ObjectMarketItem:t=new g.ParagraphMarketProductObject(r,this);break;case S.ParagraphType.ObjectAliExpressProduct:t=new m.ParagraphMarketAliExpressProductObject(r,this)}this._setObject(e._uuid,t)}return e._object=t,t},e.prototype.forgetObject=function(e){delete this._objects[e]},e.prototype.getObject=function(e){return this._objects[e]||null},e.prototype._setObject=function(e,t){return this._objects[e]=t},e.prototype.convertTextParagraphToList=function(e){var t=e.lines[0],r=t.text.indexOf(E.Space)+1;if((0,E.isDummyNumericList)(e)){var i=t.text.match(/^\d+(?=\.)/);i&&((0,E.convertParagraphToNumericList)(e,Number(i[0])),this._removeParagraphLineTextPart(e.lines[0],0,r))}else(0,E.isDummyBulletList)(e)&&((0,E.convertParagraphToBulletList)(e),this._removeParagraphLineTextPart(e.lines[0],0,r))},e.prototype._updateLineData=function(e){var t,r;if(!e)return null;var a=e instanceof Element&&e.getAttribute("data-id")||void 0,n=this.getParentParagraphEl(e),o=n!==this._els.canvas&&n instanceof HTMLElement?n.getAttribute("data-id"):null;if(e instanceof HTMLElement&&this._isWithinObjectParagraphEl(e)){var s=(0,i.__read)((0,E.paragraphElProperties)(e),5),l=s[0],d=s[1],c=s[2],h=s[3],p=s[4],u=this.getObject(d);if(!u)return;r=this.buildParagraph({id:a,parentId:o});var g=u.getCaptionEl();if(g){var m=this._getParagraphFromHTML("",g.innerHTML,!0,(0,E.isAlienParagraphEl)(g));if(this.forgetParagraphById(m.id),parseInt(l)==S.ParagraphType.ObjectPhoto){var v=u.el().dataset.paragraphLines;v&&(r.lines=JSON.parse(v));var _=u.getImageIndex();r.lines[_]=m.lines[0];for(var f=0;f<r.lines.length;f++)r.lines[f]=r.lines[f]||{text:"",decorations:{}}}else r.lines[0]=m.lines[0]}r.type=parseInt(l),r.mode=parseInt(c),r._uuid=d,r._object=u,r.mediaId=u.getMediaId(),(0,E.isVideoParagraph)(r)&&(r.autoplay=h),e.getAttribute("comment-id")&&(r.comment_ids=null===(t=e.getAttribute("comment-id"))||void 0===t?void 0:t.split(",").map(Number)),p&&this.setParagraphById(p,r);var y=a?this.getParagraphIndexById(a):null;y&&(this._ps[y]=p)}else if(e instanceof HTMLElement&&((0,E.isTableEl)(e)||e.hasAttribute("data-table-wrapper"))&&this.getOptions().modules.tables){var b="table"===e.tagName.toLowerCase()?e:e.querySelector("table");r=this._getParagraphFromHTML("table",(null==b?void 0:b.innerHTML)||"",!1,(0,E.isAlienParagraphEl)(e),a)}else if(e instanceof Element){var C=e.tagName.toLowerCase();if(r=this._getParagraphFromHTML(C,e.innerHTML,!1,(0,E.isAlienParagraphEl)(e),a),(0,E.isNumericListParagraph)(r)){var w=Number(e.getAttribute("start"));r.start=Math.max(E.MIN_LIST_START,w,Number(null==r?void 0:r.start)||0)}}else r=this._getParagraphFromHTML("p",(0,ae.clean)(e.textContent||""),!1,!0,a);return e instanceof HTMLElement&&e.dataset.sep&&r&&(r.sep=!0),r.parentId=o,r},e.prototype.getCurrentParagraphs=function(){var e=(0,i.__read)(this.getCurrentParagraphId(),2),t=e[0],r=e[1];return[this.getParagraphElById(t),this.getParagraphElById(r)]},e.prototype.isLocked=function(){return!!this.getOptions().editLockMessage},e.prototype.showEditLockInfo=function(){this.isLocked()?(this.showWarningInfo(this.getOptions().editLockMessage),this._els.canvas.removeAttribute("contenteditable"),this._objectPickerEl.style.display="none",this._hideObjectPicker(),this._hideFormatTooltip()):this.showWarningInfo()},e.prototype.showRevEditInfo=function(){window.nav.objLoc.from_rev&&this.showWarningInfo((0,ne.getLang)("pages_article_rev_edit"))},e.prototype.showWarningInfo=function(e){var t=this._els.editor.querySelector(".article_ed__warn_info");if(t&&!e&&(this._els.editor.classList.remove("article_ed__warn_shown"),t.remove()),!t&&e){var r=(0,ie.createElement)('\n        <div class="article_ed__warn_info">\n            <div class="article_ed__warn_info_icon">'+(0,te.getIcon24WarningFilled)().icon+'</div>\n            <div class="article_ed__warn_info_text">'+e+"</div>\n        </div>");this._els.editor.appendChild(r),this._els.editor.classList.add("article_ed__warn_shown")}},e.prototype._initResizeTooltip=function(){var e=this,t=(0,ie.createElement)('<div class="resize-tooltip__btns article_format_btns clear_fix"></div>');this.resizeTooltip=new le.ElementTooltip(this._els.editor.parentNode,{content:t,autoShow:!1,customShow:!0,forceSide:"top",cls:"resize-tooltip article_format_tt"}),t.addEventListener("click",(function(t){var r=t.target.closest(".article_format_btn");if(r instanceof HTMLElement){var i=parseInt(r.dataset.mode||"");e.setModeCurrentObject(i)}}))},e.prototype._autoplayTooltipBtn=function(e){var t=this,r=document.createElement("button");r.classList.add("article_autoplay_btn-wrapper"),r.classList.toggle("on",!!e.autoplay);var i=(0,$.getIcon20CheckBoxOn)().icon,a=(0,J.getIcon20CheckBoxOff)().icon;return r.addEventListener("click",(function(e){e.target.classList.contains("article_autoplay_btn-wrapper")||(t.toggleAutoplayCurrentObject(),t._showResizeTooltip())})),r.appendChild((0,ie.createElement)('\n        <span class="article_autoplay_btn-checkbox">\n            '+(e.autoplay?i:a)+" \n        </span>     \n    ")),r.appendChild((0,ie.createElement)('\n        <div class="article_autoplay_btn">'+(0,ne.getLang)("pages_article_autoplay_edit")+"</div>        \n    ")),r},e.prototype._showResizeTooltip=function(){var e,t,r,a,n,o=(0,i.__read)(this.getCurrentParagraphId(),1)[0],s=this.getParagraphElById(o),l=this.getParagraphById(o);if(l){var d=Number(l.type);if(S.ResizableObjectTypes.includes(d))if(this.resizeTooltip&&!this.resizeTooltip.isShown()&&this.resizeTooltip.show(),null==s?void 0:s.classList.contains("article_ed__carousel_edit_open"))this.resizeTooltip.hide();else if((0,E.isMediaParagraph)(l)&&(null===(e=l._object)||void 0===e?void 0:e.isLoading()))this.resizeTooltip.hide();else{var c=[{id:S.ObjectResizeType.Float,type:"inline"},{id:S.ObjectResizeType.Normal,type:"text"},{id:S.ObjectResizeType.Medium,type:"bigger"},{id:S.ObjectResizeType.Large,type:"cover"}],h=document.querySelector(".resize-tooltip__btns");if(h){var p=[1,1,1,1],u=!1;(0,E.isPhotoParagraph)(l)?(null===(t=l._object)||void 0===t?void 0:t.isCarousel())?p=[0,1,1,0]:(null===(r=l._object)||void 0===r?void 0:r.isSmallPhotoSize())||(p=[1,1,0,0]):(0,E.isGIFParagraph)(l)?(null===(a=l._object)||void 0===a?void 0:a._isSmallGifSize())||(p=[1,1,0,0]):(0,E.isVideoParagraph)(l)?(null===(n=l._object)||void 0===n?void 0:n.platform)||(u=!0):[E.isTwitterParagraph,E.isFacebookParagraph,E.isInstagramParagraph,E.isVKParagraph,E.isTelegramParagraph].some((function(e){return e(l)}))&&(p=[1,1,0,0]),h.innerHTML="",this.comments&&(h.appendChild((0,ie.createElement)('\n          <button class="article_format_btn" onclick="cur.articleEditor.setComment(cur.articleEditor.getCurrentParagraphId()[0], \'resize\')">'+(0,pe.getIcon24CommentAddBadgeOutline)().icon+"</button>\n        ")),h.appendChild((0,ie.createElement)('\n          <div class="article_format_divider"></div>\n        '))),c.forEach((function(e,t){var r="";switch(e.type){case"inline":r=(0,j.getIcon24ObjectInlineFilled)().icon;break;case"text":r=(0,N.getIcon24ObjectTextFilled)().icon;break;case"bigger":r=(0,W.getIcon24ObjectBiggerFilled)().icon;break;case"cover":r=(0,z.getIcon24ObjectCoverFilled)().icon}p[t]&&h.appendChild((0,ie.createElement)('\n          <button class="article_format_btn'+((0,E.isObjectResize)(l)&&l.mode==e.id||(!(0,E.isObjectResize)(l)||!l.mode)&&!e.id?" article_format_btn_active":"")+" article_format_btn_"+e.type+'"  data-mode='+e.id+" >"+r+"</button>\n        "))})),u&&(h.appendChild((0,ie.createElement)('\n          <div class="article_format_divider"></div>\n        ')),h.appendChild(this._autoplayTooltipBtn(l))),this._updatePositionResizeTooltip()}}}},e.prototype._updatePositionResizeTooltip=function(){var e=this.resizeTooltip,t=(0,i.__read)((0,ie.getXY)(this._els.editor),2)[1],r=(0,i.__read)(this.getCurrentParagraphId(),1)[0],a=this.getParagraphElById(r),n=a instanceof Element?a.getBoundingClientRect():{},o=n.top,s=void 0===o?0:o,l=n.left,d=void 0===l?0:l,c=n.width,h=void 0===c?0:c,p=(0,ie.getSize)(e._ttel)[0]/2;e._ttel.style.top=s-t-60+window.scrollY+140+"px",e._ttel.style.left=d+h/2-p+"px"},e.prototype.setModeObject=function(e,t){var r,i;if(void 0===t&&(t=S.ObjectResizeType.Normal),(0,E.isArticleParagraphId)(e)){var a=this.getParagraphById(e);a&&(0,E.isMediaParagraph)(a)&&(a.mode=t,this._correctEmptyParagraphAfterFloatObjects(),this.redraw(!0,!0),(0,E.isPhotoParagraph)(a)&&(this.getOrCreateParagraphObject(a),(null===(r=a._object)||void 0===r?void 0:r.isCarousel())&&(null===(i=a._object)||void 0===i||i.fixSize())),this.saveUndoStateAndDraft())}},e.prototype.setModeCurrentObject=function(e){void 0===e&&(e=S.ObjectResizeType.Normal);var t=(0,i.__read)(this.getCurrentParagraphId(),1)[0];(0,E.isArticleParagraphId)(t)&&this.setModeObject(t,e)},e.prototype.toggleAutoplayCurrentObject=function(){var e=(0,i.__read)(this.getCurrentParagraphId(),1)[0];if((0,E.isArticleParagraphId)(e)){var t=this.getParagraphById(e);(0,E.isVideoParagraph)(t)&&(t.autoplay=!t.autoplay,this._setParagraphDirty(e),this.redraw(),this.saveUndoStateAndDraft())}},e.prototype.uploadFloatList=function(){var e=this,t=(0,ie.getXY)(this._els.editor);this.floatedObjects=[],this.traverseParagraphs((function(r){if((0,E.isObjectResize)(r)&&r.mode&&Number(r.mode)===S.ObjectResizeType.Float){var i=e.getParagraphElById(r.id);if(i){var a=i.getBoundingClientRect().height,n=void 0===a?0:a,o=(0,ie.getXY)(i);e.floatedObjects.push({startY:o[1]-t[1],endY:o[1]-t[1]+n})}}}))},e.prototype._correctEmptyParagraphAfterFloatObjects=function(){var e=this;this.traverseParagraphs((function(t){var r=e.getParagraphById(e.getNextParagraphIdById(t.id));if(r&&(0,E.isObjectResize)(t)){var i="string"==typeof t.mode?parseInt(t.mode):t.mode;if(i>=0)if(1===i&&(0,E.isMediaParagraph)(r)&&!(0,E.isObjectResize)(r)){var a=e.buildParagraph();a._autoInsert=!0,e.insertParagraphIdAfter(t.id,a.id)}else 1!==i&&r&&r._autoInsert&&e.deleteParagraphById(e.getNextParagraphIdById(t.id))}}))},e.prototype._deleteEmptyParagraph=function(){var e=this;Array.from(this._els.canvas.children).forEach((function(t){if("p"!==t.tagName.toLowerCase()||t.childNodes.length){var r=(0,E.findParagraphToolsEl)(t);if(r&&t.innerHTML===r.outerHTML){t.remove();var i=t.getAttribute("data-id");i&&e.deleteParagraphById(i)}(0,E.isEditorInnerComponent)(t)&&t.remove()}else t.remove()}))},e.prototype._checkCarouselEditorScroll=function(){var e=this._els.editor.querySelector(".article_ed__caredit_items_wrap");return e?e.scrollTop:null},e.prototype._setCarouselEditorScroll=function(e){var t=this._els.editor.querySelector(".article_ed__caredit_items_wrap");t&&(t.scrollTop=e)},e.prototype.insertParagraphIdAfter=function(e){for(var t,r,a,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];if(n.every(E.isArticleParagraphId)&&(0,E.isArticleParagraphId)(e)){var s=this.getParagraphById(e);if(s){var l=this.getParagraphIndexById(e);if("number"==typeof l)if(s.parentId){var d=this.getParagraphById(s.parentId);if(!d||!(0,E.paragraphHasChildren)(d))return;try{for(var c=(0,i.__values)(n),h=c.next();!h.done;h=c.next()){var p=h.value,u=this.getParagraphById(p);if(!u)return;u.parentId=d.id}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}(a=d.children).splice.apply(a,(0,i.__spreadArray)([l+1,0],(0,i.__read)(n),!1))}else this.insertParagraphAt.apply(this,(0,i.__spreadArray)([l+1],(0,i.__read)(n),!1))}}},e.prototype.insertParagraphIdBefore=function(e){for(var t,r,a,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];if(n.every(E.isArticleParagraphId)&&(0,E.isArticleParagraphId)(e)){var s=this.getParagraphById(e);if(s){var l=this.getParagraphIndexById(e);if("number"==typeof l)if(s.parentId){var d=this.getParagraphById(s.parentId);if(!d||!(0,E.paragraphHasChildren)(d))return;try{for(var c=(0,i.__values)(n),h=c.next();!h.done;h=c.next()){var p=h.value,u=this.getParagraphById(p);if(!u)return;u.parentId=d.id}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}(a=d.children).splice.apply(a,(0,i.__spreadArray)([l,0],(0,i.__read)(n),!1))}else this.insertParagraphAt.apply(this,(0,i.__spreadArray)([l],(0,i.__read)(n),!1))}}},e.prototype.replaceParagraphId=function(e){for(var t,r,a,n,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];if(o.every(E.isArticleParagraphId)&&(0,E.isArticleParagraphId)(e)){var l=this.getParagraphById(e);if(l){var d=this.getParagraphIndexById(e);if("number"==typeof d)if(this.forgetParagraphById(e),l.parentId){var c=this.getParagraphById(l.parentId);if(!c||!(0,E.paragraphHasChildren)(c))return;try{for(var h=(0,i.__values)(o),p=h.next();!p.done;p=h.next()){var u=p.value,g=this.getParagraphById(u);if(!g)return;g.parentId=c.id}}catch(e){r={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(r)throw r.error}}(n=c.children).splice.apply(n,(0,i.__spreadArray)([d,1],(0,i.__read)(o),!1))}else(t=this._ps).splice.apply(t,(0,i.__spreadArray)([d,1],(0,i.__read)(o),!1))}}},e.prototype.getNewParagraphId=function(){return(0,re.v4)()},e.prototype.buildParagraph=function(e){void 0===e&&(e={});var t={id:e.id||this.getNewParagraphId(),parentId:e.parentId||null,type:e.type?e.type:S.ParagraphType.Text,lines:e.lines||[{text:"",decorations:{},brs:[]}]};return"_uuid"in e&&e._uuid&&(t._uuid=e._uuid),e.type===S.ParagraphType.NumericList&&(t.start="start"in e&&e.start?e.start:E.MIN_LIST_START),"mediaId"in e&&e.mediaId&&(t.mediaId=e.mediaId),e.sep&&(t.sep=e.sep),"fromExtPage"in e&&e.fromExtPage&&(t.fromExtPage=e.fromExtPage),"children"in e&&e.children&&(t.children=e.children),"table_bg_color_row"in e&&e.table_bg_color_row&&(t.table_bg_color_row=e.table_bg_color_row),"table_bg_color_column"in e&&e.table_bg_color_column&&(t.table_bg_color_column=e.table_bg_color_column),"table_columns_count"in e&&e.table_columns_count&&(t.table_columns_count=e.table_columns_count),"table_columns_resized"in e&&e.table_columns_resized&&(t.table_columns_resized=e.table_columns_resized),"table_columns_width"in e&&e.table_columns_width&&(t.table_columns_width=e.table_columns_width),"table_has_row_header"in e&&void 0!==e.table_has_row_header&&(t.table_has_row_header=e.table_has_row_header),this.store[t.id]=t,t},e.prototype.getParagraphById=function(e){return(0,E.isArticleParagraphId)(e)&&this.store.hasOwnProperty(e)?this.store[e]:null},e.prototype.setParagraphById=function(e,t){(0,E.isArticleParagraphId)(e)&&t&&(e!==t.id&&(this.forgetParagraphById(t.id),t.id=e),this.store[e]=t)},e.prototype.forgetAllParagraphIds=function(){this.store={}},e.prototype.forgetParagraphById=function(e){var t,r;if((0,E.isArticleParagraphId)(e)){var a=this.getParagraphById(e);if(a&&(this.store.hasOwnProperty(e)&&delete this.store[e],(0,E.paragraphHasChildren)(a)))try{for(var n=(0,i.__values)(a.children),o=n.next();!o.done;o=n.next()){var s=o.value;this.forgetParagraphById(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}},e.prototype.getParagraphDepth=function(e){for(var t=this.getParagraphById(e),r=0;t&&t.parentId;)t=this.getParagraphById(t.parentId),r++;return r},e.prototype.getParagraphIndexById=function(e){var t,r=this.getParagraphById(e);if(!r)return!1;if(r.parentId){var i=this.getParagraphById(r.parentId);if(!i||!(0,E.paragraphHasChildren)(i))return!1;t=i.children.findIndex((function(t){return t===e}))}else t=this._ps.findIndex((function(t){return t===e}));return-1!==t&&t},e.prototype.getNextParagraphIdById=function(e){var t=this.getParagraphById(e);if(null==t?void 0:t.parentId){var r=this.getParagraphById(t.parentId);if((0,E.paragraphHasChildren)(r)){var i=r.children.findIndex((function(t){return t===e}));return r.children[i+1]||!1}return!1}var a=this.getParagraphIndexById(e);return"number"==typeof a&&this._ps[a+1]||!1},e.prototype.isFirstParagraph=function(e){var t=this.getPrevParagraphIdById(e);return!(0,E.isArticleParagraphId)(t)},e.prototype.isLastParagraph=function(e){var t=this.getNextParagraphIdById(e);return!(0,E.isArticleParagraphId)(t)},e.prototype.getPrevParagraphIdById=function(e){var t=this.getParagraphById(e);if(null==t?void 0:t.parentId){var r=this.getParagraphById(t.parentId);if((0,E.paragraphHasChildren)(r)){var i=r.children.findIndex((function(t){return t===e}));return r.children[i-1]||!1}return!1}var a=this.getParagraphIndexById(e);return"number"==typeof a&&this._ps[a-1]||!1},e.prototype.getParentParagraphEl=function(e){var t=this;if(e.parentElement)return(0,ie.traverseParent)(e.parentElement,(function(e){return e==t._els.canvas||null!==e.getAttribute("data-id")}),E.MAX_DOM_DEPTH)},e.prototype.getSelectedParagraphs=function(){var e=(0,i.__read)(this.getCurrentParagraphId(),2),t=e[0],r=e[1];if(!(0,E.isArticleParagraphId)(t))return[];if((r=r||t)===t){var a=this.getParagraphById(t);return a?[a]:[]}var n=[];return this.traverseParagraphs(t,r,(function(e){n.push(e)})),n},e.prototype.traverseParagraphs=function(e,t,r){var a,n,o,s,l;if((0,E.isArticleParagraphId)(e)&&(0,E.isArticleParagraphId)(t)&&"function"==typeof r)o=e,s=t,l=r;else if((0,E.isArticleParagraphId)(e)&&"function"==typeof t)o=e,s=e,l=t;else{if("function"!=typeof e)return;o=this._ps[0],s=this._ps[this._ps.length-1],l=e}for(var d=o;(0,E.isArticleParagraphId)(d);){var c=this.getParagraphById(d),h=void 0;if(!c)return;if(void 0!==(h=l(c)))return h;if((0,E.paragraphHasChildren)(c))try{for(var p=(a=void 0,(0,i.__values)(c.children)),u=p.next();!u.done;u=p.next()){var g=u.value,m=this.traverseParagraphs(g,l);if(void 0!==m)return m;if(g===s)return}}catch(e){a={error:e}}finally{try{u&&!u.done&&(n=p.return)&&n.call(p)}finally{if(a)throw a.error}}if(d===s)return;d=this.getNextParagraphIdById(d)}},e.prototype.mapParagraphs=function(e){var t,r,a=this,n={},o=[],s=function(t){var r=a.getParagraphById(t);if(r){var i=e(r);if(null==i?void 0:i.children){for(var o=[],l=0;l<i.children.length;l++){var d=s(i.children[l]);d&&(o.push(d.id),n[d.id]=d)}i.children=o}return i&&(n[i.id]=i),i}};try{for(var l=(0,i.__values)(this._ps),d=l.next();!d.done;d=l.next()){var c=d.value,h=s(c);h&&o.push(h.id)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return{ps:o,store:n}},e.prototype.traverseParentParagraph=function(e,t){for(var r=this.getParagraphById(e);r&&!t(r);)r=this.getParagraphById(r.parentId||!1);return r},e.prototype.removeDuplicateParagraphIds=function(){var e=new Set;(0,E.traverseTree)(this._els.canvas,(function(t){if(t instanceof HTMLElement){var r=t.getAttribute("data-id");e.has(r)?t.removeAttribute("data-id"):e.add(r)}}))},e.prototype.setDecorationForSelectParagraphs=function(e,t,r,a){var o=this;void 0===t&&(t=[]),void 0===r&&(r="toggle");var s=(0,i.__read)(this.getCurrentParagraphId(),2),l=s[0],d=s[1],c=(0,i.__read)(n.SelectionManager.getRange(),1)[0];c&&l&&d&&(this.traverseParagraphs(l,d,(function(i){var n,s=o.getParagraphElById(i.id);s&&s instanceof HTMLElement&&(((0,E.isObjectParagraph)(i)&&null===(null===(n=c.startContainer.parentElement)||void 0===n?void 0:n.closest(".article_ed__figcaption"))||(0,E.isTableParagraph)(i))&&a?a(i):(0,E.isListParagraph)(i)?o.setDecorationForSelectList(e,i,s,l!==i.id,t,r):(0,E.isObjectParagraph)(i)?o.setDecorationForSelectCaptionInCarousel(e,i,t,r):o.setDecorationForSelectSimpleParagraph(e,i,s,l!==i.id,t,r))})),this._setCurrentParagraphDirty(),this.redraw())},e.prototype.setDecorationForSelectList=function(e,t,r,a,o,s){var l=this;void 0===o&&(o=[]);var d=(0,i.__read)(n.SelectionManager.getRangeInParagraphForDecoration(r,a),2),c=d[0],h=d[1],p=0;t.lines.forEach((function(r,i){var a=0,n=0,d=!1;c>=p&&h<=p+r.text.length?(a=c-p,n=h-p,d=!0):c>=p&&c<p+r.text.length?(a=c-p,n=r.text.length,d=!0):h<=p+r.text.length&&h>p?(n=h-p,d=!0):c<p&&h>p+r.text.length&&(n=r.text.length,d=!0),d&&l.addOrDeleteDecorationInLine(e,t.lines[i],a,n,s,o),p+=r.text.length}))},e.prototype.setDecorationForSelectCaptionInCarousel=function(e,t,r,a){var o,s,l;void 0===r&&(r=[]);var d=(0,E.isPhotoParagraph)(t)&&(null===(o=t._object)||void 0===o?void 0:o.isCarousel())&&(null===(s=t._object)||void 0===s?void 0:s.getImageIndex())||0,c=(0,E.isObjectParagraph)(t)?null===(l=t._object)||void 0===l?void 0:l.getCaptionEl():null,h=(0,i.__read)(c?n.SelectionManager.getRangeInParagraphForDecoration(c):[0,0],2),p=h[0],u=h[1];this.addOrDeleteDecorationInLine(e,t.lines[d],p,u,a,r)},e.prototype.setDecorationForSelectSimpleParagraph=function(e,t,r,a,o,s){void 0===o&&(o=[]);var l=(0,i.__read)(n.SelectionManager.getRangeInParagraphForDecoration(r,a),2),d=l[0],c=l[1];t.lines.length>0&&this.addOrDeleteDecorationInLine(e,t.lines[0],d,c,s,o)},e.prototype.replaceOrClearComments=function(e,t){var r=this;Object.entries(this.store).forEach((function(a){var n=(0,i.__read)(a,2),o=n[0],s=n[1];if(s.comment_ids){var l=s.comment_ids.join(",");s.comment_ids=void 0!==t?s.comment_ids.map((function(r){return e===r?t:r})):s.comment_ids.filter((function(t){return t!==e})),0===s.comment_ids.length&&delete s.comment_ids,s.comment_ids&&l===s.comment_ids.join(",")||r.setParagraphDirty(o)}s.lines.forEach((function(i){if(i.decorations&&i.decorations.comment){var a=i.decorations.comment.join(",");void 0!==t?i.decorations.comment.forEach((function(r){return r[2]=r[2]===e?t:r[2]})):i.decorations.comment=i.decorations.comment.filter((function(t){return t[2]!==e})),0===i.decorations.comment.length&&delete i.decorations.comment,i.decorations.comment&&a===i.decorations.comment.join(",")||r.setParagraphDirty(o)}}))}))},e.prototype.addOrDeleteDecorationInLine=function(e,t,r,a,n,o){var s,l;if(void 0===n&&(n="toggle"),void 0===o&&(o=[]),t.decorations){var d=function(e){var t=[];return e.forEach((function(e){var n=Number(e[0]),o=Number(e[1]),s=e.length>2?e.slice(2):[];r<=n&&a>=o||(r>n&&a<o?(t.push((0,i.__spreadArray)([n,r],(0,i.__read)(s),!1)),t.push((0,i.__spreadArray)([a,o],(0,i.__read)(s),!1))):r<=o&&r>=n?t.push((0,i.__spreadArray)([n,r],(0,i.__read)(s),!1)):a>=n&&a<=o?t.push((0,i.__spreadArray)([a,o],(0,i.__read)(s),!1)):t.push(e))})),t};if(t.decorations[e]||"delete"===n){if("add"===n)t.decorations[e].push((0,i.__spreadArray)([r,a],(0,i.__read)(o),!1));else if("delete"===n)t.decorations[e]=d(t.decorations[e]);else if(0===o.length){var c=t.decorations[e].filter((function(e){return a>Number(e[0])&&r<Number(e[1])})).length;if(0===c)null===(l=t.decorations[e])||void 0===l||l.push([r,a]);else if(c>=2)t.decorations[e]=d(t.decorations[e]),t.decorations[e].push([r,a]);else{var h=t.decorations[e].findIndex((function(e){return a>Number(e[0])&&r<Number(e[1])})),p=t.decorations[e].splice(h,1)[0],u=Number(p[0]),g=Number(p[1]);r>u&&a<g?(t.decorations[e].push([u,r]),t.decorations[e].push([a,g])):r===u&&a<g?t.decorations[e].push([a,g]):a===g&&r>u?t.decorations[e].push([u,r]):r<u&&a>g?t.decorations[e].push([r,a]):a>=g&&r!==u?t.decorations[e].push([u,a]):r<=u&&a!==g&&t.decorations[e].push([r,g])}}}else t.decorations[e]=[],null===(s=t.decorations[e])||void 0===s||s.push((0,i.__spreadArray)([r,a],(0,i.__read)(o),!1));t.decorations[e].sort((function(e,t){return Number(e[0])-Number(t[0])}));var m=[];t.decorations[e].forEach((function(e,t){if(0!==t){var r=Number(e[0]),a=Number(e[1]),n=e.length>2?e.slice(2):[],o=JSON.stringify(n),s=m[m.length-1],l=Number(s[0]),d=Number(s[1]),c=JSON.stringify(s.length>2?s.slice(2):[]);r<=d&&o===c?(m.pop(),m.push((0,i.__spreadArray)([l,a],(0,i.__read)(n),!1))):m.push(e)}else m.push(e)})),t.decorations[e]=m}},e.prototype.removeAllParagraphTools=function(){this._els.canvas.querySelectorAll("."+E.ArticleEditorParagraphToolsClass).forEach((function(e){return e.remove()}))},e.prototype.hasTextContent=function(e){return e&&Boolean(e.textContent)},e}()},164451:(e,t,r)=>{"use strict";r.d(t,{ArticleEditorCarousel:()=>m});var i=r(570655),a=r(595800),n=r(501389),o=r(650588),s=r(83178),l=r(70162),d=r(146143),c=r(622858),h=r(390237),p=r(244817),u=r(975624);function g(e,t){return e?'<div class="article_ed__caredit_item article_ed__caredit_item_photo" data-media-id="'+t+'">\n      <div class="article_ed__caredit_photo" style="background-image: url('+e+')"></div>\n      <div class="article_ed__caredit_remove"><div class="article_ed__caredit_remove_icon"></div></div>\n    </div>':'<button class="article_ed__caredit_item article_ed__caredit_item_add" nodrag="1">\n      <div class="article_ed__caredit_icon">'+(0,p.getIcon24CameraOutline)().icon+'</div>\n      <div class="article_ed__caredit_item_text">'+(0,l.getLang)("pages_article_ed_carousel_add")+"</div>\n    </button>"}var m=function(){function e(e,t,r,n,s){var c=this,p='<div class="article_ed__caredit">\n                  <div class="article_ed__caredit_inner">\n    ';p+='\n      <div class="article_ed__caredit_header">\n        <div class="article_ed__caredit_container">\n          '+(0,l.getLang)("pages_article_ed_carousel_title")+'\n          <div class="article_ed__caredit_header_controls">\n            <div class="article_ed__caredit_header_counter"></div>\n            <button class="flat_button article_ed__caredit_save">'+(0,l.getLang)("global_save")+'</button>\n            <button class="flat_button article_ed__caredit_cancel">'+(0,l.getLang)("global_cancel")+"</button>\n          </div>\n         </div>\n      </div>\n    ",p+='\n      <div class="article_ed__caredit_items_wrap article_ed__caredit_container">\n        <div class="article_ed__caredit_items">\n    ',t.getMediaId().split(",").forEach((function(e){var t=a.ArticleEditorPreparedData.get(o.ParagraphType.ObjectPhoto,e),r=(0,i.__read)((0,o.getAppropriateImage)(t.sizes,251),1)[0];p+=g(r,e)})),p+=g(),p+="  </div>",p+="</div>",p+='</div>\n             <div class="article_ed__caredit_loading" style="display: none">'+(0,u.getIcon48LoaderWhite)().icon+"</div>\n           </div>";var m=(0,h.createElement)(p);this._els={editor:m,itemsWrap:m.querySelector(".article_ed__caredit_items_wrap"),items:m.querySelector(".article_ed__caredit_items"),addButton:m.querySelector(".article_ed__caredit_item_add"),saveButton:m.querySelector(".article_ed__caredit_save"),cancelButton:m.querySelector(".article_ed__caredit_cancel"),loading:m.querySelector(".article_ed__caredit_loading"),counter:m.querySelector(".article_ed__caredit_header_counter")},this._els.addButton.addEventListener("click",(function(){(0,d.showBox)("al_photos.php",{to_id:t.getEditor().getArticleOwnerId(),act:"choose_photo",max_files:c._limit-c._medias.length,article:1},{cache:1,stat:[window.jsc("web/photos.js"),"photos.css",window.jsc("web/upload.js")]}),window.cur.chooseMedia=c._onPhotoAdd.bind(c),window.cur.showMediaProgress=function(){c._els.loading.style.display="block",t.getEditor().setMediaUploadMode(!0)},window.cur.choosePhotoUploadedAll=function(){c._els.loading.style.display="none",t.getEditor().setMediaUploadMode(!1)}})),this._onSave=r,this._els.saveButton.addEventListener("click",this.save.bind(this)),this._els.cancelButton.addEventListener("click",this.cancel.bind(this)),this._els.items.addEventListener("click",(function(e){if(e.target instanceof HTMLElement&&e.target.classList.contains("article_ed__caredit_remove")){var t=(0,h.findClosestElementWithSelector)(".article_ed__caredit_item",e.target);null==t||t.remove(),c._collectMediaIds(),c._initSorter(),c._toggleAddButton(),c._updateCounter()}})),e.appendChild(this._els.editor),this._els.itemsWrap.style.height=(0,h.getSize)(this._els.itemsWrap)[1]+"px",this._initSorter(),this._limit=n,this._showedError=!1,this._originalMedias=this._collectMediaIds(),this._originalCaptions=s.slice(),this._captions=s.slice(),this._toggleAddButton(),this._updateCounter()}return e.prototype.cancel=function(){this._els.editor.remove(),this._onSave(this._originalMedias.join(","),this._originalCaptions)},e.prototype.save=function(){this._els.editor.remove(),this._onSave(this._medias.join(","),this._captions)},e.prototype._updateCounter=function(){this._els.counter.innerHTML=(0,l.getLang)("pages_aricle_ed_carousel_counter",this._medias.length)},e.prototype._toggleAddButton=function(){this._els.addButton.style.display=this._medias.length<this._limit?"block":"none"},e.prototype._collectMediaIds=function(){var e,t;this._medias=[],this._captions=[];var r=function(e){if(e instanceof HTMLElement){var t=e.dataset.mediaId;if(t&&(a._medias.push(t),a._originalMedias&&a._originalCaptions)){var r=a._originalMedias.findIndex((function(e){return e===t}));-1!==r?a._captions.push(a._originalCaptions[r]):a._captions.push({text:"",decorations:{},brs:[]})}}},a=this;try{for(var n=(0,i.__values)(this._els.items.children),o=n.next();!o.done;o=n.next()){r(o.value)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return this._medias=this._medias.slice(0,this._limit),this._captions=this._captions.slice(0,this._limit),this._medias},e.prototype.addPhoto=function(e,t,r){void 0===r&&(r=0),this._onPhotoAdd("photo",e,t,r)},e.prototype._onPhotoAdd=function(e,t,r,c){var p,u=this;if(!this._medias.includes(t)&&this._medias.length<this._limit){a.ArticleEditorPreparedData.add(o.ParagraphType.ObjectPhoto,t,{size:(0,s.getPhotoSize)(r.editable.sizes),sizes:r.editable.sizes});var m=(0,i.__read)((0,o.getAppropriateImage)(r.editable.sizes,251),1)[0];this._els.addButton.before((0,h.createElement)(g(m,t)))}else if(this._medias.length>=this._limit&&!this._showedError){this._showedError=!0,(0,d.showFastBox)((0,l.getLang)("global_error"),(0,l.getLang)("pages_article_ed_carousel_limit_photos").replace("{limit}",String(this._limit))).setOptions({onHide:function(){u._showedError=!1}})}return void 0===c&&(null===(p=(0,n.curBox)())||void 0===p||p.hide(),this._initSorter()),this._collectMediaIds(),this._toggleAddButton(),this._updateCounter(),!1},e.prototype._initSorter=function(){var e=this;this._sorter?this._sorter.update():this._sorter=new c.default(this._els.items,"",{onReorder:function(){e._collectMediaIds()}})},e}()},82160:(e,t,r)=>{"use strict";r.d(t,{ArticleEditorDrag:()=>_});var i=r(570655),a=r(83178),n=r(650588),o=r(390237),s=r(595800),l=r(146143),d=r(70162),c=r(517920),h=r(704914),p=r(604602),u=r(502810),g=r(881344),m=r(601306),v=r(788382),_=function(){function e(e,t){this._editor=e,this._els=t,this._scrollGap=200,this._hoveredIndex=!1,this._hoveredCarouselParagraphObject=null,this._draggedLineIndex=!1,this._paramsForHoverLine={},this._addPreventEvents(),this._addDragOSEvents(),this._initDropEvent(),this._initDragLeaveEvent(),this._editor.getOptions().modules.drag&&this._initDragButton(),this._initMouseDownEvent(!0)}return e.prototype._addPreventEvents=function(){var e=this;["dragenter","dragover","dragleave","drop"].forEach((function(t){e._els.canvas.addEventListener(t,e._preventDefaults,!1)}))},e.prototype._addDragOSEvents=function(){var e=this;["dragenter","dragover"].forEach((function(t){e._els.canvas.addEventListener(t,e._onDragOver.bind(e))}))},e.prototype._initDragLeaveEvent=function(){var e=this;this._els.canvas.addEventListener("dragleave",(function(t){e._dragAndDropTO&&(clearTimeout(e._dragAndDropTO),e._preventDefaults(t)),e._dragAndDropTO=setTimeout((function(){return e._cancelMove()}),100)}))},e.prototype._initDropEvent=function(){var e=this;this._els.canvas.addEventListener("drop",(function(t){var r=t.dataTransfer;if(r&&r.files.length){var n=r.files;if(!e._areFilesTypesValid(n))return(0,l.showFastBox)((0,d.getLang)("global_error"),(0,d.getLang)("pages_article_ed_paste_photo_file_error")),void e._cancelMove();if(e._hoveredIndex&&t.target instanceof Node){e._cancelCarouselHover(),e._editor.photoPasteUploadingProcess=!0;var o=(0,i.__read)(e._editor.getContainingParagraphEl(t.target),3)[2],s=Array.from(n),c=o&&(0,a.isPhotoParagraph)(o)&&e._canCreateCarousel(t),h=0;o&&c?Promise.all(s.map((function(t){return e._addPhotoToPhotoParagraph(t,o)}))).then((function(){e._hoveredIndex&&(e._editor.focusParagraph(e._editor.getState().ps[e._hoveredIndex]),e._editor.showObjectPicker(),e._editor.saveUndoStateAndDraft(),e._cancelMove())})).catch((function(){})):e._createPhotoParagraph(n[0],e._hoveredIndex).then((function(t){var r=[];e._hoveredIndex!==e._editor.getParagraphIndexById(t.id)&&h++;for(var i=1;i<s.length;i++)r.push(e._addPhotoToPhotoParagraph(s[i],t));return Promise.all(r)})).then((function(){if(e._hoveredIndex){e._editor.showObjectPicker();var t=e._editor.getState().ps[e._hoveredIndex+h];e._editor.focusParagraph(t),e._editor.saveUndoStateAndDraft(),e._cancelMove()}})).catch((function(){}))}}}))},e.prototype._initMouseDownEvent=function(e){var t=this;void 0===e&&(e=!1),(!e&&this._dragButton?this._dragButton:this._els.editor).addEventListener("mousedown",(function(r){var n;if(!e&&t._dragButton&&(r.stopPropagation(),null===(n=t._els.editor.parentElement)||void 0===n||n.dispatchEvent(new Event("mousedown",{bubbles:!0,cancelable:!0}))),t._shadowEl&&t._shadowEl.parentNode&&t._shadowEl.parentNode.removeChild(t._shadowEl),2==r.button)return t._cancelMove(),void t._preventDefaults(r);if(r.target instanceof Node){t._toggleHovered(!1);var o=(0,i.__read)(t._editor.getContainingParagraphEl(r.target),3),s=o[0],l=o[1],d=o[2];t._draggedElement=s,t._draggedIndex=t._editor.getParagraphIndexById(l),t._draggedParagraph=d,e||!t._dragButton||(0,a.isMediaParagraph)(t._draggedParagraph)||t._els.canvas.classList.add("no_select"),t._draggedParagraph&&t._draggedElement&&!1!==t._draggedLineIndex&&(0,a.isListParagraph)(t._draggedParagraph)&&(t._draggedElement=t._draggedElement.querySelectorAll("li")[t._draggedLineIndex]),t._draggedParagraph&&t._draggedIndex&&(!e||(0,a.isMediaParagraph)(t._draggedParagraph))&&(t._checkSelectionParagraph(t._draggedIndex,t._draggedLineIndex),t._resetMouseMoveParameters(r.pageX,r.pageY),t._initMouseMoveEvent(e),t._initMouseUpEvent())}}))},e.prototype._initMouseMoveEvent=function(e){var t=this;window.addEventListener("mousemove",this._moveHandler=function(r){if(r.target instanceof Node&&t._draggedParagraph&&t._draggedIndex&&t._draggedElement&&!(!t._shadowEl&&e&&Math.abs(t._mouseMoveParameters.initialY-r.pageY)<10)&&(t._createShadowEl(r),t._shadowEl)){0===t._mouseMoveParameters.parentPos.length&&t._cancelMove(),t._shadowEl.style.left=r.pageX-t._mouseMoveParameters.parentPos[0]+(e?-t._mouseMoveParameters.cursorLeftOffset:24)+"px",t._shadowEl.style.top=r.pageY-(0,o.scrollGetY)()-t._mouseMoveParameters.cursorTopOffset-t._mouseMoveParameters.parentPos[1]+t._editor.getOptions().layer.scrollTop-(e?0:12)+"px",t._scrollEditor(r);var n=(0,i.__read)(t._getHoveredParagraph(r),3),s=n[0],l=n[1],d=n[2];if(!d||!d.parentId){if(l&&t._draggedParagraph&&(0,a.isPhotoParagraph)(t._draggedParagraph)&&(0,a.isPhotoParagraph)(d)&&t._startDragParagraphIndex===t._endDragParagraphIndex){if(t._canCreateCarousel(r,t._draggedParagraph,l))return t._toggleHovered(!1),t._createCarouselHover(d),void(t._hoveredIndex=l);t._cancelCarouselHover()}s&&!1!==l&&d&&(l+1<t._startDragParagraphIndex||l>t._endDragParagraphIndex||!1!==t._hoveredLineIndex&&!1!==t._startDragLine&&(t._startDragParagraphIndex===t._endDragParagraphIndex&&t._hoveredLineIndex<t._startDragLine||t._hoveredLineIndex>t._endDragLine||l<t._startDragParagraphIndex))?(t._toggleHovered(s),t._hoveredIndex=l):(t._toggleHovered(!1),t._hoveredIndex=!1)}}})},e.prototype._initMouseUpEvent=function(){var e=this;window.addEventListener("mouseup",this._upHandler=function(t){e._changePositionParagraphs(t)})},e.prototype._initDragButton=function(){var e=this;if(this._els.editor.parentElement){this._dragButtonDummy=document.createElement("span"),this._dragButtonDummy.innerHTML=(0,h.getIcon24DotsVertical)().icon,this._dragButtonDummy.classList.add("article_ed_hover_drag_dummy"),this._dragButton=document.createElement("span"),this._dragButton.innerHTML=(0,h.getIcon24DotsVertical)().icon,this._dragButton.classList.add("article_ed_hover_drag_button"),this._dragButtonWrapper=document.createElement("span"),this._dragButtonWrapper.classList.add("article_ed_hover_drag_button_wrapper"),this._dragButtonWrapper.appendChild(this._dragButton),this._dragButtonTooltip=new c.default(this._dragButton,{content:(0,d.getLang)("pages_article_ed_drag_tooltip"),delay:800,forceSide:"bottom",cls:"article_ed_hover_drag_tooltip",width:210,appendTo:this._els.editor});var t='\n      <button class="article_ed_hover_drag_tooltip_button article_ed_hover_drag_tooltip_move" onclick="cur.articleEditor.drag.changeParagraphPositionButton(-1)">\n        '+(0,p.getIcon20ArrowUpOutline)().icon+"\n        "+(0,d.getLang)("pages_article_ed_drag_menu_up")+'\n      </button>\n      <button class="article_ed_hover_drag_tooltip_button article_ed_hover_drag_tooltip_move" onclick="cur.articleEditor.drag.changeParagraphPositionButton(1)">\n        '+(0,u.getIcon20ArrowDownOutline)().icon+"\n        "+(0,d.getLang)("pages_article_ed_drag_menu_down")+"\n      </button>"+(this._editor.comments?'<button class="article_ed_hover_drag_tooltip_button article_ed_hover_drag_tooltip_move" onclick="cur.articleEditor.drag.setComment()">\n        '+(0,v.getIcon20CommentAddBadgeOutline)().icon+"\n        "+(0,d.getLang)("pages_article_ed_drag_menu_comment")+"\n      </button>":"")+'<button class="article_ed_hover_drag_tooltip_button article_ed_hover_drag_tooltip_delete" onclick="cur.articleEditor.drag.deleteParagraphButton()">\n        '+(0,g.getIcon20DeleteOutline)().icon+"\n        "+(0,d.getLang)("pages_article_ed_drag_menu_delete")+"\n      </button>\n    ",r=document.createElement("div");r.innerHTML=t,this._dragButtonMenuTooltip=new c.default(this._dragButtonWrapper,{content:r,forceSide:"bottom",align:"left",cls:"article_ed_hover_drag_menu",width:210,offset:[-8,20],autoShow:!1,appendTo:this._els.editor,onShow:function(){if(e._dragButtonTooltip.hide(),e._currentHoverIndex){var t=e._editor.getState().ps[e._currentHoverIndex],i=e._editor.getParagraphById(t);if(i&&(0,a.isTableParagraph)(i)){var n=e._editor.getParagraphElById(i.id).querySelector("[data-table-container]");n instanceof HTMLElement&&m.SelectionManager.selectEl(n)}if(1!==e._currentHoverIndex||!i||(0,a.isListParagraph)(i)&&0!==e._draggedLineIndex){var o=r.querySelector(".article_ed_hover_drag_tooltip_move:disabled");o&&o.removeAttribute("disabled")}else{var s=r.querySelector(".article_ed_hover_drag_tooltip_move");s&&s.setAttribute("disabled","")}}},onHide:function(){!1!=!e._currentHoverIndex&&e.deleteDragButton(null,!0)}}),this._initMouseDownEvent(!1)}},e.prototype.addDragButton=function(e,t,r){var n=this;if(this._dragButtonWrapper&&this._dragButtonDummy&&!(0,a.findDragButtonEl)(e)){var o=document.createElement("span"),s=this._dragButtonDummy.cloneNode(!0);o.classList.add(a.ArticleEditorDragButtonClass),o.append(s),r.prepend(o);var l=function(){n._dragButtonMenuTooltip.isShown()||n.deleteDragButton(e)},d=function(r){var o=n._currentHoverIndex,s=(0,a.findParagraphToolsEl)(e),d=(0,a.findDragButtonEl)(e);if(s&&d&&d instanceof HTMLElement){var c=(0,i.__read)(n._editor.getContainingParagraphEl(e),2)[1];if(n._currentHoverIndex=n._editor.getParagraphIndexById(c),n._dragButtonMenuTooltip.isShown()&&o!==n._currentHoverIndex&&n._dragButtonMenuTooltip.hide(),!n._shadowEl&&n._dragButtonWrapper&&e.innerHTML!==s.outerHTML+"<br>"){if(n._checkFloatObjects(e)&&"FIGURE"!==e.tagName&&(d.style.left="358px",e.addEventListener("click",n._floatClickEvent=function(){!n._checkFloatObjects(e)&&n._dragButtonWrapper&&d.style.removeProperty("left")})),(0,a.isListParagraph)(t)){var h=Array.from(e.querySelectorAll("li")),p=h[h.length-1].getBoundingClientRect().bottom,u=h.map((function(e){return e.getBoundingClientRect().top+(n._dragButtonMenuTooltip.isShown()?6:0)}));u.push(p);var g=u.findIndex((function(e){return r.y<e}));if(g>0&&--g,n._draggedLineIndex!==g&&n._dragButtonMenuTooltip.hide(),-1!==g){n._draggedLineIndex=g;var m=t.lines[g].level&&1!==t.lines[g].level?8:0,v=e.querySelectorAll("li")[g].getBoundingClientRect().top-e.getBoundingClientRect().top+m;v>0?d.style.paddingTop=v+"px":d.style.removeProperty("padding-top")}}else n._draggedLineIndex=!1;n._dragButtonDummy&&n._dragButtonWrapper&&n._dragButtonWrapper.parentElement&&n._dragButtonWrapper.parentElement.replaceChild(n._dragButtonDummy.cloneNode(!0),n._dragButtonWrapper);var _=d.querySelector(".article_ed_hover_drag_dummy");_&&d.replaceChild(n._dragButtonWrapper,_),e.removeEventListener("mouseleave",l),e.addEventListener("mouseleave",l)}}};(0,a.isListParagraph)(t)?e.addEventListener("mousemove",d):window.browser.mozilla?e.onmouseenter=d:e.addEventListener("mouseenter",d)}},e.prototype.deleteDragButton=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=!1),this._dragButtonWrapper&&this._dragButtonWrapper.parentElement&&this._dragButtonDummy){var r=this._dragButtonWrapper.parentElement;r.style.removeProperty("left"),r.style.removeProperty("padding-top"),r.replaceChild(this._dragButtonDummy.cloneNode(!0),this._dragButtonWrapper),this._currentHoverIndex=!1,e&&e.removeEventListener("click",this._floatClickEvent),t||(this._dragButtonTooltip.hide(),this._dragButtonMenuTooltip.hide())}},e.prototype._toggleHovered=function(e){var t;if(!1!==e&&e===this._hoveredCarouselParagraphObject||this._cancelCarouselHover(),this._currentHovered!=e||this._paramsForHoverLine.level&&this._paramsForHoverLine.level!==this._hoveredLevel){if(this._els.editor.querySelectorAll(".article_ed__drag_hovered").forEach((function(e){e.classList.remove("article_ed__drag_hovered"),e.querySelectorAll(".article_ed__drag_hovered_item").forEach((function(e){e.remove()}))})),this._els.editor.querySelectorAll(".article_ed__drag_hover_background").forEach((function(e){e.remove()})),e&&e instanceof HTMLElement){var r=(0,i.__read)(this._editor.getContainingParagraphEl(e),1)[0];if(!r)return;var a=document.createElement("div");if(a.className="article_ed__drag_hovered_item",this._paramsForHoverLine.lineBottom&&(a.style.bottom=this._paramsForHoverLine.lineBottom-6+"px"),this._paramsForHoverLine.lineLeft&&a.classList.add("article_ed__drag_hovered_item_new"),e.classList.add("article_ed__drag_hovered"),e.appendChild(a),this._paramsForHoverLine.level){this._hoveredLevel=this._paramsForHoverLine.level,a.classList.add("article_ed__drag_hovered_item_list");var n=(r.children.length+Number(r.getAttribute("start"))-1).toString().length-1;if(1!==this._paramsForHoverLine.level){var o=document.createElement("div");o.classList.add("article_ed__drag_hover_background");var s=e,l=null===(t=e.parentElement)||void 0===t?void 0:t.closest("li");this._paramsForHoverLine.lineBottom||this._paramsForHoverLine.lineLeft||!l||(s=l),2===this._paramsForHoverLine.level&&o.classList.add("article_ed__drag_hover_background_primary");var d=20*n+4;if(o.style.left="-"+(r.getBoundingClientRect().width-s.getBoundingClientRect().width+d)+"px",o.style.width=r.getBoundingClientRect().width+d+5+"px",s.appendChild(o),this._paramsForHoverLine.countLines)for(var c=r.getBoundingClientRect().width-e.getBoundingClientRect().width,h=1;h<=this._paramsForHoverLine.countLines;h++){var p=document.createElement("div"),u=1===h&&this._paramsForHoverLine.level-this._paramsForHoverLine.countLines==1?10*n:0;p.classList.add("article_ed__drag_hovered_item","article_ed__drag_hovered_item_list","article_ed__drag_hovered_item_levels"),p.style.left="-"+(c-32*(h+this._paramsForHoverLine.level-this._paramsForHoverLine.countLines-2)+u)+"px",p.style.width=24+u+"px",e.appendChild(p)}}else n>0&&(a.style.left="-"+(10*n+20)+"px",a.style.width="calc(100% + "+(10*n+20)+" px);")}}this._currentHovered=e}},e.prototype._cancelCarouselHover=function(){this._hoveredCarouselParagraphObject&&(this._hoveredCarouselParagraphObject.getObjectEl().classList.remove("article__carousel--noHover"),this._hoveredCarouselParagraphObject.removeCarouselHover(),this._hoveredCarouselParagraphObject=null)},e.prototype._cancelMove=function(){window.removeEventListener("mousemove",this._moveHandler),window.removeEventListener("mouseup",this._upHandler),this._dragButton&&this._dragButton.style.removeProperty("cursor"),this._hoveredIndex=!1,this._hoveredLineIndex=!1,this._draggedIndex=!1,this._draggedParagraph=null,this._draggedElement=null,this._startDragParagraphIndex=!1,this._endDragParagraphIndex=!1,this._startDragLine=!1,this._endDragLine=!1,this._paramsForHoverLine={},clearTimeout(this._dragAndDropTO),clearInterval(this._autoScrollTO),this._toggleHovered(!1),this._shadowEl&&this._shadowEl.parentNode&&this._shadowEl.parentNode.removeChild(this._shadowEl),this._els.canvas.classList.remove("no_select"),this._shadowEl=!1,this._resetMouseMoveParameters(),this._els.editor.parentNode instanceof HTMLElement&&this._els.editor.parentNode.style.removeProperty("cursor"),Array.from(this._els.canvas.querySelectorAll(".article_ed__dragged")).forEach((function(e){e.classList.remove("article_ed__dragged")}))},e.prototype._areFilesTypesValid=function(e){return Array.from(e).every((function(e){return!!e.name&&(0,a.checkFileType)(e.type)}))},e.prototype._createCarouselHover=function(e){e&&(this._hoveredCarouselParagraphObject=this._editor.getOrCreateParagraphObject(e),this._hoveredCarouselParagraphObject&&(this._hoveredCarouselParagraphObject.getObjectEl().classList.add("article__carousel--noHover"),this._hoveredCarouselParagraphObject.renderCarouselHover()))},e.prototype._preventDefaults=function(e){e.preventDefault(),e.stopPropagation()},e.prototype._canCreateCarousel=function(e,t,r){var s,l;void 0===t&&(t=null),void 0===r&&(r=null);var d=!1;if(e.target instanceof Node){if(t){if(!(0,a.isPhotoParagraph)(t))return!1;this._editor.getOrCreateParagraphObject(t),d=(null===(l=t._object)||void 0===l?void 0:l.isCarouselEditorOpened())||!1}var c,h;if(r){var p=this._editor.getState().ps[r];h=this._editor.getParagraphById(p),c=this._editor.getParagraphElByIndex(r)}else c=(s=(0,i.__read)(this._editor.getContainingParagraphEl(e.target),3))[0],h=s[2];if(h&&(0,a.isObjectResize)(h)&&h.mode===n.ObjectResizeType.Float)return!1;if(t===h||d)return!1;if((0,a.isPhotoParagraph)(h)&&c instanceof HTMLElement){var u=(0,o.getXY)(c),g=(0,o.getSize)(c);if(e.pageY<u[1]+.7*g[1])return!0}return!1}},e.prototype._addPhotoInCarousel=function(e,t){var r=e.isCarouselEditorOpened();t&&(r||e.createCarousel(),t.forEach((function(t,r){var i={editable:{sizes:s.ArticleEditorPreparedData.get(n.ParagraphType.ObjectPhoto,t).sizes}};e.addPhotoInCarousel(t,i,r)})))},e.prototype._onDragOver=function(e){var t=this;this._dragAndDropTO&&(clearTimeout(this._dragAndDropTO),this._preventDefaults(e)),this._dragAndDropTO=setTimeout((function(){if(e.target instanceof Node){var r=(0,i.__read)(t._editor.getContainingParagraphEl(e.target),3),o=r[0],s=r[1],l=r[2],d=t._editor.getParagraphIndexById(s);l&&+l.type===n.ParagraphType.ObjectPhoto&&t._canCreateCarousel(e)&&(0,a.isPhotoParagraph)(l)?(t._toggleHovered(!1),t._createCarouselHover(l)):t._toggleHovered(o),t._hoveredIndex=d,t._els.canvas.classList.add("no_select"),t._scrollEditor(e)}}),0)},e.prototype._createPhotoParagraph=function(e,t){var r=this;return new Promise((function(i){var o=new FileReader;o.onload=function(){var s;r._editor.photoPasteUploadingProcess=!1;var l=t,d=r._editor.getState().ps[l],c=r._editor.buildParagraph({type:n.ParagraphType.ObjectPhoto});r._editor.getOrCreateParagraphObject(c),null===(s=c._object)||void 0===s||s.setBLOB(e,(function(){i(c)}));var h=r._editor.getState().ps[t],p=r._editor.getParagraphById(h);(0,a.isParagraphEmpty)(p)&&t?((0,a.hasSeparator)(p)&&(c.sep=1),r._editor.deleteParagraphById(d)):l=t+1,r._editor.insertParagraphAt(l,c.id),r._editor.redraw(!0,!0),(new Image).src=String(o.result),r._editor.resizeTooltip&&r._editor.resizeTooltip.isShown()&&r._editor.resizeTooltip.hide()},o.readAsDataURL(e)}))},e.prototype._addPhotoToPhotoParagraph=function(e,t){var r=this;return new Promise((function(i){var a=new FileReader;a.onload=function(){var a;r._editor.photoPasteUploadingProcess=!1;var o=r._editor.buildParagraph({type:n.ParagraphType.ObjectPhoto}),s=r._editor.getOrCreateParagraphObject(t);s.setLoadingState(!0,!0);r._editor.getOrCreateParagraphObject(o),null===(a=o._object)||void 0===a||a.setBLOB(e,(function(){var e=r._editor.getOrCreateParagraphObject(o).getMediaId(0);s.setLoadingState(!1),r._addPhotoInCarousel(s,[e]),o._uuid&&r._editor.getObject(o._uuid)&&r._editor.forgetObject(o._uuid),i("done")})),r._editor.resizeTooltip&&r._editor.resizeTooltip.isShown()&&r._editor.resizeTooltip.hide()},a.readAsDataURL(e)}))},e.prototype._checkFloatObjects=function(e){var t=(0,o.getXY)(this._els.editor),r=(0,o.getXY)(e)[1]-t[1],i=!1;return this._editor.uploadFloatList(),this._editor.floatedObjects.forEach((function(e){e.startY<=r+15&&e.endY+10>=r&&(i=!0)})),i},e.prototype.changeParagraphPositionButton=function(e){if(!1!==this._currentHoverIndex){this._dragButtonMenuTooltip.hide(),this._checkSelectionParagraph(this._currentHoverIndex,this._draggedLineIndex);var t=this._editor.getState().ps[this._currentHoverIndex],r=this._editor.getParagraphById(t);if(this._startDragParagraphIndex&&this._endDragParagraphIndex){if(!1!==this._startDragLine&&!1!==this._endDragLine&&this._startDragLine+e>=0&&r&&this._endDragLine+e<r.lines.length){if(e>0){var i=r.lines[this._startDragLine].level,a=r.lines[this._endDragLine+e].level;this._hoveredLineIndex=i&&a&&i>a?this._endDragLine+e:this._getLineWithSameOrLowerLevel(this._endDragLine+e,r)}else this._hoveredLineIndex=this._getLineWithSameOrLowerLevel(this._startDragLine,r,!0,e+1),--this._hoveredLineIndex;this._hoveredIndex=this._currentHoverIndex}else this._startDragParagraphIndex+e!==0&&(this._hoveredIndex=e>0?this._endDragParagraphIndex+e:this._startDragParagraphIndex+e-1);this._changePositionParagraphs(),m.SelectionManager.removeAllRanges()}}},e.prototype.deleteParagraphButton=function(){if(!1!==this._currentHoverIndex){if(this._dragButtonMenuTooltip.hide(),this._checkSelectionParagraph(this._currentHoverIndex,this._draggedLineIndex),!1!==this._startDragParagraphIndex&&!1!==this._endDragParagraphIndex&&this._startDragParagraphIndex===this._endDragParagraphIndex){var e=this._editor.getState().ps[this._startDragParagraphIndex],t=this._editor.getParagraphById(e);!1!==this._startDragLine&&!1!==this._endDragLine&&t?(t.lines.splice(this._startDragLine,this._endDragLine-this._startDragLine+1),0===t.lines.length&&this._editor.deleteParagraphById(e)):this._editor.deleteParagraphById(e)}else for(var r=this._els.canvas.children.length-1;r>=0;r--){e=this._editor.getState().ps[r],t=this._editor.getParagraphById(e);if(this._startDragParagraphIndex&&this._endDragParagraphIndex&&r>=this._startDragParagraphIndex&&r<=this._endDragParagraphIndex&&t)if(r===this._startDragParagraphIndex&&(0,a.isListParagraph)(t)&&!1!==this._startDragLine){if(t.lines.splice(this._startDragLine),0===t.lines.length){var i=this._editor.getState().ps[r];this._editor.deleteParagraphById(i)}}else if(r===this._endDragParagraphIndex&&(0,a.isListParagraph)(t)&&!1!==this._endDragLine){if(t.lines.splice(0,this._endDragLine+1),0===t.lines.length){i=this._editor.getState().ps[r];this._editor.deleteParagraphById(i)}}else{i=this._editor.getState().ps[r];this._editor.deleteParagraphById(i)}}m.SelectionManager.removeAllRanges(),this._editor.redraw(!0),this._editor.saveUndoStateAndDraft()}},e.prototype._scrollEditor=function(e){var t=this,r=(0,o.getSize)(this._els.canvas)[1];clearInterval(this._autoScrollTO),e.pageY-(0,o.scrollGetY)()<this._scrollGap?this._autoScrollTO=setInterval((function(){t._editor.getOptions().layer.scrollTop-=10}),10):e.pageY-(0,o.scrollGetY)()>window.innerHeight-this._scrollGap&&(this._autoScrollTO=setInterval((function(){t._editor.getOptions().layer.scrollTop+window.innerHeight>r+300?clearInterval(t._autoScrollTO):t._editor.getOptions().layer.scrollTop+=10}),10))},e.prototype._resetMouseMoveParameters=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._mouseMoveParameters={initialY:t,initialX:e,parentPos:[],size:[],pos:[],cursorLeftOffset:0,cursorTopOffset:0}},e.prototype._createShadowEl=function(e){var t=this;if(!this._shadowEl&&this._draggedParagraph&&this._draggedElement){this._mouseMoveParameters.parentPos=(0,o.getXY)(this._els.canvas),this._mouseMoveParameters.parentPos[1]-=(0,o.scrollGetY)(),this._mouseMoveParameters.size=(0,o.getSize)(this._draggedElement),this._mouseMoveParameters.pos=(0,o.getXY)(this._draggedElement),this._mouseMoveParameters.cursorLeftOffset=e.pageX-this._mouseMoveParameters.pos[0],this._mouseMoveParameters.cursorTopOffset=e.pageY-this._mouseMoveParameters.pos[1]+this._editor.getOptions().layer.scrollTop,this._shadowEl=document.createElement("div"),this._shadowEl.classList.add("article","article_ed__drag_text"),Array.from(this._els.canvas.children).forEach((function(e,r){var i=t._editor.getState().ps[r],s=t._editor.getParagraphById(i),l=t._editor.getParagraphElByIndex(r);if(t._startDragParagraphIndex&&t._endDragParagraphIndex&&r>=t._startDragParagraphIndex&&r<=t._endDragParagraphIndex&&s&&l&&l instanceof HTMLElement&&t._shadowEl)if((0,a.isMediaParagraph)(s)){if(t._startDragParagraphIndex===t._endDragParagraphIndex)t._shadowEl=document.createElement("div"),t._shadowEl.classList.add("article_ed__drag_shadow"),t._els.editor.appendChild(t._shadowEl),t._shadowEl.style.width=t._mouseMoveParameters.size[0]+"px",t._shadowEl.style.height=t._mouseMoveParameters.size[1]+"px";else{var d=document.createElement("figure");d.classList.add("article_ed__drag_shadow_inline"),d.setAttribute("data-mode",String(e.getAttribute("data-mode")));var c=(0,o.getSize)(l),h=e.getAttribute("data-mode");if(null!==h&&"0"!==h&&"1"!==h){var p=c[0]/c[1];c[0]=720,c[1]=Math.round(720*p),d.setAttribute("data-mode","0")}d.style.width=c[0]+"px",d.style.height=c[1]+"px",t._shadowEl.append(d)}e.classList.add("article_ed__dragged")}else if((0,a.isTableParagraph)(s)){var u=e.cloneNode(!0);u.style.left=a.TABLE_DEFAULT_LEFT_OFFSET+"px",t._shadowEl=document.createElement("div"),t._shadowEl.classList.add("article_ed__drag_table"),t._shadowEl.append(u),(0,a.copyTextStyles)(e,t._shadowEl),e.classList.add("article_ed__dragged"),t._els.editor.appendChild(t._shadowEl)}else if((0,a.isListParagraph)(s)){var g=s.type==n.ParagraphType.NumericList;(t._startDragParagraphIndex===t._endDragParagraphIndex&&!1!==t._startDragLine&&!1!==t._endDragLine?Array.from(l.querySelectorAll("li")).slice(t._startDragLine,t._endDragLine+1):r===t._startDragParagraphIndex&&!1!==t._startDragLine?Array.from(l.querySelectorAll("li")).slice(t._startDragLine):r===t._endDragParagraphIndex&&!1!==t._endDragLine?Array.from(l.querySelectorAll("li")).slice(0,t._endDragLine+1):Array.from(l.querySelectorAll("li"))).forEach((function(e){var r=e.parentElement;if(r){var i=document.createElement(g?"ol":"ul");i.append(e.cloneNode(!0)),i.className=r.className,i.classList.add("article_ed_list_element");var n=(0,a.findParagraphToolsEl)(r)?0:1,o=r.getAttribute("type"),s=r.getAttribute("data-sep"),l=r.getAttribute("start")?Number(r.getAttribute("start"))-1:0;i.setAttribute("start",String(Array.from(r.children).indexOf(e)+n+l)),o&&i.setAttribute("type",o),s&&0===Array.from(r.children).indexOf(e)&&i.setAttribute("data-sep",s);var d=i.querySelector(g?"ol":"ul");d&&d.remove(),t._shadowEl&&(t._shadowEl.append(i),e.classList.contains("article_ed__dragged_repeat")?e.classList.remove("article_ed__dragged_repeat"):(e.classList.add("article_ed__dragged"),Array.from(e.querySelectorAll("li")).forEach((function(e){e.classList.add("article_ed__dragged_repeat")}))))}}))}else t._shadowEl.append(e.cloneNode(!0)),e.classList.add("article_ed__dragged")})),this._els.editor.appendChild(this._shadowEl);var r=this._shadowEl.querySelector(".article_ed_hover_drag_button_wrapper");r&&r.parentNode&&r.parentNode.removeChild(r),this._els.editor.parentNode instanceof HTMLElement&&this._dragButton&&(this._els.editor.parentNode.style.cursor="move",this._dragButton.style.cursor="move"),this._dragButtonTooltip&&this._dragButtonMenuTooltip&&(this._dragButtonTooltip.hide(),this._dragButtonMenuTooltip.hide())}},e.prototype._getHoveredParagraph=function(e){var t=this;if(!(e.target instanceof Node&&this._draggedParagraph))return[null,!1,null];this._hoveredLineIndex=!1,this._paramsForHoverLine={};var r=(0,i.__read)(this._editor.getContainingParagraphEl(e.target),3),o=r[0],s=r[1],l=r[2],d=this._editor.getParagraphIndexById(s),c=[];Array.from(this._els.canvas.children).forEach((function(e,r){var o=t._editor.getState().ps[r],s=t._editor.getParagraphById(o);if(t._draggedElement&&"LI"===t._draggedElement.tagName&&!1!==t._draggedLineIndex&&t._startDragParagraphIndex===t._endDragParagraphIndex&&s&&(0,a.isListParagraph)(s)){var l=(0,a.isNumericListParagraph)(s),d=[];Array.from(e.querySelectorAll("li")).forEach((function(e,i){if(0===i){var n=t._editor.getParagraphElByIndex(r-1),o=t._editor.getState().ps[r-1],h=t._editor.getParagraphById(o);n&&n instanceof HTMLElement&&h&&(t._startDragParagraphIndex!==r||0!==t._draggedLineIndex)&&(d.push({paragraphIndex:r,lineIndex:-1,lineEl:n,bottom:e.getBoundingClientRect().top}),(0,a.isListParagraph)(h)||c.pop())}var p=e.getBoundingClientRect().bottom,u=e.getBoundingClientRect().left,g=e.querySelector(l?"ol":"ul"),m=s.lines[i].level;g&&m&&d.push({paragraphIndex:r,lineIndex:i,lineEl:e,bottom:p-g.getBoundingClientRect().height,level:m+1,lineBottom:g.getBoundingClientRect().height,lineLeft:!0}),d.push({paragraphIndex:r,lineIndex:t._getLineWithSameOrLowerLevel(i,s),lineEl:e,level:m,left:u,bottom:p}),m&&m!==a.MAX_LISTS_LEVEL&&!g&&d.push({paragraphIndex:r,lineIndex:i,lineEl:e,bottom:p,level:m+1,left:u+20+12,lineLeft:!0})})),c.push.apply(c,(0,i.__spreadArray)([],(0,i.__read)(d.sort((function(e,t){return e.bottom-t.bottom}))),!1))}else s&&(0,a.isObjectResize)(s)&&s.mode===n.ObjectResizeType.Float?c.push({paragraphIndex:r,bottom:e.getBoundingClientRect().top}):c.push({paragraphIndex:r,bottom:e.getBoundingClientRect().bottom})}));var h=void 0,p=-1;if((c=c.filter((function(t){return t.bottom>e.y}))).length>1&&c[0].left?-1===(p=(c=c.filter((function(e){return e.bottom===c[0].bottom}))).findIndex((function(t){return t.left&&t.left>e.x})))?(h=c[c.length-1],p=c.length-1):h=c[p]:c.length>=1&&(h=c[0]),h||(h={paragraphIndex:this._els.canvas.children.length-1,bottom:0}),!d||(0,a.isListParagraph)(this._draggedParagraph)){d=h.paragraphIndex;var u=this._editor.getState().ps[d];l=this._editor.getParagraphById(u);var g=this._editor.getParagraphElByIndex(d);g instanceof HTMLElement&&(o=g),h.lineEl&&void 0!==h.lineIndex&&(o=h.lineEl,this._hoveredLineIndex=h.lineIndex,h.level&&(this._paramsForHoverLine.level=h.level),h.lineBottom&&(this._paramsForHoverLine.lineBottom=h.lineBottom),h.left&&(this._paramsForHoverLine.left=h.left),h.lineLeft&&(this._paramsForHoverLine.lineLeft=h.lineLeft),-1!==p&&(this._paramsForHoverLine.countLines=p))}return[o,d,l]},e.prototype._checkSelectionParagraph=function(e,t){var r,n,o=window.getSelection(),s=(0,i.__read)(this._editor.getCurrentParagraphId(),2),l=s[0],d=s[1],c=this._editor.getParagraphIndexById(l),h=this._editor.getParagraphIndexById(d);if(o&&!o.isCollapsed&&e>=c&&e<=h){var p=o.getRangeAt(0),u=(0,i.__read)(this._editor.getContainingParagraphEl(p.startContainer),3),g=u[0],m=u[1],v=u[2],_=(0,i.__read)(this._editor.getContainingParagraphEl(p.endContainer),3),f=_[0],y=_[1],b=_[2],C=this._editor.getParagraphIndexById(m),w=this._editor.getParagraphIndexById(y);if(v&&(0,a.isListParagraph)(v)?(r=(0,i.__read)((0,a.findLineIndexOfList)(g,p.startContainer),1),this._startDragLine=r[0]):this._startDragLine=!1,b&&(0,a.isListParagraph)(b)){var E=void 0;if(n=(0,i.__read)((0,a.findLineIndexOfList)(f,p.endContainer),2),this._endDragLine=n[0],E=n[1],!1!==this._endDragLine&&E){var P=E.querySelectorAll("li").length;P>0&&(this._endDragLine+=P)}}else this._endDragLine=!1;var S=!1!==this._startDragLine&&this._startDragLine<=t&&!1!==this._endDragLine&&this._endDragLine>=t,A=e===C&&(v&&!(0,a.isListParagraph)(v)||!1!==this._startDragLine&&this._startDragLine<=t),I=e===w&&(b&&!(0,a.isListParagraph)(b)||!1!==this._endDragLine&&this._endDragLine>=t);if(S||c!==h&&(A||I||e>c&&e<h)){if(this._startDragParagraphIndex=c,this._endDragParagraphIndex=h,!1!==this._startDragLine&&!1!==this._endDragLine)if((T=this._editor.getParagraphElByIndex(e))instanceof HTMLElement){var L=T.querySelectorAll("li")[this._startDragLine].querySelectorAll("li").length;this._startDragLine+L>this._endDragLine&&(this._endDragLine=this._startDragLine+L)}}else if(this._startDragParagraphIndex=e,this._endDragParagraphIndex=e,this._startDragLine=t,this._endDragLine=t,!1!==this._endDragLine)(T=this._editor.getParagraphElByIndex(e))instanceof HTMLElement&&(this._endDragLine+=T.querySelectorAll("li")[this._endDragLine].querySelectorAll("li").length)}else{var T;if(this._startDragParagraphIndex=e,this._endDragParagraphIndex=e,this._startDragLine=t,this._endDragLine=t,!1!==this._endDragLine)(T=this._editor.getParagraphElByIndex(e))instanceof HTMLElement&&(this._endDragLine+=T.querySelectorAll("li")[this._endDragLine].querySelectorAll("li").length)}},e.prototype._changePositionParagraphs=function(e){var t,r,n=this;if(void 0===e&&(e=null),!1!==this._hoveredIndex&&!1!==this._startDragParagraphIndex&&!1!==this._endDragParagraphIndex){var o=this._editor.getState().ps[this._hoveredIndex],s=this._editor.getParagraphById(o);if(!s||!this._startDragParagraphIndex||!this._endDragParagraphIndex)return;this._els.canvas.classList.remove("no_select");var l=this._hoveredIndex<this._startDragParagraphIndex?this._hoveredIndex+1:this._hoveredIndex-this._endDragParagraphIndex+this._startDragParagraphIndex;if(this._startDragParagraphIndex===this._endDragParagraphIndex){var d=this._editor.getState().ps[this._startDragParagraphIndex];if(this._draggedParagraph=this._editor.getParagraphById(d),this._draggedParagraph)if(e&&(0,a.isPhotoParagraph)(s)&&this._canCreateCarousel(e,this._draggedParagraph)){var c=this._editor.getOrCreateParagraphObject(this._draggedParagraph).getMediaIds(),h=this._editor.getOrCreateParagraphObject(s),p=this._editor.getState().ps[this._startDragParagraphIndex];this._editor.deleteParagraphById(p),this._addPhotoInCarousel(h,c),this._editor.redraw(!0,!0),this._editor.focusParagraph(s.id)}else if(!1!==this._startDragLine&&!1!==this._endDragLine){var u=this._draggedParagraph.lines.splice(this._startDragLine,this._endDragLine-this._startDragLine+1),g=0;if(!1!==this._hoveredLineIndex){if(this._paramsForHoverLine&&this._paramsForHoverLine.level){var m=u[0].level;u.forEach((function(e){e.level&&m&&(e.level<m&&(m=e.level),n._paramsForHoverLine&&n._paramsForHoverLine.level&&(e.level=e.level-m+n._paramsForHoverLine.level),e.level>a.MAX_LISTS_LEVEL&&(e.level=a.MAX_LISTS_LEVEL))}))}if(this._startDragParagraphIndex===this._hoveredIndex){var v=this._hoveredLineIndex>this._startDragLine?this._hoveredLineIndex-this._endDragLine+this._startDragLine-1:this._hoveredLineIndex;(t=this._draggedParagraph.lines).splice.apply(t,(0,i.__spreadArray)([v+1,0],(0,i.__read)(u),!1))}else(r=s.lines).splice.apply(r,(0,i.__spreadArray)([this._hoveredLineIndex+1,0],(0,i.__read)(u),!1))}else{var _=this._editor.buildParagraph({lines:u,type:this._draggedParagraph.type});this._editor.insertParagraphAt(this._hoveredIndex>this._startDragParagraphIndex?++l:l,_.id),this._hoveredIndex<this._startDragParagraphIndex&&++g}if(0===this._draggedParagraph.lines.length){var f=this._editor.getState().ps[this._startDragParagraphIndex+g];this._editor.deleteParagraphById(f),this._hoveredIndex>this._startDragParagraphIndex&&--l}this._editor.redraw(!0,!0);var y=this._editor.getState().ps[l];this._editor.focusParagraph(y)}else{this._editor.moveParagraphs(this._startDragParagraphIndex,l),this._editor.redraw(!0,!0);y=this._editor.getState().ps[l];this._editor.focusParagraph(y)}}else{var b=this._editor.getState().ps[this._startDragParagraphIndex],C=this._editor.getParagraphById(b),w=this._editor.getState().ps[this._endDragParagraphIndex],E=this._editor.getParagraphById(w);if(C&&(0,a.isListParagraph)(C)&&!1!==this._startDragLine){_=this._editor.buildParagraph({lines:C.lines.splice(this._startDragLine),type:C.type});if(0===C.lines.length){p=this._editor.getState().ps[this._startDragParagraphIndex];this._editor.deleteParagraphById(p),this._editor.insertParagraphAt(this._startDragParagraphIndex,_.id)}else this._editor.insertParagraphAt(++this._startDragParagraphIndex,_.id),++this._endDragParagraphIndex,this._hoveredIndex>this._startDragParagraphIndex&&++l}if(E&&(0,a.isListParagraph)(E)&&!1!==this._endDragLine){_=this._editor.buildParagraph({lines:E.lines.splice(0,this._endDragLine+1),type:E.type});if(0===E.lines.length){var P=this._editor.getState().ps[this._endDragParagraphIndex];this._editor.deleteParagraphById(P),this._editor.insertParagraphAt(this._endDragParagraphIndex,_.id)}else this._editor.insertParagraphAt(this._endDragParagraphIndex,_.id),this._hoveredIndex>this._startDragParagraphIndex&&++l}this._editor.moveParagraphs(this._startDragParagraphIndex,l,this._endDragParagraphIndex-this._startDragParagraphIndex+1),this._editor.redraw(!0,!0);y=this._editor.getState().ps[l];this._editor.focusParagraph(y)}this._editor.saveUndoStateAndDraft(),this._editor.resizeTooltip&&this._editor.resizeTooltip.isShown()&&this._editor.resizeTooltip.hide()}this._cancelMove()},e.prototype._getLineWithSameOrLowerLevel=function(e,t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=0),t.lines[e]){var a=t.lines[e].level;for(e+=i;a&&(!r&&e+1<t.lines.length||r&&e-1>-1);){var n=r?e-1:e+1,o=t.lines[n].level;if(!(o&&a<o)){r&&--e;break}r?--e:++e}}return e},e.prototype.removeAllHoverLines=function(){this._editor.getOptions().modules.drag&&this._els.canvas.querySelectorAll(".article_ed_hover_line").forEach((function(e){return e.remove()}))},e.prototype.setComment=function(){if(this._dragButtonMenuTooltip.hide(),!1!==this._currentHoverIndex){var e=(0,i.__read)(m.SelectionManager.getRange(),2),t=e[0],r=e[1],n=this._editor.getState().ps[this._currentHoverIndex],o=this._editor.getParagraphById(n),s=this._editor.getParagraphElByIndex(this._currentHoverIndex);if(s&&s instanceof HTMLElement&&t&&o){if(!1!==this._draggedLineIndex){var l=(0,i.__read)((0,a.findLineIndexOfList)(s,t.startContainer),1)[0],d=(0,i.__read)((0,a.findLineIndexOfList)(s,t.endContainer),1)[0];if(this._draggedLineIndex<l||this._draggedLineIndex>d||!1===l&&!1===d){var c=s.querySelectorAll("li")[this._draggedLineIndex];if(""===c.innerText||"\n"===c.innerText)return;var h=c.querySelector("li")?1:0;m.SelectionManager.setRange(c,0,c,c.childNodes.length-h)}}else(0,a.isObjectParagraph)(o)||(0,a.isTableParagraph)(o)||!r||m.SelectionManager.setRange(s,0,s,s.childNodes.length);var p=(0,i.__read)(this._editor.getCurrentParagraphId(),2),u=p[0],g=p[1];r=(0,i.__read)(m.SelectionManager.getRange(),2)[1];var v=this._editor.getParagraphIndexById(u),_=this._editor.getParagraphIndexById(g);!r&&!(0,a.isTableParagraph)(o)&&!1!==v&&!1!==_&&this._currentHoverIndex>=v&&this._currentHoverIndex<=_?this._editor.setComment(!1,"drag"):this._editor.setComment(n,"drag")}}},e}()},435030:(e,t,r)=>{"use strict";r.d(t,{initLimits:()=>o,checkLimits:()=>s});var i,a=r(83178),n=r(70162);function o(e){i=e}function s(e){var t=[],r=e.getState().ps.length;r>i.maxParagraphs&&t.push((0,n.getLang)("pages_article_ed_limit_paragraphs").replace("{count}",String(r)).replace("{limit}",String(i.maxParagraphs)));var o=0,s=0;return e.traverseParagraphs((function(e){var r=0;e.lines.forEach((function(e){e&&(o+=e.text.length,r+=e.text.length)})),(0,a.isMediaParagraph)(e)&&s++,r>i.maxSymbolsPerParagraph&&t.push((0,n.getLang)("pages_article_ed_limit_symbols_per_par").replace("{count}",String(r)).replace("{limit}",String(i.maxSymbolsPerParagraph)))})),o>i.maxSymbols&&t.push((0,n.getLang)("pages_article_ed_limit_symbols").replace("{count}",String(o)).replace("{limit}",String(i.maxSymbols))),s>i.maxObjects&&t.push((0,n.getLang)("pages_article_ed_limit_objects").replace("{count}",String(s)).replace("{limit}",String(i.maxObjects))),t.length&&t.push((0,n.getLang)("pages_article_ed_limit")),t.join("<br>")}},595800:(e,t,r)=>{"use strict";r.d(t,{ArticleEditorPreparedData:()=>o});var i=r(83178),a={};function n(e){var t=e.split("_");return t[0]+"_"+t[1]}var o={add:function(e,t,r){a[e]=a[e]||{},(0,i.isEmbedType)(e)?a[e][t]=r:a[e][n(t)]=r},get:function(e,t,r){if(a[e]=a[e]||{},(0,i.isEmbedType)(e))return a[e][t];if(void 0!==r){var o=t.split(",");t=o[r]}return a[e][n(t)]},addRaw:function(e,t,r){a[e]=a[e]||{},a[e][t]=r},getRaw:function(e,t){return a[e]=a[e]||{},a[e][t]}}},783898:(e,t,r)=>{"use strict";r.d(t,{ArticleEditorSaver:()=>o});var i=r(146143),a=r(70162),n=r(733164),o={_saveChunk:function(e,t,r,i,a,n){window.ajax.post("al_articles.php",{act:"save_text_chunk",article_owner_id:e,article_id:t,hash:a,chunk_index:i,Article_text:JSON.stringify(r)},{onDone:function(e){n(e)},onFail:function(){return n(!0),!0}})},_saveFinally:function(e,t,r,o,s,l,d,c,h,p){window.ajax.post("al_articles.php",Object.assign({act:"save",article_owner_id:e,article_id:t,cover_photo_id:s,name:o,is_published:Number(r),chunks_count:c,Article_text:h?JSON.stringify(h):"",hash:d},l||{}),{onDone:p,onFail:function(e){return(0,n.isString)(e)&&e.startsWith("locked ")&&p(e),e&&((0,i.showFastBox)((0,a.getLang)("global_error"),e),p(!0)),!0}})},save:function(e,t,r,n,o,s,l,d,c,h){var p=this,u=[],g=[],m=0;if(r.forEach((function(e){var t=JSON.stringify(e).length;(m+=t)>=d&&(u.push(g),m=t,g=[]),g.push(e)})),g.length&&u.push(g),u.length>1){var v=new window.CallHub((function(){p._saveFinally(e,t,n,o,s,c,l,u.length,!1,h)}),u.length);u.forEach((function(r,n){p._saveChunk(e,t,r,n,l,(function(e){e?(0,i.showFastBox)((0,a.getLang)("global_error"),(0,a.getLang)("pages_articles_save_fail")):v.done()}))}))}else this._saveFinally(e,t,n,o,s,c,l,0,r,h)}}},83178:(e,t,r)=>{"use strict";r.d(t,{NBSP_UNICODE:()=>c,Space:()=>h,ZERO_WIDTH_SPACE:()=>p,CURSOR_MARKER_START:()=>u,CURSOR_MARKER_END:()=>g,MAX_LISTS_LEVEL:()=>m,MIN_LISTS_LEVEL:()=>v,MAX_DOM_DEPTH:()=>_,NUMERIC_LIST_START:()=>f,BULLET_LIST_START:()=>y,MIN_LIST_START:()=>b,ArticleEditorParagraphClass:()=>C,ArticleEditorDragButtonClass:()=>w,ArticleEditorParagraphToolsClass:()=>E,ArticleEditorInnerComponentsClass:()=>P,isEditorInnerComponent:()=>S,ArticleCommentsBackgroundClass:()=>A,ArticleCommentsBackgroundHoverClass:()=>I,ArticleCommentsBackgroundEditClass:()=>L,Key:()=>T,isArticleParagraphId:()=>x,TABLE_CELL_INITIAL_WIDTH:()=>M,TABLE_CELL_DEFAULT_WIDTH:()=>B,TABLE_CELL_DEFAULT_HEIGHT:()=>O,TABLE_CELL_MIN_WIDTH:()=>k,TABLE_DEFAULT_COLUMNS_COUNT:()=>R,TABLE_DEFAULT_ROWS_COUNT:()=>D,TABLE_DEFAULT_LEFT_OFFSET:()=>H,TABLE_EDITOR_PADDING:()=>j,TABLE_CELL_BG_COLORS:()=>W,TABLE_CELL_DEFAULT_BG:()=>N,isObject:()=>z,replaceParagraphEntities:()=>F,isQuoteEl:()=>U,isCiteEl:()=>q,paragraphElProperties:()=>V,isParagraphEl:()=>G,isBR:()=>X,prepareLineText:()=>K,isObjectParagraphEl:()=>Z,isDummyNumericList:()=>Y,isDummyBulletList:()=>Q,isDummyList:()=>$,convertParagraphToNumericList:()=>J,convertParagraphToBulletList:()=>ee,isEmojiImg:()=>te,hasSeparator:()=>re,genSepatorId:()=>ae,isEmbedType:()=>ne,convertBRsToArray:()=>oe,cleanTextSpaces:()=>le,mergeRanges:()=>de,isWhiteSpaceChar:()=>ce,isCyrillicChar:()=>pe,isLatinChar:()=>ue,isAlienParagraphEl:()=>ge,getPhotoSize:()=>me,childNodeIndex:()=>ve,generateLatinizedName:()=>ye,queuePhotoProcess:()=>Ae,decorationsSlice:()=>Ie,cleanLineBRs:()=>Le,cleanBRs:()=>Te,traverseTree:()=>xe,isPublishNameCorrect:()=>Me,correctRealIndexes:()=>Oe,isVKUrl:()=>ke,decodeURL:()=>Re,hasBlockElements:()=>He,buildProductSnippetElement:()=>je,normalizeLineLevels:()=>We,getPathFromNodeToNode:()=>Ne,getNodeByPath:()=>ze,isListEl:()=>Fe,isLiEl:()=>Ue,checkFileType:()=>qe,findDragButtonEl:()=>Ve,isTableEl:()=>Ge,domChildIndex:()=>Xe,domIsLastChild:()=>Ke,domIsFirstChild:()=>Ze,copyTextStyles:()=>Ye,getOwnWidth:()=>Qe,getMinContentWidth:()=>$e,isParagraphToolsEl:()=>Je,findParagraphToolsEl:()=>et,isMediaParagraph:()=>rt,isTextParagraph:()=>it,isHeader1Paragraph:()=>at,isHeader2Paragraph:()=>nt,isHeader3Paragraph:()=>ot,isHeaderParagraph:()=>st,isCodeParagraph:()=>lt,isNumericListParagraph:()=>dt,isBulletListParagraph:()=>ct,isListParagraph:()=>ht,isQuoteParagraph:()=>pt,isQuote2Paragraph:()=>ut,isTableParagraph:()=>gt,isTableRowParagraph:()=>mt,isTableCellParagraph:()=>vt,isPhotoParagraph:()=>_t,isVideoParagraph:()=>ft,isGIFParagraph:()=>yt,isTwitterParagraph:()=>bt,isFacebookParagraph:()=>Ct,isInstagramParagraph:()=>wt,isVKParagraph:()=>Et,isTelegramParagraph:()=>Pt,isObjectResize:()=>St,paragraphHasChildren:()=>At,isParagraphEmpty:()=>It,isObjectParagraph:()=>Lt,findLineIndexOfList:()=>Tt,urlWithProtocol:()=>xt});var i=r(570655),a=r(650588),n=r(390237),o=r(36534),s=r(961540),l=r(659397),d="&nbsp;",c=" ",h=" ",p="\ufeff",u="​",g="‌",m=3,v=1,_=2*m+4+10+8,f=/^\d+\./,y=/^(\*|-)/,b=1,C="_article_paragraph",w="article_ed_hover_line",E="article_ed_paragraph_tools",P="article_inner_component",S=function(e){return e instanceof HTMLElement&&e.classList.contains(P)},A="ArticleComments__text",I="ArticleComments__text--hover",L="ArticleComments__text--edit",T={KeyA:65,KeyB:66,KeyC:67,KeyI:73,KeyS:83,KeyY:89,KeyZ:90,Apostrophe:192,Backspace:8,Enter:13,Space:32,Up:38,Down:40,Delete:46,Tab:9,Esc:27},x=function(e){return"string"==typeof e},M=240,B=180,O=42,k=80,R=3,D=3,H=-65,j=35,W=["standard","green","red","blue","orange","yellow","purple"],N="standard",z=function(e){return"[object Object]"===Object.prototype.toString.call(e)};function F(e){return(0,n.createElement)("<textarea>"+(e||"")+"</textarea>").value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function U(e){return e instanceof HTMLElement&&["cite","blockquote"].includes(e.tagName.toLowerCase())}function q(e){return e instanceof HTMLElement&&"cite"===e.tagName.toLowerCase()}function V(e){return[e.dataset.type||"",e.dataset.uuid||"",e.dataset.mode||"","true"===e.dataset.autoplay,e.dataset.id||""]}function G(e){return e instanceof HTMLElement&&(e.classList.contains(C)||e.hasAttribute("data-id"))}function X(e){return e instanceof HTMLElement&&"br"==e.tagName.toLowerCase()}function K(e,t,r,i,a){if(void 0===a&&(a=!1),e=e.substring(t,r),i&&i.length){var n=[],o=0;i.forEach((function(r){if(!((r-=t)<=0||r>e.length)){var i=e.substring(o,r);i=a?i:se(i),i+="<br/>",n.push(i),o=r}}));var s=e.substring(o);n.push(a?s:se(s));n[n.length-1];return n.join("")}return a?e:se(e)}function Z(e){return e instanceof HTMLElement&&!!e.dataset.uuid}function Y(e,t){void 0===t&&(t=!0);var r=t?new RegExp(f.source+" "):f,i=null==e?void 0:e.lines[0];return e.type===a.ParagraphType.Text&&i&&r.test(i.text)}function Q(e,t){void 0===t&&(t=!0);var r=t?new RegExp(y.source+" "):y,i=null==e?void 0:e.lines[0];return e.type===a.ParagraphType.Text&&i&&r.test(i.text)}function $(e,t){return void 0===t&&(t=!0),Y(e,t)||Q(e,t)}function J(e,t){return e.type=a.ParagraphType.NumericList,e.start=Math.max(b,t),e}function ee(e){return e.type=a.ParagraphType.BulletList,e}function te(e){return"emoji"===e.classList.value&&e.src&&/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/g.test(e.alt)}function re(e){return Boolean(e&&e.sep)}var ie=0;function ae(){return++ie}function ne(e){return[a.ParagraphType.ObjectFacebook,a.ParagraphType.ObjectInstagram,a.ParagraphType.ObjectTwitter,a.ParagraphType.ObjectTelegram,a.ParagraphType.ObjectVK,a.ParagraphType.ObjectAliExpressProduct].includes(e)}function oe(e){var t,r;if(Array.isArray(e))return e;var a=[];try{for(var n=(0,i.__values)(Object.values(e)),o=n.next();!o.done;o=n.next()){var s=o.value;a.push(Number(s))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return a.sort(),a}function se(e){return-1!=e.search(/^\s/)&&(e=d+e.trimLeft()),-1!=e.search(/\s$/)&&(e=e.trimRight()+d),e}function le(e){return e.replace(/\s\s+/g," ").replace(/\s/g," ")}function de(e){var t=JSON.parse(JSON.stringify(e));t.sort((function(e,t){return e[0]-t[0]}));for(var r=0;r<t.length-1;){var i=t[r],a=t[r+1],n=i[2]===a[2];i[1]>=a[0]&&n?(i[1]=Math.max(i[1],a[1]),t.splice(r+1,1)):r++}return t}function ce(e){return/\s/.test(e)}var he=/[\u0400-\u04FF]/;function pe(e){return he.test(e)}function ue(e){return/[a-zA-Z]/.test(e)}function ge(e){return!e.classList.contains(C)}function me(e){var t,r,a=[];try{for(var n=(0,i.__values)(Object.values(e)),o=n.next();!o.done;o=n.next()){var s=o.value;a.push(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}var l=a.sort((function(e,t){return t[1]-e[1]}))[0];return[l[1],l[2]]}function ve(e){var t=e.parentNode;if(null==t?void 0:t.childNodes.length)for(var r=0;r<t.childNodes.length;r++)if(e==t.childNodes[r])return r;return-1}var _e=[{to:"a",from:"[ÀÁÂÃÄÅÆĀĂĄẠẢẤẦẨẪẬẮẰẲẴẶ]"},{to:"c",from:"[ÇĆĈČ]"},{to:"d",from:"[ÐĎĐÞ]"},{to:"e",from:"[ÈÉÊËĒĔĖĘĚẸẺẼẾỀỂỄỆ]"},{to:"g",from:"[ĜĞĢǴ]"},{to:"h",from:"[ĤḦ]"},{to:"i",from:"[ÌÍÎÏĨĪĮİỈỊ]"},{to:"j",from:"[Ĵ]"},{to:"ij",from:"[Ĳ]"},{to:"k",from:"[Ķ]"},{to:"l",from:"[ĹĻĽŁ]"},{to:"m",from:"[Ḿ]"},{to:"n",from:"[ÑŃŅŇ]"},{to:"o",from:"[ÒÓÔÕÖØŌŎŐỌỎỐỒỔỖỘỚỜỞỠỢǪǬƠ]"},{to:"oe",from:"[Œ]"},{to:"p",from:"[ṕ]"},{to:"r",from:"[ŔŖŘ]"},{to:"s",from:"[ßŚŜŞŠ]"},{to:"t",from:"[ŢŤ]"},{to:"u",from:"[ÙÚÛÜŨŪŬŮŰŲỤỦỨỪỬỮỰƯ]"},{to:"w",from:"[ẂŴẀẄ]"},{to:"x",from:"[ẍ]"},{to:"y",from:"[ÝŶŸỲỴỶỸ]"},{to:"z",from:"[ŹŻŽ]"}],fe={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1105:"e",1078:"zh",1079:"z",1080:"i",1081:"i",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"c",1095:"ch",1096:"sh",1097:"sch",1099:"y",1101:"e",1102:"u",1103:"ya"};function ye(e,t){e=e.toLowerCase();var r="",i=!1,a="-qwertyuiopasdfghjklzxcvbnm0123456789".split("");_e.forEach((function(t){e=e.replace(new RegExp(t.from,"gi"),t.to)}));for(var n=0;n<e.length;n++)if(/\s/.test(e[n]))i||(r+="-",i=!0);else if(a.includes(e[n]))r+=e[n],i=!1;else{var o=fe[e.charCodeAt(n)];o&&(r+=o,i=!1)}return r=(r=r.substr(0,t)).replace(/-*$/,"").replace(/^-*/,"").replace(/-+/g,"-")}function be(e){var t,r,i;t=e.split(",")[0].includes("base64")?atob(e.split(",")[1]):unescape(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length);for(var a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([i],{type:r})}function Ce(e,t,r){var i,a="";if(t=t||{},!e)return r(new Error("Pass in a IMG DOM node or a url as first param"),!1);if("object"==typeof e&&"img"===e.tagName.toLowerCase()&&(a=e.src),"string"==typeof e&&(a=e),!a.startsWith("data:")||t.convert){var n,o={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",svg:"image/svg+xml"};t.type=o[t.type]||((n=a)?o[n.split("?").shift().split(".").pop()]:null),t.src=a,t.callback=r,t.name=null===(i=a.toLowerCase().match(/\w+\.(?:jpg|jpeg|png|gif)/))||void 0===i?void 0:i[0],t.type?function(e,t){var r=document.createElement("canvas"),i=document.createElement("img");i.onload=function(){var e=r.getContext("2d");e&&(r.width=i.width,r.height=i.height,e.drawImage(i,0,0),t(null,r.toDataURL("image/png")))},i.addEventListener("error",(function(){t(new Error("FailedToLoadImage"))})),(null==r?void 0:r.getContext("2d"))?(i.crossOrigin="anonymous",i.src=e):setTimeout(t,0,new Error("CanvasIsNotSupported"))}(a,we.bind(null,t)):r(new Error("Image type is not supported"),!1)}else r(null,be(a))}function we(e,t,r){if(t)e.callback(t);else{var i=be(r);i.name=i.filename=e.name,e.callback(null,i)}}var Ee=[],Pe=0;function Se(){if(0!=Ee.length&&2!=Pe){Pe++;var e=Ee.shift(),t=new Image,r=function(t,r){e.blobPreparedCallback(t,r,(function(){Pe--,Se()}))};t.addEventListener("error",(function(){r(!0,!1)})),t.addEventListener("load",(function(){Ce(t,{},(function(e,t){r(!!e,t)}))})),t.src=e.src}}function Ae(e,t){Ee.push({src:e,blobPreparedCallback:t}),Se()}function Ie(e,t,r){var i={},a=function(a){if(e.hasOwnProperty(a)){var n=[];e[a].forEach((function(e){t<e[1]&&e[0]<=r&&n.push([Math.max(e[0],t)-t,Math.min(r,e[1])-t,e[2]])})),i[a]=n}};for(var n in e)a(n);return i}function Le(e){e.brs&&(e.brs=e.brs.filter((function(e,t,r){return r.indexOf(e)===t})),e.brs[e.brs.length-1]==e.text.length&&e.brs.pop())}function Te(e,t){var r=e.length;return(1==r&&e[r-1]==t||r>1&&e[r-1]==t&&e[r-2]!=t)&&e.pop(),e}function xe(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var a=t(e,i);if(void 0!==a)return a;var n,o=Array.prototype.slice.call(e.childNodes);for(r&&o.filter((function(e){return e.nodeType!==Node.TEXT_NODE}));n=o.shift();){var s=xe(n,t,r,!1);if(void 0!==s)return s}}function Me(e){return!!/^[a-z0-9\-]+$/.test(e)&&(!e.includes("--")&&(!e.startsWith("-")&&!e.endsWith("-")&&!(e.length>60)))}function Be(e,t,r){var a,n;if(e.decorations)try{for(var o=(0,i.__values)(Object.values(e.decorations)),s=o.next();!s.done;s=o.next()){s.value.forEach((function(e){e[0]>t&&(e[0]+=r),e[1]>t&&(e[1]+=r)}))}}catch(e){a={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}e.brs&&e.brs.forEach((function(i,a){i>t&&e.brs&&(e.brs[a]+=r)}))}function Oe(e,t){e.lines.forEach((function(e){for(var r=(0,l.decodeHTMLEntities)(e.text),i=0,a=r.length;i<a;i++){var n=r.charCodeAt(i);n>=55296&&n<=56319&&(Be(e,i,t),i+=Math.abs(t))}}))}function ke(e){return s.VK_URL_REGEX.test(e)}function Re(e){var t=e;try{t=decodeURIComponent(e)}catch(r){t=e}return t}var De=new Set(["div","p","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","main","nav","output","pre","section","table","thead","tbody","tfoot","tr","th","td","address","article","aside","blockquote","canvas","dd","dl","dt","fieldset","figcaption","figure","ol","ul"]);function He(e){for(var t=0,r=e.children.length;t<r;t++)if(De.has(e.children[t].tagName.toLowerCase()))return!0;return!1}function je(e,t){var r;if(e.snippet)r=e.snippet;else{var i=e.product;i.description||(i.description=i.title),r=(0,o.replaceTemplate)(window.cur.articleEditor.getOptions().marketItemSnippetTemplate,i)}return(0,n.createElement)('<div class="'+t+'" contenteditable="false">'+r+"</div>")}function We(e){var t=v,r=v;e.forEach((function(e,i){var a=Number(e.level);a>t&&r!==a&&0!==i?t=Math.min(m,t+1):a<t&&(t=a),r=a,a!==t&&(e.level=t)}))}function Ne(e,t){if(!(e instanceof Node&&t instanceof Node))return null;if(!e.contains(t))return null;var r=[];return(0,n.traverseParent)(t,(function(t){if(t===e)return!0;r.push(ve(t))})),r.reverse()}function ze(e,t){var r,a;if(!t||!t.length)return e||null;var n=e;try{for(var o=(0,i.__values)(t),s=o.next();!s.done;s=o.next()){var l=s.value;n&&(n=n.childNodes[l])}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return n||null}function Fe(e){return e instanceof Element&&["ul","ol"].includes(e.tagName.toLowerCase())}function Ue(e){return e instanceof Element&&"li"===e.tagName.toLowerCase()}function qe(e){return a.ALLOWED_FILE_TYPES_FOR_PASTE.split(";").some((function(t){return t=t.split(".")[1],e.includes(t)}))}function Ve(e){return e instanceof HTMLElement&&e.querySelector("."+w)}function Ge(e){return e instanceof HTMLElement&&"table"===e.tagName.toLowerCase()}function Xe(e){var t=null==e?void 0:e.parentElement;return t&&e?Array.from(t.childNodes).indexOf(e):-1}function Ke(e){var t;return e===(null===(t=e.parentElement)||void 0===t?void 0:t.lastChild)}function Ze(e){var t;return e===(null===(t=e.parentElement)||void 0===t?void 0:t.firstChild)}function Ye(e,t){var r=window.getComputedStyle(e);t.style.fontFamily=r.fontFamily,t.style.fontSize=r.fontSize,t.style.fontStyle=r.fontStyle,t.style.fontWeight=r.fontWeight,t.style.fontStretch=r.fontStretch,t.style.fontVariant=r.fontVariant,t.style.letterSpacing=r.letterSpacing,t.style.textTransform=r.textTransform,t.style.lineHeight=r.lineHeight,t.style.textDecoration=r.textDecoration,t.style.textIndent=r.textIndent,t.style.whiteSpace=r.whiteSpace,t.style.wordBreak=r.wordBreak,t.style.wordSpacing=r.wordSpacing}function Qe(e,t){void 0===t&&(t=document.body);var r=e.cloneNode(!0);r.style.position="absolute",r.style.top="0",r.style.left="-9999px",r.style.overflow="hidden",r.style.visibility="hidden",r.style.whiteSpace="nowrap",r.style.height="0",Ye(e,r);var i=window.getComputedStyle(e);r.style.boxSizing="border-box",r.style.borderLeftWidth=i.borderLeftWidth,r.style.borderRightWidth=i.borderRightWidth,r.style.paddingLeft=i.paddingLeft,r.style.paddingRight=i.paddingRight,t.appendChild(r);var a=parseInt(window.getComputedStyle(r).width);return r.remove(),a}function $e(e,t){void 0===t&&(t=document.body);var r=e.cloneNode(!0);r.style.width="min-content",r.style.position="absolute",r.style.top="0",r.style.left="-9999px",r.style.overflow="hidden",r.style.visibility="hidden",r.style.height="0",Ye(e,r);var i=window.getComputedStyle(e);r.style.boxSizing="border-box",r.style.borderLeftWidth=i.borderLeftWidth,r.style.borderRightWidth=i.borderRightWidth,r.style.paddingLeft=i.paddingLeft,r.style.paddingRight=i.paddingRight,t.appendChild(r);var a=parseInt(window.getComputedStyle(r).width);return r.remove(),a}function Je(e){return e instanceof HTMLElement&&e.classList.contains(E)}function et(e){return e instanceof HTMLElement&&e.querySelector("."+E)}var tt=function(e){return z(e)&&["lines","type"].every((function(t){return e.hasOwnProperty(t)}))},rt=function(e){return z(e)&&tt(e)&&e.type>=100},it=function(e){return tt(e)&&e.type===a.ParagraphType.Text},at=function(e){return tt(e)&&e.type===a.ParagraphType.Header1},nt=function(e){return tt(e)&&e.type===a.ParagraphType.Header2},ot=function(e){return tt(e)&&e.type===a.ParagraphType.Header3},st=function(e){return at(e)||nt(e)||ot(e)},lt=function(e){return tt(e)&&e.type===a.ParagraphType.Code},dt=function(e){return tt(e)&&e.type===a.ParagraphType.NumericList},ct=function(e){return tt(e)&&e.type===a.ParagraphType.BulletList},ht=function(e){return dt(e)||ct(e)},pt=function(e){return tt(e)&&e.type===a.ParagraphType.Quote},ut=function(e){return tt(e)&&e.type===a.ParagraphType.Quote2},gt=function(e){return tt(e)&&e.type===a.ParagraphType.Table},mt=function(e){return tt(e)&&e.type===a.ParagraphType.TableRow},vt=function(e){return tt(e)&&e.type===a.ParagraphType.TableCell},_t=function(e){return tt(e)&&e.type===a.ParagraphType.ObjectPhoto},ft=function(e){return tt(e)&&e.type===a.ParagraphType.ObjectVideo},yt=function(e){return tt(e)&&e.type===a.ParagraphType.ObjectGIF},bt=function(e){return tt(e)&&e.type===a.ParagraphType.ObjectTwitter},Ct=function(e){return tt(e)&&e.type===a.ParagraphType.ObjectFacebook},wt=function(e){return tt(e)&&e.type===a.ParagraphType.ObjectInstagram},Et=function(e){return tt(e)&&e.type===a.ParagraphType.ObjectVK},Pt=function(e){return tt(e)&&e.type===a.ParagraphType.ObjectTelegram},St=function(e){return tt(e)&&e.hasOwnProperty("mode")},At=function(e){return tt(e)&&e.hasOwnProperty("children")},It=function(e,t){if(!e)return!0;if(rt(e))return!1;var r=(e.lines||[]).some((function(e){var r=e.text;return t?r.trim():r})),i=At(e)&&0!==e.children.length;return!r&&!i},Lt=function(e){return tt(e)&&e.hasOwnProperty("_object")};function Tt(e,t){for(var r=t instanceof HTMLLIElement?t:t.parentElement;r&&r.parentElement&&"LI"!==r.tagName;)r=r.parentElement;return e&&r instanceof HTMLLIElement?[Array.from(e.querySelectorAll("li")).indexOf(r),r]:[!1,void 0]}var xt=function(e){e.match("^https?://")||(e=(ke(e)?"https":"http")+"://"+e);return e}},42347:(e,t,r)=>{"use strict";r.d(t,{ParagraphObject:()=>h});var i,a=r(570655),n=r(601306),o=r(70162),s=r(390237),l=r(929416),d=r(975624),c=window.browser&&(window.browser.mozilla||window.browser.safari),h=function(){function e(e,t,r){this._mediaId=e,this._editor=t,this._highlighted=!1,this.isCaptioned=r,i=this.getEditor().getOptions().multiMediasSeparator}return Object.defineProperty(e.prototype,"isCaptioned",{get:function(){return this._isCaptioned},set:function(e){this._isCaptioned=e},enumerable:!1,configurable:!0}),e.prototype.getEditor=function(){return this._editor},e.prototype.getMediaIdsCount=function(){return this._mediaId.split(i).length},e.prototype.getMediaId=function(e){return void 0!==e?this._mediaId.split(i)[e]:this._mediaId},e.prototype.getMediaIds=function(){return this._mediaId.split(i)},e.prototype.setMediaId=function(e){this._mediaId=e},e.prototype.highlight=function(e,t){var r;if(void 0===e&&(e=!1),void 0===t&&(t=!1),e!=this._highlighted){this._highlighted=e;var i=this.el();if(e){var a=(0,s.getSize)(i),o=(0,s.createElement)('<div class="article_ed__object_highlight _article_ed__object_highlight"></div>');o.style.width=a[0]+0+"px",o.style.height=a[1]+0+"px",i.classList.add("article_ed__object_highlighted")}else null===(r=i.querySelector("._article_ed__object_highlight"))||void 0===r||r.remove(),i.classList.remove("article_ed__object_highlighted");if(this.isCaptioned)if(e)this.toggleCaption(!0),this._toggleCaptionPlaceholder(this.isEmptyCaption()),t||n.SelectionManager.setCaretAtElement(this._getCaptionEl(),!0);else{var l=this.isEmptyCaption();this._toggleCaptionPlaceholder(l),this.toggleCaption(!l)}}},e.prototype.render=function(){return!1},e.prototype.appendObjectInnerEl=function(){var e=this.render();e.classList.add("article_object_el"),e.setAttribute("contenteditable","false");var t=this._objectEl.querySelector(".article_object_el");if(t)t.replaceWith(e);else{var r=this._objectEl.querySelector(".article_ed__img_inner");null==r||r.insertBefore(e,r.firstChild)}},e.prototype.el=function(){var e=this;if(!this._objectEl){var t=this.render();t.classList.add("article_object_el"),t.setAttribute("contenteditable","false");var r=this.getEditor().isLocked()?"false":"true",i=window.browser.mozilla?'contenteditable="'+r+'"':'contenteditable="false"';this._objectEl=(0,s.createElement)("<figure "+i+"></figure>");var a=this.renderExtraControlsEl(),l=this.renderEditControlEl();if(a){var d=(0,s.createElement)('<div class="article_ed__img_wrapper"></div>'),h=(0,s.createElement)('<div class="article_ed__img_inner"></div>');a.setAttribute("contenteditable","false"),a.classList.add("article_ed__extra_controls"),h.appendChild(a),d.appendChild(h),this._objectEl.appendChild(d),this.appendObjectInnerEl()}else this._objectEl.appendChild(t);l&&this._objectEl.appendChild(l),this.isCaptioned&&(this._captionEl=(0,s.createElement)('<figcaption class="article_ed__figcaption" contenteditable="false">\n          <div class="article_ed__figcaption_edit" contenteditable="'+r+'"></div>\n          <div class="article_ed__caption_placeholder" contenteditable="false">'+(0,o.getLang)("pages_article_figure_placeholder")+"</div>\n        </figcaption>"),this._objectEl.appendChild(this._captionEl)),c&&t.addEventListener("click",(function(){e.highlight(!0),n.SelectionManager.setCaretAtElement(t)}))}return this._setLoadingEl(),this._objectEl},e.prototype.renderExtraControlsEl=function(){return!1},e.prototype.renderEditControlEl=function(){return!1},e.prototype.renderLoadErr=function(){return(0,s.createElement)('\n      <div class="article_editor_embed_error">\n        <p class="article_editor_embed_error_text">'+(0,o.getLang)("pages_article_load_error_msg")+"</p>\n      </div>\n    ")},e.prototype.setLoadingState=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this._isLoading!=e&&(this._isLoading=e,this._setLoadingEl(t),this._objectEl&&this._objectEl.classList.toggle("article_ed__object_loading",e),e||this.getEditor().onObjectStateLoaded())},e.prototype.isLoading=function(){return this._isLoading},e.prototype._setLoadingEl=function(e){var t,r;if(void 0===e&&(e=!1),this._objectEl){if(null===(t=this._objectEl.querySelector(".article_ed___object_loading_placeholder"))||void 0===t||t.remove(),this._isLoading){var i=e?(0,d.getIcon48LoaderWhite)().icon:(0,l.getIcon48Loader)().icon,a=(0,s.createElement)('<div class="article_ed___object_loading_placeholder">'+i+"</div>");a.classList.toggle("article_ed__object_loading_white",e),null===(r=this._objectEl.firstChild)||void 0===r||r.before(a)}this._objectEl.classList.toggle("article_ed___object_loading",!!this._isLoading)}},e.prototype.getCaptionEl=function(){return this.isCaptioned&&this._getCaptionEl()||!1},e.prototype.isCaptionFocused=function(){return!!this.isCaptioned&&this._isFocusInCaption()},e.prototype.setCaptionElHtml=function(e){if(this.isCaptioned){e=e.trim();var t=this._getCaptionEl();t&&(t.innerHTML!=e&&(t.innerHTML=e),this._toggleCaptionPlaceholder(!e),this.toggleCaption(!!e))}},e.prototype.isEmptyCaption=function(){var e,t;return!(null===(t=null===(e=this._getCaptionEl())||void 0===e?void 0:e.textContent)||void 0===t?void 0:t.trim())},e.prototype._getCaptionEl=function(){var e;return null===(e=this._captionEl)||void 0===e?void 0:e.querySelector(".article_ed__figcaption_edit")},e.prototype.toggleCaption=function(e){this._captionEl.classList.toggle("article_ed__figcaption_visible",e)},e.prototype._toggleCaptionPlaceholder=function(e){if(void 0===this._captionPlaceholderShown||this._captionPlaceholderShown!==e){var t=this._captionEl.querySelector(".article_ed__caption_placeholder");t&&t instanceof HTMLElement&&(t.style.display=e?"block":"none",this._captionPlaceholderShown=e)}},e.prototype._isFocusInCaption=function(){var e=this,t=(0,a.__read)(n.SelectionManager.getRange(),2),r=t[0],i=t[1];if(!r)return!1;var o=function(t){var r=e._captionEl;return!!(0,s.traverseParent)(t,(function(e){return e==r}),10)};if(i)return o(r.startContainer);var l=o(r.startContainer),d=o(r.endContainer);return l&&d},e.prototype.loadErrorHandler=function(e){this.setLoadingState(!1),this._objectEl.classList.add("article_paragraph_err"),e.appendChild(this.renderLoadErr())},e.prototype.getObjectEl=function(){return this._objectEl},e.prototype.onViewport=function(e){},e.prototype.onRender=function(){},e}()},892158:(e,t,r)=>{"use strict";r.d(t,{ParagraphAudioObject:()=>d});var i=r(570655),a=r(42347),n=r(595800),o=r(650588),s=r(819086),l=r(390237),d=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=n.ArticleEditorPreparedData.get(o.ParagraphType.ObjectAudio,this.getMediaId()).audio,t=s.AudioUtils.drawAudio(e);return this._el=(0,l.createElement)('<div class="article_object_audio">'+t+"</div>"),this._el},t}(a.ParagraphObject)},656682:(e,t,r)=>{"use strict";r.d(t,{ParagraphAudioPlaylistObject:()=>d});var i=r(570655),a=r(42347),n=r(595800),o=r(650588),s=r(70162),l=r(390237),d=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this;this._el=(0,l.createElement)('\n      <div class="article_object_audio"></div>\n    ');var t=n.ArticleEditorPreparedData.get(o.ParagraphType.ObjectAudioPlaylist,this.getMediaId());if(t.snippet)this._el.innerHTML=t.snippet;else{var r=(0,i.__read)(this.getMediaId().split("_"),2),a=r[0],d=r[1];this.setLoadingState(!0),window.ajax.post("al_articles.php",{act:"get_audioplaylist_snippet",pl_owner_id:a,pl_id:d,pl_access_hash:t.accessHash},{onDone:function(t){e.setLoadingState(!1),e._el.appendChild((0,l.createElement)(t))}})}return this._el.appendChild((0,l.createElement)('<div class="article_ed__audioplaylist_play_note" contenteditable="false">'+(0,s.getLang)("pages_articles_editor_audio_play_note")+"</div>")),this._el},t}(a.ParagraphObject)},671981:(e,t,r)=>{"use strict";r.d(t,{ParagraphFacebookObject:()=>s});var i=r(570655),a=r(42347),n=r(570313),o=r(390237),s=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this,t=(0,i.__read)(this.getMediaId().split(";"),2),r=t[0],a=t[1];this._el=(0,o.createElement)('<div class="article_object_embed fb-post" data-href="https://www.facebook.com/'+r+"/posts/"+a+'/" data-width="552px"></div>'),this.setLoadingState(!0);var s=window.vk&&0==window.vk.lang?"ru_RU":"en_US";return(0,n.loadScript)("https://connect.facebook.net/"+s+"/all.js#xfbml=1&amp;version=v2.8",{onLoad:function(){setTimeout((function(){var t;null===(t=window.FB)||void 0===t||t.XFBML.parse(e._objectEl,e.setLoadingState(!1))}),0)},onError:function(){e.loadErrorHandler(e._el)}}),this._el},t}(a.ParagraphObject)},650839:(e,t,r)=>{"use strict";r.d(t,{ParagraphGIFObject:()=>c});var i=r(570655),a=r(146143),n=r(42347),o=r(595800),s=r(650588),l=r(70162),d=r(390237),c=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this;this._el=(0,d.createElement)('<div class="article_ed__gif_content"></div>');var t=o.ArticleEditorPreparedData.get(s.ParagraphType.ObjectGIF,this.getMediaId());if(t){if(this.setLoadingState(!1),t.video){if(this._videoEl=(0,d.createElement)('<video autoplay loop muted src="'+t.video+'&mp4=1">'),t.size){var r=t.size[0]<t.size[1],i=!this._isSmallGifSize();(r||i)&&(this._videoEl.style.maxWidth=t.size[0]+"px")}this._el.appendChild(this._videoEl),this._el.appendChild((0,d.createElement)('<span class="article_ed__select_dummy">&nbsp;</span>'))}else if(t.href){var n=t.href+"&wnd=1&module="+window.cur.module;this._imgEl=(0,d.createElement)("<img>"),this._imgEl.addEventListener("error",(function(){(0,a.showFastBox)((0,l.getLang)("pages_article_error_box_title"),(0,l.getLang)("pages_article_error_box_text")),e._editor.removeObject(e)})),this._imgEl.src=n,this._el.appendChild(this._imgEl)}}else this.setLoadingState(!0);return this._el},t.prototype.onViewport=function(e){this._imgEl?this._imgEl.style.visibility=e?"visible":"hidden":e?this._videoEl&&this._videoEl.play().catch((function(){})):this._videoEl&&this._videoEl.pause()},t.prototype.onRender=function(){var e=this;setTimeout((function(){if(e._videoEl&&(e._videoEl.play().catch((function(){})),window.browser.msie)){var t=e._videoEl.src;e._videoEl.src="",e._videoEl.src=t}}))},t.prototype._isSmallGifSize=function(){var e=o.ArticleEditorPreparedData.get(s.ParagraphType.ObjectGIF,this.getMediaId());return!(!e||!e.size)&&e.size[0]>this.getEditor().getOptions().minGifWidthExpand},t}(n.ParagraphObject)},746546:(e,t,r)=>{"use strict";r.d(t,{ParagraphInstagramObject:()=>d});var i=r(570655),a=r(42347),n=r(650588),o=r(152278),s=r(570313),l=r(390237),d=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this;return this._el=(0,l.createElement)('\n      <div class="article_object_embed article_object_embed_instagram">\n        <blockquote\n            class="article_embed_spacer instagram-media"\n            data-instgrm-permalink="https://instagram.com/p/'+this.getMediaId()+'"\n            data-instgrm-version="12"\n        ></blockquote>\n      <div>\n    '),this.setLoadingState(!0),(0,s.loadScript)("https://www.instagram.com/embed.js",{onLoad:function(){setTimeout((function(){var t;null===(t=window.instgrm)||void 0===t||t.Embeds.process(),(0,o.addEvent)(window,"message",n.changeHeightInstagramEmbed),e.setLoadingState(!1)}),0)},onError:function(){e.loadErrorHandler(e._el)}}),this._el},t}(a.ParagraphObject)},641239:(e,t,r)=>{"use strict";r.d(t,{ParagraphMarketAliExpressProductObject:()=>l});var i=r(570655),a=r(42347),n=r(595800),o=r(650588),s=r(83178),l=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=n.ArticleEditorPreparedData.getRaw(o.ParagraphType.ObjectAliExpressProduct,this.getMediaId());return this._el=(0,s.buildProductSnippetElement)(e,"article_add__object_market_aliexpress_product"),this._el},t}(a.ParagraphObject)},119162:(e,t,r)=>{"use strict";r.d(t,{ParagraphMarketProductObject:()=>l});var i=r(570655),a=r(42347),n=r(595800),o=r(650588),s=r(83178),l=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=n.ArticleEditorPreparedData.get(o.ParagraphType.ObjectMarketItem,this.getMediaId());return this._el=(0,s.buildProductSnippetElement)(e,"article_add__object_market_product"),this._el},t}(a.ParagraphObject)},621118:(e,t,r)=>{"use strict";r.d(t,{ParagraphPhotoObject:()=>m});var i,a=r(570655),n=r(42347),o=r(601306),s=r(650588),l=r(595800),d=r(164451),c=r(83178),h=r(70162),p=r(390237),u=r(157307),g=r(120476),m=function(e){function t(t,r,i){var a=e.call(this,t,r,!0)||this;return a._currentImageIndex=0,a.paragraph=i,a}return(0,a.__extends)(t,e),t.prototype.cancelCarouselEditor=function(){var e;null===(e=this._carouselEditor)||void 0===e||e.cancel()},t.prototype.renderExtraControlsEl=function(){var e=this,t=(0,p.createElement)('\n        <div>\n          <div class="article_ed__carousel_nav_btn">\n            <div class="article_ed__carousel_nav_btn_left">'+(0,u.getIcon36CarouselLeftFilled)().icon+'</div>\n            <div class="article_ed__carousel_nav_btn_right">'+(0,g.getIcon36CarouselRightFilled)().icon+'</div>\n          </div>\n          <div class="article_ed__carousel_btns">\n            <button class="article_ed__carousel_btn article_ed__carousel_btn_edit">'+(0,h.getLang)("pages_article_ed_create_carousel")+'</button>\n            <div class="article_ed__carousel_btn article_ed__carousel_counter"></div>\n          </div>\n        </div>\n    ');this._carouselControlsEl=t;var r=t.querySelector(".article_ed__carousel_btn_edit"),i=t.querySelector(".article_ed__carousel_nav_btn_left"),a=t.querySelector(".article_ed__carousel_nav_btn_right");return this._editButtonEl=r,this._controls=t,this.updateEditButtonCaption(),r.addEventListener("click",(function(t){return e.createCarousel(),(0,p.cancelEvent)(t)})),i.addEventListener("click",this.prevPhotoInCarousel.bind(this)),a.addEventListener("click",this.nextPhotoInCarousel.bind(this)),this._setImageIndex(0),t},t.prototype.renderCarouselHover=function(){this._carouselControlsEl&&!this._hoverEl&&(this._hoverEl=(0,p.createElement)('<div class="article_ed__carouselHover"></div>'),this._hoverEl.innerHTML=this.isCarousel()||this.isCarouselEditorOpened()?(0,h.getLang)("pages_article_ed_add_photo_carousel_hint"):(0,h.getLang)("pages_article_ed_create_carousel_hint"),this._carouselControlsEl.after(this._hoverEl))},t.prototype.removeCarouselHover=function(){var e;null===(e=this._hoverEl)||void 0===e||e.remove(),this._hoverEl=null},t.prototype.updateEditButtonCaption=function(){var e=this.getMediaIdsCount()>1;this._editButtonEl.innerHTML=e?(0,h.getLang)("pages_article_ed_edit_carousel"):(0,h.getLang)("pages_article_ed_create_carousel")},t.prototype.createCarousel=function(){var e=this,t=this.getEditor();t.closeAllCarouselEditors(),t.resizeTooltip&&t.resizeTooltip.hide(),this._objectEl.classList.add("article_ed__carousel_edit_open");var r=t.getParagraphById(this.paragraph.id);this.toggleCaption(!1),this._carouselEditor=new d.ArticleEditorCarousel(this._controls,this,(function(i,a){i?(delete e._fixedImageSize,e.setMediaId(i),e.appendObjectInnerEl(),t.saveUndoStateAndDraft(),e.updateEditButtonCaption(),r&&(r.lines=a.slice()),e._setImageIndex(0),t.getParagraphIndexById(e.paragraph.id)>=0?(t.setParagraphDirty(e.paragraph.id),t.redraw(!1)):t.redraw(!0),e._objectEl.classList.remove("article_ed__carousel_edit_open"),delete e._carouselEditor,e._captionEl&&e._captionEl.innerText&&e.toggleCaption(!0)):t.removeObject(e)}),t.getLimits().maxCarouselItems,r?r.lines.slice():[])},t.prototype.addPhotoInCarousel=function(e,t,r){void 0===r&&(r=0),this._carouselEditor&&this._carouselEditor.addPhoto(e,t,r)},t.prototype.nextPhotoInCarousel=function(){this.isCarousel()&&this._changePhotoInCarousel(!1)},t.prototype.prevPhotoInCarousel=function(){this.isCarousel()&&this._changePhotoInCarousel(!0)},t.prototype._changePhotoInCarousel=function(e){var t=this.getEditor();if(this._setImageIndex(this.getImageIndex()+(e?-1:1)),t.getParagraphIndexById(this.paragraph.id)>=0?(t.setParagraphDirty(this.paragraph.id),t.redraw(!1)):t.redraw(!0),this.isCaptionFocused()){var r=this.getCaptionEl();r&&o.SelectionManager.setCaretAtElement(r,!0)}},t.prototype.getImageIndex=function(){return Math.min(this.getMediaIdsCount()-1,this._currentImageIndex)},t.prototype._setImageIndex=function(e){this._currentImageIndex=Math.min(Math.max(0,e),this.getMediaIdsCount());var t=this._carouselControlsEl.querySelector(".article_ed__carousel_nav_btn"),r=this._carouselControlsEl.querySelector(".article_ed__carousel_counter");t&&r instanceof HTMLElement&&(null==t||t.classList.toggle("no_left",0==this._currentImageIndex),null==t||t.classList.toggle("no_right",this._currentImageIndex==this.getMediaIdsCount()-1),this._objectEl.classList.toggle("article__carousel",this.isCarousel()),this.isCarousel()?(r.style.display="inline-block",r.innerHTML=(0,h.getLang)("pages_article_ed_carousel_counter").replace("{counter}",String(this._currentImageIndex+1)).replace("{total}",String(this.getMediaIdsCount()))):r.style.display="none",this._drawImage(),this.highlight())},t.prototype.render=function(){var e=this;this._el=(0,p.createElement)('\n      <div class="article_ed__img_content">\n        <img contenteditable="false" class="article_ed__img"/>\n      </div>\n    ');var t=l.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPhoto,this.getMediaId(),0);t&&t.sizes?(this.setLoadingState(!1),this._drawImage()):this.setLoadingState(!0);var r=this._el.querySelector("img");return r&&r.addEventListener("load",(function(){e.getEditor().onObjectStateLoaded()})),this._el},t.prototype._initUpload=function(e,t){var r=this;if(void 0===this._upload){var i=this.getEditor().getPhotoUploadOptions();this._upload=window.Upload.init(this.getEditor().getPhotoUploadEl(),i.url,i.params,{file_name:"photo",file_size_limit:15728640,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:s.ALLOWED_FILE_TYPES_FOR_PASTE,file_input:null,accept:"image/jpeg,image/png,image/gif",wiki_editor:0,noCheck:!0,onUploadComplete:function(t,i){var n=JSON.parse(i);n&&0!==Object.keys(n).length?window.ajax.post("al_photos.php",(0,a.__assign)((0,a.__assign)({},n),{act:"choose_uploaded"}),{onDone:function(t,i){r._mediaId=t,l.ArticleEditorPreparedData.add(s.ParagraphType.ObjectPhoto,t,{size:(0,c.getPhotoSize)(i.editable.sizes),sizes:i.editable.sizes}),r._drawImage(),e(),r.getEditor().saveUndoStateAndDraft()}}):e()},onNoFilteredCallback:function(){null==t||t()},max_files:20,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:i.opts.server,error:i.opts.default_error,error_hash:i.opts.error_hash,lang:{filesize_error:(0,h.getLang)("pages_article_ed_filesize_error")}})}},t.prototype._getImageEl=function(){return this._el.querySelector("img")},t.prototype.setBLOB=function(e,t,r){var i=this,a=new FileReader;a.onload=function(){i._initUpload(t,r),window.Upload.checkFilesSizes(i._upload,[e])?window.Upload.onFileApiSend(i._upload,[e]):null==r||r()},a.readAsDataURL(e)},t.prototype._drawImage=function(){var e=this;if(this._el){var t=l.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPhoto,this.getMediaId(),this.getImageIndex()),r=720;if((0,c.isObjectResize)(this.paragraph))switch(Number(this.paragraph.mode)){case 1:r=350;break;case 2:r=920;break;case 3:r=window.innerWidth}if(t){var n=(0,a.__read)((0,s.getAppropriateImage)(t.sizes,r),1)[0],o=this._getImageEl(),d=!1;o.onload=function(){clearTimeout(i),d=!0,o.style.visibility="visible",o.style.display="block",e.setLoadingState(!1),e.isCarousel()&&(0===e.getImageIndex()&&(e._fixedImageSize=(0,p.getSize)(e._el),e._ratio=e._fixedImageSize[0]/e._fixedImageSize[1]),e.fixSize())},o.src=n,clearTimeout(i),d||(i=setTimeout((function(){d||(o.style.visibility="hidden",e.setLoadingState(!0,e.isCarousel()))}),10))}}},t.prototype.isCarousel=function(){return this.getMediaIdsCount()>1},t.prototype.isCarouselEditorOpened=function(){return!!this._carouselEditor},t.prototype.fixSize=function(){this._ratio&&(this._fixedImageSize=(0,p.getSize)(this._el),this._el.style.height=Math.ceil(this._fixedImageSize[0]/this._ratio)+"px",this._getImageEl().style.maxWidth=this._fixedImageSize[0]+"px",this._getImageEl().style.maxHeight=Math.ceil(this._fixedImageSize[0]/this._ratio)+"px")},t.prototype.isSmallPhotoSize=function(){var e=l.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPhoto,this.getMediaId(),0);return!(!e&&!e.size)&&e.size[0]>=720},t.prototype.toggleCaption=function(e){this.isCarouselEditorOpened()&&e||this._captionEl.classList.toggle("article_ed__figcaption_visible",e)},t}(n.ParagraphObject)},157853:(e,t,r)=>{"use strict";r.d(t,{ParagraphPodcastObject:()=>d});var i=r(570655),a=r(42347),n=r(595800),o=r(650588),s=r(70162),l=r(390237),d=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this;this._el=(0,l.createElement)('\n      <div class="article_object_audio"></div>\n    ');var t=n.ArticleEditorPreparedData.get(o.ParagraphType.ObjectPodcast,this.getMediaId());if(t.snippet)this._el.innerHTML=t.snippet;else{var r=(0,i.__read)(this.getMediaId().split("_"),2),a=r[0],d=r[1];this.setLoadingState(!0),window.ajax.post("al_articles.php",{act:"get_podcast_snippet",owner_id:a,podcast_id:d},{onDone:function(t){e.setLoadingState(!1),e._el.appendChild((0,l.createElement)(t))}})}return this._el.appendChild((0,l.createElement)('<div class="article_ed__audioplaylist_play_note" contenteditable="false">'+(0,s.getLang)("pages_articles_editor_audio_play_note")+"</div>")),this._el},t}(a.ParagraphObject)},892318:(e,t,r)=>{"use strict";r.d(t,{ParagraphPollObject:()=>d});var i=r(570655),a=r(42347),n=r(595800),o=r(650588),s=r(70162),l=r(390237),d=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this;this._el=(0,l.createElement)('\n      <div class="article_object_poll"></div>\n    ');var t=n.ArticleEditorPreparedData.get(o.ParagraphType.ObjectPoll,this.getMediaId());if(t&&t.snippet)return this._el.appendChild((0,l.createElement)(t.snippet)),this._el;var r=(0,i.__read)(this.getMediaId().split("_"),2)[1];return this.setLoadingState(!0),window.ajax.post("al_articles.php",{act:"get_poll_snippet",voting_id:r},{onDone:function(t){e.setLoadingState(!1),e._el.appendChild((0,l.createElement)(t))}}),this._el},t.prototype.renderEditControlEl=function(){var e=n.ArticleEditorPreparedData.get(o.ParagraphType.ObjectPoll,this.getMediaId());if(!e||!e.editable)return!1;var t=(0,l.createElement)('\n      <div class="article_ed__obj_edit_control">\n        <div class="article_ed__poll_object_btn">\n          <button class="article_ed__poll_object_edit">'+(0,s.getLang)("global_edit")+"</button>\n        </div>\n      </div>\n    ");return t.querySelector(".article_ed__poll_object_edit").addEventListener("click",this._editor.editObjectPoll.bind(this._editor,this)),t},t}(a.ParagraphObject)},560949:(e,t,r)=>{"use strict";r.d(t,{ParagraphTelegramObject:()=>s});var i=r(570655),a=r(42347),n=r(570313),o=r(390237),s=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this,t=(0,i.__read)(this.getMediaId().split(";"),2),r=t[0],a=t[1];return this._el=(0,o.createElement)('<div class="article_object_embed"><blockquote class="telegram-post" data-telegram-post="'+r+"/"+a+'" data-width="100%" data-userpic="true"></div>'),this.setLoadingState(!0),(0,n.loadScript)("https://telegram.org/js/telegram-widget.js?5",{onLoad:function(){e.setLoadingState(!1)},onError:function(){e.loadErrorHandler(e._el)}}),this._el},t}(a.ParagraphObject)},24904:(e,t,r)=>{"use strict";r.d(t,{ParagraphTwitterObject:()=>s});var i=r(570655),a=r(42347),n=r(570313),o=r(390237),s=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this;return this._el=(0,o.createElement)('<div class="article_object_embed"></div>'),this.setLoadingState(!0),(0,n.loadScript)("https://platform.twitter.com/widgets.js",{onLoad:function(){var t;e.setLoadingState(!1),null===(t=window.twttr)||void 0===t||t.widgets.createTweet(e.getMediaId(),e._el,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0}).then((function(){}))},onError:function(){e.loadErrorHandler(e._el)}}),this._el},t}(a.ParagraphObject)},964104:(e,t,r)=>{"use strict";r.d(t,{ParagraphVideoObject:()=>c});var i=r(570655),a=r(42347),n=r(650588),o=r(595800),s=r(70162),l=r(873589),d=r(390237),c=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){this._el=(0,d.createElement)('<div class="article_object_video"></div>');var e=o.ArticleEditorPreparedData.get(n.ParagraphType.ObjectVideo,this.getMediaId());if(!e)return this.setLoadingState(!0),this._el;if(this.platform=e.editable.is_live?"VK_live":e.platform||"",this.setLoadingState(!1),e.preview)this._el.appendChild((0,d.createElement)('<div class="article_ed__video_play_note" contenteditable="false">'+(0,s.getLang)("pages_articles_editor_video_play_note")+"</div>")),this._el.appendChild((0,d.createElement)(e.preview));else if(e.editable||e.thumb){var t=void 0;if(e.thumb)t=e.thumb;else t=(0,n.getAppropriateImage)(e.editable.sizes,this.getEditor().getWidth(!0))[0];this._el.appendChild((0,d.createElement)('<div class="article_object_video_play"></div>')),this._el.appendChild((0,d.createElement)((0,l.rs)(this.getEditor().getOptions().videoLabelTemplate,{duration:e.duration||0,platform:e.platform||""}))),this._el.appendChild((0,d.createElement)('<div class="article_ed__video_play_note" contenteditable="false">'+(0,s.getLang)("pages_articles_editor_video_play_note")+"</div>")),this._el.appendChild((0,d.createElement)('<img class="article_ed__video_img" src="'+t+'" contenteditable="false" />'))}return this._el},t}(a.ParagraphObject)},882206:(e,t,r)=>{"use strict";r.d(t,{ParagraphVKObject:()=>s});var i=r(570655),a=r(42347),n=r(570313),o=r(390237),s=function(e){function t(t,r){return e.call(this,t,r,!0)||this}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this;return this._el=(0,o.createElement)('<div class="article_object_embed"></div>'),setTimeout((function(){var t=(0,i.__read)(e.getMediaId().split(";"),2),r=t[0],a=t[1],o=e._objectEl.dataset.uuid||"",s="vk_post_"+e.getMediaId()+"_"+o;e._el.setAttribute("id",s),e.setLoadingState(!0),(0,n.loadScript)("/js/api/openapi.js",{onLoad:function(){window.ajax.post("dev.php",{act:"a_get_post_hash",post:r+"_"+a},{onDone:function(t){var i,n;t&&(e.setLoadingState(!1),null===(n=null===(i=window.VK)||void 0===i?void 0:i.Widgets)||void 0===n||n.Post(""+s,r,a,t))},onFail:function(){return e.loadErrorHandler(e._el),!0}})}})}),0),this._el},t}(a.ParagraphObject)},60014:(e,t,r)=>{"use strict";r.d(t,{Sequences:()=>i});var i=[{pattern:/--$/,noUndo:!0,substitution:"—"},{pattern:/\s"$/,substitution:" “",noUndo:!0,cyrillic:!1},{pattern:/(\S)"$/,substitution:"$1”",noUndo:!0,cyrillic:!1},{pattern:/^"$/,substitution:"“",noUndo:!0,cyrillic:!1},{pattern:/\s"$/,substitution:" «",noUndo:!0,cyrillic:!0},{pattern:/(\S)"$/,substitution:"$1»",noUndo:!0,cyrillic:!0},{pattern:/^"$/,substitution:"«",noUndo:!0,cyrillic:!0},{pattern:"+/-",substitution:"±"},{pattern:"+-",substitution:"±"},{pattern:"^2",substitution:"²"},{pattern:"^3",substitution:"³"},{pattern:"<<",substitution:"«"},{pattern:">>",substitution:"»"},{pattern:"(c)",substitution:"©"},{pattern:"(C)",substitution:"©"},{pattern:"(r)",substitution:"®"},{pattern:"(R)",substitution:"®"},{pattern:"1/2",substitution:"½"},{pattern:"1/4",substitution:"¼"},{pattern:"3/4",substitution:"¾"},{pattern:"...",substitution:"…"},{pattern:"->",substitution:"→"},{pattern:"<-",substitution:"←"},{pattern:"!=",substitution:"≠"},{pattern:"<=",substitution:"≤"},{pattern:">=",substitution:"≥"}]},929314:(e,t,r)=>{"use strict";r.d(t,{createComment:()=>a,editComment:()=>n,deleteComment:()=>o,getComments:()=>s,setCommentState:()=>l});var i=r(189798),a=function(e){return(0,i.api)("articles.createComment",e)},n=function(e){return(0,i.api)("articles.editComment",e)},o=function(e){return(0,i.api)("articles.deleteComment",e)},s=function(e){return(0,i.api)("articles.getComments",e)},l=function(e){return(0,i.api)("articles.setCommentState",e)}},530662:(e,t,r)=>{"use strict";r.d(t,{ArticleAttachComment:()=>o});var i=r(565573),a=r(390237),n=r(191381),o=function(){function e(e,t,r,i,a){this.contentMargin=n.ArticleCommentTopAttachPadding,this.attachElement=e,this.attachPosition=t,this.attachElementHeight=this.attachElement.clientHeight,this.commentIds=r,this.store=i,this.dataMode=a,2===this.dataMode&&(this.contentMargin=n.ArticleCommentsMinHeight),this.defineOpening(),2!==this.dataMode&&3!==this.dataMode||this.createButton()}return e.prototype.createButton=function(){var e,t=this,r=(0,i.getIcon16CommentOutline)().icon;this.button=(0,a.createElement)('<div class="ArticleComments__attachCommentButton ArticleComments__attachCommentButton--close">'+r+" "+this.commentIds.length+"</div>"),this.button.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),t.isOpen?t.closeAttachComments():t.openAttachComments()})),null===(e=this.attachElement.querySelector(".article_ed_paragraph_tools"))||void 0===e||e.append(this.button)},e.prototype.closeAttachComments=function(){var e=this;if(this.button){this.store.commentsContentView.filter((function(t){return e.commentIds.includes(t.getCommentId())})).forEach((function(t){t.setMarginTop(e.attachElementHeight+n.ArticleCommentsAttachMargin),t.removeModifier("inAttach")})),this.button.classList.add("ArticleComments__attachCommentButton--close"),this.isOpen=!1;var t=new CustomEvent("setCommentsElsPosition");document.dispatchEvent(t)}},e.prototype.openAttachComments=function(){var e=this;this.store.openAttachComments(),this.store.commentsContentView.filter((function(t){return e.commentIds.includes(t.getCommentId())})).forEach((function(t){t.setMarginTop(e.contentMargin),t.setModifier("inAttach")})),this.isOpen=!0,this.button.classList.remove("ArticleComments__attachCommentButton--close");var t=new CustomEvent("setCommentsElsPosition");this.store.articleLayer.dispatchEvent(t)},e.prototype.getOpenStatus=function(){return this.isOpen},e.prototype.defineOpening=function(){var e=this,t=this.store.commentsContentView.filter((function(t){return e.commentIds.includes(t.getCommentId())}));0!==t.length?this.isOpen=t[0].getMargin()<=this.contentMargin:this.isOpen=!1},e.prototype.destroy=function(){this.button&&this.button.remove()},e}()},30462:(e,t,r)=>{"use strict";r.d(t,{ArticleCommentsComment:()=>v});var i=r(390237),a=r(273293),n=r(929222),o=r(22028),s=r(281983),l=r(427053),d=r(691033),c=r(666738),h=r(517920),p=r(608021),u=r(191381),g=r(733164),m=r(820929),v=function(){function e(e,t,r,a){this.profiles=[],this.commentShowMoreTooltip=[],this.defaultPosition=0,this.minHeight=u.ArticleCommentsMinHeight,this.heightElement=this.minHeight,this.marginTop=0,this.position=0,this.store=t,this.modifier=[],a&&(a instanceof Array?this.modifier=a:this.modifier.push(a)),this.commentInfo=e,this.profiles=this.store.getCommentsProfiles(),this.commentReplayData=e.thread,this.navigateCb=r,this.renderShowMoreButton(),this.renderDataReplay(),this.element=(0,i.createElement)('<div class="ArticleComments__commentElement" data-comment-id="'+this.commentInfo.id+'">');var n=this.getProfileById(this.commentInfo.from_id),o=this.commentInfo.date!==this.commentInfo.modification_time;this.commentAuthorName=(0,i.createElement)('<span class="ArticleComments__commentAuthorName">\n            '+n.first_name+" "+n.last_name+"\n        </span>"),o&&this.createEditedInfoBlock(this.commentAuthorName),this.commentText=(0,i.createElement)('<span class="ArticleComments__commentAuthorText"></span>'),this.commentText.textContent=(0,g.clean)(this.commentInfo.text),this.commentWrap=(0,i.createElement)('<div class="ArticleComments__commentWrapper ArticleComments__commentWrapper---main">\n            <img class="ArticleComments__commentAvatar"\n                src="'+n.photo_50+'"\n                alt="'+n.first_name+'">\n        </div>'),this.element.append(this.commentWrap),this.createHeader(),this.initReplayWrapper(),this.createInput(),this.setStatus("inactive"),this.initCustomEventsListeners()}return e.prototype.createSingleComment=function(e){var t=(0,i.createElement)('<span class="ArticleComments__commentAuthorText ArticleComments__commentAuthorText--replay"></span>');this.processText(t,e.text);var r=this.getProfileById(e.from_id),a=(0,i.createElement)('<div class="ArticleComments__commentWrapper" data-comment-id="'+e.id+'">\n            <span class="ArticleComments__commentCreateData">'+(0,p.getDateText)(e.date,0)+'</span>\n            <img class="ArticleComments__commentAvatar"\n                src="'+r.photo_50+'"\n                alt="'+r.first_name+'">\n            <span class="ArticleComments__commentAuthorName">\n                '+r.first_name+" "+r.last_name+"\n            </span>\n        </div>");if(e.date!==e.modification_time&&this.createEditedInfoBlock(a.querySelector(".ArticleComments__commentAuthorName")),window.vk.id===e.from_id){var n=this.createShowMoreButton(u.ArticleCommentsReplayTooltip,e.id);a.prepend(n)}return a.append(t),a},e.prototype.createShowMoreButton=function(e,t){var r,n=this,o=(0,i.createElement)('<div class="ArticleComments__tooltipWrapper"></div>');e.forEach((function(e){if(!("resolve"===e.type&&n.commentInfo.is_resolved||"unresolve"===e.type&&!n.commentInfo.is_resolved||n.getModifier().includes("outContent")&&"edit"===e.type)){var r=(0,i.createElement)('<div class="ArticleComments__tooltipItem '+(e.remove?"ArticleComments__tooltipItem--remove":"")+'">'+e.text+"</div>");switch(e.type){case"edit":r.addEventListener("click",(function(e){e.stopPropagation(),n.actionEditComment(t)}));break;case"delete":r.addEventListener("click",(function(){n.deleteComment(t).then((function(){})).catch((function(e){console.log(e)}))}));break;case"resolve":r.addEventListener("click",(function(){n.store.sendResolveComment(n.commentInfo.id).then((function(){})).catch((function(e){console.log(e)}))}));break;case"unresolve":r.addEventListener("click",(function(){n.store.sendUnresolveComment(n.commentInfo.id).then((function(){})).catch((function(e){console.log(e)}))}))}o.append(r)}}));var s=(0,a.getIcon16MoreHorizontal)().icon,l=(0,i.createElement)('<div class="ArticleComments__commentShowMore">'+s+"</div>"),d=!1;(null===(r=this.commentReplayData)||void 0===r?void 0:r.count)&&(d=this.commentReplayData.count>2&&this.commentShowMoreTooltip.length===this.commentReplayData.count);var c=new h.default(l,{content:o,forceSide:d?"top":"bottom",autoShow:!1,offset:[-86,10],cls:"ArticleComments__tooltip",noHideOnClick:!1,onShow:function(){n.element.classList.add("ArticleComments__commentShowMore--open")},onHide:function(){n.element.classList.remove("ArticleComments__commentShowMore--open")}});return this.commentShowMoreTooltip.push(c),l.addEventListener("click",(function(e){e.stopPropagation()})),l},e.prototype.createEditedInfoBlock=function(e){if(!e.querySelector(".ArticleComments__commentEditedInfo")){var t=(0,i.createElement)('<div class="ArticleComments__commentEditedInfo">&nbsp;('+(0,p.getLang)("pages_article_comments_edited_text")+".)</div>");e.append(t)}},e.prototype.renderShowMoreButton=function(){var e=!1;this.element&&this.commentWrap.contains(this.commentShowMore)&&(this.commentShowMore.remove(),e=!0),window.vk.id===this.commentInfo.from_id?this.commentShowMore=this.createShowMoreButton(u.ArticleCommentsTreadTooltip,this.commentInfo.id):this.commentShowMore=(0,i.createElement)("<div></div>"),e&&this.commentWrap.append(this.commentShowMore)},e.prototype.hideAllTooltips=function(){this.commentShowMoreTooltip.forEach((function(e){e.isShown()&&e.hide()}))},e.prototype.renderDataReplay=function(){this.commentDataReplay?this.commentDataReplay.innerHTML=(0,p.getDateText)(this.commentInfo.date,0)+" • "+(this.commentReplayData&&this.commentReplayData.count>=1?this.commentReplayData.count+" "+(0,p.getLang)("pages_article_comments_replay_count",this.commentReplayData.count):(0,p.getLang)("pages_article_comments_no_replays")):this.commentDataReplay=(0,i.createElement)('<span class="ArticleComments__commentCreateData">\n            '+(0,p.getDateText)(this.commentInfo.date,0)+" • "+(this.commentReplayData&&this.commentReplayData.count>=1?this.commentReplayData.count+" "+(0,p.getLang)("pages_article_comments_replay_count",this.commentReplayData.count):(0,p.getLang)("pages_article_comments_no_replays"))+"\n        </span>")},e.prototype.processText=function(e,t,r){var a=this;void 0===r&&(r=!1);var n=100;"hover"===this.status&&(n=75);var o=(0,i.createElement)('<button class="ArticleComments__commentShowFull">'+(0,p.getLang)("pages_article_comments_show_full_text")+"...</button>"),s=(0,g.clean)(t);s.length>=n&&!r?(e.innerHTML=this.processMentionToText(s.slice(0,n)+"..."),"hover"!==this.status&&(e.append(o),o.addEventListener("click",(function(t){t.stopPropagation(),e.innerHTML=(0,m.replaceHyperLinks)(a.processMentionToText(s),(function(e){return(0,m.linksReplacer)(e)})),a.renderReplayWrapper(),a.activeAnimation()})))):e.innerHTML=(0,m.replaceHyperLinks)(this.processMentionToText(s),(function(e){return(0,m.linksReplacer)(e)})),this.renderReplayWrapper()},e.prototype.processMentionToText=function(e,t){void 0===t&&(t=!1);var r=e,i=e.match(/\[id[a-zA-ZА-Яа-я\d@*|]+]/g);return i?(i.forEach((function(e){var i=e.match(/\[(.*)\|/),a=e.match(/\|(.*)\]/);if(i&&a){var n=a[1].startsWith("@");r=t?n?r.replace(e,a[1]):r.replace(e,"@"+i[1]+" ("+a[1]+")"):r.replace(e,'<a href="/'+(n?a[1].slice(1):i[1])+'" >'+a[1]+"</a>")}})),r):r},e.prototype.createHeader=function(){var e=this,t=(0,n.getIcon24ArrowLeftOutline)().icon;this.commentHeaderPrevButton=(0,i.createElement)('\n            <button class="ArticleComments__commentControlsButton">'+t+"</button>\n        "),this.commentHeaderPrevButton.addEventListener("click",(function(t){t.stopPropagation(),e.navigateCb("left",e.getCommentId())}));var r=(0,o.getIcon24ArrowRightOutline)().icon;this.commentHeaderNextButton=(0,i.createElement)('\n            <button class="ArticleComments__commentControlsButton">'+r+"</button>\n        "),this.commentHeaderNextButton.addEventListener("click",(function(t){t.stopPropagation(),e.navigateCb("right",e.getCommentId())}));var a=(0,s.getIcon24CheckCircleOutline)().icon;this.commentHeaderResolveButton=(0,i.createElement)('\n            <button class="ArticleComments__commentControlsButton">'+a+"</button>\n        "),this.commentHeaderResolveButton.addEventListener("click",(function(t){t.stopPropagation(),e.commentInfo.is_resolved?e.store.sendUnresolveComment(e.commentInfo.id).then((function(){})).catch((function(e){console.log(e)})):e.store.sendResolveComment(e.commentInfo.id).then((function(){})).catch((function(e){console.log(e)}))})),this.renderResolveButton();var d=(0,l.getIcon24CancelOutline)().icon;this.commentHeaderDeleteButton=(0,i.createElement)('\n            <button class="ArticleComments__commentControlsButton">'+d+"</button>\n        "),this.commentHeaderDeleteButton.addEventListener("click",(function(){e.setStatus("inactive")})),this.commentHeader=(0,i.createElement)('<div class="ArticleComments__commentHeader"></div>'),this.commentHeader.append(this.commentHeaderPrevButton,this.commentHeaderNextButton),window.vk.id===this.commentInfo.from_id&&this.commentHeader.append(this.commentHeaderResolveButton),this.commentHeader.append(this.commentHeaderDeleteButton)},e.prototype.renderResolveButton=function(){this.commentHeaderResolveButton.classList.toggle("ArticleComments__commentControlsButton--resolve",this.commentInfo.is_resolved)},e.prototype.initReplayWrapper=function(){var e,t,r=this;this.commentReplayWrapper||(this.commentReplayWrapper=(0,i.createElement)('<div class="ArticleComments__commentReplayWrapper"></div>')),(null===(e=this.commentReplayData)||void 0===e?void 0:e.items)&&this.commentReplayData.items.length>0?(this.commentReplayWrapper.classList.add("ArticleComments__commentReplayWrapper"),this.commentReplayWrapper.classList.remove("ArticleComments__commentReplayWrapper--lowReplays"),this.commentReplayWrapper.scrollHeight<500&&this.commentReplayWrapper.classList.add("ArticleComments__commentReplayWrapper--lowReplays"),this.commentReplayWrapper.innerHTML="",null===(t=this.commentReplayData.items)||void 0===t||t.forEach((function(e){r.commentReplayWrapper.append(r.createSingleComment(e))}))):(this.commentReplayWrapper.classList.remove("ArticleComments__commentReplayWrapper"),this.commentReplayWrapper.classList.remove("ArticleComments__commentReplayWrapper--lowReplays"))},e.prototype.renderReplayWrapper=function(){this.commentReplayData&&this.commentReplayData.count>0?(this.commentReplayWrapper.classList.add("ArticleComments__commentReplayWrapper"),this.commentReplayWrapper.classList.remove("ArticleComments__commentReplayWrapper--lowReplays"),this.commentReplayWrapper.scrollHeight<500?this.commentReplayWrapper.classList.add("ArticleComments__commentReplayWrapper--lowReplays"):this.commentReplayWrapper.classList.remove("ArticleComments__commentReplayWrapper--lowReplays")):(this.commentReplayWrapper.classList.remove("ArticleComments__commentReplayWrapper"),this.commentReplayWrapper.classList.remove("ArticleComments__commentReplayWrapper--lowReplays"))},e.prototype.createInput=function(){var e=this;this.commentInput=new c.ArticleCommentInput({closeMentionCallback:function(){e.element.style.overflow="",e.element.classList.remove("ArticleComments__mentionOpenBottom")},openMentionCallback:function(t){e.element.style.overflow="visible",e.commentInputWrapper.getBoundingClientRect().top-u.ArticleCommentsMentionHeight-u.ArticleCommentsMentionMarginTopDocument>0?t.classList.add("ArticleComments__mentionWrap--top"):(e.element.classList.add("ArticleComments__mentionOpenBottom"),t.classList.add("ArticleComments__mentionWrap--bottom")),e.commentInputWrapper.appendChild(t)},resizeCallBack:function(){e.activeAnimation()}}),this.setInputReplayCallback(),this.commentInputWrapper=(0,i.createElement)('<div class="ArticleComments__commentInputWrapper"></div>'),this.commentInputWrapper.append(this.commentInput.getWrapper())},e.prototype.setInputReplayCallback=function(){var e=this;this.commentInput.setSendCallBack((function(t){return e.commentInput.setText(""),e.sendReplayComment(e.commentInfo.id,t)}))},e.prototype.actionEditComment=function(e){var t,r,i,a,n=this;"active"!==this.status&&this.setStatus("active");var o="";if(this.commentInfo.id===e)o=this.commentInfo.text;else{var s=null===(i=null===(r=null===(t=this.commentReplayData)||void 0===t?void 0:t.items)||void 0===r?void 0:r.find((function(t){return t.id===e})))||void 0===i?void 0:i.text;o=s||""}null===(a=this.element.querySelector(".ArticleComments__commentWrapper--editing"))||void 0===a||a.classList.remove("ArticleComments__commentWrapper--editing");var l=this.element.querySelector("[data-comment-id='"+e+"']");l||(l=this.commentWrap),l.classList.add("ArticleComments__commentWrapper--editing"),this.commentInput.setButton("check"),this.commentInput.setSendCallBack((function(t){return n.commentInput.setText(""),n.destroyCommentEditPopup(),n.editComment(e,t)})),this.commentInput.setText(this.processMentionToText(o,!0)),this.createCommentEditPopup(this.processMentionToText(o,!0)),this.activeAnimation(),this.hideAllTooltips()},e.prototype.createCommentEditPopup=function(e){var t=this;this.commentEditPopup instanceof HTMLElement&&this.commentEditPopup.remove(),this.commentEditPopup=(0,i.createElement)('<div class="ArticleComments__commentEditPopup"></div>');var r=(0,i.createElement)('<span class="ArticleComments__commentEditPopupTittle">'+(0,p.getLang)("pages_article_comments_edit_title")+"</span>");this.commentEditPopup.append(r);var a=(0,i.createElement)('<span class="ArticleComments__commentEditPopupText"></span>');a.textContent=(0,g.clean)(e),this.commentEditPopup.append(a);var n=(0,d.getIcon24Cancel)().icon,o=(0,i.createElement)('<button class="ArticleComments__commentEditPopupButton">'+n+"</button>");this.commentEditPopup.append(o),o.addEventListener("click",(function(e){e.stopPropagation(),t.destroyCommentEditPopup()})),this.commentInputWrapper.prepend(this.commentEditPopup)},e.prototype.destroyCommentEditPopup=function(){var e;this.commentEditPopup.remove(),this.commentInput.setButton("send"),this.commentInput.setText(""),this.setInputReplayCallback(),null===(e=this.element.querySelector(".ArticleComments__commentWrapper--editing"))||void 0===e||e.classList.remove("ArticleComments__commentWrapper--editing"),this.activeAnimation()},e.prototype.setStatus=function(e,t){if(void 0===t&&(t=!1),this.status!==e||t)switch(this.hideAllTooltips(),this.commentEditPopup&&this.destroyCommentEditPopup(),e){case"inactive":if(this.modifier.includes("sideWindow")||this.modifier.includes("inAttach")){this.unHoverAnimation(),this.setStatus("hover");break}this.element.classList.remove("ArticleComments__commentElement--sideWindow"),this.status=e,this.commentInput.clearMention(),this.element.classList.remove("ArticleComments__commentElement--hover-mobile"),this.element.classList.remove("ArticleComments__commentElement--active-mobile"),this.element.classList.remove("ArticleComments__commentElement--hover"),this.element.classList.remove("ArticleComments__commentElement--active"),this.modifier.includes("mobile")?(this.commentWrap.classList.add("ArticleComments__commentWrapper--inactive-mobile"),this.element.classList.add("ArticleComments__commentElement--inactive-mobile"),this.commentAuthorName.remove(),this.commentText.remove()):(this.commentWrap.classList.remove("ArticleComments__commentWrapper--inactive-mobile"),this.element.classList.remove("ArticleComments__commentElement--inactive-mobile"),this.commentWrap.classList.add("ArticleComments__commentWrapper--inactive"),this.commentWrap.append(this.commentAuthorName,this.commentText)),this.commentText.classList.add("ArticleComments__commentAuthorText--inactive"),this.commentText.classList.remove("ArticleComments__commentAuthorText--hover"),this.commentShowMore.remove(),this.commentDataReplay.remove(),this.commentHeader.remove(),this.commentReplayWrapper.remove(),this.commentInputWrapper.remove(),this.processText(this.commentText,this.commentInfo.text,!0),this.store.hoverProcessing(this.getCommentId(),"inactive"),this.unHoverAnimation();break;case"hover":this.modifier.includes("sideWindow")?this.element.classList.add("ArticleComments__commentElement--sideWindow"):this.element.classList.remove("ArticleComments__commentElement--sideWindow"),this.modifier.includes("mobile")&&this.element.classList.add("ArticleComments__commentElement--hover-mobile"),this.status=e,this.element.classList.remove("ArticleComments__commentElement--active"),this.element.classList.remove("ArticleComments__commentElement--active-mobile"),this.element.classList.add("ArticleComments__commentElement--hover"),this.commentWrap.classList.remove("ArticleComments__commentWrapper--inactive-mobile"),this.element.classList.remove("ArticleComments__commentElement--inactive-mobile"),this.commentWrap.classList.remove("ArticleComments__commentWrapper--inactive"),this.commentText.classList.remove("ArticleComments__commentAuthorText--inactive"),this.commentText.classList.add("ArticleComments__commentAuthorText--hover"),this.commentHeader.remove(),this.commentReplayWrapper.remove(),this.commentInputWrapper.remove(),this.commentWrap.append(this.commentAuthorName,this.commentText),this.commentWrap.append(this.commentShowMore,this.commentDataReplay),this.processText(this.commentText,this.commentInfo.text),this.modifier.includes("sideWindow")?this.store.hoverProcessing(this.getCommentId(),"inactive"):this.store.hoverProcessing(this.getCommentId(),"hover"),this.hoverAnimation();break;case"active":this.modifier.includes("sideWindow")?(this.element.classList.add("ArticleComments__commentElement--sideWindow"),this.store.scrollIntoViewContent(this.getCommentId())):this.element.classList.remove("ArticleComments__commentElement--sideWindow"),this.modifier.includes("mobile")&&this.element.classList.add("ArticleComments__commentElement--active-mobile"),this.commentWrap.classList.remove("ArticleComments__commentWrapper--inactive-mobile"),this.status=e,this.element.classList.remove("ArticleComments__commentElement--hover"),this.element.classList.remove("ArticleComments__commentElement--hover-mobile"),this.element.classList.add("ArticleComments__commentElement--active"),this.commentText.classList.remove("ArticleComments__commentAuthorText--inactive"),this.commentText.classList.remove("ArticleComments__commentAuthorText--hover"),this.commentWrap.classList.remove("ArticleComments__commentWrapper--inactive"),this.commentWrap.append(this.commentAuthorName,this.commentText),this.commentWrap.append(this.commentShowMore,this.commentDataReplay),this.element.prepend(this.commentHeader),this.element.append(this.commentReplayWrapper),!this.getModifier().includes("outContent")&&this.element.append(this.commentInputWrapper),this.processText(this.commentText,this.commentInfo.text),this.getModifier().includes("inAttach")||this.store.closeAttachComments(),this.store.hoverProcessing(this.getCommentId(),"active"),this.activeAnimation()}},e.prototype.hoverAnimation=function(){var e=this.commentWrap.clientHeight;this.element.style.height=e+"px",this.updateHeight(e)},e.prototype.unHoverAnimation=function(){var e=this.commentWrap.clientHeight;this.element.style.height=e+"px",this.updateHeight(e)},e.prototype.activeAnimation=function(){var e=this.commentHeader.clientHeight+this.commentWrap.clientHeight+this.commentReplayWrapper.clientHeight+this.commentInputWrapper.clientHeight;this.element.style.height=e+"px",this.updateHeight(e,!0)},e.prototype.updateHeight=function(e,t){void 0===t&&(t=!1),t&&!this.modifier.includes("downOpen")?this.setElementHeight(e/2):this.setElementHeight(e),this.modifier.includes("sideWindow")||this.store.processPosition()},e.prototype.setStatusHover=function(){"active"!==this.status&&"hover"!==this.status&&this.setStatus("hover")},e.prototype.setStatusRemoveHover=function(){"active"!==this.status&&"inactive"!==this.status&&this.setStatus("inactive")},e.prototype.setStatusActive=function(){"active"!==this.status&&this.setStatus("active")},e.prototype.setStatusInactive=function(){"inactive"!==this.status&&(!this.modifier.includes("sideWindow")&&this.store.processPosition(),this.setStatus("inactive"))},e.prototype.setModifier=function(e,t){void 0===t&&(t=!0),this.modifier.includes(e)||this.modifier.push(e),this.setStatus(this.status,t)},e.prototype.getModifier=function(){return this.modifier},e.prototype.removeModifier=function(e){var t=this.modifier.indexOf(e);-1!==t&&this.modifier.splice(t,1),"inAttach"!==e?this.setStatus(this.status,!0):this.setStatus("inactive",!0)},e.prototype.removeAnimations=function(){this.element.classList.add("ArticleComments__commentElement--noAnimations")},e.prototype.returnAnimations=function(){var e=this;setTimeout((function(){e.element.classList.remove("ArticleComments__commentElement--noAnimations")}),500)},e.prototype.getElement=function(){return this.element},e.prototype.getCommentId=function(){return this.commentInfo.id},e.prototype.getStatus=function(){return this.status},e.prototype.getProfileById=function(e){return this.profiles.find((function(t){return t.id===e}))},e.prototype.sendReplayComment=function(e,t){return this.store.sendReplayComment(e,t)},e.prototype.renderNewReplayComment=function(e){var t;this.commentReplayWrapper.classList.add("ArticleComments__commentReplayWrapper"),(null===(t=this.commentReplayData)||void 0===t?void 0:t.count)&&this.commentReplayData.count<=2?this.commentReplayWrapper.classList.add("ArticleComments__commentReplayWrapper--lowReplays"):this.commentReplayWrapper.classList.remove("ArticleComments__commentReplayWrapper--lowReplays"),this.commentReplayWrapper.append(this.createSingleComment(e)),this.renderDataReplay()},e.prototype.deleteComment=function(e){return this.store.sendDeleteComment(e)},e.prototype.editComment=function(e,t){return this.store.sendEditComment(e,t)},e.prototype.setPosition=function(e){e!==this.position&&(this.position=e,this.element.style.top=e+"px")},e.prototype.getPosition=function(){return this.position},e.prototype.setDefaultPosition=function(e){this.defaultPosition=e},e.prototype.getDefaultPosition=function(){return this.defaultPosition},e.prototype.setElementHeight=function(e){this.heightElement=0!==e?e:this.minHeight},e.prototype.getElementHeight=function(){return this.heightElement},e.prototype.setMarginTop=function(e){e!==this.marginTop&&(this.marginTop=e)},e.prototype.getMargin=function(){return this.marginTop},e.prototype.scrollIntoView=function(){if(!this.getModifier().includes("sideWindow")){var e=this.element.getBoundingClientRect().top,t=document.documentElement.getBoundingClientRect().top,r=document.documentElement.clientHeight;e>=t&&e<=t+r||this.element.scrollIntoView({block:"center",behavior:"smooth"})}},e.prototype.initCustomEventsListeners=function(){var e=this;this.store.articleLayer.addEventListener("sendReplayComment",(function(t){t.detail.commentId===e.commentInfo.id&&(e.renderNewReplayComment(t.detail.replayComment),e.activeAnimation())})),this.store.articleLayer.addEventListener("sendDeleteComment",(function(t){var r,i;null===(i=null===(r=e.commentInfo.thread)||void 0===r?void 0:r.items)||void 0===i||i.forEach((function(r){var i;r.id===t.detail.commentId&&(null===(i=e.commentReplayWrapper.querySelector('[data-comment-id="'+t.detail.commentId+'"]'))||void 0===i||i.remove(),e.renderReplayWrapper(),e.renderDataReplay(),e.activeAnimation())}))})),this.store.articleLayer.addEventListener("sendEditComment",(function(t){var r,i;e.commentInfo.id===t.detail.commentId?(e.processText(e.commentText,t.detail.text),e.activeAnimation()):null===(i=null===(r=e.commentInfo.thread)||void 0===r?void 0:r.items)||void 0===i||i.forEach((function(r){var i,a;if(r.id===t.detail.commentId){var n=null===(i=e.commentReplayWrapper)||void 0===i?void 0:i.querySelector('[data-comment-id="'+t.detail.commentId+'"] .ArticleComments__commentAuthorText'),o=null===(a=e.commentReplayWrapper)||void 0===a?void 0:a.querySelector('[data-comment-id="'+t.detail.commentId+'"] .ArticleComments__commentAuthorName');o&&e.createEditedInfoBlock(o),n&&n instanceof HTMLElement&&e.processText(n,t.detail.text),e.activeAnimation()}}))})),this.store.articleLayer.addEventListener("sendResolveComment",(function(t){e.commentInfo.id===t.detail.commentId&&(e.renderResolveButton(),e.renderShowMoreButton())})),this.store.articleLayer.addEventListener("sendUnresolveComment",(function(t){e.commentInfo.id===t.detail.commentId&&(e.renderResolveButton(),e.renderShowMoreButton())}))},e}()},191381:(e,t,r)=>{"use strict";r.d(t,{ArticleCommentsTreadTooltip:()=>a,ArticleCommentsReplayTooltip:()=>n,ArticleCommentsSortTooltip:()=>o,ArticleCommentsMinHeight:()=>s,ArticleCommentTopAttachPadding:()=>l,ArticleCommentsAttachMargin:()=>d,ArticleCommentsBottomSeparatorMargin:()=>c,ArticleCommentsBreakPoint:()=>h,ArticleCommentsMentionHeight:()=>p,ArticleCommentsMentionMarginTopDocument:()=>u,ArticleCommentsInputMaxLength:()=>g,ArticleCommentsStatsEventType:()=>m});var i=r(70162),a=[{text:(0,i.getLang)("pages_article_comments_tooltip_resolve"),type:"resolve"},{text:(0,i.getLang)("pages_article_comments_tooltip_unresolve"),type:"unresolve"},{text:(0,i.getLang)("pages_article_comments_tooltip_edit"),type:"edit"},{text:(0,i.getLang)("pages_article_comments_tooltip_delete"),type:"delete",remove:!0}],n=[{text:(0,i.getLang)("pages_article_comments_tooltip_edit"),type:"edit"},{text:(0,i.getLang)("pages_article_comments_tooltip_delete_replay"),type:"delete",remove:!0}],o=[{text:(0,i.getLang)("pages_article_comments_filter_all"),type:"all"},{text:(0,i.getLang)("pages_article_comments_filter_mine"),type:"myself"},{text:(0,i.getLang)("pages_article_comments_filter_resolved"),type:"resolved"},{text:(0,i.getLang)("pages_article_comments_filter_deleted"),type:"outContent"}],s=52,l=22,d=40,c=620,h=1280,p=216,u=84,g=4096,m={createCommentFromFormatTooltip:"create_comment_from_format_tooltip",createCommentFromResizeTooltip:"create_comment_from_resize_tooltip",createCommentFromDragTooltip:"create_comment_from_drag_tooltip",cancelCreateCommentByIcon:"cancel_create_comment_by_icon",cancelCreateCommentByClick:"cancel_create_comment_by_click",cancelCreateCommentByEsc:"cancel_create_comment_by_esc",hoverToCommentContent:"hover_to_comment_content",clickToCommentContent:"click_to_comment_content",hoverToCommentBlock:"hover_to_comment_block",clickToCommentBlock:"click_to_comment_block",clickToCommentsIcon:"click_to_comments_icon",clickToNextThread:"click_to_next_thread",clickToPrevThread:"click_to_prev_thread",clickToOpenCommentPanel:"click_to_open_comment_panel",showAllComments:"show_all_comments",showOpenComments:"show_open_comments",showResolvedComments:"show_resolved_comments",showDeletedComments:"show_deleted_comments"}},524667:(e,t,r)=>{"use strict";r.d(t,{ArticleCommentsContentView:()=>n});var i=r(30462),a=r(191381),n=function(){function e(e,t,r,i){this.breakPoint=a.ArticleCommentsBreakPoint,this.editor=e,this.store=t,this.comments=this.store.getContentCommentsList(),this.articleId=r,this.articleOwnerId=i,this.initWrapper(),this.createCommentCards(this.comments),this.initCustomEvents(),this.setCommentsElsDefaultPosition()}return e.prototype.initWrapper=function(){var e=this;this.wrapper=document.createElement("div"),this.wrapper.classList.add("ArticleComments__sideWrapper"),this.setSidePosition(this.wrapper),this.store.editor._setEventListener(window,"resize",(function(){e.store.commentsContentView.forEach((function(t){document.documentElement.clientWidth<=e.breakPoint?t.setModifier("mobile"):t.removeModifier("mobile")}))})),this.editor.appendChild(this.wrapper),this.initHeightSeparator()},e.prototype.setSidePosition=function(e){var t=(window.screen.width-this.editor.offsetWidth)/2;e.style.right="-"+t+"px",e.style.width=t-15+"px"},e.prototype.navigateButtonsCb=function(e,t){if(!(this.store.commentsContentView.length<2)){var r=this.store.commentsContentView.findIndex((function(e){return e.getCommentId()===t}));switch(e){case"left":this.store.sendCommentsStats(a.ArticleCommentsStatsEventType.clickToPrevThread,this.store.commentsContentView[r].getCommentId()),r-1>=0?(this.store.commentsContentView[r].setStatusInactive(),this.store.commentsContentView[r-1].setStatusActive(),this.store.commentsContentView[r-1].scrollIntoView()):(this.store.commentsContentView[r].setStatusInactive(),this.store.commentsContentView[this.store.commentsContentView.length-1].setStatusActive(),this.store.commentsContentView[this.store.commentsContentView.length-1].scrollIntoView());break;case"right":this.store.sendCommentsStats(a.ArticleCommentsStatsEventType.clickToNextThread,this.store.commentsContentView[r].getCommentId()),r===this.store.commentsContentView.length-1?(this.store.commentsContentView[r].setStatusInactive(),this.store.commentsContentView[0].setStatusActive(),this.store.commentsContentView[0].scrollIntoView()):(this.store.commentsContentView[r].setStatusInactive(),this.store.commentsContentView[r+1].setStatusActive(),this.store.commentsContentView[r+1].scrollIntoView())}}},e.prototype.createCommentCards=function(e){var t=this;e.forEach((function(e){var r=new i.ArticleCommentsComment(e,t.store,t.navigateButtonsCb);document.documentElement.clientWidth<=t.breakPoint&&r.setModifier("mobile"),r.getElement().addEventListener("mouseenter",(function(){t.store.sendCommentsStats(a.ArticleCommentsStatsEventType.hoverToCommentBlock,r.getCommentId()),r.setStatusHover()})),r.getElement().addEventListener("mouseleave",(function(){r.setStatusRemoveHover()})),t.store.editor._setEventListener(document,"click",(function(e){e.target instanceof Element&&e.target.closest('[data-comment-id="'+r.getCommentId()+'"]')&&e.target.closest(".ArticleComments__sideWrapper")?(r.getModifier().includes("mobile")?t.store.sendCommentsStats(a.ArticleCommentsStatsEventType.clickToCommentsIcon,r.getCommentId()):t.store.sendCommentsStats(a.ArticleCommentsStatsEventType.clickToCommentBlock,r.getCommentId()),r.setStatusActive()):e.target instanceof Element&&e.target.closest('[data-comment-id="'+r.getCommentId()+'"]')&&e.target.closest(".ArticleComments__sideWindow")||r.setStatusInactive()})),t.store.commentsContentView.push(r),t.setCommentsCard(r)}))},e.prototype.setCommentsCard=function(e){this.wrapper.append(e.getElement())},e.prototype.setCommentsElsDefaultPosition=function(){var e=this;this.setMarginAttachComment(),this.removeDownOpenAll(),this.setModifierToAttachComments(),this.store.hideResolveComments(),this.store.commentsContentView.forEach((function(t){var r=e.store.contentElsWithComments.find((function(e){return e.id.includes(t.getCommentId())}));if(!r||(null==r?void 0:r.isResolved))t.setDefaultPosition(-4e3),t.getElement().remove();else if(r){e.wrapper.append(t.getElement());var i=r.element.getBoundingClientRect().top-e.editor.getBoundingClientRect().top;r.position!==i&&0!==e.store.commentsContentView.length&&(r.position=i-13,0!==t.getMargin()?t.setDefaultPosition(r.position+t.getMargin()):t.setDefaultPosition(r.position))}})),this.sortCommentsByPosition(),this.store.processPosition(),this.setHeightSeparatorMargin()},e.prototype.sortCommentsByPosition=function(){this.store.commentsContentView.sort((function(e,t){return e.getDefaultPosition()-t.getDefaultPosition()}))},e.prototype.setMarginAttachComment=function(){var e=this;this.store.attachComments.forEach((function(t){t.commentsId.forEach((function(r){var i=e.store.commentsContentView.find((function(e){return e.getCommentId()===r}));if(i)if("tableCell"===t.dataMode){var n=i.getCommentId(),o=e.store.contentElsWithComments.find((function(e){return e.id.includes(n)}));o&&!i.getModifier().includes("inAttach")&&i.setMarginTop(t.height-(o.element.getBoundingClientRect().top-e.editor.getBoundingClientRect().top-t.attachPosition))}else 0===t.dataMode||1===t.dataMode?!i.getModifier().includes("inAttach")&&i.setMarginTop(0):!i.getModifier().includes("inAttach")&&i.setMarginTop(t.height+a.ArticleCommentsAttachMargin)}))}))},e.prototype.removeDownOpenAll=function(){this.store.commentsContentView.forEach((function(e){e.removeModifier("downOpen")}))},e.prototype.setModifierToAttachComments=function(){var e=this;this.store.attachComments.forEach((function(t){t.commentsId.forEach((function(t){var r;null===(r=e.store.commentsContentView.find((function(e){return e.getCommentId()===t})))||void 0===r||r.setModifier("downOpen")}))}))},e.prototype.initHeightSeparator=function(){this.heightSeparator=document.createElement("div"),this.heightSeparator.classList.add("ArticleComments__heightSeparator"),this.heightSeparator.style.margin="0px",this.editor.appendChild(this.heightSeparator)},e.prototype.setHeightSeparatorMargin=function(){if(0!==this.store.commentsContentView.length){var e=this.store.commentsContentView[this.store.commentsContentView.length-1].getPosition()-this.editor.offsetHeight;e<a.ArticleCommentsBottomSeparatorMargin?this.heightSeparator.style.margin=e>0?a.ArticleCommentsBottomSeparatorMargin+e+"px":a.ArticleCommentsBottomSeparatorMargin+"px":this.heightSeparator.style.margin="0px"}},e.prototype.initCustomEvents=function(){var e=this;this.store.articleLayer.addEventListener("sendDeleteComment",(function(t){e.store.commentsContentView.forEach((function(r,i){r.getCommentId()===t.detail.commentId&&(r.getElement().remove(),e.store.commentsContentView.splice(i,1))}))})),this.store.articleLayer.addEventListener("sendCreateComment",(function(t){var r=t.detail.newComment;e.createCommentCards([r])})),this.store.articleLayer.addEventListener("setCommentsElsPosition",(function(){e.setCommentsElsDefaultPosition()}))},e}()},369132:(e,t,r)=>{"use strict";r.d(t,{ArticleCommentCreateTooltip:()=>h});var i=r(570655),a=r(517920),n=r(601306),o=r(873589),s=r(927766),l=r(83178),d=r(666738),c=r(191381),h=function(){function e(e,t,r,h){var p=this;this.closedByClick=!0,this.editor=e,this.els=t,this.comments=r,this.store=h;var u=document.createElement("div");this.els.editor.appendChild(u),this.inputCreate=new d.ArticleCommentInput({sendCallback:function(e){return p.store.sendCreateComment(e)},closeCallback:function(){p.tooltip.hide()},newComment:!0,closeMentionCallback:function(){var e=p.tooltip._ttel;e instanceof HTMLElement&&e.classList.remove("ArticleComments__mentionOpenTop","ArticleComments__mentionOpenBottom")},openMentionCallback:function(e){var t=p.tooltip._ttel;t instanceof HTMLElement&&(t.getBoundingClientRect().top-c.ArticleCommentsMentionHeight-c.ArticleCommentsMentionMarginTopDocument>0?(t.classList.add("ArticleComments__mentionOpenTop"),e.classList.add("ArticleComments__mentionWrap--top")):(t.classList.add("ArticleComments__mentionOpenBottom"),e.classList.add("ArticleComments__mentionWrap--bottom")),t.appendChild(e))},switchClosedByClick:function(){p.setClosedByNoClick()},sendCommentsStats:function(e){var t;null===(t=p.editor.comments)||void 0===t||t.store.sendCommentsStats(e)}});var g=void 0;this.tooltip=new a.default(u,{content:this.inputCreate.getWrapper(),autoShow:!1,customShow:!0,appendTo:this.els.editor,forceSide:"bottom",width:320,cls:"ArticleComments__createTooltip",setPos:function(e){var t=(0,i.__read)(n.SelectionManager.getRange(),3),r=t[0],a=t[2];if(a&&a.rangeCount&&r){var l=r.getBoundingClientRect();p.selectedEl&&(l=p.selectedEl.getBoundingClientRect(),p.selectedEl=void 0);var d=(0,o.getXY)(p.els.canvas);d[1]-=(0,s.scrollGetY)();var c=(0,o.getSize)(e._ttel);return{left:l.left+l.width/2-c[0]/2-d[0],top:(window.innerHeight-l.bottom-c[1]-4>=0?l.bottom+4:l.top-c[1]-4)-d[1]}}},onShow:function(){p.setClosedByClick(),window.addEventListener("keydown",g=function(e){e.keyCode==l.Key.Esc&&p.tooltip.hide()})},onHide:function(){var e;p.inputCreate.clear(),g&&window.removeEventListener("keydown",g),p.closedByClick&&(null===(e=p.editor.comments)||void 0===e||e.store.sendCommentsStats(c.ArticleCommentsStatsEventType.cancelCreateCommentByClick)),p.editor.replaceOrClearComments(0),p.editor.redraw()}})}return e.prototype.hide=function(){this.tooltip.hide()},e.prototype.setClosedByNoClick=function(){this.closedByClick=!1},e.prototype.setClosedByClick=function(){this.closedByClick=!0},e.prototype.showCreateTooltip=function(e){e&&(this.selectedEl=e),this.tooltip.show()},e.prototype.focusCreateInput=function(){this.inputCreate.focus()},e}()},333773:(e,t,r)=>{"use strict";r.d(t,{ArticleComments:()=>l});var i=r(83178),a=r(369132),n=r(524667),o=r(811483),s=r(138764),l=function(){function e(e,t){var r=this;this.editor=e,this.els=t,this.store=new s.ArticleCommentsStore(this.editor.getArticleId(),this.editor.getArticleOwnerId(),this.editor,this.els.editor),this.store.getComments().then((function(){r.contentView=new n.ArticleCommentsContentView(r.els.editor,r.store,r.editor.getArticleId(),r.editor.getArticleOwnerId()),r.windowView=new o.ArticleCommentsWindowView(r.els.editor,r.store,r.editor.getArticleId(),r.editor.getArticleOwnerId())})).catch((function(e){console.log(e)})),this.createTooltip=new a.ArticleCommentCreateTooltip(e,t,this,this.store),this.initCustomEvents()}return e.prototype.addCommentAtParagraph=function(e){e.comment_ids||(e.comment_ids=[]),e.comment_ids.push(0)},e.prototype.addHoverEditComment=function(e){this.els.canvas.querySelectorAll("."+i.ArticleCommentsBackgroundClass+'[comment-id="'+e+'"]').forEach((function(e){e.classList.add(i.ArticleCommentsBackgroundEditClass)}))},e.prototype.deleteHoverEditComment=function(){this.els.canvas.querySelectorAll("."+i.ArticleCommentsBackgroundEditClass).forEach((function(e){e.classList.remove(i.ArticleCommentsBackgroundEditClass)}))},e.prototype.updateCommentElements=function(){var e,t;this.store.findContentWithComments(),null===(e=this.contentView)||void 0===e||e.setCommentsElsDefaultPosition(),null===(t=this.windowView)||void 0===t||t.closeSideWindow()},e.prototype.initCustomEvents=function(){var e=this;this.store.articleLayer.addEventListener("sendCreateComment",(function(t){e.editor.replaceOrClearComments(0,t.detail.newComment.id),e.deleteHoverEditComment(),e.createTooltip.hide(),e.editor.redraw(),e.editor.saveUndoStateAndDraft()})),this.store.articleLayer.addEventListener("sendResolveComment",(function(){var t;null===(t=e.contentView)||void 0===t||t.setCommentsElsDefaultPosition()})),this.store.articleLayer.addEventListener("sendUnresolveComment",(function(){var t;null===(t=e.contentView)||void 0===t||t.setCommentsElsDefaultPosition()}))},e.prototype.sendCreateComment=function(e){this.store.sendCreateComment(e).catch((function(e){console.log(e)}))},e}()},666738:(e,t,r)=>{"use strict";r.d(t,{ArticleCommentInput:()=>c});var i=r(608021),a=r(980767),n=r(953590),o=r(281983),s=r(152278),l=r(997320),d=r(191381),c=function(){function e(e){var t=this;this.isPrevNewLine=!1,this.sendCallback=e.sendCallback,this.newComment=Boolean(e.newComment),this.closeCallback=e.closeCallback,this.switchClosedByClick=e.switchClosedByClick,this.sendCommentsStats=e.sendCommentsStats,e.resizeCallBack&&(this.resizeCallBack=e.resizeCallBack),this.inputWrapper=document.createElement("div"),this.inputWrapper.className="ArticleComments__inputWrapper",this.input=document.createElement("textarea"),this.input.className="ArticleComments__input",this.input.setAttribute("placeholder",this.newComment?(0,i.getLang)("pages_article_comments_ph_new"):(0,i.getLang)("pages_article_comments_ph_answer")),this.input.setAttribute("rows","1"),this.inputWrapper.appendChild(this.input),this.button=document.createElement("button"),this.button.className="ArticleComments__inputButton",this.setButton(this.newComment?"close":"send"),this.button.setAttribute("type","button"),this.inputWrapper.appendChild(this.button),this.mention=new l.ArticleCommentMention(this.input,e.openMentionCallback,e.closeMentionCallback),this.newComment&&(this.input.addEventListener("input",(function(){""!==t.input.value&&"send"!==t.typeButton?t.setButton("send"):""===t.input.value&&"close"!==t.typeButton&&t.setButton("close")})),this.input.addEventListener("keyup",(function(e){"Escape"!==e.key&&"Esc"!==e.key||(t.switchClosedByClick&&t.switchClosedByClick(),t.sendCommentsStats&&t.sendCommentsStats(d.ArticleCommentsStatsEventType.cancelCreateCommentByEsc),t.close(!1))}))),this.input.addEventListener("input",(function(){t.input.value.length>d.ArticleCommentsInputMaxLength&&(t.input.value=t.input.value.slice(0,d.ArticleCommentsInputMaxLength));var e=t.input.style.height;t.input.style.height="5px",t.input.style.height=t.input.scrollHeight+"px",t.input.selectionEnd===t.input.textLength&&t.input.clientHeight+"px"!==t.input.style.height&&(t.input.scrollTop=t.input.scrollHeight+8),e!==t.input.style.height&&t.resizeCallBack&&t.resizeCallBack()})),this.input.addEventListener("keydown",(function(e){var r=e.metaKey||e.ctrlKey,i=e.shiftKey;return!r||"a"!=e.key&&"A"!=e.key?"Enter"!=e.key||i?void 0:(""!==t.input.value&&t.send(),(0,s.cancelEvent)(e)):(t.input.select(),(0,s.cancelEvent)(e))})),this.input.addEventListener("click",(function(){t.mention.show()})),this.input.addEventListener("keyup",(function(){t.mention.show()})),this.button.addEventListener("click",(function(e){e.stopPropagation(),"close"===t.typeButton&&t.closeCallback?(t.switchClosedByClick&&t.switchClosedByClick(),t.sendCommentsStats&&t.sendCommentsStats(d.ArticleCommentsStatsEventType.cancelCreateCommentByIcon),t.close(!1)):"send"!==t.typeButton&&"check"!==t.typeButton||t.send()}))}return e.prototype.getWrapper=function(){return this.inputWrapper},e.prototype.focus=function(){this.input.focus()},e.prototype.clear=function(e){void 0===e&&(e=!0),this.input.value="",this.input.style.height="auto",e&&this.setButton("close"),this.input.removeAttribute("disabled"),this.button.classList.remove("ArticleComments__inputButton--disabled"),this.mention.clear()},e.prototype.clearMention=function(){this.mention.clear()},e.prototype.setButton=function(e){var t=(0,a.getIcon24Send)().icon,r=(0,n.getIcon24DismissSubstract)().icon,i=(0,o.getIcon24CheckCircleOutline)().icon;this.button.classList.remove("ArticleComments__inputButton--blue"),"send"===e?(this.button.innerHTML=t,this.typeButton="send"):"close"===e?(this.button.innerHTML=r,this.typeButton="close"):"check"===e&&(this.button.classList.add("ArticleComments__inputButton--blue"),this.button.innerHTML=i,this.typeButton="check")},e.prototype.close=function(e){void 0===e&&(e=!0),e&&this.sendCommentsStats&&this.sendCommentsStats(d.ArticleCommentsStatsEventType.cancelCreateCommentByClick),this.closeCallback&&this.closeCallback()},e.prototype.setSendCallBack=function(e){this.sendCallback=e},e.prototype.send=function(){var e=this;this.input.setAttribute("disabled","true"),this.button.classList.add("ArticleComments__inputButton--disabled"),this.sendCallback&&this.sendCallback(this.input.value).then((function(){e.input.removeAttribute("disabled"),e.button.classList.remove("ArticleComments__inputButton--disabled")})).catch((function(e){console.log(e)}))},e.prototype.setText=function(e){this.input.value=e,this.input.dispatchEvent(new Event("input"))},e}()},997320:(e,t,r)=>{"use strict";r.d(t,{ArticleCommentMention:()=>a});var i=r(749140),a=function(){function e(e,t,r){this.input=e,this.openMentionCallback=t,this.closeMentionCallback=r}return e.prototype.show=function(){if(this.input.selectionStart===this.input.selectionEnd){var e=this.input.value.slice(0,this.input.selectionStart),t=Math.max(e.lastIndexOf(" "),e.lastIndexOf("\n")),r=e.lastIndexOf("@");if(r>t){var i=e.slice(r+1),a=this.getMentionItems(i,r);return void(a&&this.openMentionCallback&&this.openMentionCallback(a))}}this.clear()},e.prototype.getMentionItems=function(e,t){var r=this;if(!this.mentionItems){var a=[];if(window.cur.articleEditor.getOptions().suggestions&&(a=JSON.parse(JSON.stringify(window.cur.articleEditor.getOptions().suggestions))),!a)return;a.forEach((function(e){return e.id="id"+e.id})),this.mentionItems=a}var n=""!==e?this.mentionItems.filter((function(t){return t.domain.startsWith(e)&&e!==t.domain||""===t.domain&&String(t.id).startsWith(e)&&e!==String(t.id)})):this.mentionItems;if(0===n.length)return this.clear(),!1;if(this.currentMentionItems===JSON.stringify(n))return!1;this.clear(),this.currentMentionItems=JSON.stringify(n);var o=(0,i.createElement)('<div class="ArticleComments__mentionWrap"></div>');return n.forEach((function(e){var t=(0,i.createElement)('<div class="ArticleComments__mentionItem">\n                   <img src="'+e.avatar+'" alt="'+e.name+'" class="ArticleComments__mentionAvatar">\n                   <div class="ArticleComments__mentionInner">\n                       <span class="ArticleComments__mentionName">'+e.name+'</span>\n                       <span class="ArticleComments__mentionValue" domain="'+!!e.domain+'">@'+(e.domain?e.domain:e.id)+"</span>\n                   </div>\n               </div>");o.appendChild(t)})),o.addEventListener("click",(function(e){var i,a,n;e.stopPropagation();var o=e.target;if(o instanceof HTMLElement&&(o=o.closest(".ArticleComments__mentionItem"))instanceof HTMLElement){var s=o.querySelector(".ArticleComments__mentionValue"),l=o.querySelector(".ArticleComments__mentionName"),d=null==s?void 0:s.getAttribute("domain"),c=(null===(i=null==l?void 0:l.textContent)||void 0===i?void 0:i.includes(" "))?null===(a=null==l?void 0:l.textContent)||void 0===a?void 0:a.slice(0,null===(n=null==l?void 0:l.textContent)||void 0===n?void 0:n.indexOf(" ")):null==l?void 0:l.textContent;if(s&&void 0!==d&&c){var h=s.textContent+("true"===d?"":" ("+c+")");r.input.value=r.input.value.slice(0,t)+h+r.input.value.slice(r.input.selectionStart),r.clear();var p=t+h.length+1;r.input.focus(),r.input.setSelectionRange(p,p)}}})),o},e.prototype.clear=function(){this.currentMentionItems="";var e=document.querySelector(".ArticleComments__mentionWrap");e&&e.remove(),this.closeMentionCallback&&this.closeMentionCallback()},e}()},138764:(e,t,r)=>{"use strict";r.d(t,{ArticleCommentsStore:()=>h});var i=r(570655),a=r(929314),n=r(83178),o=r(530662),s=r(191381),l=r(798262),d=r(506770),c=r(769488),h=function(){function e(e,t,r,i){var a=this;this.commentsItems=[],this.commentsContentView=[],this.commentsWindowView=[],this.contentElsWithComments=[],this.attachComments=[],this.positionList=[],this.commentsProfiles=[],this.hoverElement={type:"inactive",id:null},this.isNeedCloseWindow=!0,this.mouseoverContentElement=function(e){var t;e.stopPropagation();var r=e.currentTarget;if(r instanceof Element){var i=null===(t=r.getAttribute("comment-id"))||void 0===t?void 0:t.split(",").map((function(e){return Number(e)}));i&&a.hoverProcessing(i[0],"hover"),i&&a.sendCommentsStats(s.ArticleCommentsStatsEventType.hoverToCommentContent,i[0])}},this.mouseoutContentElement=function(e){var t;e.stopPropagation();var r=e.currentTarget;if(r instanceof Element){var i=null===(t=r.getAttribute("comment-id"))||void 0===t?void 0:t.split(",").map((function(e){return Number(e)}));i&&a.hoverProcessing(i[0],"unHover")}},this.clickContentElement=function(e){var t;e.stopPropagation();var r=e.currentTarget;if(r instanceof Element){var i=null===(t=r.getAttribute("comment-id"))||void 0===t?void 0:t.split(",").map((function(e){return Number(e)}));i&&a.hoverProcessing(i[0],"active"),i&&a.sendCommentsStats(s.ArticleCommentsStatsEventType.clickToCommentContent,i[0])}},this.articleId=e,this.articleOwnerId=t,this.editor=r,this.editorElement=i;var n=document.querySelector(".article_ed_layer__wrap");if(!n)throw new Error("Error: can not find article");this.articleLayer=n}return e.prototype.getComments=function(){return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,t,r,n;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(e=this.editor.getArticleId(),t=this.articleOwnerId,0===this.editor.getArticleId())return[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,(0,a.getComments)({owner_id:t,article_id:e})];case 2:return r=i.sent(),this.commentsItems=r.items,this.commentsItems.forEach((function(e){e.thread||(e.thread={count:0,items:[]})})),this.commentsProfiles=r.profiles,this.findContentWithComments(),this.hideResolveComments(),[3,4];case 3:return n=i.sent(),console.log("Error get comments",n),[3,4];case 4:return[2]}}))}))},e.prototype.hoverProcessing=function(e,t){var r,i,a,o,s,l,d,c,h,p;switch(t){case"hover":this.hoverElement.id=e,this.hoverElement.type=t,null===(r=this.contentElsWithComments.filter((function(t){return t.id.includes(e)})))||void 0===r||r.forEach((function(e){return e.element.classList.add(n.ArticleCommentsBackgroundHoverClass)})),null===(i=this.commentsContentView.find((function(t){return t.getCommentId()===e})))||void 0===i||i.setStatusHover();break;case"unHover":if("active"===(null===(a=this.commentsContentView.find((function(t){return t.getCommentId()===e})))||void 0===a?void 0:a.getStatus()))break;"hover"===this.hoverElement.type&&this.hoverElement.id===e&&(null===(o=this.contentElsWithComments.filter((function(t){return t.id.includes(e)})))||void 0===o||o.forEach((function(e){return e.element.classList.remove(n.ArticleCommentsBackgroundHoverClass)})),null===(s=this.commentsContentView.find((function(t){return t.getCommentId()===e})))||void 0===s||s.setStatusRemoveHover(),this.hoverElement.id=null,this.hoverElement.type="unHover");break;case"inactive":null===(l=this.contentElsWithComments.filter((function(t){return t.id.includes(e)})))||void 0===l||l.forEach((function(e){return e.element.classList.remove(n.ArticleCommentsBackgroundHoverClass)})),null===(d=this.commentsContentView.find((function(t){return t.getCommentId()===e})))||void 0===d||d.setStatusInactive(),this.hoverElement.id=null,this.hoverElement.type="inactive";break;case"active":null===(c=this.contentElsWithComments.filter((function(t){return t.id.includes(e)})))||void 0===c||c.forEach((function(e){return e.element.classList.remove(n.ArticleCommentsBackgroundHoverClass)})),this.commentsContentView.forEach((function(t){t.getCommentId()!==e&&t.setStatusInactive()})),null===(h=this.contentElsWithComments.filter((function(t){return t.id.includes(e)})))||void 0===h||h.forEach((function(e){return e.element.classList.add(n.ArticleCommentsBackgroundHoverClass)})),null===(p=this.commentsContentView.find((function(t){return t.getCommentId()===e})))||void 0===p||p.setStatusActive(),this.hoverElement.id=e,this.hoverElement.type=t}},e.prototype.findContentWithComments=function(){var e=this;this.contentElsWithComments=[],this.attachComments.forEach((function(e){return e.button.destroy()})),this.attachComments=[],this.editorElement.querySelectorAll("[comment-id]").forEach((function(t){var r,i={};if(i.id=null===(r=t.getAttribute("comment-id"))||void 0===r?void 0:r.split(",").map((function(e){return Number(e)})),i.element=t,t.getAttribute("data-mode"))i.dataMode=t.getAttribute("data-mode"),e.setAttachData(t,i.id,Number(t.getAttribute("data-mode")));else if(t.hasAttribute("data-table-wrapper"))i.dataMode="table",e.setAttachData(t,i.id,i.dataMode);else if(t.closest("[data-table-cell-content]")){i.dataMode="tableCell";var a=null==t?void 0:t.closest("[data-table-wrapper]");a&&e.setAttachData(a,i.id,i.dataMode)}i.element.removeEventListener("mouseover",e.mouseoverContentElement),i.element.addEventListener("mouseover",e.mouseoverContentElement),i.element.removeEventListener("mouseout",e.mouseoutContentElement),i.element.addEventListener("mouseout",e.mouseoutContentElement),i.element.removeEventListener("click",e.clickContentElement),i.element.addEventListener("click",e.clickContentElement),e.contentElsWithComments.push(i)})),this.findAllAttach()},e.prototype.processPosition=function(){var e=this;this.commentsContentView.forEach((function(t,r){var i=t.getDefaultPosition();if(0!==r){var a=e.commentsContentView[r-1].getPosition(),n=e.commentsContentView[r-1].getElementHeight();a+n>i?t.setPosition(a+n+5):t.setPosition(i),e.processCommentOnAttach(t),e.checkTopCommentDownOpen(r)&&t.setModifier("downOpen")}else t.setPosition(i)})),this.processPositionActive()},e.prototype.findAllAttach=function(){var e=this;this.allAttach=[];var t=[];this.editorElement.querySelectorAll("[data-table-wrapper]").forEach((function(r){var i=r.getBoundingClientRect().top-e.editorElement.getBoundingClientRect().top;t.push({attachElement:r,attachPosition:i,height:r.clientHeight,commentsId:[]})})),this.editorElement.querySelectorAll("[data-mode]").forEach((function(r){if("1"!==r.getAttribute("data-mode")&&"0"!==r.getAttribute("data-mode")){var i=r.getBoundingClientRect().top-e.editorElement.getBoundingClientRect().top;t.push({attachElement:r,attachPosition:i,height:r.clientHeight,commentsId:[]})}}));var r=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.attachComments),!1),(0,i.__read)(t),!1);r.sort((function(e,t){return e.attachPosition-t.attachPosition}));var a=r.filter((function(e,t){return 0===t||e.attachElement!==r[t-1].attachElement}));this.allAttach=a},e.prototype.processCommentOnAttach=function(e){this.allAttach.forEach((function(t){if(!(1===t.dataMode||0===t.dataMode||t.commentsId.includes(e.getCommentId())&&e.getModifier().includes("inAttach"))){var r=t.attachPosition,i=t.attachPosition+t.height,a=e.getPosition(),n=e.getPosition()+s.ArticleCommentsMinHeight,o=e.getPosition()+e.getElementHeight(),l=a<=r&&n>=r||a>=r&&n<=i||a<=i&&n>=i;("hover"!==e.getStatus()&&"active"!==e.getStatus()||l)&&(a<=r&&o>=r||a>=r&&o<=i||a<=i&&o>=i)&&(e.setPosition(i+10),e.setModifier("downOpen",!1))}}))},e.prototype.processPositionActive=function(){var e=this.commentsContentView.find((function(e){return"active"===e.getStatus()}));if(e&&!e.getModifier().includes("downOpen")){var t=this.commentsContentView.findIndex((function(e){return"active"===e.getStatus()})),r=e.getPosition(),i=e.getElementHeight();if(e.setPosition(r-i),this.checkTopSeparator(t),this.checkTopSeparator(t)||this.checkTopCommentDownOpen(t))return e.setModifier("downOpen"),void this.processPosition();for(var a=t-1;a>=0;a--)this.commentsContentView[a].getPosition()+this.commentsContentView[a].getElementHeight()+5>this.commentsContentView[a+1].getPosition()&&this.commentsContentView[a].setPosition(this.commentsContentView[a+1].getPosition()-this.commentsContentView[a].getElementHeight()-5)}},e.prototype.checkTopSeparator=function(e){for(var t=0,r=0;r<e;r++)t+=r==e?this.commentsContentView[r].getElementHeight()/2:this.commentsContentView[r].getElementHeight();return t>this.commentsContentView[e].getPosition()+20},e.prototype.checkTopCommentDownOpen=function(e){if(0===e)return!1;var t=this.commentsContentView[e],r=this.commentsContentView[e-1];if(r.getModifier().includes("downOpen")&&r.getPosition()+r.getElementHeight()>t.getPosition())return!0;return!1},e.prototype.setAttachData=function(e,t,r){var i=e.getBoundingClientRect().top-this.editorElement.getBoundingClientRect().top,a=new o.ArticleAttachComment(e,i,t,this,r);this.attachComments.push({attachElement:e,attachPosition:i,height:e.clientHeight,commentsId:t,button:a,dataMode:r})},e.prototype.filterContentComments=function(e){var t=this,r=[];return e.forEach((function(e){t.contentElsWithComments.find((function(t){return t.id.includes(e.id)}))&&r.push(e)})),r},e.prototype.filterNonContentComments=function(e){var t=this,r=[];return e.forEach((function(e){t.contentElsWithComments.find((function(t){return t.id.includes(e.id)}))||r.push(e)})),r},e.prototype.getCommentsList=function(){return this.commentsItems},e.prototype.getCommentsProfiles=function(){return this.commentsProfiles},e.prototype.getContentCommentsList=function(){return this.filterContentComments(this.commentsItems)},e.prototype.getNonContentCommentsList=function(){return this.filterNonContentComments(this.commentsItems)},e.prototype.openAttachComments=function(){var e;null===(e=this.commentsContentView.find((function(e){return"active"===e.getStatus()})))||void 0===e||e.setStatusInactive()},e.prototype.closeAttachComments=function(){this.attachComments.forEach((function(e){e.button.getOpenStatus()&&e.button.closeAttachComments()}))},e.prototype.scrollIntoViewContent=function(e){this.contentElsWithComments.forEach((function(t){if(t.id.includes(e)){var r=t.element.getBoundingClientRect().top,i=document.documentElement.getBoundingClientRect().top,a=document.documentElement.clientHeight;r>=i&&r<=i+a||t.element.scrollIntoView({block:"center",behavior:"smooth"})}}))},e.prototype.hideResolveComments=function(){var e=this;this.contentElsWithComments.forEach((function(t){t.isResolved=!1,t.element.classList.remove("ArticleComments__text--hide"),e.commentsItems.find((function(e){return t.id.includes(e.id)&&!0===e.is_resolved}))&&(t.isResolved=!0,t.element.classList.add("ArticleComments__text--hide"))}))},e.prototype.sendEditComment=function(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function(){var r,n,o;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(0,a.editComment)({owner_id:this.articleOwnerId,comment_id:e,text:t})];case 1:return i.sent()&&((r=this.commentsItems.find((function(t){return t.id===e})))?r.text=t:this.commentsItems.forEach((function(r){var i,a,n=null===(a=null===(i=r.thread)||void 0===i?void 0:i.items)||void 0===a?void 0:a.find((function(t){return t.id===e}));n&&(n.text=t)}))),n=new CustomEvent("sendEditComment",{detail:{commentId:e,text:t}}),this.articleLayer.dispatchEvent(n),[3,3];case 2:return o=i.sent(),console.log("Error edit comments",o),[3,3];case 3:return[2]}}))}))},e.prototype.sendCreateComment=function(e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var t,r,n,o;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),0===(t=window.cur.articleEditor.getArticleId())&&this.editor.comments?(this.editor.comments.textCreate=e,this.editor.saveDraft(),[2]):(0===this.articleId&&(this.articleId=this.editor.getArticleId()),[4,(0,a.createComment)({owner_id:this.articleOwnerId,article_id:t,text:e})]);case 1:return(r=i.sent()).thread={count:0,items:[]},this.commentsItems.push(r),0!==this.commentsProfiles.length?[3,3]:[4,this.getComments().then().catch((function(e){return console.log(e)}))];case 2:i.sent(),i.label=3;case 3:return n=new CustomEvent("sendCreateComment",{detail:{newComment:r,text:e}}),this.articleLayer.dispatchEvent(n),this.findContentWithComments(),[3,5];case 4:return o=i.sent(),console.log("Error create comments",o),[3,5];case 5:return[2]}}))}))},e.prototype.sendReplayComment=function(e,t){return(0,i.__awaiter)(this,void 0,void 0,(function(){var r,n,o;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(0,a.createComment)({owner_id:this.articleOwnerId,article_id:this.articleId,reply_to_comment:e,text:t})];case 1:return r=i.sent(),this.commentsItems.forEach((function(t){var i;t.id===e&&t.thread&&(t.thread.count++,null===(i=t.thread.items)||void 0===i||i.push(r))})),n=new CustomEvent("sendReplayComment",{detail:{commentId:e,replayComment:r}}),this.articleLayer.dispatchEvent(n),[3,3];case 2:return o=i.sent(),console.log("Error replay comments",o),[3,3];case 3:return[2]}}))}))},e.prototype.sendDeleteComment=function(e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var t,r,n,o=this;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(0,a.deleteComment)({owner_id:this.articleOwnerId,comment_id:e})];case 1:return i.sent()&&((t=this.commentsItems.find((function(t){return t.id===e})))?(r=new CustomEvent("sendDeleteComment",{detail:{commentId:e}}),this.articleLayer.dispatchEvent(r),this.commentsItems.splice(this.commentsItems.indexOf(t),1)):this.commentsItems.forEach((function(t){var r,i,a;if(t.thread){var n=null===(r=t.thread.items)||void 0===r?void 0:r.find((function(t){return t.id===e}));if(n){t.thread.count--;var s=new CustomEvent("sendDeleteComment",{detail:{commentId:e}});o.articleLayer.dispatchEvent(s),null===(i=t.thread.items)||void 0===i||i.splice(null===(a=t.thread.items)||void 0===a?void 0:a.indexOf(n),1)}}})),this.isNeedCloseWindow=!1,this.editor.replaceOrClearComments(e),this.editor.redraw(),this.editor.saveUndoStateAndDraft()),[3,3];case 2:return n=i.sent(),console.log("Error delete comments",n),[3,3];case 3:return[2]}}))}))},e.prototype.sendResolveComment=function(e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var t,r;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(0,a.setCommentState)({owner_id:this.articleOwnerId,comment_id:e,is_resolved:1})];case 1:return i.sent()&&this.commentsItems.forEach((function(t){t.id===e&&(t.is_resolved=!0)})),t=new CustomEvent("sendResolveComment",{detail:{commentId:e}}),this.articleLayer.dispatchEvent(t),[3,3];case 2:return r=i.sent(),console.log("Error resolve comments",r),[3,3];case 3:return[2]}}))}))},e.prototype.sendUnresolveComment=function(e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var t,r;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(0,a.setCommentState)({owner_id:this.articleOwnerId,comment_id:e,is_resolved:0})];case 1:return i.sent()&&this.commentsItems.forEach((function(t){t.id===e&&(t.is_resolved=!1)})),t=new CustomEvent("sendUnresolveComment",{detail:{commentId:e}}),this.articleLayer.dispatchEvent(t),[3,3];case 2:return r=i.sent(),console.log("Error unresolve comments",r),[3,3];case 3:return[2]}}))}))},e.prototype.sendCommentsStats=function(e,t){if((0,d.partConfigEnabled)("article_comments_analytics")){var r={event_type:e,article_owner_id:this.articleOwnerId,article_id:this.articleId,comment_id:t};(0,d.partConfigEnabled)("article_comments_analytics_log")&&(0,c.debugLog)(r),(0,l.statlogsValueEvent)("article_editor_product_analytics",r)}},e}()},811483:(e,t,r)=>{"use strict";r.d(t,{ArticleCommentsWindowView:()=>h});var i=r(30462),a=r(390237),n=r(729805),o=r(892237),s=r(450558),l=r(517920),d=r(608021),c=r(191381),h=function(){function e(e,t,r,i){this.isOpenSideWindow=!1,this.sortParams="all",this.editor=e,this.store=t,this.comments=this.store.getCommentsList(),this.articleId=r,this.articleOwnerId=i,this.initWrapper(),this.sortComments(),this.initCustomEvents()}return e.prototype.initWrapper=function(){var e;this.wrapper=document.createElement("div"),this.wrapper.classList.add("ArticleComments__sideWindow","ArticleComments__sideWindow--close");var t=null===(e=document.querySelector(".article_ed_layer__header"))||void 0===e?void 0:e.clientHeight;this.wrapper.style.top=t+"px",this.wrapper.style.height="calc(100% - "+t+"px)",this.createSideWindowHeader(),this.initSideWindowButton(),this.editor.appendChild(this.wrapper)},e.prototype.createSideWindowHeader=function(){this.header=(0,a.createElement)('<div class="ArticleComments__sideWindowHeader"></div>');var e=(0,a.createElement)('<span class="ArticleComments__sideWindowTittle">'+(0,d.getLang)("pages_article_comments_window_title")+"</span>");this.header.prepend(e),this.initSortSelectButton(c.ArticleCommentsSortTooltip),this.wrapper.prepend(this.header)},e.prototype.initSortSelectButton=function(e){var t=this,r=e[0].text;this.selectButton&&this.selectButton.remove();var i=(0,a.createElement)('<div class="ArticleComments__tooltipWrapper"></div>');e.forEach((function(n){var s=(0,a.createElement)('<div class="ArticleComments__tooltipItem--sort">'+n.text+"</div>");if(t.sortParams===n.type){r=n.text;var l=(0,o.getIcon16Done)().icon,d=(0,a.createElement)('<div class="ArticleComments__tooltipItemIcon">'+l+"</div>");s.append(d)}s.addEventListener("click",(function(){t.changeSortParams(n.type),t.sortComments(),t.initSortSelectButton(e)})),i.append(s)}));var s=(0,n.getIcon16Dropdown)().icon,d=(0,a.createElement)('<button class="ArticleComments__sideWindowSelectButton">'+r+" "+s+"</button>");new l.default(d,{content:i,forceSide:"bottom",autoShow:!1,offset:[0,0],cls:"ArticleComments__tooltip",noHideOnClick:!1}),d.addEventListener("click",(function(e){e.stopPropagation()})),this.selectButton=d,this.header.append(this.selectButton)},e.prototype.setNoCommentPlug=function(){if(!this.plugElement){var e=(0,s.getIcon56CommentSlashOutline)().icon;this.plugElement=(0,a.createElement)('<div class="ArticleComments__sideWindowNoCommentPlug">'+e+" "+(0,d.getLang)("pages_article_comments_window_no_comments")+"</div>")}return this.plugElement},e.prototype.removeNoCommentPlug=function(){this.plugElement&&this.plugElement.remove()},e.prototype.changeSortParams=function(e){this.sortParams=e},e.prototype.initSideWindowButton=function(){var e,t=this;this.sideWindowButton=document.querySelector(".article_ed_layer__comments"),null===(e=this.sideWindowButton)||void 0===e||e.addEventListener("click",(function(){var e;if(t.store.sendCommentsStats(c.ArticleCommentsStatsEventType.clickToOpenCommentPanel),t.isOpenSideWindow=!t.isOpenSideWindow,t.toggleEditorCanvasPos(),t.isOpenSideWindow){t.sortComments(),t.wrapper.classList.remove("ArticleComments__sideWindow--close"),null===(e=t.sideWindowButton)||void 0===e||e.classList.add("article_ed_layer__comments--active");var r=document.querySelector(".ArticleComments__sideWrapper");null!==r&&r instanceof HTMLElement&&(r.style.opacity="0")}else t.closeSideWindow()}))},e.prototype.toggleEditorCanvasPos=function(){var e=document.querySelector(".article_editor_canvas");if(e&&e instanceof HTMLElement){var t=(window.innerWidth-e.clientWidth)/2;if(t<344){var r=344-t;this.isOpenSideWindow?(r>t-40&&(r=t-40),e.style.left="-"+r+"px"):e.style.left="0px"}}},e.prototype.closeSideWindow=function(){var e;if(this.store.isNeedCloseWindow){this.wrapper.classList.add("ArticleComments__sideWindow--close"),null===(e=this.sideWindowButton)||void 0===e||e.classList.remove("article_ed_layer__comments--active"),this.isOpenSideWindow=!1,this.toggleEditorCanvasPos();var t=document.querySelector(".ArticleComments__sideWrapper");null!==t&&t instanceof HTMLElement&&(t.style.opacity="1")}else this.store.isNeedCloseWindow=!0},e.prototype.sortComments=function(e){var t,r=[];switch(e?t=e:(this.clearCommentCards(),t=this.comments||e),this.sortParams){case"all":this.store.sendCommentsStats(c.ArticleCommentsStatsEventType.showAllComments),this.createCommentCards(t);break;case"myself":this.store.sendCommentsStats(c.ArticleCommentsStatsEventType.showOpenComments),t.forEach((function(e){e.from_id===window.vk.id&&r.push(e)})),this.createCommentCards(r);break;case"resolved":this.store.sendCommentsStats(c.ArticleCommentsStatsEventType.showResolvedComments),t.forEach((function(e){e.is_resolved&&r.push(e)})),this.createCommentCards(r);break;case"outContent":this.store.sendCommentsStats(c.ArticleCommentsStatsEventType.showDeletedComments),this.createCommentCards(this.store.getNonContentCommentsList(),!0)}},e.prototype.navigateButtonsCb=function(e,t){if(!(this.store.commentsWindowView.length<2)){var r=this.store.commentsWindowView.findIndex((function(e){return e.getCommentId()===t}));switch(e){case"left":this.store.sendCommentsStats(c.ArticleCommentsStatsEventType.clickToPrevThread,this.store.commentsContentView[r].getCommentId()),r-1>=0?(this.store.commentsWindowView[r].setStatusInactive(),this.store.commentsWindowView[r-1].setStatusActive()):(this.store.commentsWindowView[r].setStatusInactive(),this.store.commentsWindowView[this.store.commentsWindowView.length-1].setStatusActive());break;case"right":this.store.sendCommentsStats(c.ArticleCommentsStatsEventType.clickToNextThread,this.store.commentsContentView[r].getCommentId()),r===this.store.commentsWindowView.length-1?(this.store.commentsWindowView[r].setStatusInactive(),this.store.commentsWindowView[0].setStatusActive()):(this.store.commentsWindowView[r].setStatusInactive(),this.store.commentsWindowView[r+1].setStatusActive())}}},e.prototype.createCommentCards=function(e,t){var r=this;void 0===t&&(t=!1),0===e.length?this.wrapper.append(this.setNoCommentPlug()):this.removeNoCommentPlug(),e.forEach((function(e){var a=t?["sideWindow","outContent"]:["sideWindow"],n=new i.ArticleCommentsComment(e,r.store,r.navigateButtonsCb,a);r.store.editor._setEventListener(document,"click",(function(e){e.target instanceof Element&&e.target.closest('[data-comment-id="'+n.getCommentId()+'"]')&&e.target.closest(".ArticleComments__sideWindow")?n.setStatusActive():n.setStatusInactive()})),r.store.commentsWindowView.push(n),n.removeAnimations(),r.setCommentsCard(n),n.setModifier("sideWindow"),n.returnAnimations()}))},e.prototype.clearCommentCards=function(){this.store.commentsWindowView.forEach((function(e){e.getElement().remove()})),this.store.commentsWindowView=[]},e.prototype.setCommentsCard=function(e){this.wrapper.append(e.getElement())},e.prototype.initCustomEvents=function(){var e=this;this.store.articleLayer.addEventListener("sendDeleteComment",(function(t){e.store.commentsWindowView.forEach((function(r,i){r.getCommentId()===t.detail.commentId&&(r.getElement().remove(),e.store.commentsWindowView.splice(i,1))}))})),this.store.articleLayer.addEventListener("sendCreateComment",(function(t){var r=t.detail.newComment;e.comments=e.store.getCommentsList(),e.sortComments([r])}))},e}()},432158:(e,t,r)=>{"use strict";r.d(t,{CursorManager:()=>l});var i=r(570655),a=r(601306),n=r(201240),o=r(83178),s=r(390237),l=function(){function e(e,t){this.editor=e,this.els=t}return e.prototype.getKey=function(){return"article_cursor_"+this.editor.getArticleOwnerId()+"_"+(this.editor.getArticleId()||0)},e.prototype.getCursor=function(){var e=(0,i.__read)(a.SelectionManager.getRange(),2),t=e[0],r=e[1];if(!t)return!1;var n={start:{path:[]},end:{path:[]},isEmpty:function(){return!1}};return this.fillCursor(n.start,t.startContainer,t.startOffset),!r&&n.end?this.fillCursor(n.end,t.endContainer,t.endOffset):delete n.end,n.isEmpty=function(){return!n.end&&0===n.start.nodeOffset&&0===n.start.path.length&&0===n.start.path[0]},n},e.prototype.fillCursor=function(e,t,r){var i=this.els.canvas;t.nodeType==Node.TEXT_NODE?e.textOffset=r:e.nodeOffset=r,(0,s.traverseParent)(t,(function(t){if(t==i)return!0;if((0,o.isQuoteEl)(t)){var r=t.firstElementChild;r&&(0,o.isParagraphToolsEl)(r)&&(r=r.nextElementSibling),r&&["span","p"].includes(r.tagName.toLowerCase())&&e.path.pop()}e.path.push((0,o.childNodeIndex)(t))}),o.MAX_DOM_DEPTH),e.path=e.path.slice().reverse()},e.prototype.saveLastCursor=function(){var e=this.getCursor(),t=this.getKey();localStorage.removeItem(t),e&&!e.isEmpty()&&localStorage.setItem(t,JSON.stringify(e)),this.lastCursor=e},e.prototype.restoreLastCursor=function(){var e=localStorage.getItem(this.getKey());e?this.restoreCursor(JSON.parse(e)):a.SelectionManager.setCaretAtElement(this.els.canvas.firstChild)},e.prototype.getElementFromCursor=function(e){var t=this.els.canvas,r=0;return e.path.forEach((function(r,i){if((0,o.isQuoteEl)(t)){var a=t.firstElementChild;a&&(0,o.isParagraphToolsEl)(a)&&(a=a.nextElementSibling),a&&1==i&&["span","p"].includes(a.tagName.toLowerCase())&&(t=a)}r=Math.min(t.childNodes.length-1,r);var n=t.childNodes[r];if(n instanceof HTMLElement&&(0,o.isParagraphToolsEl)(n)&&n.nextSibling&&(n=n.nextSibling),!n)return e.nodeOffset=0,!1;t=n})),r=t.nodeType==Node.TEXT_NODE&&void 0!==e.textOffset?Math.min((t.textContent||"").length,e.textOffset):0,void 0!==e.nodeOffset&&t instanceof Element&&(r=Math.min(e.nodeOffset,t.childNodes.length)),[t,r]},e.prototype.restoreCursor=function(e){if(!e)return this.restoreCursorFromMarker();var t=document.createRange();try{var r=(0,i.__read)(this.getElementFromCursor(e.start),2),a=r[0],n=r[1];if((0,o.isBR)(a)&&0==n){var s=a.parentNode;s&&(0,o.isParagraphEl)(s)&&1==s.childNodes.length&&(a=s)}if((0,o.findDragButtonEl)(a)&&a.childNodes.length>1&&0===n&&(a=a.childNodes[1]),t.setStart(a,n),e.end){var l=(0,i.__read)(this.getElementFromCursor(e.end),2),d=l[0],c=l[1];t.setEnd(d,c)}var h=window.getSelection();h&&h.setBaseAndExtent(t.startContainer,t.startOffset,t.endContainer,t.endOffset)}catch(e){console.error(e)}},e.setMarker=function(e,t,r){if(e.nodeType==Node.TEXT_NODE){var i=e.textContent||"";e.textContent=""+i.substring(0,t)+r+i.substring(t)}else{var a=document.createTextNode(r);e.insertBefore(a,e.childNodes[t])}},e.prototype.saveCursorMarker=function(){if(!this.markerCursorSet){var t=(0,i.__read)(a.SelectionManager.getRange(),2),r=t[0],n=t[1];if(!r)return[0,0];var s=r.startContainer,l=r.startOffset,d=r.endContainer,c=r.endOffset;if(s!=this.els.canvas){var h=this.editor.getContainingParagraphEl(s)[1];e.setMarker(s,l,o.CURSOR_MARKER_START),n||(this.editor.getContainingParagraphEl(d)[1]==h&&(d.textContent||"").includes(o.CURSOR_MARKER_START)&&(c+=1),e.setMarker(d,c,o.CURSOR_MARKER_END)),this.markerCursorSet=!0}}},e.prototype.restoreCursorFromMarker=function(){if(this.markerCursorSet){var e,t,r,i=function(e,t,r){return function t(i){if(i instanceof Text){var a=(i.textContent||"").indexOf(e);if(a>=0){i.textContent=(i.textContent||"").split(e).join("");var n=i.parentElement;return i&&-1!=i.data.search(/\s$/)&&(i.data=i.data.trimRight()+o.NBSP_UNICODE,r&&r[0]==i&&(r[0]=i)),n&&!n.innerHTML&&((i=n)instanceof Element&&(i.innerHTML="<br/>"),a=0),[i,a]}}else for(var s=0,l=i.childNodes.length;s<l;s++){var d;if(d=t(i.childNodes[s]))return d}}(t)};for(r=0;r<this.els.canvas.children.length&&!(e=i(o.CURSOR_MARKER_START,this.els.canvas.children[r]));r++);for(;r<this.els.canvas.children.length&&!(t=i(o.CURSOR_MARKER_END,this.els.canvas.children[r],e));r++);if(e){var a=document.createRange();e[0].nodeType==Node.TEXT_NODE&&(e[1]=Math.min(e[1],e[0].textContent.length)),a.setStart(e[0],e[1]),t&&(t[0].nodeType==Node.TEXT_NODE&&(t[1]=Math.min(t[1],t[0].textContent.length)),a.setEnd(t[0],t[1]));var n=window.getSelection();n&&n.setBaseAndExtent(a.startContainer,a.startOffset,a.endContainer,a.endOffset)}this.removeMarkerFromModel(o.CURSOR_MARKER_START),this.removeMarkerFromModel(o.CURSOR_MARKER_END),this.markerCursorSet=!1}},e.prototype.removeMarkerFromModel=function(e){this.editor.traverseParagraphs((function(t){t.lines.forEach((function(t){var r=t.text.indexOf(e);if(r>=0){t.text=t.text.replace(e,"");var i=0;if(t.brs)for(var a=0;a<t.brs.length;a++)t.brs[a]>r&&(i=1),t.brs[a]-=i;n.Decorations.forEach((function(e){var i,a=null===(i=t.decorations)||void 0===i?void 0:i[e.type];if(a)for(var n=0,o=a.length;n<o;n++){var s=a[n];s[0]>r&&(s[0]-=1),s[1]>r&&(s[1]-=1)}}))}}))}))},e.prototype.checkMarkerCursor=function(){return this.markerCursorSet},e.justCursorInString=function(e){return 1==(e=e.trim()).length&&e.startsWith(o.CURSOR_MARKER_START)},e}()},790301:(e,t,r)=>{"use strict";r.d(t,{HistoryManager:()=>n});var i=r(570655),a=r(985535),n=function(){function e(e,t){this.editor=e,this.maxSize=t,this.undos=[],this.redos=[]}return e.prototype.undo=function(){this.saveUndoDelayedTO&&this.saveUndoState(),0!==this.undos.length&&(this.redos.push(this.undoCurrentState),this.applyState(this.undos.pop()),0==this.undos.length&&(this.undoable=!1))},e.prototype.redo=function(){0!=this.redos.length&&(this.undos.push(this.undoCurrentState),this.applyState(this.redos.pop()))},e.prototype.canUndo=function(){return this.undoable||this.undos.length>0},e.prototype.canRedo=function(){return this.redos.length>0},e.prototype.saveUndoStateDelayed=function(e){var t=this;void 0===e&&(e=1e3),"number"==typeof this.saveUndoDelayedTO&&clearTimeout(this.saveUndoDelayedTO),this.saveUndoDelayedTO=setTimeout((function(){t.saveUndoState()}),e)},e.prototype.saveUndoState=function(){var e,t;"number"==typeof this.saveUndoDelayedTO&&clearTimeout(this.saveUndoDelayedTO),this.saveUndoDelayedTO=null;var r=this.editor.mapParagraphs((function(e){return(0,a.getCleanedParagraph)(e,true)})),i=r.ps,n=r.store;if(this.undoCurrentState){if(JSON.stringify([i,n])==JSON.stringify([this.undoCurrentState.ps,this.undoCurrentState.store]))return;this.undos.push({ps:this.undoCurrentState.ps,store:this.undoCurrentState.store,cursor:this.editor.cursor.lastCursor}),this.undos.length>this.maxSize&&this.undos.shift()}this.undoCurrentState={ps:i,store:n,cursor:this.editor.cursor.getCursor()},this.redos=[],null===(t=(e=this.editor.getOptions()).onUndoRedo)||void 0===t||t.call(e)},e.prototype.applyState=function(e){var t,r,n,o;if(e){try{for(var s=(0,i.__values)(Object.values(e.store)),l=s.next();!l.done;l=s.next()){var d=l.value;(0,a.expandParagraphFields)(d)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}this.editor.setState(e.ps,e.store);var c=this.editor.mapParagraphs((function(e){return(0,a.getCleanedParagraph)(e,!0)})),h=c.ps,p=c.store;this.undoCurrentState={ps:h,store:p,cursor:e.cursor},this.editor.redraw(!0),e.cursor&&this.editor.cursor.restoreCursor(e.cursor),null===(o=(n=this.editor.getOptions()).onUndoRedo)||void 0===o||o.call(n)}},e}()},601306:(e,t,r)=>{"use strict";r.d(t,{SelectionManager:()=>o});var i=r(570655),a=r(201240),n=r(83178),o=function(){function e(e,t){this.editor=e,this.els=t}return e.getRange=function(){var e=window.getSelection();return(null==e?void 0:e.rangeCount)?[e.getRangeAt(0),e.isCollapsed,e]:[!1]},e.setRange=function(e,t,r,i){if(e&&r){var a=document.createRange();a.setStart(e,t),a.setEnd(r,i);var n=window.getSelection();null==n||n.removeAllRanges(),null==n||n.addRange(a)}},e.getFocusedElement=function(){var e=window.getSelection();return(null==e?void 0:e.focusNode)||null},e.selectElContents=function(e){if(e)try{var t=document.createRange();t.selectNodeContents(e);var r=window.getSelection();null==r||r.removeAllRanges(),null==r||r.addRange(t)}catch(e){}},e.selectEl=function(e){if(e)try{var t=document.createRange();t.selectNode(e);var r=window.getSelection();null==r||r.removeAllRanges(),null==r||r.addRange(t)}catch(e){}},e.setCaretAtElement=function(e,t){if(e)try{var r=document.createRange();t?(r.selectNodeContents(e),r.collapse(!1)):(r.setStart(e,0),r.setEnd(e,0));var i=window.getSelection();null==i||i.removeAllRanges(),null==i||i.addRange(r)}catch(e){}},e.getRangeRect=function(e){var t=e.getBoundingClientRect();if(e.collapsed&&0===t.top&&0===t.left){var r=document.createTextNode(n.ZERO_WIDTH_SPACE);e.insertNode(r),t=e.getBoundingClientRect(),r.remove()}return t},e.atTheFirstTextLineIn=function(t){var r=(0,i.__read)(e.getRange(),1)[0];if(!r)return!1;var a=getComputedStyle(t),n=t.getBoundingClientRect();return e.getRangeRect(r).top-parseInt(a.lineHeight)<n.top-parseInt(a.paddingTop)},e.atTheLastTextLineIn=function(t){var r=(0,i.__read)(e.getRange(),1)[0];if(!r)return!1;var a=getComputedStyle(t),n=t.getBoundingClientRect();return e.getRangeRect(r).bottom+parseInt(a.lineHeight)>n.bottom-parseInt(a.paddingBottom)},e.removeAllRanges=function(){var e=window.getSelection();null==e||e.removeAllRanges()},e.prototype.getCurrentParagraphId=function(){var t=window.getSelection();if(null==t?void 0:t.rangeCount){var r=t.getRangeAt(0);if(r.startContainer==this.els.canvas)return[this.editor.getState().ps[r.startOffset]||!1,this.editor.getState().ps[r.endOffset-1]||!1];var a=r.startContainer===this.els.canvas&&r.startContainer instanceof HTMLElement?r.startContainer.children[r.startOffset]:r.startContainer,n=(0,i.__read)(this.editor.getContainingParagraphEl(a),1)[0];a=n?e.getStartSelectionAtTheEndNode(a,r,n):a;var o=(0,i.__read)(this.editor.getContainingParagraphEl(a),2)[1],s=r.endContainer===this.els.canvas&&r.endContainer instanceof HTMLElement?r.endContainer.children[r.endOffset]:r.endContainer,l=(0,i.__read)(this.editor.getContainingParagraphEl(s),1)[0];s=l?e.getEndSelectionAtTheStartNode(s,r,l):s;var d=(0,i.__read)(this.editor.getContainingParagraphEl(s),2)[1];return[o||!1,d||(o||this.editor.getState().ps[0])||!1]}return[this.editor.getState().ps[0]||!1,!1]},e.prototype.getCurrentSelectionState=function(){var t,r,o,s,l,d,c,h=(0,i.__read)(this.getCurrentParagraphId(),2),p=h[0],u=h[1];if(!1===p||!1===u)return!1;var g=(0,i.__read)(e.getRange(),2),m=g[0],v=g[1],_=this.editor.getParagraphById(p);m&&!v&&(0,n.isHeader1Paragraph)(_)&&m.startContainer instanceof Text&&m.startOffset===m.startContainer.data.length&&(p=this.editor.getNextParagraphIdById(p));var f,y,b=null===(l=window.getSelection())||void 0===l?void 0:l.toString(),C={decorations:{},header1:!1,header2:!0,header3:!0,header:!1,object:!1,citequote:!0,blockquote:!0,list:!1,inTable:!1,hasTable:!1,hasRow:!1,hasCell:!1,numericList:!1,bulletList:!1,justHeaders:!0,selectedText:b=" "===b?b:(null==b?void 0:b.trim())||""},w={},E=0,P=function(t){var r;S.editor.traverseParentParagraph(t.id,(function(e){((0,n.isTableParagraph)(e)||(0,n.isTableRowParagraph)(e)||(0,n.isTableCellParagraph)(e))&&(C.inTable=!0)})),(0,n.isTableParagraph)(t)&&(C.hasTable=!0),(0,n.isTableRowParagraph)(t)&&(C.hasRow=!0),(0,n.isTableCellParagraph)(t)&&(C.hasCell=!0);var o=(0,n.isObjectParagraph)(t)?null===(d=t._object)||void 0===d?void 0:d.getCaptionEl():S.editor.getParagraphElById(t.id);void 0===f&&(o?(r=(0,i.__read)(e.getCaretCharacterOffsetWithin(o),2),f=r[0],y=r[1]):(f=0,y=0)),t.lines.forEach((function(e,r){var i,o=e.decorations;(0,n.isPhotoParagraph)(t)&&(null===(i=t._object)||void 0===i?void 0:i.getImageIndex())!==r||(o&&a.Decorations.forEach((function(t){var r=o[t.type];r&&0!==r.length&&r.forEach((function(r){var i=[r[0]+E,r[1]+E];if("link"==t.type)f<i[1]&&y>i[0]&&(w[t.type]=1,C.decorations[t.type]=!0);else if(1==w[t.type]){var a=y>=i[0]&&y<=i[1];y>i[1]||(a?r[0]>0?w[t.type]=-1:(w[t.type]=2,C.decorations[t.type]=!0):w[t.type]=-1)}else if(!w[t.type]){var n=f>=i[0]&&f<=i[1];a=y>=i[0]&&y<=i[1];n&&a?(w[t.type]=2,C.decorations[t.type]=!0):n&&(e.text.length>i[1]?w[t.type]=-1:w[t.type]=1)}}))})),E+=e.text.length)}))},S=this;try{for(var A=(0,i.__values)(this.editor.getSelectedParagraphs()),I=A.next();!I.done;I=A.next()){P(I.value)}}catch(e){t={error:e}}finally{try{I&&!I.done&&(r=A.return)&&r.call(A)}finally{if(t)throw t.error}}try{for(var L=(0,i.__values)(this.editor.getSelectedParagraphs()),T=L.next();!T.done;T=L.next()){var x=T.value;(0,n.isMediaParagraph)(x)&&(C.captionFocused=C.captionFocused||(null===(c=x._object)||void 0===c?void 0:c.isCaptionFocused()),C.object=!0),(0,n.isHeader1Paragraph)(x)&&(C.header1=!0),(0,n.isHeader2Paragraph)(x)||(C.header2=!1),(0,n.isHeader3Paragraph)(x)||(C.header3=!1),(0,n.isHeaderParagraph)(x)?C.header=!0:C.justHeaders=!1,(0,n.isQuoteParagraph)(x)||(C.blockquote=!1),(0,n.isQuote2Paragraph)(x)||(C.citequote=!1),(0,n.isBulletListParagraph)(x)&&(C.list=!0,C.bulletList=!0),(0,n.isNumericListParagraph)(x)&&(C.list=!0,C.numericList=!0)}}catch(e){o={error:e}}finally{try{T&&!T.done&&(s=L.return)&&s.call(L)}finally{if(o)throw o.error}}return!(m&&m.startContainer instanceof HTMLElement&&m.startContainer.classList.contains("article_ed__noconteditable"))&&(C.multiline=p!=u,C)},e.getRangeInParagraphForDecoration=function(t,r){void 0===r&&(r=!1);var a=(0,i.__read)(e.getRange(),3),n=a[0],o=a[2];if(!t||!n||!o||0===o.rangeCount)return[0,0];var s=0,l=0,d=n.cloneRange();d.selectNodeContents(t);var c=d.toString().length;return r?d.setStart(t,0):(d.setEnd(n.startContainer,n.startOffset),s=d.toString().length),d.setEnd(n.endContainer,n.endOffset),c<(l=d.toString().length)&&(l=c),[s,l]},e.getStartSelectionAtTheEndNode=function(e,t,r){var i;if(!(0!==e.childNodes.length?e.childNodes.length===t.startOffset:(null===(i=e.textContent)||void 0===i?void 0:i.length)===t.startOffset)||t.startContainer===t.endContainer)return t.startContainer;for(;e!==r;){var a=e.parentNode;if(!a||a.lastChild!==e||(0,n.isParagraphEl)(e))return t.startContainer;e=a}return r.nextSibling||r},e.getEndSelectionAtTheStartNode=function(e,t,r){if(0!==t.endOffset&&!(0,n.isParagraphEl)(e)||t.startContainer===t.endContainer)return t.endContainer;for(;e!==r;){var i=e.parentNode;if(!(i&&i.firstChild&&(i.firstChild===e||i.childNodes[1]===e&&(0,n.isParagraphToolsEl)(i.firstChild)))||(0,n.isParagraphEl)(e))return t.endContainer;e=i}return r.previousSibling||r},e.prototype.atTheStart=function(t){if(!t)return!1;var r=(0,i.__read)(e.getRange(),2),a=r[0],o=r[1];if(!a||!o)return!1;if(t===a.startContainer&&0===a.startOffset)return!0;if(!t.contains(a.startContainer)||0!==a.startOffset)return!1;if(t instanceof HTMLElement){var s=Array.from(t.childNodes).filter((function(e){return e instanceof Text||e instanceof HTMLElement&&!e.classList.contains(n.ArticleEditorParagraphToolsClass)}));return this.atTheStart(s[0])}return!1},e.getCaretCharacterOffsetWithin=function(t){var r,a=(0,i.__read)(e.getRange(),1)[0];if(!a||!t)return[0,0];var n=a.cloneRange();return n.selectNodeContents(t),n.setEnd(a.startContainer,a.startOffset),r=n.toString().length,n.setEnd(a.endContainer,a.endOffset),[r,n.toString().length]},e}()},532289:(e,t,r)=>{"use strict";r.d(t,{getIcon16Add:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M9 9v4a1 1 0 1 1-2 0V9H3a1 1 0 1 1 0-2h4V3a1 1 0 1 1 2 0v4h4a1 1 0 1 1 0 2H9Z"/></svg>',name:"add_16"}}},659214:(e,t,r)=>{"use strict";r.d(t,{getIcon16CheckOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M12.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd"/></svg>',name:"check_outline_16"}}},83688:(e,t,r)=>{"use strict";r.d(t,{getIcon16Done:()=>i});var i=function(){return{icon:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.74 3.76c.35.34.35.9 0 1.23l-7.31 7.25a.88.88 0 0 1-1.25 0L2.26 9.36a.87.87 0 0 1 0-1.23.88.88 0 0 1 1.24 0l2.3 2.26 6.7-6.63a.88.88 0 0 1 1.24 0Z" fill="currentColor"/></svg>',name:"done_16"}}},788656:(e,t,r)=>{"use strict";r.d(t,{getIcon20Add:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 3a.75.75 0 0 1 .75.75v5.5h5.5a.75.75 0 0 1 0 1.5h-5.5v5.5a.75.75 0 0 1-1.5 0v-5.5h-5.5a.75.75 0 0 1 0-1.5h5.5v-5.5A.75.75 0 0 1 10 3Z" clip-rule="evenodd"/></svg>',name:"add_20"}}},502810:(e,t,r)=>{"use strict";r.d(t,{getIcon20ArrowDownOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path d="m10.75 14 3.98-3.8a.75.75 0 1 1 1.04 1.1l-5.25 5a.75.75 0 0 1-1.04 0l-5.25-5a.75.75 0 1 1 1.04-1.1L9.25 14V4.25a.75.75 0 0 1 1.5 0V14Z"/></svg>',name:"arrow_down_outline_20"}}},261730:(e,t,r)=>{"use strict";r.d(t,{getIcon20ArrowLeftOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="M8.7 4.23a.75.75 0 1 1 1.1 1.04L6 9.25h9.75a.75.75 0 0 1 0 1.5H6l3.8 3.98a.75.75 0 0 1-.03 1.06.75.75 0 0 1-1.06-.02l-5-5.25a.75.75 0 0 1 0-1.04l5-5.25Z"/></svg>',name:"arrow_left_outline_20"}}},883780:(e,t,r)=>{"use strict";r.d(t,{getIcon20ArrowRightOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="M11.3 15.77a.75.75 0 0 1-1.07.02.75.75 0 0 1-.02-1.06L14 10.75H4.25a.75.75 0 0 1 0-1.5H14l-3.8-3.98a.75.75 0 0 1 .03-1.06.75.75 0 0 1 1.06.02l5 5.25a.75.75 0 0 1 0 1.04l-5 5.25Z"/></svg>',name:"arrow_right_outline_20"}}},604602:(e,t,r)=>{"use strict";r.d(t,{getIcon20ArrowUpOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="21" height="20" fill="none" viewBox="0 0 21 20"><path fill="currentColor" d="M15.77 8.7a.75.75 0 0 1-1.03 1.1L10.75 6v9.75a.75.75 0 0 1-1.5 0V6L5.27 9.8a.75.75 0 1 1-1.03-1.1l5.25-5a.75.75 0 0 1 1.03 0l5.25 5Z"/></svg>',name:"arrow_up_outline_20"}}},300426:(e,t,r)=>{"use strict";r.d(t,{getIcon20CheckBoxOff:()=>i});var i=function(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05 2.53C4.79 2.13 5.52 2 7.13 2h5.74c1.61 0 2.34.14 3.08.53.65.35 1.17.87 1.52 1.52.4.74.53 1.47.53 3.08v5.74c0 1.61-.14 2.34-.53 3.08a3.64 3.64 0 0 1-1.52 1.52c-.74.4-1.47.53-3.08.53H7.13c-1.61 0-2.34-.14-3.08-.53a3.64 3.64 0 0 1-1.52-1.52c-.4-.74-.53-1.47-.53-3.08V7.13c0-1.61.14-2.34.53-3.08.35-.65.87-1.17 1.52-1.52Zm3.08.97c-1.53 0-1.96.14-2.38.36-.38.2-.69.5-.9.9-.21.4-.35.84-.35 2.37v5.74c0 1.53.14 1.96.36 2.38.2.38.5.69.9.9.4.21.84.35 2.37.35h5.74c1.53 0 1.96-.14 2.38-.36.38-.2.69-.5.9-.9.21-.4.35-.84.35-2.37V7.13c0-1.53-.14-1.96-.36-2.38-.2-.38-.5-.69-.9-.9-.4-.21-.84-.35-2.37-.35H7.13Z" fill="currentColor"/></svg>',name:"check_box_off_20"}}},222105:(e,t,r)=>{"use strict";r.d(t,{getIcon20CheckBoxOn:()=>i});var i=function(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.44 4.18C2 5.04 2 6.16 2 8.4v3.2c0 2.24 0 3.36.44 4.22a4 4 0 0 0 1.74 1.74c.86.44 1.98.44 4.22.44h3.2c2.24 0 3.36 0 4.22-.44a4 4 0 0 0 1.74-1.74c.44-.86.44-1.98.44-4.22V8.4c0-2.24 0-3.36-.44-4.22a4 4 0 0 0-1.74-1.74C14.96 2 13.84 2 11.6 2H8.4c-2.24 0-3.36 0-4.22.44a4 4 0 0 0-1.74 1.74Zm12.2 3.8a.9.9 0 1 0-1.28-1.27L8.7 11.38 6.64 9.33a.9.9 0 0 0-1.28 1.27l2.7 2.69a.9.9 0 0 0 1.27 0l5.3-5.3Z" fill="currentColor"/></svg>',name:"check_box_on_20"}}},578954:(e,t,r)=>{"use strict";r.d(t,{getIcon20ChevronLeftOutline:()=>i});var i=function(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 4.22a.75.75 0 0 1 0 1.06L7.8 10l4.72 4.72a.75.75 0 1 1-1.06 1.06l-5.25-5.25a.75.75 0 0 1 0-1.06l5.25-5.25a.75.75 0 0 1 1.05 0z" fill="currentColor"/></svg>',name:"chevron_left_outline_20"}}},881344:(e,t,r)=>{"use strict";r.d(t,{getIcon20DeleteOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.84 4H2.75a.75.75 0 0 0 0 1.5h.55l.9 9.25c.05.52.1.96.16 1.31.06.37.16.71.35 1.03a2.9 2.9 0 0 0 1.25 1.13c.33.16.68.22 1.06.25.36.03.8.03 1.32.03h3.32c.53 0 .96 0 1.32-.03.38-.03.73-.1 1.06-.25a2.9 2.9 0 0 0 1.25-1.13c.19-.32.29-.66.35-1.03.06-.35.1-.79.16-1.31l.9-9.25h.55a.75.75 0 0 0 0-1.5h-4.09a3.25 3.25 0 0 0-6.32 0Zm1.58 0h3.16a1.75 1.75 0 0 0-3.16 0Zm6.78 1.5H4.8l.9 9.07c.05.56.08.94.13 1.23.05.28.1.42.17.52a1.4 1.4 0 0 0 .6.55c.1.04.25.08.53.1.3.03.68.03 1.24.03h3.26c.56 0 .94 0 1.23-.02.29-.03.43-.07.54-.11a1.4 1.4 0 0 0 .6-.55c.06-.1.11-.24.16-.52.05-.3.1-.67.15-1.23l.89-9.07Zm-2.89 2a.75.75 0 0 1 .69.81l-.5 6a.75.75 0 0 1-1.5-.12l.5-6a.75.75 0 0 1 .81-.69Zm-4.62 0a.75.75 0 0 1 .8.69l.5 6a.75.75 0 0 1-1.49.13l-.5-6a.75.75 0 0 1 .69-.82Z" clip-rule="evenodd"/></svg>',name:"delete_outline_20"}}},580943:(e,t,r)=>{"use strict";r.d(t,{getIcon20PalleteOutline:()=>i});var i=function(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M10.8 6.05a1.25 1.25 0 1 1 2.5 0 1.25 1.25 0 0 1-2.5 0zm3.65 2.15a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5zM4.3 9.45a1.25 1.25 0 1 1 2.5 0 1.25 1.25 0 0 1-2.5 0zM7.85 4.8a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5z"/><path clip-rule="evenodd" d="M14.18 14.04c2.14.23 4.32-.75 4.32-4.04A8.47 8.47 0 0 0 10 1.5 8.47 8.47 0 0 0 1.5 10a8.47 8.47 0 0 0 8.5 8.5c1.13 0 2.25-1 1.98-2.43l-.17-.68c-.25-.94-.43-1.6 1.08-1.49l1.29.14zm.16-1.5-.25-.02-1.1-.12a3.34 3.34 0 0 0-1.74.27 2 2 0 0 0-1.1 1.68 3.8 3.8 0 0 0 .22 1.47l.14.54c.02.13 0 .22 0 .28a.44.44 0 0 1-.1.17.57.57 0 0 1-.41.19 6.97 6.97 0 0 1-7-7 6.97 6.97 0 0 1 7-7 6.97 6.97 0 0 1 7 7c0 1.3-.41 1.87-.77 2.15-.42.32-1.07.48-1.9.4z" fill-rule="evenodd"/></g></svg>',name:"pallete_outline_20"}}},56730:(e,t,r)=>{"use strict";r.d(t,{getIcon20TableHeaderOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.3 3c-2.38 0-3.57 0-4.48.46a4.25 4.25 0 0 0-.8.54H3v.01a4.25 4.25 0 0 0-1.04 1.31c-.46.91-.46 2.1-.46 4.48v.4c0 2.38 0 3.57.46 4.48a4.25 4.25 0 0 0 1.86 1.86c.91.46 2.1.46 4.48.46h3.4c2.38 0 3.57 0 4.48-.46a4.25 4.25 0 0 0 1.86-1.86c.46-.91.46-2.1.46-4.48v-.4c0-2.38 0-3.57-.46-4.48A4.25 4.25 0 0 0 17 4.01V4h-.01a4.25 4.25 0 0 0-.81-.54C15.27 3 14.08 3 11.7 3H8.3Zm.95 4H3.06a8.08 8.08 0 0 0 0 .13C3 7.76 3 8.59 3 9.8v.7h6.25V7Zm1.5 0v3.5H17v-.7c0-1.22 0-2.04-.05-2.67a8.32 8.32 0 0 0-.02-.13h-6.18Zm-1.5 5H3.01c0 .33.02.61.04.87A3 3 0 0 0 3.3 14a2.75 2.75 0 0 0 1.2 1.2c.2.1.51.2 1.13.25.63.05 1.46.05 2.67.05h.95V12Zm1.5 3.5V12h6.24l-.04.87A3 3 0 0 1 16.7 14a2.75 2.75 0 0 1-1.2 1.2c-.2.1-.51.2-1.13.25-.63.05-1.45.05-2.67.05h-.95Z" clip-rule="evenodd"/></svg>',name:"table_header_outline_20"}}},506127:(e,t,r)=>{"use strict";r.d(t,{getIcon24BoldFilled:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"/><path fill="currentColor" d="M18.246 12.66c.482.33.872.746 1.173 1.246.3.5.451 1.088.451 1.764 0 .812-.17 1.498-.513 2.058-.342.56-.832 1.002-1.471 1.325-.677.346-1.457.59-2.34.733-.883.143-1.923.214-3.118.214H4.5a.5.5 0 1 1 0-1H5c1 0 1-1 1-3V8c0-2 0-3-1-3h-.5a.5.5 0 0 1 0-1h8.312c2.187 0 3.766.3 4.735.902.97.601 1.455 1.488 1.455 2.661 0 .541-.11 1.017-.327 1.426-.218.41-.53.765-.936 1.066a5.618 5.618 0 0 1-1.32.722c-.51.203-1.06.372-1.645.507v.214a9.13 9.13 0 0 1 1.826.39c.632.198 1.18.456 1.646.772zM15 7.83c0-.89-.301-1.585-.904-2.083C13.494 5.25 12.591 5 11.386 5c-.172 0-.396.006-.673.017l-.425.017a.3.3 0 0 0-.288.3V10.7a.3.3 0 0 0 .3.3h.407c1.467 0 2.55-.285 3.247-.855C14.65 9.575 15 8.804 15 7.83zm1 7.676c0-1.13-.402-1.998-1.205-2.6-.804-.604-1.96-.906-3.466-.906-.174 0-.404.006-.692.017a60.6 60.6 0 0 0-.35.015.3.3 0 0 0-.287.3v5.66c.082.282.338.521.767.716.43.195.95.292 1.562.292 1.087 0 1.97-.306 2.65-.917.68-.61 1.021-1.47 1.021-2.577z"/></g></svg>',name:"bold_filled_24"}}},244817:(e,t,r)=>{"use strict";r.d(t,{getIcon24CameraOutline:()=>i});var i=function(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.46 3h3.08c.29 0 .53 0 .76.03.7.1 1.35.47 1.8 1.03.25.3.4.64.62.96.2.28.5.46.85.48.3.02.58-.01.88.02a3.9 3.9 0 0 1 3.53 3.53c.02.18.02.37.02.65v4.04c0 1.09 0 1.96-.06 2.66a5.03 5.03 0 0 1-.47 1.92 4.9 4.9 0 0 1-2.15 2.15c-.57.29-1.2.41-1.92.47-.7.06-1.57.06-2.66.06H9.26c-1.09 0-1.96 0-2.66-.06a5.03 5.03 0 0 1-1.92-.47 4.9 4.9 0 0 1-2.15-2.15 5.07 5.07 0 0 1-.47-1.92C2 15.7 2 14.83 2 13.74V9.7c0-.28 0-.47.02-.65a3.9 3.9 0 0 1 3.53-3.53c.3-.03.59 0 .88-.02.34-.02.65-.2.85-.48.21-.32.37-.67.61-.96A2.9 2.9 0 0 1 9.7 3.03c.23-.03.47-.03.76-.03Zm0 1.8-.49.01a1.1 1.1 0 0 0-.69.4c-.2.24-.33.56-.52.82A2.9 2.9 0 0 1 6.54 7.3c-.28.01-.55-.02-.83 0a2.1 2.1 0 0 0-1.9 1.91l-.01.53v3.96c0 1.14 0 1.93.05 2.55.05.62.15.98.29 1.26.3.58.77 1.05 1.35 1.35.28.14.64.24 1.26.29.62.05 1.42.05 2.55.05h5.4c1.13 0 1.93 0 2.55-.05.62-.05.98-.15 1.26-.29a3.1 3.1 0 0 0 1.35-1.35c.14-.28.24-.64.29-1.26.05-.62.05-1.41.05-2.55V9.21a2.1 2.1 0 0 0-1.91-1.9c-.28-.03-.55 0-.83-.01a2.9 2.9 0 0 1-2.22-1.27c-.19-.26-.32-.58-.52-.83a1.1 1.1 0 0 0-.69-.39 3.92 3.92 0 0 0-.49-.01h-3.08Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M12 9.8a2.7 2.7 0 1 0 0 5.4 2.7 2.7 0 0 0 0-5.4Zm-4.5 2.7a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0Z" fill="currentColor"/></svg>',name:"camera_outline_24"}}},361865:(e,t,r)=>{"use strict";r.d(t,{getIcon24Cancel:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M7.54 6.26a.9.9 0 0 0-1.28 1.28L10.73 12l-4.47 4.46a.9.9 0 0 0 1.28 1.28L12 13.27l4.46 4.47a.9.9 0 1 0 1.28-1.28L13.27 12l4.47-4.46a.9.9 0 1 0-1.28-1.28L12 10.73 7.54 6.26Z"/></svg>',name:"cancel_24"}}},118593:(e,t,r)=>{"use strict";r.d(t,{getIcon24CloseFilled:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"/><path fill="currentColor" fill-rule="nonzero" d="M13.414 12l3.536-3.536a1 1 0 0 0-1.414-1.414L12 10.586 8.464 7.05A1 1 0 0 0 7.05 8.464L10.586 12 7.05 15.536a1 1 0 0 0 1.414 1.414L12 13.414l3.536 3.536a1 1 0 0 0 1.414-1.414L13.414 12z"/></g></svg>',name:"close_filled_24"}}},265242:(e,t,r)=>{"use strict";r.d(t,{getIcon24CrossedFilled:()=>i});var i=function(){return{icon:'<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m0 0h24v24h-24z"/><g fill="currentColor"><path d="m12.056 20c-.875 0-1.691-.114-2.448-.342-.757-.229-1.398-.5-1.923-.814l-.696.75h-.858l-.131-5.492h.868c.195.52.444 1.07.747 1.648a8.039 8.039 0 0 0 1.05 1.552c.41.478.87.867 1.377 1.167.508.3 1.102.45 1.781.45.915 0 1.617-.238 2.105-.713.487-.474.731-1.072.731-1.792 0-.592-.207-1.09-.62-1.493-.414-.403-1.055-.751-1.923-1.044-.565-.192-1.085-.37-1.56-.535-.474-.164-.92-.332-1.336-.503-.963-.407-1.678-.988-2.145-1.744-.468-.757-.702-1.602-.702-2.537 0-.592.122-1.161.364-1.707a4.522 4.522 0 0 1 1.06-1.471c.444-.407 1.012-.739 1.705-.996a6.456 6.456 0 0 1 2.26-.384c.795 0 1.538.116 2.231.348s1.238.465 1.635.7l.616-.641h.878l.08 5.18h-.867a20.506 20.506 0 0 0 -.712-1.707 7.501 7.501 0 0 0 -.863-1.45 3.979 3.979 0 0 0 -1.14-.99c-.43-.247-.935-.37-1.514-.37-.727 0-1.32.218-1.781.653s-.692.974-.692 1.616c0 .607.2 1.102.6 1.488.401.385 1.025.724 1.873 1.016.498.179 1.006.357 1.524.536.518.178.979.35 1.383.513.975.4 1.717.951 2.225 1.654s.762 1.574.762 2.617c0 .656-.145 1.291-.434 1.905a4.38 4.38 0 0 1 -1.17 1.53c-.539.45-1.161.796-1.868 1.038-.706.243-1.53.364-2.472.364z"/><path d="m2 11h20v2h-20z"/></g></g></svg>',name:"crossed_filled_24"}}},704914:(e,t,r)=>{"use strict";r.d(t,{getIcon24DotsVertical:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M9 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm2 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4-10a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm2 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm-2 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" clip-rule="evenodd"/></svg>',name:"dots_vertical_24"}}},325499:(e,t,r)=>{"use strict";r.d(t,{getIcon24Header1Filled:()=>i});var i=function(){return{icon:'<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m0 0h24v24h-24z"/><g fill="currentColor"><path d="m5 6h4v12h-4zm10 0h4v12h-4z"/><path d="m8 11h8v1h-8zm1 5.5c0 2.5 0 2.8 2 2.8v.7h-8v-.7c1.96 0 2-.3 2-2.71v-.09zm10 0c0 2.5 0 2.8 2 2.8v.7h-8v-.7c1.96 0 2-.3 2-2.71v-.09zm-10-9c0-2.5 0-2.8 2-2.8v-.7h-8v.7c1.96 0 2 .3 2 2.71v.09zm10 0c0-2.5 0-2.8 2-2.8v-.7h-8v.7c1.96 0 2 .3 2 2.71v.09z"/></g></g></svg>',name:"header1_filled_24"}}},840374:(e,t,r)=>{"use strict";r.d(t,{getIcon24Header2Filled:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"/><g fill="currentColor"><path d="M7 10h3v8H7zM10 13h4v1h-4z"/><path d="M10 17.015c0 1.99 0 2.288 1 2.288V20H6v-.697c1 0 1-.298 1-2.288 0-.02 1-.02 3 0zm7 0c0 1.99 0 2.288 1 2.288V20h-5v-.697c1 0 1-.298 1-2.288 0-.02 1-.02 3 0zM10 10.985c0-1.99 0-2.288 1-2.288V8H6v.697c1 0 1 .298 1 2.288 0 .02 1 .02 3 0zM17 10.985c0-1.99 0-2.288 1-2.288V8h-5v.697c1 0 1 .298 1 2.288 0 .02 1 .02 3 0z"/><path d="M14 10h3v8h-3z"/></g></g></svg>',name:"header2_filled_24"}}},887560:(e,t,r)=>{"use strict";r.d(t,{getIcon24ItalicFilled:()=>i});var i=function(){return{icon:'<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m0 0h24v24h-24z"/><path d="m6 20 .192-.823c.218-.008.515-.032.89-.073a4.42 4.42 0 0 0 .869-.164c.293-.098.516-.246.67-.445.155-.2.262-.43.322-.694l2.582-11.185a4.53 4.53 0 0 0 .079-.395c.015-.105.022-.184.022-.237 0-.315-.174-.561-.524-.738s-.885-.318-1.607-.423l.192-.823h8.874l-.192.823c-.24.015-.548.05-.924.107a5.816 5.816 0 0 0 -.846.175c-.308.098-.536.25-.682.457-.147.206-.25.438-.31.693l-2.582 11.197c-.03.128-.055.248-.074.36-.018.113-.028.2-.028.26 0 .376.175.637.524.784.35.146.89.253 1.619.32l-.192.824z" fill="currentColor"/></g></svg>',name:"italic_filled_24"}}},154313:(e,t,r)=>{"use strict";r.d(t,{getIcon24LinkFilled:()=>i});var i=function(){return{icon:'<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m0 0h24v24h-24z"/><path d="m0 0h24v24h-24z"/><g stroke="currentColor" stroke-linecap="round" stroke-width="1.75"><path d="m10 14 4-4"/><path d="m16.5 13.5c3-3 3.5-5.5 1.5-7.5s-4.5-1.5-7.5 1.5m-3 3c-3 3-3.5 5.5-1.5 7.5s4.5 1.5 7.5-1.5" stroke-linejoin="round"/></g></g></svg>',name:"link_filled_24"}}},219652:(e,t,r)=>{"use strict";r.d(t,{getIcon24ListBulletFilled:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5.9a.9.9 0 0 1 .9-.9h11.2a.9.9 0 1 1 0 1.8H8.9a.9.9 0 0 1-.9-.9ZM8 12a.9.9 0 0 1 .9-.9h11.2a.9.9 0 1 1 0 1.8H8.9A.9.9 0 0 1 8 12Zm0 6.1a.9.9 0 0 1 .9-.9h11.2a.9.9 0 1 1 0 1.8H8.9a.9.9 0 0 1-.9-.9ZM6 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm0 6a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM6 6a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"/></svg>',name:"list_bullet_filled_24"}}},611460:(e,t,r)=>{"use strict";r.d(t,{getIcon24ListNumberFilled:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5.9a.9.9 0 0 1 .9-.9h11.2a.9.9 0 0 1 0 1.8H8.9a.9.9 0 0 1-.9-.9ZM8 12a.9.9 0 0 1 .9-.9h11.2a.9.9 0 0 1 0 1.8H8.9A.9.9 0 0 1 8 12Zm0 6.1a.9.9 0 0 1 .9-.9h11.2a.9.9 0 0 1 0 1.8H8.9a.9.9 0 0 1-.9-.9ZM3.9 7.36c0 .41.2.64.55.64.35 0 .55-.23.55-.64V4.72C5 4.28 4.75 4 4.35 4a1.3 1.3 0 0 0-.7.23l-.37.24c-.18.13-.28.28-.28.45 0 .24.15.4.37.4.1 0 .2-.03.37-.14l.15-.1v2.28ZM3 13.52c0 .29.22.48.52.48h1.95c.33 0 .53-.17.53-.46 0-.3-.2-.47-.53-.47h-.93v-.05l.66-.6c.44-.41.66-.82.66-1.24 0-.68-.6-1.18-1.42-1.18-.78 0-1.44.5-1.44 1.06 0 .25.19.44.46.44.19 0 .3-.08.48-.3.15-.18.27-.25.44-.25.21 0 .37.14.37.35 0 .2-.13.38-.42.66l-.86.83c-.34.33-.46.52-.46.74Zm0 5.55c0 .52.64.93 1.43.93.92 0 1.57-.49 1.57-1.18 0-.5-.32-.87-.77-.9v-.08c.38-.03.67-.38.67-.8 0-.61-.6-1.04-1.46-1.04-.78 0-1.43.4-1.43.88 0 .25.2.43.45.43a.6.6 0 0 0 .43-.18c.2-.2.35-.27.53-.27.24 0 .42.14.42.33 0 .2-.18.33-.42.33h-.15c-.22 0-.38.2-.38.43 0 .26.16.44.38.44h.15c.3 0 .48.15.48.38 0 .22-.19.37-.48.37-.2 0-.38-.09-.56-.28-.15-.17-.29-.24-.44-.24-.24 0-.42.19-.42.45Z"/></svg>',name:"list_number_filled_24"}}},275419:(e,t,r)=>{"use strict";r.d(t,{getIcon24ObjectBiggerFilled:()=>i});var i=function(){return{icon:'<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"/><path d="M4 8h16a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1zm3 10h10a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2zM7 4h10a1 1 0 0 1 0 2H7a1 1 0 1 1 0-2z" fill="currentColor"/></g></svg>',name:"object_bigger_filled_24"}}},826383:(e,t,r)=>{"use strict";r.d(t,{getIcon24ObjectCoverFilled:()=>i});var i=function(){return{icon:'<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"/><path d="M3 4h18a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1zm4 14h10a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2z" fill="currentColor"/></g></svg>',name:"object_cover_filled_24"}}},713137:(e,t,r)=>{"use strict";r.d(t,{getIcon24ObjectInlineFilled:()=>i});var i=function(){return{icon:'<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"/><path d="M6 9h4a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1zm0 8h12a1 1 0 0 1 0 2H6a1 1 0 0 1 0-2zm8-8h4a1 1 0 0 1 0 2h-4a1 1 0 1 1 0-2zm0 4h4a1 1 0 0 1 0 2h-4a1 1 0 1 1 0-2zM6 5h12a1 1 0 0 1 0 2H6a1 1 0 1 1 0-2z" fill="currentColor"/></g></svg>',name:"object_inline_filled_24"}}},563365:(e,t,r)=>{"use strict";r.d(t,{getIcon24ObjectTextFilled:()=>i});var i=function(){return{icon:'<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"/><path d="M7 18h10a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2zM7 8h10a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1zm0-4h10a1 1 0 0 1 0 2H7a1 1 0 1 1 0-2z" fill="currentColor"/></g></svg>',name:"object_text_filled_24"}}},387685:(e,t,r)=>{"use strict";r.d(t,{getIcon24QuoteFilled:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"/><path fill="currentColor" d="M10.972 10l.01.14a3.54 3.54 0 0 1 .017.453l.001.157c0 4.28-2.686 7.75-6 7.75a.127.127 0 0 1-.063-.238c1.279-.73 2.132-1.464 2.558-2.203a5.474 5.474 0 0 0 .707-2.13A3.5 3.5 0 1 1 7.5 7a3.515 3.515 0 0 1 3.472 3.001zm9 0l.01.14a3.54 3.54 0 0 1 .017.453l.001.157c0 4.28-2.686 7.75-6 7.75a.127.127 0 0 1-.063-.238c1.279-.73 2.132-1.464 2.558-2.203a5.474 5.474 0 0 0 .707-2.13A3.5 3.5 0 1 1 16.5 7a3.515 3.515 0 0 1 3.472 3.001z"/></g></svg>',name:"quote_filled_24"}}},310469:(e,t,r)=>{"use strict";r.d(t,{getIcon24WarningFilled:()=>i});var i=function(){return{icon:'<svg height="24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m0 0h24v24h-24z"/><path d="m1.354 19.382c-.814 1.446-.136 2.618 1.523 2.618h18.246c1.655 0 2.337-1.173 1.523-2.618l-9.172-16.294c-.814-1.446-2.134-1.445-2.948 0z" fill="#ffae38"/><path d="m12.675 15.5h-1.35l-.075-7.5h1.5zm-.675 3a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5z" fill="#fff"/></g></svg>',name:"warning_filled_24"}}},669783:(e,t,r)=>{"use strict";r.d(t,{getIcon28GifOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 28 28"><path fill-rule="evenodd" d="M11.6 6h4.8c1.71 0 2.88 0 3.78.07.87.08 1.32.2 1.64.37a4 4 0 0 1 1.74 1.74c.16.32.3.76.36 1.64.08.9.08 2.07.08 3.78v.8c0 1.71 0 2.88-.08 3.78-.07.88-.2 1.32-.36 1.64a4 4 0 0 1-1.74 1.74c-.32.16-.77.3-1.64.36-.9.08-2.07.08-3.78.08h-4.8c-1.71 0-2.88 0-3.78-.07a4.33 4.33 0 0 1-1.64-.37 4 4 0 0 1-1.74-1.74 4.28 4.28 0 0 1-.36-1.64C4 17.28 4 16.1 4 14.4v-.8c0-1.71 0-2.88.07-3.78.08-.88.2-1.32.37-1.64a4 4 0 0 1 1.74-1.74c.32-.16.77-.3 1.64-.36C8.72 6 9.9 6 11.6 6ZM2 13.6c0-3.36 0-5.04.65-6.32a6 6 0 0 1 2.63-2.63C6.56 4 8.24 4 11.6 4h4.8c3.36 0 5.04 0 6.32.65a6 6 0 0 1 2.63 2.63c.65 1.28.65 2.96.65 6.32v.8c0 3.36 0 5.04-.65 6.32a6 6 0 0 1-2.63 2.63c-1.28.65-2.96.65-6.32.65h-4.8c-3.36 0-5.04 0-6.32-.65a6 6 0 0 1-2.63-2.63C2 19.44 2 17.76 2 14.4v-.8ZM9.24 10c-.98 0-1.79.37-2.35.97S6 12.43 6 13.48v1c0 1.1.33 1.97.9 2.58.55.6 1.37.94 2.39.94.9 0 1.67-.29 2.2-.8.54-.5.85-1.21.85-2.06v-.46c0-.36-.08-.64-.26-.82-.19-.19-.46-.27-.82-.27h-1.3a.85.85 0 0 0-.57.18.7.7 0 0 0-.24.53c0 .23.11.42.25.55.14.12.33.15.57.15h.57v.25c0 .32-.11.61-.32.8-.2.19-.5.3-.87.3-.46 0-.82-.17-1.05-.47a2.26 2.26 0 0 1-.38-1.4v-.9c0-.63.13-1.1.37-1.4.24-.3.6-.47 1.08-.47.64 0 1.01.4 1.43.83l.02.02a.74.74 0 0 0 .57.26.77.77 0 0 0 .57-.23c.14-.14.2-.35.2-.59 0-.47-.32-.97-.8-1.33A3.42 3.42 0 0 0 9.24 10Zm5.37 0c-.3 0-.53.09-.7.28-.16.18-.24.42-.24.75v5.9c0 .32.08.58.25.76.17.19.4.31.7.31a.9.9 0 0 0 .7-.3c.16-.2.24-.45.24-.78v-5.9c0-.32-.08-.56-.24-.74a.9.9 0 0 0-.7-.28Zm2.64.45c.19-.2.51-.29.85-.29h3.11c.45 0 .79.35.79.82a.77.77 0 0 1-.79.8H19v1.65h1.97a.68.68 0 0 1 .52.22.82.82 0 0 1 .24.57c0 .23-.1.43-.24.57a.68.68 0 0 1-.52.21H19v1.92c0 .33-.04.6-.2.78-.16.19-.51.3-.8.3-.3 0-.58-.11-.75-.3a1.13 1.13 0 0 1-.25-.78v-5.64c0-.35.06-.63.25-.83Z" clip-rule="evenodd"/></svg>',name:"gif_outline_28"}}},60726:(e,t,r)=>{"use strict";r.d(t,{getIcon28MarketOutline:()=>i});var i=function(){return{icon:'<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21.15 8c1.34 0 1.83.14 2.32.4.48.26.87.65 1.13 1.13l.1.19c.2.44.3.96.3 2.13v7.68c-.04 2.02-.3 2.83-.73 3.66a5 5 0 0 1-2.08 2.08c-.9.47-1.79.73-4.24.73H9.47c-2.02-.04-2.83-.3-3.66-.73a5 5 0 0 1-2.08-2.08c-.45-.86-.7-1.71-.73-3.94v-7.4c0-1.34.14-1.83.4-2.32.26-.48.65-.87 1.13-1.13l.19-.1c.4-.18.88-.28 1.88-.3h14.55Zm0 2H6.5c-.63.01-.82.06-1.01.16a.73.73 0 0 0-.32.32c-.1.2-.15.42-.16 1.18v7.29c0 1.93.13 2.6.5 3.3a3 3 0 0 0 1.26 1.25c.69.37 1.36.5 3.3.5h7.89c1.93 0 2.6-.13 3.3-.5a3 3 0 0 0 1.25-1.26c.37-.69.5-1.36.5-3.3v-7.1c0-.91-.04-1.14-.16-1.36a.73.73 0 0 0-.32-.32c-.2-.1-.38-.15-1.01-.16h-.36ZM19 12a1 1 0 1 1 0 2 1 1 0 0 1 0-2ZM9 12a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm5-10a6 6 0 0 1 6 6h-2a4 4 0 0 0-8 0H8a6 6 0 0 1 6-6Z" fill="currentColor"/></svg>',name:"market_outline_28"}}},980889:(e,t,r)=>{"use strict";r.d(t,{getIcon28MusicOutline:()=>i});var i=function(){return{icon:'<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="music_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="music_outline_28__music_outline_28"><path d="M0 0h28v28H0z"/><path d="M11 16.93v2.46c0 4.7-4.58 7.1-7.07 4.61-2.5-2.49-.08-7.07 4.6-7.07H11Zm-2 2h-.46c-3.02 0-4.34 2.52-3.2 3.66C6.48 23.73 9 22.4 9 19.39v-.46Zm10.39-15.4A3 3 0 0 1 23 6.45v10.43c0 4.7-4.58 7.1-7.07 4.61-2.5-2.49-.08-7.07 4.6-7.07H21v-4.7L11 11.8V18H9V8.92c0-.95.08-1.43.31-1.96.23-.5.56-.9 1-1.23.47-.33.93-.51 1.85-.7ZM21 16.42h-.46c-3.02 0-4.34 2.52-3.2 3.66 1.14 1.14 3.66-.18 3.66-3.2v-.46Zm-.02-10.17a1 1 0 0 0-1.18-.78l-7.23 1.5c-.67.15-.88.23-1.08.37-.16.12-.27.25-.35.43-.1.23-.14.45-.14 1.14v.85l10-2.08V6.46a1 1 0 0 0 0-.1Z" id="music_outline_28__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"music_outline_28"}}},316178:(e,t,r)=>{"use strict";r.d(t,{getIcon28PictureOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 28 28"><path d="M12 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM6.07 3.8c1.1-.58 2.17-.8 4.62-.8h6.62c2.45 0 3.52.22 4.62.8a5.46 5.46 0 0 1 2.27 2.27c.58 1.1.8 2.17.8 4.62v6.62c0 2.45-.22 3.53-.8 4.62a5.46 5.46 0 0 1-2.27 2.27c-1.1.59-2.17.8-4.62.8h-6.62c-2.45 0-3.52-.21-4.62-.8a5.46 5.46 0 0 1-2.27-2.27c-.58-1.1-.8-2.17-.8-4.62v-6.62c0-2.45.22-3.52.8-4.62A5.47 5.47 0 0 1 6.07 3.8ZM10.69 5c-2.33 0-3.02.21-3.68.56a3.47 3.47 0 0 0-1.45 1.45C5.21 7.67 5 8.36 5 10.7v6.62c0 1.67.1 2.5.3 3.07l2.7-2.7c.37-.37.69-.7.97-.94.3-.25.63-.48 1.03-.6a3 3 0 0 1 1.85-.01c.4.12.73.35 1.03.6.27.23.57.52.92.86l2.93-2.9c.37-.38.7-.7.98-.94.3-.25.63-.48 1.04-.61a3 3 0 0 1 1.85 0c.4.13.73.36 1.03.62.28.24.6.56.98.93l.39.4v-4.4c0-2.33-.21-3.02-.57-3.68A3.47 3.47 0 0 0 21 5.57C20.33 5.2 19.64 5 17.3 5h-6.62ZM23 17.9l-1.77-1.77c-.4-.4-.67-.66-.89-.85-.2-.17-.3-.22-.35-.23a1 1 0 0 0-.62 0c-.05.01-.15.05-.36.23-.22.18-.48.44-.89.85l-3.6 3.58a1 1 0 0 1-1.4 0l-.62-.6a16.8 16.8 0 0 0-.89-.84c-.2-.18-.3-.22-.36-.24a1 1 0 0 0-.61 0c-.06.02-.15.06-.36.24s-.48.44-.88.85l-2.94 2.94c.17.14.36.27.56.37.66.36 1.35.57 3.68.57h6.62c2.33 0 3.02-.21 3.68-.57A3.47 3.47 0 0 0 22.44 21c.32-.6.52-1.22.56-3.08Z" clip-rule="evenodd"/></svg>',name:"picture_outline_28"}}},861626:(e,t,r)=>{"use strict";r.d(t,{getIcon28PollSquareOutline:()=>i});var i=function(){return{icon:'<svg width="28" height="28" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><g id="poll_square_outline_28__Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="poll_square_outline_28__poll_square_outline_28"><path id="poll_square_outline_28__poll_outline_28" d="M0 0h28v28H0z"/><path d="M10.7 5c-2.14 0-2.9.15-3.69.57-.63.33-1.1.81-1.44 1.44C5.15 7.8 5 8.56 5 10.7v6.62c0 2.13.15 2.9.57 3.68.33.63.81 1.1 1.44 1.44.78.42 1.55.57 3.68.57h6.62c2.13 0 2.9-.15 3.68-.57A3.45 3.45 0 0 0 22.43 21c.42-.78.57-1.55.57-3.68v-6.62c0-2.13-.15-2.9-.57-3.68A3.45 3.45 0 0 0 21 5.57C20.2 5.15 19.44 5 17.3 5h-6.62Zm0-2h6.6c2.68 0 3.65.28 4.63.8a5.45 5.45 0 0 1 2.27 2.27c.52.98.8 1.95.8 4.62v6.62c0 2.67-.28 3.64-.8 4.62a5.45 5.45 0 0 1-2.27 2.27c-.98.52-1.95.8-4.62.8h-6.62c-2.67 0-3.64-.28-4.62-.8a5.45 5.45 0 0 1-2.27-2.27c-.52-.98-.8-1.95-.8-4.62v-6.62c0-2.67.28-3.64.8-4.62A5.45 5.45 0 0 1 6.07 3.8c.98-.52 1.95-.8 4.62-.8Zm.3 16a1 1 0 0 1-2 0v-6a1 1 0 0 1 2 0v6Zm4 0a1 1 0 0 1-2 0V9a1 1 0 0 1 2 0v10Zm4 0a1 1 0 0 1-2 0v-4a1 1 0 0 1 2 0v4Z" id="poll_square_outline_28__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"poll_square_outline_28"}}},298484:(e,t,r)=>{"use strict";r.d(t,{getIcon28QuoteOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 28 28"><path fill-rule="evenodd" d="M4 7a1 1 0 0 1 1-1h18a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1Zm6.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm5 0a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm3.5 1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM5 20a1 1 0 1 0 0 2h18a1 1 0 1 0 0-2H5Z" clip-rule="evenodd"/></svg>',name:"quote_outline_28"}}},162129:(e,t,r)=>{"use strict";r.d(t,{getIcon28TablecellsOutline:()=>i});var i=function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 28 28"><path fill-rule="evenodd" d="M9.7 4c-2.46 0-3.53.22-4.63.8A5.47 5.47 0 0 0 2.8 7.07c-.58 1.1-.8 2.17-.8 4.62v4.62c0 2.45.22 3.53.8 4.62a5.46 5.46 0 0 0 2.27 2.27c1.1.58 2.17.8 4.62.8h8.62c2.45 0 3.53-.22 4.62-.8a5.46 5.46 0 0 0 2.27-2.27c.59-1.1.8-2.17.8-4.62v-4.62c0-2.45-.21-3.52-.8-4.62a5.46 5.46 0 0 0-2.27-2.27c-1.1-.58-2.17-.8-4.62-.8H9.69ZM6 6.56C6.67 6.21 7.36 6 9.7 6H13v4H4.05a4.5 4.5 0 0 1 .51-1.99 3.47 3.47 0 0 1 1.45-1.44ZM13 12H4v4h9v-4Zm2 4v-4h9v4h-9Zm-2 2H4.05a4.5 4.5 0 0 0 .51 1.99 3.47 3.47 0 0 0 1.45 1.45c.66.35 1.35.56 3.68.56H13v-4Zm2 4v-4h8.95a4.5 4.5 0 0 1-.51 1.99 3.47 3.47 0 0 1-1.45 1.45c-.66.35-1.35.56-3.68.56H15Zm0-12V6h3.3c2.34 0 3.03.21 3.69.56a3.47 3.47 0 0 1 1.45 1.45c.24.47.42.94.5 1.99H15Z" clip-rule="evenodd"/></svg>',name:"tablecells_outline_28"}}},262004:(e,t,r)=>{"use strict";r.d(t,{getIcon28VideoCircleOutline:()=>i});var i=function(){return{icon:'<svg fill="none" height="28" viewBox="0 0 28 28" width="28" xmlns="http://www.w3.org/2000/svg"><g clip-rule="evenodd" fill="currentColor" fill-rule="evenodd"><path d="M18.08 15.65c.26-.18.57-.44.75-.84a2 2 0 0 0 0-1.62 2.1 2.1 0 0 0-.75-.84c-.25-.18-.58-.37-.94-.58l-2.78-1.6c-.36-.21-.69-.4-.97-.53a2.1 2.1 0 0 0-1.1-.23 2 2 0 0 0-1.4.82 2.1 2.1 0 0 0-.36 1.06c-.03.31-.03.7-.03 1.1v3.21c0 .42 0 .8.03 1.1.03.32.1.72.35 1.07a2 2 0 0 0 1.41.82c.44.04.82-.1 1.1-.23.28-.13.61-.32.97-.53l2.78-1.6c.36-.2.69-.4.94-.58zm-1.98-2.17c.41.24.66.38.83.5l.02.02-.02.02c-.17.12-.42.26-.83.5l-2.7 1.56c-.41.24-.66.38-.85.46l-.03.02v-.04c-.02-.2-.02-.49-.02-.96v-3.12a12.25 12.25 0 0 1 .02-1l.03.02c.19.08.44.22.85.46z"/><path d="M26 14a12 12 0 1 1-24 0 12 12 0 0 1 24 0zm-2 0a10 10 0 1 1-20 0 10 10 0 0 1 20 0z"/></g></svg>',name:"video_circle_outline_28"}}},157307:(e,t,r)=>{"use strict";r.d(t,{getIcon36CarouselLeftFilled:()=>i});var i=function(){return{icon:'<svg height="36" viewBox="0 0 24 36" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="a" d="m19.644 16.147-12.86-12.798a1.226 1.226 0 0 0 -1.72.006l-.702.7a1.2 1.2 0 0 0 -.006 1.712l11.287 11.233-11.287 11.233a1.2 1.2 0 0 0 .006 1.712l.702.7a1.226 1.226 0 0 0 1.72.006l12.86-12.798a1.198 1.198 0 0 0 0-1.706z"/><filter id="b" height="142.9%" width="175%" x="-37.5%" y="-17.9%"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feGaussianBlur in="shadowOffsetOuter1" result="shadowBlurOuter1" stdDeviation="1.5"/><feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"/><feColorMatrix in="shadowBlurOuter1" result="shadowMatrixOuter1" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"/><feMorphology in="SourceAlpha" operator="dilate" radius=".5" result="shadowSpreadOuter2"/><feOffset in="shadowSpreadOuter2" result="shadowOffsetOuter2"/><feComposite in="shadowOffsetOuter2" in2="SourceAlpha" operator="out" result="shadowOffsetOuter2"/><feColorMatrix in="shadowOffsetOuter2" result="shadowMatrixOuter2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"/><feMerge><feMergeNode in="shadowMatrixOuter1"/><feMergeNode in="shadowMatrixOuter2"/></feMerge></filter></defs><g fill="none" fill-rule="evenodd" transform="matrix(-1 0 0 1 24 0)"><use fill="#000" filter="url(#b)" xlink:href="#a"/><use fill="#fff" fill-opacity=".7" xlink:href="#a"/></g></svg>',name:"carousel_left_filled_36"}}},120476:(e,t,r)=>{"use strict";r.d(t,{getIcon36CarouselRightFilled:()=>i});var i=function(){return{icon:'<svg height="36" viewBox="0 0 24 36" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="a" d="m19.644 16.147-12.86-12.798a1.226 1.226 0 0 0 -1.72.006l-.702.7a1.2 1.2 0 0 0 -.006 1.712l11.287 11.233-11.287 11.233a1.2 1.2 0 0 0 .006 1.712l.702.7a1.226 1.226 0 0 0 1.72.006l12.86-12.798a1.198 1.198 0 0 0 0-1.706z"/><filter id="b" height="142.9%" width="175%" x="-37.5%" y="-17.9%"><feOffset dy="1" in="SourceAlpha" result="shadowOffsetOuter1"/><feGaussianBlur in="shadowOffsetOuter1" result="shadowBlurOuter1" stdDeviation="1.5"/><feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"/><feColorMatrix in="shadowBlurOuter1" result="shadowMatrixOuter1" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"/><feMorphology in="SourceAlpha" operator="dilate" radius=".5" result="shadowSpreadOuter2"/><feOffset in="shadowSpreadOuter2" result="shadowOffsetOuter2"/><feComposite in="shadowOffsetOuter2" in2="SourceAlpha" operator="out" result="shadowOffsetOuter2"/><feColorMatrix in="shadowOffsetOuter2" result="shadowMatrixOuter2" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"/><feMerge><feMergeNode in="shadowMatrixOuter1"/><feMergeNode in="shadowMatrixOuter2"/></feMerge></filter></defs><g fill="none" fill-rule="evenodd"><use fill="#000" filter="url(#b)" xlink:href="#a"/><use fill="#fff" fill-opacity=".7" xlink:href="#a"/></g></svg>',name:"carousel_right_filled_36"}}},929416:(e,t,r)=>{"use strict";r.d(t,{getIcon48Loader:()=>i});var i=function(){return{icon:'<svg height="48" viewBox="0 0 48 48" width="48" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m0 0h48v48h-48z"/><circle cx="24" cy="24" opacity=".5" r="16" stroke="#2a5885" stroke-dasharray="72" stroke-linecap="round" stroke-width="3"/></g></svg>',name:"loader_48"}}},975624:(e,t,r)=>{"use strict";r.d(t,{getIcon48LoaderWhite:()=>i});var i=function(){return{icon:'<svg width="48" height="48" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h48v48H0z"/><circle stroke="#FFF" stroke-width="4" stroke-linecap="round" stroke-dasharray="72" cx="24" cy="24" r="16"/></g></svg>',name:"loader_white_48"}}},489313:(e,t,r)=>{"use strict";r.d(t,{Table:()=>i.Table,Row:()=>a.Row,Cell:()=>n.Cell,model:()=>o});var i=r(591215),a=r(149638),n=r(782957),o=r(538695)},691752:(e,t,r)=>{"use strict";r.d(t,{DnD:()=>n});var i=r(390237),a=r(749140),n=function(){function e(e,t){this.container=e,this.opts=t,this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.container.addEventListener("mousedown",this.handleMouseDown)}return e.prototype.handleMouseDown=function(e){var t=this;if(e.currentTarget instanceof Node&&e.target instanceof Node&&0===e.button){var r=(0,i.traverseParent)(e.target,(function(e){if(t.opts.isDraggableHandle(e))return e}));if(r&&r instanceof HTMLElement&&(this.draggableHandle=r,this.draggable=this.opts.getDraggable(this.draggableHandle),this.draggable)){var a=this.draggable.getBoundingClientRect();this.mouseXRelatedToMirror=e.pageX-a.left,this.mouseYRelatedToMirror=e.pageY-a.top,this.mouseDown=!0,document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}}},e.prototype.handleMouseMove=function(e){var t,r;if(this.mouseDown&&"number"==typeof this.mouseXRelatedToMirror&&"number"==typeof this.mouseYRelatedToMirror&&this.draggable&&this.draggableHandle){if(this.isDraggingStarted){var i=!1;this.nextDraggable&&this.mirror&&this.isFurther(this.mirror,this.nextDraggable)?(this.prevDraggable=this.nextDraggable,this.nextDraggable=(null===(t=this.nextDraggable)||void 0===t?void 0:t.nextElementSibling)||null,i=!0):this.prevDraggable&&this.mirror&&this.isFurther(this.prevDraggable,this.mirror)&&(this.nextDraggable=this.prevDraggable,this.prevDraggable=(null===(r=this.prevDraggable)||void 0===r?void 0:r.previousElementSibling)||null,i=!0),i&&this.opts.onIntersection&&this.opts.onIntersection(this.draggable,this.prevDraggable,this.nextDraggable)}else this.isDraggingStarted=!0,this.mirror=(0,a.createElement)('<div class="ArticleDndMirror"></div>'),this.opts.mirrorContainer.appendChild(this.mirror),this.opts.onDrag&&this.opts.onDrag(this.draggable,this.mirror,this.draggableHandle),this.prevDraggable=this.draggable.previousElementSibling,this.nextDraggable=this.draggable.nextElementSibling;this.mirror&&(this.mirror.style.position="fixed",this.mirror.style.top="0px",this.mirror.style.left="0px",this.mirror.style.transform="translate("+(e.pageX-this.mouseXRelatedToMirror)+"px, "+(e.pageY-this.mouseYRelatedToMirror)+"px)")}},e.prototype.handleMouseUp=function(){this.mouseDown=!1,this.mirror&&this.isDraggingStarted&&this.draggable&&(this.opts.onDrop&&this.opts.onDrop(this.draggable,this.prevDraggable,this.nextDraggable),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.mirror.style.removeProperty("top"),this.mirror.style.removeProperty("left"),this.mirror.style.removeProperty("position"),this.mouseXRelatedToMirror=null,this.mouseYRelatedToMirror=null,this.isDraggingStarted=!1,this.draggableHandle=null,this.draggable=null,this.prevDraggable=null,this.nextDraggable=null,this.mirror.remove())},e.prototype.isFurther=function(e,t){var r=e.getBoundingClientRect(),i=t.getBoundingClientRect();return"vertical"===this.opts.direction?r.top+r.height/2>i.top+i.height/2:"horizontal"===this.opts.direction&&r.left+r.width/2>i.left+i.width/2},e.prototype.destroy=function(){this.container.removeEventListener("mousedown",this.handleMouseDown),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)},e}()},832612:(e,t,r)=>{"use strict";r.d(t,{GridSelection:()=>a});var i=r(390237),a=function(){function e(e,t){this.mode=null,this.initialItem=null,this.curItem=null,this.selectedRows=[],this.selectedColumns=[],this.started=!1,this.gridEl=e,this.opts=t,this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.gridEl.addEventListener("mousedown",this.handleMouseDown)}return e.prototype.handleChange=function(){this.opts.onChange&&this.opts.onChange({mode:this.mode,initialItem:this.initialItem,curItem:this.curItem,selectedRows:this.selectedRows,selectedColumns:this.selectedColumns})},e.prototype.handleOnStart=function(e){this.opts.onStart&&this.opts.onStart(e)},e.prototype.handleOnFinish=function(){this.opts.onFinish&&this.opts.onFinish()},e.prototype.getItemByEvent=function(e){var t=this;return e.target instanceof Node&&(0,i.traverseParent)(e.target,(function(e){if(t.opts.isGridItem(e))return!0}))},e.prototype.handleMouseDown=function(e){if(0===e.button){var t=this.getItemByEvent(e);t&&t instanceof HTMLElement&&(this.initialItem=t,this.curItem=t,document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp))}},e.prototype.handleMouseMove=function(e){if(this.initialItem){this.started||(this.started=!0,this.handleOnStart(this.initialItem));var t=this.getItemByEvent(e);if(t&&t!==this.curItem&&t instanceof HTMLElement){if(t===this.initialItem)return this.curItem!==this.initialItem?(this.mode=null,this.curItem=t,this.selectedRows=[],this.selectedColumns=[],void this.handleChange()):void 0;this.curItem=t;var r=this.opts.getGridPosition(this.initialItem),i=this.opts.getGridPosition(t);if(this.mode||(i.rowIndex!==r.rowIndex&&i.columnIndex===r.columnIndex?this.mode="column":this.mode="row"),"row"===this.mode){var a=Math.min(r.rowIndex,i.rowIndex),n=Math.max(r.rowIndex,i.rowIndex);this.selectedRows=Array.from({length:n-a+1},(function(e,t){return t+a})),this.handleChange()}else if("column"===this.mode){var o=Math.min(r.columnIndex,i.columnIndex);n=Math.max(r.columnIndex,i.columnIndex);this.selectedColumns=Array.from({length:n-o+1},(function(e,t){return t+o})),this.handleChange()}}}},e.prototype.handleMouseUp=function(){this.mode=null,this.initialItem=null,this.curItem=null,this.selectedRows=[],this.selectedColumns=[],this.started=!1,document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.handleOnFinish()},e}()},538695:(e,t,r)=>{"use strict";r.r(t),r.d(t,{buildTextParagraph:()=>o,buildRow:()=>s,buildCell:()=>l,buildTable:()=>d,buildEmptyCell:()=>c,buildDefaultTable:()=>h,addColumnAfter:()=>p,removeColumn:()=>u,moveColumns:()=>g,addRowAfter:()=>m,removeRow:()=>v,moveRows:()=>_,setHeader:()=>f,setColumnWidth:()=>y,changeColumnColor:()=>b,changeCellRowColor:()=>C,changeCellColumnColor:()=>w,changeRowColor:()=>E});var i=r(570655),a=r(83178),n=r(650588),o=function(e,t){return e.buildParagraph({type:n.ParagraphType.Text,lines:[{brs:[],decorations:{},text:""}],parentId:t})},s=function(e,t){return e.buildParagraph({type:n.ParagraphType.TableRow,lines:[],children:[],parentId:t})},l=function(e,t){return e.buildParagraph({type:n.ParagraphType.TableCell,lines:[],children:[],parentId:t})},d=function(e){return e.buildParagraph({type:n.ParagraphType.Table,lines:[],children:[],table_columns_count:a.TABLE_DEFAULT_COLUMNS_COUNT,table_columns_width:Array(a.TABLE_DEFAULT_COLUMNS_COUNT).fill(a.TABLE_CELL_INITIAL_WIDTH),table_columns_resized:Array(a.TABLE_DEFAULT_COLUMNS_COUNT).fill(!1),table_has_row_header:!1})},c=function(e,t){var r=l(e,t),i=o(e,r.id);return r.children=[i.id],r},h=function(e){var t,r,n=d(e),o=(0,i.__spreadArray)([],(0,i.__read)(Array(a.TABLE_DEFAULT_ROWS_COUNT).keys()),!1).map((function(){return s(e,n.id)}));n.children=o.map((function(e){return e.id}));var l=function(t){var r=(0,i.__spreadArray)([],(0,i.__read)(Array(a.TABLE_DEFAULT_COLUMNS_COUNT).keys()),!1).map((function(){return c(e,t.id)}));t.children=r.map((function(e){return e.id}))};try{for(var h=(0,i.__values)(o),p=h.next();!p.done;p=h.next()){l(p.value)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}return n},p=function(e,t,r){var n,o,s;try{for(var l=(0,i.__values)(t.children),d=l.next();!d.done;d=l.next()){var h=d.value,p=e.getParagraphById(h);if(p){var u=c(e,h);null===(s=p.children)||void 0===s||s.splice(r+1,0,u.id)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}t.table_columns_width.splice(r+1,0,a.TABLE_CELL_DEFAULT_WIDTH),t.table_columns_count++,t.table_columns_resized.splice(r+1,0,!1)},u=function(e,t,r,a){var n,o,s,l;try{for(var d=(0,i.__values)(t.children),c=d.next();!c.done;c=d.next()){var h=c.value,p=e.getParagraphById(h);if(p){var u=(p.children||[]).splice(r,a);try{for(var g=(s=void 0,(0,i.__values)(u)),m=g.next();!m.done;m=g.next()){var v=m.value;e.forgetParagraphById(v)}}catch(e){s={error:e}}finally{try{m&&!m.done&&(l=g.return)&&l.call(g)}finally{if(s)throw s.error}}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}t.table_columns_width.splice(r,a),t.table_columns_count-=a,t.table_columns_resized.splice(r,a)},g=function(e,t,r,a,n){var o,s,l,d,c;if(r!==n){try{for(var h=(0,i.__values)(t.children),p=h.next();!p.done;p=h.next()){var u=p.value,g=e.getParagraphById(u);if(g){var m=g.children.splice(r,a);(l=g.children).splice.apply(l,(0,i.__spreadArray)([n,0],(0,i.__read)(m),!1))}}}catch(e){o={error:e}}finally{try{p&&!p.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}var v=t.table_columns_width.splice(r,a);(d=t.table_columns_width).splice.apply(d,(0,i.__spreadArray)([n,0],(0,i.__read)(v),!1));var _=t.table_columns_resized.splice(r,a);(c=t.table_columns_resized).splice.apply(c,(0,i.__spreadArray)([n,0],(0,i.__read)(_),!1))}},m=function(e,t,r){var i=s(e,t.id),a=Array.from({length:t.table_columns_count},(function(){return c(e,i.id)}));i.children=a.map((function(e){return e.id})),t.children.splice(r+1,0,i.id)},v=function(e,t,r,a){var n,o,s=t.children.splice(r,a);try{for(var l=(0,i.__values)(s),d=l.next();!d.done;d=l.next()){var c=d.value;e.forgetParagraphById(c)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}},_=function(e,t,r,a,n){var o;if(r!==n){var s=t.children.splice(r,a);(o=t.children).splice.apply(o,(0,i.__spreadArray)([n,0],(0,i.__read)(s),!1))}},f=function(e,t,r){t.table_has_row_header=r},y=function(e,t,r,i,a){void 0===a&&(a=!1);var n=t.children[0];e.getParagraphById(n)&&(a&&(t.table_columns_resized[r]=!0),t.table_columns_width[r]=i)},b=function(e,t,r,i){for(var a=0;a<t.children.length;a++)if(0!==a||!t.table_has_row_header||"standard"===i){var n=t.children[a],o=e.getParagraphById(n);if(o){var s=e.getParagraphById(o.children[r]);s&&(i?s.table_bg_color_column=i:delete s.table_bg_color_column)}}},C=function(e,t,r,i,a){var n=t.children[r],o=e.getParagraphById(n);if(o){var s=e.getParagraphById(o.children[i]);s&&(s.table_bg_color_row=a)}},w=function(e,t,r,i,a){var n=t.children[r],o=e.getParagraphById(n);if(o){var s=e.getParagraphById(o.children[i]);s&&(s.table_bg_color_column=a)}},E=function(e,t,r,a){var n,o,s=t.children[r],l=e.getParagraphById(s);if(l)try{for(var d=(0,i.__values)(l.children),c=d.next();!c.done;c=d.next()){var h=c.value,p=e.getParagraphById(h);p&&(a?p.table_bg_color_row=a:delete p.table_bg_color_row)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}}},326445:(e,t,r)=>{"use strict";r.d(t,{AddButton:()=>o});var i=r(749140),a=r(83178),n=r(532289),o=function(){function e(){this.el=null}return e.prototype.handleClick=function(e){this.onClick&&this.onClick(e)},e.prototype.handleMouseEnter=function(e){this.onMouseEnter&&this.onMouseEnter(e)},e.prototype.handleMouseLeave=function(e){this.onMouseLeave&&this.onMouseLeave(e)},e.prototype.render=function(){return this.el=(0,i.createElement)('\n        <div class="ArticleTableAddButton '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false">\n            <div class="ArticleTableAddButton__point '+a.ArticleEditorInnerComponentsClass+'"></div>\n            <div class="ArticleTableAddButton__shape '+a.ArticleEditorInnerComponentsClass+'">\n                <div class="ArticleTableAddButton__shape_icon '+a.ArticleEditorInnerComponentsClass+'">'+(0,n.getIcon16Add)().icon+"</div>\n            </div>\n        </div>\n    "),this.el.addEventListener("click",this.handleClick.bind(this)),this.el.addEventListener("mouseenter",this.handleMouseEnter.bind(this)),this.el.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.el},e}()},825477:(e,t,r)=>{"use strict";r.d(t,{AddMultipleButton:()=>o});var i=r(749140),a=r(532289),n=r(83178),o=function(){function e(e){this.el=null,this.initialMouseX=0,this.initialMouseY=0,this.lastTriggeredMouseX=0,this.lastTriggeredMouseY=0,this.started=!1,this.opts=e,this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this)}return e.prototype.handleStart=function(){this.onStart&&this.onStart()},e.prototype.handleFinish=function(){this.onFinish&&this.onFinish()},e.prototype.handleAdd=function(){return!!this.onAdd&&this.onAdd()},e.prototype.handleRemove=function(){return!!this.onRemove&&this.onRemove()},e.prototype.handleMouseDown=function(e){if(this.el){this.initialMouseX=e.pageX,this.initialMouseY=e.pageY;var t=this.el.getBoundingClientRect(),r=t.right,i=t.bottom;this.lastTriggeredMouseX=r+document.body.scrollLeft,this.lastTriggeredMouseY=i+document.body.scrollTop,this.el.classList.add("ArticleTableAddMultipleButton--active"),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},e.prototype.handleMouseMove=function(e){if(this.el){if(!this.started){if(("horizontal"===this.opts.mode&&Math.abs(e.pageX-this.initialMouseX)>5||"vertical"===this.opts.mode&&Math.abs(e.pageY-this.initialMouseY)>5)&&(this.started=!0),!this.started)return;this.handleStart()}var t;if("horizontal"===this.opts.mode?t=(e.pageX-this.lastTriggeredMouseX)/this.opts.step:"vertical"===this.opts.mode&&(t=(e.pageY-this.lastTriggeredMouseY)/this.opts.step),t){var r=t>0?1:-1;t=Math.abs(t)>=.5&&Math.abs(t)<1?r:t,t=Math.trunc(t)}if("number"==typeof t&&0!==t)if(t>0){for(var i=!1,a=this.el.getBoundingClientRect(),n=0;n<t;n++)i=this.handleAdd()||i;if(i){var o=document.body.scrollLeft,s=document.body.scrollTop,l=this.el.getBoundingClientRect();("horizontal"===this.opts.mode?e.pageX>l.right+o||a.right<l.right:e.pageY>l.bottom+s||a.bottom<l.bottom)?(this.lastTriggeredMouseX=Math.max(e.pageX,l.left+o),this.lastTriggeredMouseY=Math.max(e.pageY,l.bottom+s)):(this.lastTriggeredMouseX=Math.min(Math.max(e.pageX,this.opts.getMinX()),l.left+o),this.lastTriggeredMouseY=Math.min(Math.max(e.pageY,l.bottom),l.bottom+s))}}else{var d=!1;for(n=0;n<Math.abs(t);n++)d=this.handleRemove()||d;if(d){var c=this.el.getBoundingClientRect(),h=c.right,p=c.bottom;this.lastTriggeredMouseX=Math.min(Math.max(e.pageX,this.opts.getMinX()),h+document.body.scrollLeft),this.lastTriggeredMouseY=Math.min(Math.max(e.pageY,p),p+document.body.scrollTop)}}}},e.prototype.handleMouseUp=function(){this.el&&(this.started?this.handleFinish():this.handleAdd(),this.started=!1,document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.el.classList.remove("ArticleTableAddMultipleButton--active"))},e.prototype.render=function(){return this.el=(0,i.createElement)('\n        <div class="ArticleTableAddMultipleButton '+n.ArticleEditorInnerComponentsClass+'" contenteditable="false">\n            <div class="ArticleTableAddMultipleButton__icon '+n.ArticleEditorInnerComponentsClass+'" contenteditable="false">\n                '+(0,a.getIcon16Add)().icon+"\n            </div>\n        </div>\n    "),this.el.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.el},e}()},691721:(e,t,r)=>{"use strict";r.d(t,{Body:()=>n});var i=r(570655),a=r(749140),n=function(){function e(){this.el=null}return e.prototype.render=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return this.el=(0,a.createElement)('<tbody data-table-body contenteditable="false"></tbody>',"table"),(e=this.el).append.apply(e,(0,i.__spreadArray)([],(0,i.__read)(t),!1)),this.el},e}()},782957:(e,t,r)=>{"use strict";r.d(t,{Cell:()=>_});var i=r(570655),a=r(749140),n=r(83178),o=r(326445),s=r(994672),l=r(218573),d=r(530791),c=r(159501),h=r(598985),p=r(601306),u=r(538695),g=r(390237),m=r(282569),v=r(707908),_=function(){function e(e,t){var r;this.el=null,this.contentWrapper=null,this.addColumnButton=null,this.addColumnButtonWrapper=null,this.addRowButton=null,this.addRowButtonWrapper=null,this.columnRightSeparator=null,this.columnRightSeparatorWrapper=null,this.columnLeftSeparator=null,this.columnLeftSeparatorWrapper=null,this.rowTopSeparator=null,this.rowTopSeparatorWrapper=null,this.rowBottomSeparator=null,this.rowBottomSeparatorWrapper=null,this.highlight=null,this.highlightWrapper=null,this.columnActionSheet=null,this.columnActionSheetWrapper=null,this.rowActionSheet=null,this.rowActionSheetWrapper=null,this.columnSizeTip=null,this.columnSizeTipWrapper=null,this.objectTooltip=null,this.paragraph=e,this.editor=t,this.parentRowParagraph=t.getParagraphById(e.parentId||!1),this.parentTableParagraph=t.getParagraphById((null===(r=this.parentRowParagraph)||void 0===r?void 0:r.parentId)||!1)}return e.prototype.render=function(){var e,t=this,r=(0,a.createElement)('<td class="ArticleTableCell" data-table-cell contenteditable="false"></td>',"tr");this.contentWrapper=(0,a.createElement)('<div class="ArticleTableCell__content" data-table-cell-content contenteditable></div>');var n=this.paragraph.children.reduce((function(e,r){var a=t.editor.getParagraphById(r);return a?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e),!1),[t.editor.renderParagraph(a)],!1):e}),[]);(e=this.contentWrapper).append.apply(e,(0,i.__spreadArray)([],(0,i.__read)(n),!1)),r.append(this.contentWrapper),this.el=Object.assign(r,{toggleVisibleRightColumnSeparator:this.toggleVisibleRightColumnSeparator.bind(this),toggleVisibleLeftColumnSeparator:this.toggleVisibleLeftColumnSeparator.bind(this),toggleVisibleTopRowSeparator:this.toggleVisibleTopRowSeparator.bind(this),toggleVisibleBottomRowSeparator:this.toggleVisibleBottomRowSeparator.bind(this),showHighlight:this.showHighlight.bind(this),hideHighlight:this.hideHighlight.bind(this),getPosition:this.getPosition.bind(this),getGridPosition:this.getGridPosition.bind(this),hideAddColumnButton:this.hideAddColumnButton.bind(this),hideAddRowButton:this.hideAddRowButton.bind(this),hideRowActionSheet:this.hideRowActionSheet.bind(this),hideColumnActionSheet:this.hideColumnActionSheet.bind(this),hideColumnSizeTip:this.hideColumnSizeTip.bind(this),showAddColumnButton:this.showAddColumnButton.bind(this),showAddRowButton:this.showAddRowButton.bind(this),showRowActionSheet:this.showRowActionSheet.bind(this),showColumnActionSheet:this.showColumnActionSheet.bind(this),showColumnSizeTip:this.showColumnSizeTip.bind(this),hideContent:this.hideContent.bind(this),showContent:this.showContent.bind(this),closeRowActionSheet:this.closeRowActionSheet.bind(this),closeColumnActionSheet:this.closeColumnActionSheet.bind(this),openRowActionSheet:this.openRowActionSheet.bind(this),openColumnActionSheet:this.openColumnActionSheet.bind(this),setHeader:this.setHeader.bind(this),getContentEl:this.getContentEl.bind(this),getContentWidth:this.getContentWidth.bind(this),getContentHeight:this.getContentHeight.bind(this),setWidth:this.setWidth.bind(this),update:this.update.bind(this),activate:this.activate.bind(this),setRowColor:this.setRowColor.bind(this),setColumnColor:this.setColumnColor.bind(this),getMinContentWidth:this.getMinContentWidth.bind(this),connectedCallback:this.connectedCallback.bind(this)});var o=this.paragraph.table_bg_color_row,s=this.paragraph.table_bg_color_column;return o&&this.setRowColor(o),s&&this.setColumnColor(s),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleSelectionChange=this.handleSelectionChange.bind(this),this.contentWrapper.addEventListener("focus",this.handleFocus.bind(this)),this.contentWrapper.addEventListener("blur",this.handleBlur.bind(this)),this.el},e.prototype.connectedCallback=function(){this.el&&(this.updateControls(),this.updateBorders(),this.updateWidth(),this.renderObjectTooltip(),document.activeElement===this.contentWrapper&&this.activate())},e.prototype.update=function(){this.updateControls(),this.updateBorders(),this.updateWidth()},e.prototype.updateControls=function(){var e=this.getGridPosition(),t=e.row,r=e.cell;t&&-1!==t.index&&-1!==r.index&&(this.updateRightColumnSeparator(),this.updateLeftColumnSeparator(),this.updateTopRowSeparator(),this.updateBottomRowSeparator(),this.updateAddColumnButton(),this.updateAddRowButton(),this.updateHighlight(),this.updateColumnActionSheet(),this.updateRowActionSheet(),this.updateColumnSizeTip())},e.prototype.updateLeftColumnSeparator=function(){var e,t;if(this.el){if(!this.getGridPosition().cell.isFirst)return null===(e=this.columnLeftSeparator)||void 0===e||e.destroy(),this.columnLeftSeparator=null,null===(t=this.columnLeftSeparatorWrapper)||void 0===t||t.remove(),void(this.columnLeftSeparatorWrapper=null);this.columnLeftSeparator||(this.columnLeftSeparator=new s.ColumnSeparator,this.columnLeftSeparatorWrapper=(0,a.createElement)('<div class="ArticleTableCell__separatorLeft" contenteditable="false"></div>'),this.columnLeftSeparatorWrapper.append(this.columnLeftSeparator.render()),this.el.append(this.columnLeftSeparatorWrapper))}},e.prototype.updateRightColumnSeparator=function(){var e=this;if(this.el){var t=this.getGridPosition();this.columnRightSeparator||(this.columnRightSeparator=new s.ColumnSeparator,this.columnRightSeparator.onMouseEnter=function(){return e.dispatchEvent("hoverRightColumnSeparator",{cellIndex:e.getPosition().index})},this.columnRightSeparator.onMouseLeave=function(){return e.dispatchEvent("blurRightColumnSeparator",{cellIndex:e.getPosition().index})},this.columnRightSeparator.onMove=function(t){return e.dispatchEvent("resizeColumnStep",{cellIndex:e.getPosition().index,dx:t})},this.columnRightSeparator.onFinish=function(){return e.dispatchEvent("resizeColumnFinish",{cellIndex:e.getPosition().index})},this.columnRightSeparator.onDblClick=function(){return e.dispatchEvent("adjustColumnSize",{cellIndex:e.getPosition().index})},this.columnRightSeparatorWrapper=(0,a.createElement)('<div class="ArticleTableCell__separatorRight" contenteditable="false"></div>'),this.columnRightSeparatorWrapper.append(this.columnRightSeparator.render()),this.el.append(this.columnRightSeparatorWrapper)),t.cell.isLast?this.columnRightSeparator.hide():this.columnRightSeparator.show()}},e.prototype.updateBottomRowSeparator=function(){if(this.el){var e=this.getGridPosition();this.rowBottomSeparator||(this.rowBottomSeparator=new l.RowSeparator,this.rowBottomSeparatorWrapper=(0,a.createElement)('<div class="ArticleTableCell__separatorBottom" contenteditable="false"></div>'),this.rowBottomSeparatorWrapper.append(this.rowBottomSeparator.render()),this.el.append(this.rowBottomSeparatorWrapper)),e.row.isLast?this.rowBottomSeparator.hide():this.rowBottomSeparator.show()}},e.prototype.updateTopRowSeparator=function(){var e,t;if(this.el){if(!this.getGridPosition().row.isFirst)return null===(e=this.rowTopSeparator)||void 0===e||e.destroy(),this.rowTopSeparator=null,null===(t=this.rowTopSeparatorWrapper)||void 0===t||t.remove(),void(this.rowTopSeparatorWrapper=null);this.rowTopSeparator||(this.rowTopSeparator=new l.RowSeparator,this.rowTopSeparatorWrapper=(0,a.createElement)('<div class="ArticleTableCell__separatorTop" contenteditable="false"></div>'),this.rowTopSeparatorWrapper.append(this.rowTopSeparator.render()),this.el.append(this.rowTopSeparatorWrapper))}},e.prototype.updateHighlight=function(){this.el&&(this.highlight||(this.highlight=new h.Highlight,this.highlightWrapper=(0,a.createElement)('<div class="ArticleTableCell__highlight" contenteditable="false"></div>'),this.highlightWrapper.append(this.highlight.render()),this.el.append(this.highlightWrapper)))},e.prototype.updateAddColumnButton=function(){var e,t=this,r=this.getGridPosition(),i=r.row,n=r.cell;if(!this.el||!i.isFirst||n.isLast)return null===(e=this.addColumnButtonWrapper)||void 0===e||e.remove(),this.addColumnButton=null,void(this.addColumnButtonWrapper=null);this.addColumnButton||(this.addColumnButton=new o.AddButton,this.addColumnButton.onClick=function(){return t.dispatchEvent("addColumn",{cellIndex:t.getPosition().index})},this.addColumnButton.onMouseEnter=function(){return t.dispatchEvent("hoverAddColumnButton",{cellIndex:t.getPosition().index})},this.addColumnButton.onMouseLeave=function(){return t.dispatchEvent("blurAddColumnButton",{cellIndex:t.getPosition().index})},this.addColumnButtonWrapper=(0,a.createElement)('<div class="ArticleTableCell__addButtonV" contenteditable="false"></div>'),this.addColumnButtonWrapper.addEventListener("mousedown",(function(e){return e.preventDefault()})),this.addColumnButtonWrapper.append(this.addColumnButton.render()),this.el.append(this.addColumnButtonWrapper))},e.prototype.updateAddRowButton=function(){var e,t=this,r=this.getGridPosition(),i=r.cell,n=r.row;if(!this.el||!i.isFirst||n.isLast)return null===(e=this.addRowButtonWrapper)||void 0===e||e.remove(),this.addRowButton=null,void(this.addRowButtonWrapper=null);this.addRowButton||(this.addRowButton=new o.AddButton,this.addRowButton.onClick=function(){return t.dispatchEvent("addRow",{rowIndex:t.getGridPosition().row.index})},this.addRowButton.onMouseEnter=function(){return t.dispatchEvent("hoverAddRowButton",{rowIndex:t.getGridPosition().row.index})},this.addRowButton.onMouseLeave=function(){return t.dispatchEvent("blurAddRowButton",{rowIndex:t.getGridPosition().row.index})},this.addRowButtonWrapper=(0,a.createElement)('<div class="ArticleTableCell__addButtonH" contenteditable="false"></div>'),this.addRowButtonWrapper.addEventListener("mousedown",(function(e){return e.preventDefault()})),this.addRowButtonWrapper.append(this.addRowButton.render()),this.el.append(this.addRowButtonWrapper))},e.prototype.updateColumnActionSheet=function(){var e,t,r=this,i=this.getGridPosition().row;if(!this.el||!i.isFirst)return null===(e=this.columnActionSheet)||void 0===e||e.destroy(),this.columnActionSheet=null,null===(t=this.columnActionSheetWrapper)||void 0===t||t.remove(),void(this.columnActionSheetWrapper=null);this.columnActionSheet||(this.columnActionSheet=new d.ColumnActionSheet(this.editor.getEditorEl(),this.paragraph.table_bg_color_column),this.columnActionSheet.canMoveToLeft=function(){return!r.getGridPosition().cell.isFirst},this.columnActionSheet.canMoveToRight=function(){return!r.getGridPosition().cell.isLast},this.columnActionSheet.canRemove=function(){return!(r.getGridPosition().cell.isFirst&&r.getGridPosition().cell.isLast)},this.columnActionSheet.onOpen=function(){r.el&&p.SelectionManager.selectEl(r.el),r.dispatchEvent("openColumnActionSheet",{cellIndex:r.getPosition().index})},this.columnActionSheet.onClose=function(){return r.dispatchEvent("closeColumnActionSheet",{cellIndex:r.getPosition().index})},this.columnActionSheet.onAddColumn=function(){return r.dispatchEvent("addColumn",{cellIndex:r.getPosition().index})},this.columnActionSheet.onMoveToLeft=function(){return r.dispatchEvent("moveColumn",{oldIndex:r.getPosition().index,newIndex:r.getPosition().index-1})},this.columnActionSheet.onMoveToRight=function(){return r.dispatchEvent("moveColumn",{oldIndex:r.getPosition().index,newIndex:r.getPosition().index+1})},this.columnActionSheet.onRemove=function(){return r.dispatchEvent("removeColumn",{cellIndex:r.getPosition().index})},this.columnActionSheet.onChangeColor=function(e){return r.dispatchEvent("changeColumnColor",{cellIndex:r.getPosition().index,color:e})},this.columnActionSheetWrapper=(0,a.createElement)('<div class="ArticleTableCell__actionSheetV" contenteditable="false"></div>'),this.columnActionSheetWrapper.append(this.columnActionSheet.render()),this.el.append(this.columnActionSheetWrapper),this.columnActionSheet.icon.setAttribute("data-draggable-horizontal",""))},e.prototype.updateRowActionSheet=function(){var e,t,r=this,i=this.getGridPosition().cell;if(!this.el||!i.isFirst)return null===(e=this.rowActionSheet)||void 0===e||e.destroy(),this.rowActionSheet=null,null===(t=this.rowActionSheetWrapper)||void 0===t||t.remove(),void(this.rowActionSheetWrapper=null);this.rowActionSheet||(this.rowActionSheet=new c.RowActionSheet(this.editor.getEditorEl(),this.paragraph.table_bg_color_row),this.rowActionSheet.canMoveToTop=function(){return!r.getGridPosition().row.isFirst},this.rowActionSheet.canMoveToBottom=function(){return!r.getGridPosition().row.isLast},this.rowActionSheet.canSetHeader=function(){return r.getGridPosition().row.isFirst},this.rowActionSheet.canRemove=function(){return!(r.getGridPosition().row.isFirst&&r.getGridPosition().row.isLast)},this.rowActionSheet.onOpen=function(){r.el&&p.SelectionManager.selectEl(r.el),r.dispatchEvent("openRowActionSheet",{rowIndex:r.getGridPosition().row.index})},this.rowActionSheet.onClose=function(){return r.dispatchEvent("closeRowActionSheet",{rowIndex:r.getGridPosition().row.index})},this.rowActionSheet.onAddRow=function(){return r.dispatchEvent("addRow",{rowIndex:r.getGridPosition().row.index})},this.rowActionSheet.onMoveToTop=function(){return r.dispatchEvent("moveRow",{oldIndex:r.getGridPosition().row.index,newIndex:r.getGridPosition().row.index-1})},this.rowActionSheet.onMoveToBottom=function(){return r.dispatchEvent("moveRow",{oldIndex:r.getGridPosition().row.index,newIndex:r.getGridPosition().row.index+1})},this.rowActionSheet.onRemove=function(){return r.dispatchEvent("removeRow",{rowIndex:r.getGridPosition().row.index})},this.rowActionSheet.onSetHeader=function(e){return r.dispatchEvent("setHeader",{value:e})},this.rowActionSheet.onChangeColor=function(e){return r.dispatchEvent("changeRowColor",{rowIndex:r.getGridPosition().row.index,color:e})},this.rowActionSheetWrapper=(0,a.createElement)('<div class="ArticleTableCell__actionSheetH" contenteditable="false"></div>'),this.rowActionSheetWrapper.append(this.rowActionSheet.render()),this.el.append(this.rowActionSheetWrapper),this.rowActionSheet.icon.setAttribute("data-draggable-vertical",""))},e.prototype.updateColumnSizeTip=function(){var e,t=this.getGridPosition().row;if(!this.el||!t.isFirst)return null===(e=this.columnSizeTipWrapper)||void 0===e||e.remove(),this.columnSizeTip=null,void(this.columnSizeTipWrapper=null);this.columnSizeTip||(this.columnSizeTip=new v.ColumnSizeTip,this.columnSizeTipWrapper=(0,a.createElement)('<div class="ArticleTableCell__columnSizeTip" contenteditable="false"></div>'),this.columnSizeTipWrapper.append(this.columnSizeTip.render()),this.el.append(this.columnSizeTipWrapper))},e.prototype.updateBorders=function(){if(this.el){var e=this.getGridPosition();e.row&&(this.el.classList.toggle("ArticleTableCell--roundTl",e.row.isFirst&&e.cell.isFirst),this.el.classList.toggle("ArticleTableCell--roundTr",e.row.isFirst&&e.cell.isLast),this.el.classList.toggle("ArticleTableCell--roundBl",e.row.isLast&&e.cell.isFirst),this.el.classList.toggle("ArticleTableCell--roundBr",e.row.isLast&&e.cell.isLast))}},e.prototype.dispatchEvent=function(e,t){this.el&&this.el.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:t}))},e.prototype.handleKeyDown=function(e){this.handleCtrlA(e),this.handleDelete(e)},e.prototype.handleCtrlA=function(e){if(this.contentWrapper){var t=e.keyCode===n.Key.KeyA;(e.metaKey||e.ctrlKey)&&t&&(p.SelectionManager.selectElContents(this.contentWrapper),e.preventDefault(),e.stopPropagation())}},e.prototype.handleDelete=function(e){var t,r,a=e.keyCode;if([n.Key.Backspace,n.Key.Delete].includes(a)){var o=(0,i.__read)(p.SelectionManager.getRange(),1)[0];if(o)if(o.startContainer===o.endContainer&&o.startContainer===this.contentWrapper){try{for(var s=(0,i.__values)(this.paragraph.children),l=s.next();!l.done;l=s.next()){var d=l.value;this.editor.deleteParagraphById(d)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var c=u.buildTextParagraph(this.editor,this.paragraph.id);this.paragraph.children=[c.id],this.saveAndRedraw(),e.preventDefault(),e.stopPropagation(),this.editor.focusParagraph(c.id)}}},e.prototype.saveAndRedraw=function(){this.editor.history.saveUndoState(),this.editor.setParagraphDirty(this.paragraph.id),this.editor.redraw(!1)},e.prototype.getGridPosition=function(){var e=this.el.parentElement;return{cell:this.getPosition(),row:null==e?void 0:e.getPosition()}},e.prototype.getPosition=function(){return{index:this.el?(0,n.domChildIndex)(this.el):-1,isLast:!!this.el&&(0,n.domIsLastChild)(this.el),isFirst:!!this.el&&(0,n.domIsFirstChild)(this.el)}},e.prototype.toggleVisibleRightColumnSeparator=function(e){if(this.columnRightSeparator){var t=this.getGridPosition();e?(this.columnRightSeparator.activate(),this.columnRightSeparator.show()):(this.columnRightSeparator.deactivate(),t.cell.isLast&&this.columnRightSeparator.hide())}},e.prototype.toggleVisibleLeftColumnSeparator=function(e){if(this.columnLeftSeparator){var t=this.getGridPosition();e?(this.columnLeftSeparator.activate(),this.columnLeftSeparator.show()):(this.columnLeftSeparator.deactivate(),t.cell.isFirst&&this.columnLeftSeparator.hide())}},e.prototype.toggleVisibleTopRowSeparator=function(e){if(this.rowTopSeparator){var t=this.getGridPosition();e?(this.rowTopSeparator.activate(),this.rowTopSeparator.show()):(this.rowTopSeparator.deactivate(),t.row.isFirst&&this.rowTopSeparator.hide())}},e.prototype.toggleVisibleBottomRowSeparator=function(e){if(this.rowBottomSeparator){var t=this.getGridPosition();e?(this.rowBottomSeparator.activate(),this.rowBottomSeparator.show()):(this.rowBottomSeparator.deactivate(),t.row.isLast&&this.rowBottomSeparator.hide())}},e.prototype.showHighlight=function(e,t,r,i,a){this.highlight&&this.el&&(this.highlight.show(a),e&&this.highlight.hideTopBorder(),t&&this.highlight.hideRightBorder(),r&&this.highlight.hideBottomBorder(),i&&this.highlight.hideLeftBorder(),this.el.classList.contains("ArticleTableCell--roundTl")&&this.highlight.roundTopLeft(),this.el.classList.contains("ArticleTableCell--roundTr")&&this.highlight.roundTopRight(),this.el.classList.contains("ArticleTableCell--roundBl")&&this.highlight.roundBottomLeft(),this.el.classList.contains("ArticleTableCell--roundBr")&&this.highlight.roundBottomRight())},e.prototype.hideHighlight=function(){this.highlight&&this.highlight.hide()},e.prototype.hideAddColumnButton=function(){this.addColumnButtonWrapper&&(this.addColumnButtonWrapper.style.visibility="hidden")},e.prototype.hideAddRowButton=function(){this.addRowButtonWrapper&&(this.addRowButtonWrapper.style.visibility="hidden")},e.prototype.hideRowActionSheet=function(){this.rowActionSheetWrapper&&this.rowActionSheet&&(this.rowActionSheetWrapper.style.visibility="hidden")},e.prototype.hideColumnActionSheet=function(){this.columnActionSheetWrapper&&this.columnActionSheet&&(this.columnActionSheetWrapper.style.visibility="hidden")},e.prototype.hideContent=function(){this.contentWrapper&&(this.contentWrapper.style.visibility="hidden")},e.prototype.hideColumnSizeTip=function(){this.columnSizeTipWrapper&&(this.columnSizeTipWrapper.style.visibility="hidden")},e.prototype.showAddColumnButton=function(){this.addColumnButtonWrapper&&(this.addColumnButtonWrapper.style.visibility="visible")},e.prototype.showAddRowButton=function(){this.addRowButtonWrapper&&(this.addRowButtonWrapper.style.visibility="visible")},e.prototype.showRowActionSheet=function(){this.rowActionSheetWrapper&&this.rowActionSheet&&(this.rowActionSheetWrapper.style.visibility="visible")},e.prototype.showColumnActionSheet=function(){this.columnActionSheetWrapper&&this.columnActionSheet&&(this.columnActionSheetWrapper.style.visibility="visible")},e.prototype.showContent=function(){this.contentWrapper&&(this.contentWrapper.style.visibility="visible")},e.prototype.showColumnSizeTip=function(){this.columnSizeTipWrapper&&this.el&&this.columnSizeTip&&(this.columnSizeTip.setSize(this.el.getBoundingClientRect().width),this.columnSizeTipWrapper.style.visibility="visible")},e.prototype.closeRowActionSheet=function(){this.rowActionSheet&&(this.rowActionSheet.close(),this.rowActionSheet.hide())},e.prototype.closeColumnActionSheet=function(){this.columnActionSheet&&(this.columnActionSheet.close(),this.columnActionSheet.hide())},e.prototype.openRowActionSheet=function(){this.rowActionSheet&&(this.rowActionSheet.open(),this.rowActionSheet.show())},e.prototype.openColumnActionSheet=function(){this.columnActionSheet&&(this.columnActionSheet.open(),this.columnActionSheet.show())},e.prototype.setHeader=function(e){this.rowActionSheet&&this.rowActionSheet.setHeader(e)},e.prototype.getContentEl=function(){return this.contentWrapper},e.prototype.getContentWidth=function(){return this.contentWrapper?this.contentWrapper.getBoundingClientRect().width:0},e.prototype.getContentHeight=function(){return this.contentWrapper?this.contentWrapper.getBoundingClientRect().height:0},e.prototype.updateWidth=function(){if(this.el&&this.paragraph.parentId){var e=this.getGridPosition();if(e.row){if(!e.row.isFirst)return this.el.style.removeProperty("width"),void this.el.style.removeProperty("min-width");if(e.cell.isLast&&this.el.style.removeProperty("width"),this.parentTableParagraph){var t=this.parentTableParagraph.table_columns_width[this.getPosition().index];this.setWidth(t,!1)}}}},e.prototype.setWidth=function(e,t){void 0===t&&(t=!1),this.el&&(e=Math.max(e,n.TABLE_CELL_MIN_WIDTH),this.columnSizeTip&&this.columnSizeTip.setSize(e),this.getPosition().isLast?this.el.style.minWidth=e+"px":(this.el.style.minWidth=e+"px",this.el.style.width=e+"px"),t&&this.el.setAttribute("data-was-resized",""))},e.prototype.activate=function(){this.showHighlight(!1,!1,!1,!1,!1),this.dispatchEvent("cellActiveStatusChanged",{value:!0})},e.prototype.deactivate=function(){this.hideHighlight(),this.dispatchEvent("cellActiveStatusChanged",{value:!1})},e.prototype.renderObjectTooltip=function(){var e,t=this,r=this.editor.getParagraphElById((null===(e=this.parentTableParagraph)||void 0===e?void 0:e.id)||!1);r&&(this.objectTooltip=new m.ObjectTooltip(r,this.editor.getEditorEl()),this.objectTooltip.onClickNumericList=function(){t.hideObjectTooltip(),t.editor.setNumericList(!0)},this.objectTooltip.onClickBulletList=function(){t.hideObjectTooltip(),t.editor.setBulletList(!0)},this.objectTooltip.render(),r.objectTooltip||(r.objectTooltip=this.objectTooltip))},e.prototype.showObjectTooltip=function(){var e=this;requestAnimationFrame((function(){e.objectTooltip&&(e.objectTooltip.setPos((function(t){var r=e.editor.getParagraphElById(e.paragraph.id);if(r){var i=e.editor.getEditorEl().getBoundingClientRect(),a=r.getBoundingClientRect(),n=t.getContent().getBoundingClientRect(),o={top:a.top-i.top-n.height-5,left:a.left-i.left+a.width/2-n.width/2};return o.left+n.width+10<window.innerWidth-i.left||(o.left=window.innerWidth-i.left-n.width-10),o}})),e.objectTooltip.show())}))},e.prototype.hideObjectTooltip=function(){this.objectTooltip&&this.objectTooltip.hide()},e.prototype.handleSelectionChange=function(){var e=(0,i.__read)(p.SelectionManager.getRange(),1)[0];if(!e||this.inCell(e.startContainer)){var t=(0,i.__read)(this.editor.getCurrentParagraphId(),1)[0],r=this.editor.getParagraphById(t);if(r){var a=this.editor.selection.getCurrentSelectionState();(0,n.isParagraphEmpty)(r)&&!(0,n.isListParagraph)(r)&&a&&!a.selectedText?this.showObjectTooltip():this.hideObjectTooltip()}else this.hideObjectTooltip()}},e.prototype.getParentCell=function(e){return(0,g.traverseParent)(e,(function(e){if(e instanceof HTMLElement&&e.hasAttribute("data-table-cell"))return!0}))||null},e.prototype.handleFocus=function(){if(this.el){var e=(0,i.__read)(p.SelectionManager.getRange(),1)[0];if(e&&document.activeElement){var t=this.getParentCell(e.startContainer),r=this.getParentCell(document.activeElement);t&&r&&t!==r&&(t.hideHighlight(),p.SelectionManager.removeAllRanges())}this.activate(),this.el.classList.add("ArticleTableCell--active"),document.addEventListener("selectionchange",this.handleSelectionChange),this.el.addEventListener("keydown",this.handleKeyDown)}},e.prototype.inSameContent=function(e){return this.inContent(e)&&this.inCell(e)},e.prototype.inContent=function(e){return!!e&&!!(0,g.traverseParent)(e,(function(e){if(e instanceof HTMLElement&&e.hasAttribute("data-table-cell-content"))return!0}))},e.prototype.inSameTable=function(e){var t=this;return!!e&&!!(0,g.traverseParent)(e,(function(e){var r;if(e instanceof HTMLElement&&e.getAttribute("data-id")===(null===(r=t.parentTableParagraph)||void 0===r?void 0:r.id))return!0}))},e.prototype.inCell=function(e){var t=this;return!!e&&!!(0,g.traverseParent)(e,(function(e){if(e instanceof HTMLElement&&e.getAttribute("data-id")===t.paragraph.id)return!0}))},e.prototype.handleBlur=function(){var e=this;this.el&&(this.editor.history.saveUndoState(),clearTimeout(this.blurTimeout),this.blurTimeout=setTimeout((function(){var t=(0,i.__read)(p.SelectionManager.getRange(),1)[0];if(!t)return e.deactivate(),void e.hideObjectTooltip();document.activeElement===e.editor.getCanvasEl()&&(e.deactivate(),e.hideObjectTooltip()),e.inSameContent(t.startContainer)||e.inSameContent(document.activeElement)||e.deactivate(),e.inSameTable(t.startContainer)||e.hideObjectTooltip()}),0),this.el.classList.remove("ArticleTableCell--active"),this.el.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("selectionchange",this.handleSelectionChange))},e.prototype.setRowColor=function(e){this.el&&this.contentWrapper&&(e?(this.el.setAttribute("data-bg-color-row",e),this.contentWrapper.setAttribute("data-bg-color-row",e)):(this.el.removeAttribute("data-bg-color-row"),this.contentWrapper.removeAttribute("data-bg-color-row")))},e.prototype.setColumnColor=function(e){this.el&&this.contentWrapper&&(e?(this.el.setAttribute("data-bg-color-column",e),this.contentWrapper.setAttribute("data-bg-color-column",e)):(this.el.removeAttribute("data-bg-color-column"),this.contentWrapper.removeAttribute("data-bg-color-column")))},e.prototype.getMinContentWidth=function(){if(!this.contentWrapper||!this.parentTableParagraph)return 0;var e=this.editor.getParagraphElById(this.parentTableParagraph.id||!1);return e?(0,n.getMinContentWidth)(this.contentWrapper,e):void 0},e}()},530791:(e,t,r)=>{"use strict";r.d(t,{ColumnActionSheet:()=>v});var i=r(570655),a=r(749140),n=r(704914),o=r(788656),s=r(261730),l=r(883780),d=r(881344),c=r(580943),h=r(578954),p=r(659214),u=r(608021),g=r(517920),m=r(83178),v=function(){function e(e,t,r){void 0===r&&(r=!1),this.el=null,this.icon=null,this.contentWrapperEl=null,this.opened=!1,this.visible=!1,this.tooltipShowed=!1,this.multipleMode=!1,this.appendTo=e,this.color=t,this.multipleMode=r,this.handleAddColumn=this.handleAddColumn.bind(this),this.handleMoveToLeft=this.handleMoveToLeft.bind(this),this.handleMoveToRight=this.handleMoveToRight.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleChangeColor=this.handleChangeColor.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.renderMainMenu=this.renderMainMenu.bind(this),this.renderColorMenu=this.renderColorMenu.bind(this)}return e.prototype.handleAddColumn=function(){this.onAddColumn&&this.onAddColumn(),this.tooltip.hide()},e.prototype.handleMoveToLeft=function(){this.onMoveToLeft&&this.onMoveToLeft(),this.tooltip.hide()},e.prototype.handleMoveToRight=function(){this.onMoveToRight&&this.onMoveToRight(),this.tooltip.hide()},e.prototype.handleRemove=function(){this.onRemove&&this.onRemove(),this.tooltip.hide()},e.prototype.handleChangeColor=function(e){this.color!==e&&(this.onChangeColor&&this.onChangeColor(e),this.color=e)},e.prototype.open=function(){this.opened=!0,this.tooltipShowed||(this.tooltip.show(),this.tooltip.updatePosition()),this.onOpen&&this.onOpen()},e.prototype.close=function(){this.opened=!1,this.tooltipShowed&&this.tooltip.hide(),this.onClose&&this.onClose()},e.prototype.show=function(){this.el&&(this.visible=!0,this.el.classList.add("ArticleTableActionSheet--active"))},e.prototype.hide=function(){this.el&&(this.visible=!1,this.el.classList.remove("ArticleTableActionSheet--active"))},e.prototype.handleMouseEnter=function(){this.show()},e.prototype.handleMouseLeave=function(){this.opened||this.hide()},e.prototype.destroy=function(){this.tooltip.destroy()},e.prototype.render=function(){var e=this;return this.el=(0,a.createElement)('<div class="ArticleTableActionSheet ArticleTableActionSheet--column '+m.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>'),this.icon=(0,a.createElement)('\n      <div class="ArticleTableActionSheet__icon ArticleTableActionSheet__icon--column '+m.ArticleEditorInnerComponentsClass+'">\n          '+(0,n.getIcon24DotsVertical)().icon+"\n      </div>\n    "),this.el.appendChild(this.icon),this.el.addEventListener("mouseenter",this.handleMouseEnter),this.el.addEventListener("mouseleave",this.handleMouseLeave),this.contentWrapperEl=(0,a.createElement)('<div contenteditable="false"></div>'),this.tooltip=new g.default(this.icon,{content:this.contentWrapperEl,forceSide:"bottom",align:"center",width:212,appendTo:this.appendTo,autoShow:!1,cls:"ArticleTableMenu",onShow:function(){e.tooltipShowed=!0,e.renderMainMenu(),e.open(),e.show()},onBeforeHide:function(){e.tooltipShowed=!1,e.close(),e.hide()},setPos:function(t){if(e.el){var r=e.appendTo.getBoundingClientRect(),i=e.el.getBoundingClientRect(),a=t.getContent().getBoundingClientRect();return{top:i.bottom-r.top+10,left:i.left-r.left+i.width/2-a.width/2}}}}),this.el},e.prototype.renderMainMenu=function(){var e=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,c.getIcon20PalleteOutline)().icon+" "+(0,u.getLang)("pages_article_ed_table_column_color",this.multipleMode?2:1)+"</button>\n    ");e.addEventListener("click",this.renderColorMenu);var t=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,o.getIcon20Add)().icon+" "+(0,u.getLang)("pages_article_ed_table_add_column")+"</button>\n    ");t.addEventListener("click",this.handleAddColumn);var r=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,s.getIcon20ArrowLeftOutline)().icon+" "+(0,u.getLang)("pages_article_ed_table_move_left")+"</button>\n    ");r.addEventListener("click",this.handleMoveToLeft);var i=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,l.getIcon20ArrowRightOutline)().icon+" "+(0,u.getLang)("pages_article_ed_table_move_right")+"</button>\n    ");i.addEventListener("click",this.handleMoveToRight);var n=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn ArticleTableActionSheetBtn--red">'+(0,d.getIcon20DeleteOutline)().icon+" "+(0,u.getLang)("pages_article_ed_table_remove_column",this.multipleMode?2:1)+"</button>\n    ");n.addEventListener("click",this.handleRemove);var h=!this.canMoveToLeft||this.canMoveToLeft(),p=!this.canMoveToRight||this.canMoveToRight(),g=!this.canRemove||this.canRemove();h?r.removeAttribute("disabled"):r.setAttribute("disabled",""),p?i.removeAttribute("disabled"):i.setAttribute("disabled",""),g?n.removeAttribute("disabled"):n.setAttribute("disabled",""),this.contentWrapperEl&&(this.contentWrapperEl.innerHTML="",this.contentWrapperEl.append(e,t,r,i,n))},e.prototype.renderColorMenu=function(){var e,t,r=this,n=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn ArticleTableActionSheetBtn--gray">'+(0,h.getIcon20ChevronLeftOutline)().icon+" "+(0,u.getLang)("pages_article_ed_table_column_color",this.multipleMode?2:1)+"</button>\n    ");n.addEventListener("click",this.renderMainMenu);var o=(0,a.createElement)('<div contenteditable="false" class="ArticleTableColorsWrapper"></div>'),s=(0,a.createElement)('<div contenteditable="false" class="ArticleTableColors"></div>');o.appendChild(s);var l=function(e){var t=(0,a.createElement)('<button class="ArticleTableColorItem ArticleTableColorItem--'+e+'">'+(0,p.getIcon16CheckOutline)().icon+"</button>");d.color===e&&t.classList.add("ArticleTableColorItem--active"),t.addEventListener("click",(function(){var a,n;try{for(var o=(a=void 0,(0,i.__values)(Array.from(s.children))),l=o.next();!l.done;l=o.next()){l.value.classList.remove("ArticleTableColorItem--active")}}catch(e){a={error:e}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}t.classList.add("ArticleTableColorItem--active"),r.handleChangeColor(e)})),s.append(t)},d=this;try{for(var c=(0,i.__values)(m.TABLE_CELL_BG_COLORS),g=c.next();!g.done;g=c.next()){l(g.value)}}catch(t){e={error:t}}finally{try{g&&!g.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}this.contentWrapperEl&&(this.contentWrapperEl.innerHTML="",this.contentWrapperEl.append(n,o))},e}()},994672:(e,t,r)=>{"use strict";r.d(t,{ColumnSeparator:()=>n});var i=r(749140),a=r(83178),n=function(){function e(){this.hovered=!1,this.visible=!1,this.activated=!1,this.mouseDown=!1,this.el=null,this.started=!1,this.mouseXRelatedToEl=null,this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleDblClick=this.handleDblClick.bind(this)}return e.prototype.show=function(){this.el&&(this.el.classList.add("ArticleTableSeparator--visible"),this.visible=!0)},e.prototype.hide=function(){this.el&&(this.el.classList.remove("ArticleTableSeparator--visible"),this.visible=!1)},e.prototype.activate=function(){this.el&&(this.el.classList.add("ArticleTableSeparator--active"),this.activated=!0)},e.prototype.deactivate=function(){this.el&&(this.el.classList.remove("ArticleTableSeparator--active"),this.activated=!1)},e.prototype.handleMouseDown=function(e){this.el&&(this.mouseDown=!0,this.mouseXRelatedToEl=e.pageX-this.el.getBoundingClientRect().left,document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp))},e.prototype.handleMouseMove=function(e){if(this.el&&"number"==typeof this.mouseXRelatedToEl){var t=e.pageX-(this.el.getBoundingClientRect().left+this.mouseXRelatedToEl);this.started=!0,this.onMove&&this.onMove(t)}},e.prototype.handleMouseUp=function(e){this.started&&this.onFinish&&this.onFinish(),this.mouseDown=!1,this.started=!1,this.mouseXRelatedToEl=null,document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.hovered||this.handleMouseLeave(e)},e.prototype.handleMouseEnter=function(e){var t=this;this.hovered=!0,clearTimeout(this.timeoutToShow),this.mouseDown||(this.timeoutToShow=setTimeout((function(){t.hovered&&t.onMouseEnter&&t.onMouseEnter(e)}),100))},e.prototype.handleMouseLeave=function(e){this.hovered=!1,this.visible&&!this.mouseDown&&this.onMouseLeave&&this.onMouseLeave(e),clearTimeout(this.timeoutToShow)},e.prototype.handleDblClick=function(e){this.onDblClick&&this.onDblClick(e)},e.prototype.destroy=function(){clearTimeout(this.timeoutToShow)},e.prototype.render=function(){return this.el=(0,i.createElement)('\n      <div class="ArticleTableSeparator ArticleTableSeparator--column '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false">\n        <div class="ArticleTableSeparator__line '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false">\n      </div>\n    '),this.el.addEventListener("mouseenter",this.handleMouseEnter),this.el.addEventListener("mouseleave",this.handleMouseLeave),this.el.addEventListener("mousedown",this.handleMouseDown),this.el.addEventListener("dblclick",this.handleDblClick),this.el},e}()},707908:(e,t,r)=>{"use strict";r.d(t,{ColumnSizeTip:()=>n});var i=r(749140),a=r(83178),n=function(){function e(){this.el=null}return e.prototype.setSize=function(e){this.el&&(this.el.innerText=""+Math.round(e))},e.prototype.render=function(){return this.el=(0,i.createElement)('<div class="ArticleTableColumnSizeTip '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>'),this.el},e}()},598985:(e,t,r)=>{"use strict";r.d(t,{Highlight:()=>n});var i=r(749140),a=r(83178),n=function(){function e(){this.el=null,this.visible=!1}return e.prototype.roundTopLeft=function(){this.el&&this.el.classList.add("ArticleTableHighlight--roundTl")},e.prototype.roundTopRight=function(){this.el&&this.el.classList.add("ArticleTableHighlight--roundTr")},e.prototype.roundBottomLeft=function(){this.el&&this.el.classList.add("ArticleTableHighlight--roundBl")},e.prototype.roundBottomRight=function(){this.el&&this.el.classList.add("ArticleTableHighlight--roundBr")},e.prototype.hideTopBorder=function(){this.el&&this.el.classList.add("ArticleTableHighlight--hideT")},e.prototype.hideRightBorder=function(){this.el&&this.el.classList.add("ArticleTableHighlight--hideR")},e.prototype.hideBottomBorder=function(){this.el&&this.el.classList.add("ArticleTableHighlight--hideB")},e.prototype.hideLeftBorder=function(){this.el&&this.el.classList.add("ArticleTableHighlight--hideL")},e.prototype.clearDecorationClasses=function(){this.el&&(this.el.classList.remove("ArticleTableHighlight--roundTl"),this.el.classList.remove("ArticleTableHighlight--roundTr"),this.el.classList.remove("ArticleTableHighlight--roundBr"),this.el.classList.remove("ArticleTableHighlight--roundBl"),this.el.classList.remove("ArticleTableHighlight--hideT"),this.el.classList.remove("ArticleTableHighlight--hideR"),this.el.classList.remove("ArticleTableHighlight--hideB"),this.el.classList.remove("ArticleTableHighlight--hideL"))},e.prototype.show=function(e){this.el&&(this.visible=!0,this.clearDecorationClasses(),this.el.classList.add("ArticleTableHighlight--active"),e&&this.el.classList.add("ArticleTableHighlight--bg"))},e.prototype.hide=function(){this.el&&(this.visible=!1,this.clearDecorationClasses(),this.el.classList.remove("ArticleTableHighlight--active"),this.el.classList.remove("ArticleTableHighlight--bg"))},e.prototype.render=function(){return this.el=(0,i.createElement)('<div class="ArticleTableHighlight '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>'),this.el},e}()},282569:(e,t,r)=>{"use strict";r.d(t,{ObjectTooltip:()=>s});var i=r(749140),a=r(517920),n=r(611460),o=r(219652),s=function(){function e(e,t){this.numericListBtn=null,this.bulletListBtn=null,this.btnWrapper=null,this.visible=!1,this.parent=e,this.appendTo=t}return e.prototype.handleClickNumericList=function(){this.onClickNumericList&&this.onClickNumericList()},e.prototype.handleClickBulletList=function(){this.onClickBulletList&&this.onClickBulletList()},e.prototype.setPos=function(e){this.tooltip&&(this.tooltip._opts.setPos=e)},e.prototype.show=function(){var e,t;this.visible=!0,null===(e=this.tooltip)||void 0===e||e.show(),null===(t=this.tooltip)||void 0===t||t.updatePosition()},e.prototype.hide=function(){var e;this.visible=!1,null===(e=this.tooltip)||void 0===e||e.hide()},e.prototype.destroy=function(){var e;null===(e=this.tooltip)||void 0===e||e.destroy()},e.prototype.getContent=function(){var e;return null===(e=this.tooltip)||void 0===e?void 0:e.getContent()},e.prototype.updatePosition=function(){var e;null===(e=this.tooltip)||void 0===e||e.updatePosition()},e.prototype.render=function(){this.numericListBtn=(0,i.createElement)('\n        <button class="article_format_btn article_format_btn_numeric_list">'+(0,n.getIcon24ListNumberFilled)().icon+"</button>\n    "),this.numericListBtn.addEventListener("click",this.handleClickNumericList.bind(this)),this.bulletListBtn=(0,i.createElement)('<button class="article_format_btn article_format_btn_bullet_list">'+(0,o.getIcon24ListBulletFilled)().icon+"</button>"),this.bulletListBtn.addEventListener("click",this.handleClickBulletList.bind(this)),this.btnWrapper=(0,i.createElement)('<div class="article_format_btns" contenteditable="false">'),this.btnWrapper.append(this.numericListBtn,this.bulletListBtn),this.tooltip=new a.default(this.parent,{content:this.btnWrapper,forceSide:"top",align:"center",customShow:!0,appendTo:this.appendTo,noAutoHideOnWindowClick:!0,cls:"article_format_tt ArticleTableObjectTooltip"})},e}()},149638:(e,t,r)=>{"use strict";r.d(t,{Row:()=>n});var i=r(570655),a=r(749140),n=function(){function e(e,t){this.el=null,this.paragraph=e,this.editor=t}return e.prototype.render=function(){var e=this,t=(0,a.createElement)('<tr class="ArticleTableRow" data-table-row contenteditable="false"></tr>',"tbody"),r=this.paragraph.children.reduce((function(t,r){var a=e.editor.getParagraphById(r);return a?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t),!1),[e.editor.renderParagraph(a)],!1):t}),[]);return t.append.apply(t,(0,i.__spreadArray)([],(0,i.__read)(r),!1)),this.el=Object.assign(t,{getPosition:this.getPosition.bind(this),setHeader:this.setHeader.bind(this),connectedCallback:this.connectedCallback.bind(this)}),this.el},e.prototype.connectedCallback=function(){var e,t;if(this.el){var r=this.el.querySelectorAll("[data-table-cell]");try{for(var a=(0,i.__values)(r),n=a.next();!n.done;n=a.next()){n.value.connectedCallback()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}},e.prototype.getPosition=function(){var e=this;if(this.el){var t=this.el.closest("table"),r=Array.from((null==t?void 0:t.querySelectorAll("[data-table-row]"))||[]);return{index:r.findIndex((function(t){return t===e.el})),isLast:this.el===r[r.length-1],isFirst:this.el===r[0]}}},e.prototype.setHeader=function(e){this.el&&(e?(this.el.classList.add("ArticleTableRow--header"),this.el.setAttribute("data-table-header","")):(this.el.classList.remove("ArticleTableRow--header"),this.el.removeAttribute("data-table-header")))},e}()},159501:(e,t,r)=>{"use strict";r.d(t,{RowActionSheet:()=>f});var i=r(570655),a=r(749140),n=r(704914),o=r(604602),s=r(502810),l=r(788656),d=r(881344),c=r(56730),h=r(83688),p=r(580943),u=r(578954),g=r(659214),m=r(70162),v=r(517920),_=r(83178),f=function(){function e(e,t,r){void 0===r&&(r=!1),this.el=null,this.icon=null,this.contentWrapperEl=null,this.headerMark=null,this.btnColorEl=null,this.visible=!1,this.opened=!1,this.tooltipShowed=!1,this.isHeader=!1,this.multipleMode=!1,this.appendTo=e,this.color=t,this.multipleMode=r,this.handleAddRow=this.handleAddRow.bind(this),this.handleMoveToTop=this.handleMoveToTop.bind(this),this.handleMoveToBottom=this.handleMoveToBottom.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleChangeColor=this.handleChangeColor.bind(this),this.handleSetHeader=this.handleSetHeader.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.renderMainMenu=this.renderMainMenu.bind(this),this.renderColorMenu=this.renderColorMenu.bind(this)}return e.prototype.handleAddRow=function(){this.onAddRow&&this.onAddRow(),this.tooltip.hide()},e.prototype.handleMoveToTop=function(){this.onMoveToTop&&this.onMoveToTop(),this.tooltip.hide()},e.prototype.handleMoveToBottom=function(){this.onMoveToBottom&&this.onMoveToBottom(),this.tooltip.hide()},e.prototype.handleRemove=function(){this.onRemove&&this.onRemove(),this.tooltip.hide()},e.prototype.handleChangeColor=function(e){this.color!==e&&(this.onChangeColor&&this.onChangeColor(e),this.color=e)},e.prototype.handleSetHeader=function(){var e=!this.isHeader;this.onSetHeader&&this.onSetHeader(e),this.setHeader(e)},e.prototype.setHeader=function(e){var t,r,i,a;this.isHeader=e,e?(null===(t=this.headerMark)||void 0===t||t.classList.add("ArticleTableActionSheet__mark--visible"),null===(r=this.btnColorEl)||void 0===r||r.setAttribute("disabled","")):(null===(i=this.headerMark)||void 0===i||i.classList.remove("ArticleTableActionSheet__mark--visible"),null===(a=this.btnColorEl)||void 0===a||a.removeAttribute("disabled"))},e.prototype.open=function(){this.opened=!0,this.tooltipShowed||(this.tooltip.show(),this.tooltip.updatePosition()),this.onOpen&&this.onOpen()},e.prototype.close=function(){this.opened=!1,this.tooltipShowed&&this.tooltip.hide(),this.onClose&&this.onClose()},e.prototype.show=function(){this.el&&(this.visible=!0,this.el.classList.add("ArticleTableActionSheet--active"))},e.prototype.hide=function(){this.el&&(this.visible=!1,this.el.classList.remove("ArticleTableActionSheet--active"))},e.prototype.handleMouseEnter=function(){this.show()},e.prototype.handleMouseLeave=function(){this.opened||this.hide()},e.prototype.destroy=function(){this.tooltip.destroy()},e.prototype.render=function(){var e=this;return this.el=(0,a.createElement)('\n      <div class="ArticleTableActionSheet ArticleTableActionSheet--row '+_.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>\n    '),this.icon=(0,a.createElement)('\n      <div class="ArticleTableActionSheet__icon '+_.ArticleEditorInnerComponentsClass+'">\n          '+(0,n.getIcon24DotsVertical)().icon+"\n      </div>\n    "),this.el.appendChild(this.icon),this.el.addEventListener("mouseenter",this.handleMouseEnter),this.el.addEventListener("mouseleave",this.handleMouseLeave),this.contentWrapperEl=(0,a.createElement)('<div contenteditable="false"></div>'),this.tooltip=new v.default(this.el,{content:this.contentWrapperEl,forceSide:"right",width:212,appendTo:this.appendTo,autoShow:!1,cls:"ArticleTableMenu",onShow:function(){e.tooltipShowed=!0,e.renderMainMenu(),e.setHeader(e.isHeader),e.open(),e.show()},onBeforeHide:function(){e.tooltipShowed=!1,e.close(),e.hide()},setPos:function(t){if(e.el){var r=e.appendTo.getBoundingClientRect(),i=e.el.getBoundingClientRect(),a=t.getContent().getBoundingClientRect();return{top:i.top-r.top+i.height/2-a.height/2,left:i.right-r.left+10}}}}),this.el},e.prototype.renderMainMenu=function(){var e=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,c.getIcon20TableHeaderOutline)().icon+" "+(0,m.getLang)("pages_article_ed_table_set_header")+"</button>\n    ");e.addEventListener("click",this.handleSetHeader.bind(this)),this.headerMark=(0,a.createElement)('\n      <div class="ArticleTableActionSheet__mark">'+(0,h.getIcon16Done)().icon+"</div>\n    "),e.append(this.headerMark),this.btnColorEl=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,p.getIcon20PalleteOutline)().icon+" "+(0,m.getLang)("pages_article_ed_table_row_color",this.multipleMode?2:1)+"</button>\n    "),this.btnColorEl.addEventListener("click",this.renderColorMenu);var t=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,l.getIcon20Add)().icon+" "+(0,m.getLang)("pages_article_ed_table_add_row")+"</button>\n    ");t.addEventListener("click",this.handleAddRow.bind(this));var r=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,o.getIcon20ArrowUpOutline)().icon+" "+(0,m.getLang)("pages_article_ed_table_move_up")+"</button>\n    ");r.addEventListener("click",this.handleMoveToTop.bind(this));var i=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn">'+(0,s.getIcon20ArrowDownOutline)().icon+" "+(0,m.getLang)("pages_article_ed_table_move_down")+"</button>\n    ");i.addEventListener("click",this.handleMoveToBottom.bind(this));var n=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn ArticleTableActionSheetBtn--red">'+(0,d.getIcon20DeleteOutline)().icon+" "+(0,m.getLang)("pages_article_ed_table_remove_row",this.multipleMode?2:1)+"</button>\n    ");n.addEventListener("click",this.handleRemove.bind(this));var u=!this.canMoveToTop||this.canMoveToTop(),g=!this.canMoveToBottom||this.canMoveToBottom(),v=!this.canSetHeader||this.canSetHeader(),_=!this.canRemove||this.canRemove();u?r.removeAttribute("disabled"):r.setAttribute("disabled",""),g?i.removeAttribute("disabled"):i.setAttribute("disabled",""),e.style.display=v?"flex":"none",_?n.removeAttribute("disabled"):n.setAttribute("disabled",""),this.contentWrapperEl&&(this.contentWrapperEl.innerHTML="",this.contentWrapperEl.append(this.btnColorEl,e,t,r,i,n))},e.prototype.renderColorMenu=function(){var e,t,r=this,n=(0,a.createElement)('\n      <button class="ArticleTableActionSheetBtn ArticleTableActionSheetBtn--gray">'+(0,u.getIcon20ChevronLeftOutline)().icon+" "+(0,m.getLang)("pages_article_ed_table_row_color",this.multipleMode?2:1)+"</button>\n    ");n.addEventListener("click",this.renderMainMenu);var o=(0,a.createElement)('<div contenteditable="false" class="ArticleTableColorsWrapper"></div>'),s=(0,a.createElement)('<div contenteditable="false" class="ArticleTableColors"></div>');o.appendChild(s);var l=function(e){var t=(0,a.createElement)('<button class="ArticleTableColorItem ArticleTableColorItem--'+e+'">'+(0,g.getIcon16CheckOutline)().icon+"</button>");d.color===e&&t.classList.add("ArticleTableColorItem--active"),t.addEventListener("click",(function(){var a,n;try{for(var o=(a=void 0,(0,i.__values)(Array.from(s.children))),l=o.next();!l.done;l=o.next()){l.value.classList.remove("ArticleTableColorItem--active")}}catch(e){a={error:e}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}t.classList.add("ArticleTableColorItem--active"),r.handleChangeColor(e)})),s.append(t)},d=this;try{for(var c=(0,i.__values)(_.TABLE_CELL_BG_COLORS),h=c.next();!h.done;h=c.next()){l(h.value)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}this.contentWrapperEl&&(this.contentWrapperEl.innerHTML="",this.contentWrapperEl.append(n,o))},e}()},218573:(e,t,r)=>{"use strict";r.d(t,{RowSeparator:()=>n});var i=r(749140),a=r(83178),n=function(){function e(){this.hovered=!1,this.visible=!1,this.activated=!1,this.el=null}return e.prototype.show=function(){this.el&&(this.el.classList.add("ArticleTableSeparator--visible"),this.visible=!0)},e.prototype.hide=function(){this.el&&(this.el.classList.remove("ArticleTableSeparator--visible"),this.visible=!1)},e.prototype.activate=function(){this.el&&(this.el.classList.add("ArticleTableSeparator--active"),this.activated=!0)},e.prototype.deactivate=function(){this.el&&(this.el.classList.remove("ArticleTableSeparator--active"),this.activated=!1)},e.prototype.handleMouseEnter=function(e){var t=this;this.hovered=!0,this.timeoutToShow=setTimeout((function(){t.hovered&&t.onMouseEnter&&t.onMouseEnter(e)}),100)},e.prototype.handleMouseLeave=function(e){this.hovered=!1,this.visible&&this.onMouseLeave&&this.onMouseLeave(e),clearTimeout(this.timeoutToShow)},e.prototype.destroy=function(){clearTimeout(this.timeoutToShow)},e.prototype.render=function(){return this.el=(0,i.createElement)('\n      <div class="ArticleTableSeparator ArticleTableSeparator--row '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false">\n        <div class="ArticleTableSeparator__line '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false">\n      </div>\n    '),this.el.addEventListener("mouseenter",this.handleMouseEnter.bind(this)),this.el.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.el},e}()},591215:(e,t,r)=>{"use strict";r.d(t,{Table:()=>v});var i=r(570655),a=r(83178),n=r(691721),o=r(538695),s=r(691752),l=r(749140),d=r(614537),c=r(601306),h=r(66737),p=r(832612),u=r(390237),g=r(825477),m=!1,v=function(){function e(e,t){this.el=null,this.container=null,this.tableEl=null,this.bodyEl=null,this.scroll=null,this.resizing=!1,this.rowDnD=null,this.columnDnD=null,this.gridSelection=null,this.selectedRows=[],this.selectedColumns=[],this.tableHighlight=null,this.highlighterWrapper=null,this.isDragging=!1,this.gridSelectionActive=!1,this.addMultipleColumnsButtonWrapper=null,this.addMultipleRowsButtonWrapper=null,this.leftFadeEl=null,this.curMinColumnWidth=null,this.curActiveCell=null,this.paragraph=e,this.editor=t,this.handleResize=this.handleResize.bind(this)}return e.prototype.render=function(){var e,t,r=this,a=(0,l.createElement)('<div class="ArticleTableWrapper" contenteditable="false" data-table-wrapper></div>');this.container=(0,l.createElement)('<div class="ArticleTableContainer" contenteditable="false" data-table-container></div>'),this.tableEl=(0,l.createElement)('<table class="ArticleTable"></table>'),this.container.appendChild(this.tableEl),a.appendChild(this.container);var o=new n.Body,s=this.paragraph.children.reduce((function(e,t){var a=r.editor.getParagraphById(t);return a?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e),!1),[r.editor.renderParagraph(a)],!1):e}),[]);return this.bodyEl=o.render.apply(o,(0,i.__spreadArray)([],(0,i.__read)(s),!1)),this.tableEl.appendChild(this.bodyEl),this.el=Object.assign(a,(0,i.__assign)({setCaret:this.setCaret.bind(this),updateTablePosition:this.updateTablePosition.bind(this),updateTableScroll:this.updateTableScroll.bind(this),updateTableWidth:this.updateTableWidth.bind(this),handleSelectionChange:this.handleSelectionChange.bind(this),connectedCallback:this.connectedCallback.bind(this),objectTooltip:null},window.vkExpand&&((e={})[window.vkExpand]=this.paragraph.id,e))),this.initScroll(),null===(t=this.scroll)||void 0===t||t.hideScrollX(),this.renderAddMultipleColumnsButton(),this.renderAddMultipleRowsButton(),this.renderLeftFade(),m||(this.editor._setEventListener(window,"resize",this.handleResize),m=!0),this.el},e.prototype.connectedCallback=function(){var e,t;if(this.paragraph&&this.el){var r=this.el.querySelectorAll("[data-table-row]");try{for(var a=(0,i.__values)(r),n=a.next();!n.done;n=a.next()){n.value.connectedCallback()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}this.updateScrollX(),this.initEvents(),this.initDnD(),this.initGridSelection(),this.initTableHighlight(),this.updateTableWidth(),this.updateTablePosition(),this.setHeader(this.paragraph.table_has_row_header)}},e.prototype.initEvents=function(){var e=this;this.el&&(this.el.addEventListener("keydown",this.handleKeyDown.bind(this)),this.el.addEventListener("paste",this.handlePaste.bind(this)),this.el.addEventListener("hoverRightColumnSeparator",(function(t){return e.toggleVisibleRightColumnSeparator.call(e,t.detail.cellIndex,!0)})),this.el.addEventListener("hoverAddColumnButton",(function(t){return e.toggleVisibleRightColumnSeparator.call(e,t.detail.cellIndex,!0)})),this.el.addEventListener("blurRightColumnSeparator",(function(t){return e.toggleVisibleRightColumnSeparator.call(e,t.detail.cellIndex,!1)})),this.el.addEventListener("blurAddColumnButton",(function(t){return e.toggleVisibleRightColumnSeparator.call(e,t.detail.cellIndex,!1)})),this.el.addEventListener("hoverAddRowButton",(function(t){return e.toggleVisibleBottomRowSeparator.call(e,t.detail.rowIndex,!0)})),this.el.addEventListener("blurAddRowButton",(function(t){return e.toggleVisibleBottomRowSeparator.call(e,t.detail.rowIndex,!1)})),this.el.addEventListener("openRowActionSheet",(function(t){return e.showRowHighlight.call(e,t.detail.rowIndex)})),this.el.addEventListener("closeRowActionSheet",this.handleCloseActionSheet.bind(this)),this.el.addEventListener("addRow",(function(t){var r;return e.addRow.call(e,null===(r=t.detail)||void 0===r?void 0:r.rowIndex,{})})),this.el.addEventListener("removeRow",this.removeSelectedRows.bind(this,{})),this.el.addEventListener("moveRow",(function(t){return e.moveSelectedRows.call(e,t.detail.newIndex)})),this.el.addEventListener("openColumnActionSheet",(function(t){return e.showColumnHighlight.call(e,t.detail.cellIndex)})),this.el.addEventListener("closeColumnActionSheet",this.handleCloseActionSheet.bind(this)),this.el.addEventListener("addColumn",(function(t){var r;return e.addColumn.call(e,null===(r=t.detail)||void 0===r?void 0:r.cellIndex,{})})),this.el.addEventListener("removeColumn",this.removeSelectedColumns.bind(this,{})),this.el.addEventListener("moveColumn",(function(t){return e.moveSelectedColumns.call(e,t.detail.newIndex)})),this.el.addEventListener("setHeader",(function(t){return e.setHeader.call(e,t.detail.value)})),this.el.addEventListener("resizeColumnStep",(function(t){return e.resizeColumn.call(e,t.detail.cellIndex,t.detail.dx)})),this.el.addEventListener("resizeColumnFinish",(function(t){return e.finishResizeColumn.call(e,t.detail.cellIndex)})),this.el.addEventListener("adjustColumnSize",(function(t){return e.adjustColumnSize.call(e,t.detail.cellIndex)})),this.el.addEventListener("changeColumnColor",(function(t){return e.changeSelectedColumnsColor.call(e,t.detail.color)})),this.el.addEventListener("changeRowColor",(function(t){return e.changeSelectedRowsColor.call(e,t.detail.color)})),this.el.addEventListener("cellActiveStatusChanged",(function(t){return e.handleChangeCellActiveStatus(t.target,t.detail.value)})))},e.prototype.toggleVisibleRightColumnSeparator=function(e,t){var r,a;if(this.container){var n=(0,i.__spreadArray)([],(0,i.__read)(this.container.querySelectorAll("[data-table-cell]:nth-child("+(e+1)+")")),!1);try{for(var o=(0,i.__values)(n),s=o.next();!s.done;s=o.next()){s.value.toggleVisibleRightColumnSeparator(t)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}}},e.prototype.toggleVisibleLeftColumnSeparator=function(e,t){var r,a;if(this.container){var n=(0,i.__spreadArray)([],(0,i.__read)(this.container.querySelectorAll("[data-table-cell]:nth-child("+(e+1)+")")),!1);try{for(var o=(0,i.__values)(n),s=o.next();!s.done;s=o.next()){s.value.toggleVisibleLeftColumnSeparator(t)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}}},e.prototype.toggleVisibleBottomRowSeparator=function(e,t){var r,a;if(this.container){var n=(0,i.__spreadArray)([],(0,i.__read)(this.container.querySelectorAll("[data-table-row]:nth-child("+(e+1)+") [data-table-cell]")),!1);try{for(var o=(0,i.__values)(n),s=o.next();!s.done;s=o.next()){s.value.toggleVisibleBottomRowSeparator(t)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}}},e.prototype.toggleVisibleTopRowSeparator=function(e,t){var r,a;if(this.container){var n=(0,i.__spreadArray)([],(0,i.__read)(this.container.querySelectorAll("[data-table-row]:nth-child("+(e+1)+") [data-table-cell]")),!1);try{for(var o=(0,i.__values)(n),s=o.next();!s.done;s=o.next()){s.value.toggleVisibleTopRowSeparator(t)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}}},e.prototype.showRowHighlight=function(e){var t=this.selectedRows[0],r=this.selectedRows[this.selectedRows.length-1];this.selectedRows.includes(e)||(e>=t&&e<=r?(this.setSelectedRows((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.selectedRows),!1),[e],!1)),this.selectedRows.sort((function(e,t){return e-t}))):(this.setSelectedColumns([]),this.setSelectedRows([e])),this.tableHighlight&&(this.tableHighlight.hasFullHighlight=!1)),this.highlightCurrentSelectedCells()},e.prototype.showColumnHighlight=function(e){var t=this.selectedColumns[0],r=this.selectedColumns[this.selectedColumns.length-1];this.selectedColumns.includes(e)||(e>=t&&e<=r?(this.setSelectedColumns((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.selectedColumns),!1),[e],!1)),this.selectedColumns.sort((function(e,t){return e-t}))):(this.setSelectedRows([]),this.setSelectedColumns([e])),this.tableHighlight&&(this.tableHighlight.hasFullHighlight=!1)),this.highlightCurrentSelectedCells()},e.prototype.handleCloseActionSheet=function(){var e;1!==this.selectedRows.length&&1!==this.selectedColumns.length||this.isDragging||(this.setSelectedRows([]),this.setSelectedColumns([]),null===(e=this.tableHighlight)||void 0===e||e.hideCellHighlight())},e.prototype.handleChangeCellActiveStatus=function(e,t){t?(this.curActiveCell&&this.curActiveCell!==e&&this.curActiveCell.hideHighlight(),this.curActiveCell=e):this.curActiveCell===e&&(this.curActiveCell.hideHighlight(),this.curActiveCell=null)},e.prototype.updateCells=function(e,t){var r,a;if(this.bodyEl){var n=this.bodyEl.querySelector("[data-table-row]:nth-child("+(e+1)+")");if(n){var o="number"==typeof t?n.querySelectorAll("[data-table-cell]:nth-child("+(t+1)+")"):n.querySelectorAll("[data-table-cell]");try{for(var s=(0,i.__values)(o),l=s.next();!l.done;l=s.next()){l.value.update()}}catch(e){r={error:e}}finally{try{l&&!l.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}}}},e.prototype.isTableLargeThanCanvas=function(){if(this.tableEl)return this.tableEl.getBoundingClientRect().width>this.editor.getCanvasEl().getBoundingClientRect().width},e.prototype.correctColumnWidthToFillFreeWidth=function(){var e,t;if(this.paragraph&&this.paragraph.children&&this.paragraph.table_columns_resized){var r=this.editor.getParagraphById(this.paragraph.children[0]);if(r){for(var n=0,o=[],s=0;s<r.children.length;s++){var l=r.children[s],d=this.editor.getParagraphById(l);if(d){var c=this.editor.getParagraphElById(d.id),h=c?c.getBoundingClientRect().width:this.paragraph.table_columns_width[s]||0;this.paragraph.table_columns_resized[s]?n+=h:o.push(s)}}var p=this.editor.getCanvasEl(),u=parseInt(window.getComputedStyle(p).width)-n,g=Math.max(a.TABLE_CELL_DEFAULT_WIDTH,u/o.length);try{for(var m=(0,i.__values)(o),v=m.next();!v.done;v=m.next()){var _=v.value;this.setColumnWidth(_,g)}}catch(t){e={error:t}}finally{try{v&&!v.done&&(t=m.return)&&t.call(m)}finally{if(e)throw e.error}}}}},e.prototype.addColumn=function(e,t){var r,i=void 0===t?{}:t,a=i.setCaret,n=void 0===a||a,s=i.save,l=void 0===s||s;if(this.bodyEl){e="number"==typeof e?e:this.selectedColumns[this.selectedColumns.length-1],o.addColumnAfter(this.editor,this.paragraph,e);for(var d=0;d<this.paragraph.children.length;d++){if(p=this.editor.getParagraphById(this.paragraph.children[d])){var c=this.editor.getParagraphById(p.children[e]),h=null==c?void 0:c.table_bg_color_row;h&&o.changeCellRowColor(this.editor,this.paragraph,d,e+1,h)}}this.isTableLargeThanCanvas()||this.correctColumnWidthToFillFreeWidth(),l&&this.editor.history.saveUndoState();for(d=0;d<this.paragraph.children.length;d++){var p;if(p=this.editor.getParagraphById(this.paragraph.children[d])){var u=this.editor.getParagraphById(p.children[e+1]);if(u){var g=this.editor.renderParagraph(u),m=this.bodyEl.querySelector("[data-table-row]:nth-child("+(d+1)+") [data-table-cell]:nth-child("+(e+1)+")");null==m||m.after(g),g.connectedCallback(),g.getPosition().isLast&&this.updateCells(d,e)}}}this.setSelectedColumns([]),this.updateTableWidth(),this.updateTablePosition(),n&&this.setCaret(0,e+1),null===(r=this.editor.comments)||void 0===r||r.updateCommentElements(),this.editor.saveDraft()}},e.prototype.removeSelectedColumns=function(e){var t,r,a,n,s,l=this,d=void 0===e?{}:e,c=d.setCaret,h=void 0===c||c,p=d.save,u=void 0===p||p;if(this.bodyEl){var g=this.selectedColumns[0],m=this.selectedColumns[this.selectedColumns.length-1];if(o.removeColumn(this.editor,this.paragraph,g,this.selectedColumns.length),this.editor.getParagraphById(this.paragraph.children[0])){this.isTableLargeThanCanvas()||(this.paragraph.table_columns_resized[this.paragraph.table_columns_resized.length-1]=!1);try{for(var v=(0,i.__values)(this.bodyEl.children),_=v.next();!_.done;_=v.next()){var f=_.value,y=(0,i.__spreadArray)([],(0,i.__read)(f.children),!1).slice(g,m+1);try{for(var b=(a=void 0,(0,i.__values)(y)),C=b.next();!C.done;C=b.next()){var w=C.value,E=w.getGridPosition(),P=void 0;E.cell.isFirst?P=E.cell.index:E.cell.isLast&&(P=E.cell.index-1),w.remove(),void 0!==P&&this.updateCells(E.row.index,P)}}catch(e){a={error:e}}finally{try{C&&!C.done&&(n=b.return)&&n.call(b)}finally{if(a)throw a.error}}}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}this.isTableLargeThanCanvas()||this.correctColumnWidthToFillFreeWidth(),this.updateTableWidth(),this.updateTablePosition();var S=this.paragraph.table_columns_count-1,A=m+1-this.selectedColumns.length,I=Math.min(A,S);h&&setTimeout((function(){l.setCaret(0,I)})),this.setSelectedColumns([]),u&&this.editor.history.saveUndoState(),null===(s=this.editor.comments)||void 0===s||s.updateCommentElements(),this.editor.saveDraft()}}},e.prototype.moveSelectedColumns=function(e){var t,r,a,n,s,l,d=this;if(this.bodyEl){var c=this.selectedColumns[0],h=this.selectedColumns[this.selectedColumns.length-1];o.moveColumns(this.editor,this.paragraph,c,this.selectedColumns.length,e),this.editor.history.saveUndoState();for(var p=0;p<this.bodyEl.children.length;p++){var u=this.bodyEl.children[p],g=new Set,m=u.children[c],v=u.children[h];m.getPosition().isFirst&&g.add(v.nextElementSibling),v.getPosition().isLast&&g.add(m.previousElementSibling);var _=(0,i.__spreadArray)([],(0,i.__read)(u.children),!1).slice(c,h+1);try{for(var f=(t=void 0,(0,i.__values)(_)),y=f.next();!y.done;y=f.next()){(E=y.value).remove()}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}var b=u.children[e];b?b.before.apply(b,(0,i.__spreadArray)([],(0,i.__read)(_),!1)):u.append.apply(u,(0,i.__spreadArray)([],(0,i.__read)(_),!1)),m.getPosition().isFirst&&g.add(v.nextElementSibling),v.getPosition().isLast&&g.add(m.previousElementSibling);try{for(var C=(a=void 0,(0,i.__values)(_)),w=C.next();!w.done;w=C.next()){var E=w.value;g.add(E)}}catch(e){a={error:e}}finally{try{w&&!w.done&&(n=C.return)&&n.call(C)}finally{if(a)throw a.error}}try{for(var P=(s=void 0,(0,i.__values)(g)),S=P.next();!S.done;S=P.next()){var A=S.value;this.updateCells(p,A.getPosition().index)}}catch(e){s={error:e}}finally{try{S&&!S.done&&(l=P.return)&&l.call(P)}finally{if(s)throw s.error}}}this.setSelectedColumns([]),setTimeout((function(){d.setCaret(0,e)})),this.editor.saveDraft()}},e.prototype.addRow=function(e,t){var r,i=this,a=void 0===t?{}:t,n=a.setCaret,s=void 0===n||n,l=a.save,d=void 0===l||l;if(this.bodyEl){e="number"==typeof e?e:this.selectedRows[this.selectedRows.length-1],o.addRowAfter(this.editor,this.paragraph,e);var c=this.editor.getParagraphById(this.paragraph.children[e]),h=this.editor.getParagraphById(this.paragraph.children[e+1]);if(c&&h){for(var p=0;p<h.children.length;p++){var u=this.editor.getParagraphById(c.children[p]),g=null==u?void 0:u.table_bg_color_column;g&&o.changeCellColumnColor(this.editor,this.paragraph,e+1,p,g)}d&&this.editor.history.saveUndoState();var m=this.editor.renderParagraph(h),v=this.bodyEl.querySelector("[data-table-row]:nth-child("+(e+1)+")");null==v||v.after(m),m.connectedCallback();var _=m.getPosition(),f=_.index;_.isLast&&this.updateCells(f-1),s&&setTimeout((function(){"number"==typeof e&&i.setCaret(e+1,0)})),this.setSelectedRows([]),null===(r=this.editor.comments)||void 0===r||r.updateCommentElements(),this.editor.saveDraft()}}},e.prototype.removeSelectedRows=function(e){var t,r,a,n,s=this,l=void 0===e?{}:e,d=l.setCaret,c=void 0===d||d,h=l.save,p=void 0===h||h;if(this.bodyEl){var u=this.selectedRows[0],g=this.selectedRows[this.selectedRows.length-1];o.removeRow(this.editor,this.paragraph,u,this.selectedRows.length);var m=(0,i.__spreadArray)([],(0,i.__read)(this.bodyEl.children),!1).slice(u,g+1);try{for(var v=(0,i.__values)(m),_=v.next();!_.done;_=v.next()){var f=_.value,y=f.getPosition(),b=y.isFirst,C=y.isLast,w=y.index,E=void 0;b?E=w:C&&(E=w-1),f.remove(),void 0!==E&&this.updateCells(E),b&&(null===(a=this.columnDnD)||void 0===a||a.destroy(),this.initColumnDnD())}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}var P=this.paragraph.children.length-1,S=g+1-this.selectedRows.length,A=Math.min(S,P);c&&setTimeout((function(){s.setCaret(A,0)})),this.setSelectedRows([]),p&&this.editor.history.saveUndoState(),null===(n=this.editor.comments)||void 0===n||n.updateCommentElements(),this.editor.saveDraft()}},e.prototype.moveSelectedRows=function(e){var t,r,a,n,s,l,d,c,h,p,u=this;if(this.bodyEl&&this.paragraph){var g=this.selectedRows[0],m=this.selectedRows[this.selectedRows.length-1],v=this.bodyEl.children[g],_=this.bodyEl.children[m],f=new Set;v.getPosition().isFirst&&f.add(_.nextElementSibling),_.getPosition().isLast&&f.add(v.previousElementSibling);var y=(0,i.__spreadArray)([],(0,i.__read)(this.bodyEl.children),!1).slice(g,m+1);try{for(var b=(0,i.__values)(y),C=b.next();!C.done;C=b.next()){var w=C.value;this.bodyEl.removeChild(w)}}catch(e){t={error:e}}finally{try{C&&!C.done&&(r=b.return)&&r.call(b)}finally{if(t)throw t.error}}var E=this.bodyEl.children[e];E?E.before.apply(E,(0,i.__spreadArray)([],(0,i.__read)(y),!1)):(a=this.bodyEl).append.apply(a,(0,i.__spreadArray)([],(0,i.__read)(y),!1)),v.getPosition().isFirst&&f.add(_.nextElementSibling),_.getPosition().isLast&&f.add(v.previousElementSibling);try{for(var P=(0,i.__values)(y),S=P.next();!S.done;S=P.next()){w=S.value;f.add(w)}}catch(e){n={error:e}}finally{try{S&&!S.done&&(s=P.return)&&s.call(P)}finally{if(n)throw n.error}}try{for(var A=(0,i.__values)(f),I=A.next();!I.done;I=A.next()){var L=I.value,T=L.getPosition();if(T.isFirst&&this.paragraph.table_has_row_header){var x=(0,i.__spreadArray)([],(0,i.__read)(L.children),!1);try{for(var M=(c=void 0,(0,i.__values)(x)),B=M.next();!B.done;B=M.next()){B.value.setRowColor(null)}}catch(e){c={error:e}}finally{try{B&&!B.done&&(h=M.return)&&h.call(M)}finally{if(c)throw c.error}}}this.updateCells(T.index),L.setHeader(this.paragraph.table_has_row_header&&T.isFirst)}}catch(e){l={error:e}}finally{try{I&&!I.done&&(d=A.return)&&d.call(A)}finally{if(l)throw l.error}}(0===g||v.getPosition().isFirst)&&(null===(p=this.columnDnD)||void 0===p||p.destroy(),this.initColumnDnD()),setTimeout((function(){u.setCaret(e,0)})),o.moveRows(this.editor,this.paragraph,g,this.selectedRows.length,e),0===e&&this.paragraph.table_has_row_header&&o.changeRowColor(this.editor,this.paragraph,0,null),this.editor.history.saveUndoState(),this.editor.saveDraft()}},e.prototype.setHeader=function(e){var t,r;if(this.bodyEl&&this.paragraph){var a=this.bodyEl.querySelector("[data-table-row]"),n=a.querySelector("[data-table-cell]");if(e?(a.setHeader(!0),n.setHeader(!0)):(a.setHeader(!1),n.setHeader(!1)),e){var s=(0,i.__spreadArray)([],(0,i.__read)(a.children),!1);try{for(var l=(0,i.__values)(s),d=l.next();!d.done;d=l.next()){d.value.setRowColor(null),o.changeRowColor(this.editor,this.paragraph,0,null)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}o.setHeader(this.editor,this.paragraph,e),this.editor.history.saveUndoState(),this.editor.saveDraft()}},e.prototype.resizeColumn=function(e,t){var r,i;if(this.el&&this.container){var a=this.container.querySelector("[data-table-cell]:nth-child("+(e+1)+")"),n=parseInt(window.getComputedStyle(a).width,10);this.curMinColumnWidth||(this.curMinColumnWidth=a.getMinContentWidth());var o=Math.max(n+Math.round(t),this.curMinColumnWidth);this.resizing||(this.editor.getCanvasEl().classList.add("no_events"),null===(r=window.getSelection())||void 0===r||r.removeAllRanges(),this.resizing=!0,this.el.classList.add("ArticleTableWrapper--resizing"),document.body.style.cursor="col-resize",a.showColumnSizeTip()),this.setSelectedRows([]),this.setSelectedColumns([]),null===(i=this.tableHighlight)||void 0===i||i.hideCellHighlight(),this.setColumnWidth(e,o,!0),this.updateTableWidth(),this.updateTablePosition()}},e.prototype.setColumnWidth=function(e,t,r){if(void 0===r&&(r=!1),this.container&&this.paragraph){var i=this.editor.getParagraphById(this.paragraph.children[0]);if(i){if(e===i.children.length-1){var n=this.editor.getCanvasEl(),s=parseInt(window.getComputedStyle(n).width);if(this.paragraph.table_columns_width.reduce((function(r,i,a){return r+(a===e?t:i)}),0)<=s+1){var l=s-this.paragraph.table_columns_width.slice(0,this.paragraph.table_columns_count-1).reduce((function(e,t){return e+t}),0);if(this.paragraph.table_columns_width[e]<=l)return;t=l}}t=Math.max(t,a.TABLE_CELL_MIN_WIDTH);var d=this.editor.getParagraphElById(i.children[e]);d&&d.setWidth(t,r),o.setColumnWidth(this.editor,this.paragraph,e,t,r),this.editor.saveDraft()}}},e.prototype.finishResizeColumn=function(e){this.el&&this.container&&(this.container.querySelector("[data-table-cell]:nth-child("+(e+1)+")").hideColumnSizeTip(),this.editor.getCanvasEl().classList.remove("no_events"),this.resizing=!1,document.body.style.removeProperty("cursor"),this.el.classList.remove("ArticleTableWrapper--resizing"),this.editor.history.saveUndoState(),this.curMinColumnWidth=null)},e.prototype.adjustColumnSize=function(e){var t;if(this.container){var r=(0,i.__spreadArray)([],(0,i.__read)(this.container.querySelectorAll("[data-table-cell]:nth-child("+(e+1)+")")),!1),n=window.innerWidth,o=Math.max.apply(Math,(0,i.__spreadArray)([],(0,i.__read)(r.map((function(e){return(0,a.getOwnWidth)(e.getContentEl())}))),!1))+2+2;this.setColumnWidth(e,Math.min(o,n),!0),this.setSelectedRows([]),this.setSelectedColumns([]),null===(t=this.tableHighlight)||void 0===t||t.hideCellHighlight(),this.updateTableWidth(),this.updateTablePosition()}},e.prototype.changeSelectedColumnsColor=function(e){var t,r;if(this.el&&this.paragraph){var n=e===a.TABLE_CELL_DEFAULT_BG?null:e;try{for(var s=(0,i.__values)(this.selectedColumns),l=s.next();!l.done;l=s.next()){for(var d=l.value,c=(0,i.__spreadArray)([],(0,i.__read)(this.el.querySelectorAll("[data-table-cell]:nth-child("+(d+1)+")")),!1),h=0;h<c.length;h++){c[h].setColumnColor(n)}o.changeColumnColor(this.editor,this.paragraph,d,n)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}this.editor.history.saveUndoState(),this.editor.saveDraft()}},e.prototype.changeSelectedRowsColor=function(e,t){var r,n,s,l;if(void 0===t&&(t=!0),this.el){var d=e===a.TABLE_CELL_DEFAULT_BG?null:e;try{for(var c=(0,i.__values)(this.selectedRows),h=c.next();!h.done;h=c.next()){var p=h.value,u=(0,i.__spreadArray)([],(0,i.__read)(this.el.querySelectorAll(" [data-table-row]:nth-child("+(p+1)+") [data-table-cell]")),!1);try{for(var g=(s=void 0,(0,i.__values)(u)),m=g.next();!m.done;m=g.next()){m.value.setRowColor(d)}}catch(e){s={error:e}}finally{try{m&&!m.done&&(l=g.return)&&l.call(g)}finally{if(s)throw s.error}}o.changeRowColor(this.editor,this.paragraph,p,d)}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}t&&(this.editor.history.saveUndoState(),this.editor.saveDraft())}},e.prototype.updateTablePosition=function(){var e;if(this.container&&this.el){var t=this.editor.getCanvasEl(),r=window.getComputedStyle(t).width,i=window.getComputedStyle(this.container).width,n=parseInt(i)-parseInt(r),o=t.getBoundingClientRect().left,s=Math.min(Math.abs(a.TABLE_DEFAULT_LEFT_OFFSET)+n/2,o);this.el.style.left=-s+"px",null===(e=this.scroll)||void 0===e||e.update()}},e.prototype.updateTableWidth=function(){if(this.tableEl&&this.el&&this.container){var e=this.paragraph.table_columns_width.reduce((function(e,t){return e+t}),0);this.tableEl.style.width=e+"px";var t=parseInt(window.getComputedStyle(this.editor.getCanvasEl()).width),r=window.getComputedStyle(this.container),i=Math.max(e,t)+parseInt(r.paddingLeft)+parseInt(r.paddingRight);this.el.style.width=Math.min(i,window.innerWidth-a.TABLE_EDITOR_PADDING)+"px"}},e.prototype.initDnD=function(){this.initRowDnD(),this.initColumnDnD()},e.prototype.initRowDnD=function(){var e,t,r=this;this.el&&this.bodyEl&&(this.rowDnD=new s.DnD(this.el,{mirrorContainer:this.el,direction:"vertical",isDraggableHandle:function(e){return e instanceof HTMLElement&&e.hasAttribute("data-draggable-vertical")},getDraggable:function(e){if(!r.bodyEl)return null;var t=(0,u.traverseParent)(e,(function(e){if(e instanceof HTMLElement&&e.hasAttribute("data-table-row"))return e}));if(t&&t instanceof HTMLElement)return r.setSelectedRows([]),t;var i=r.bodyEl.children[r.selectedRows[0]];return i&&i instanceof HTMLElement?i:null},onDrag:function(e,t){var a,n,o,s,l,d,c;if(r.el&&r.tableEl&&r.bodyEl&&r.highlighterWrapper){r.el.classList.add("ArticleTableWrapper--dragging"),r.isDragging=!0,null===(l=window.getSelection())||void 0===l||l.removeAllRanges(),r.selectedRows.length||r.setSelectedRows([e.getPosition().index]);for(var h=r.selectedRows[0],p=r.selectedRows[r.selectedRows.length-1],u=h!==p,g=[],m=(0,i.__spreadArray)([],(0,i.__read)(r.bodyEl.children),!1).slice(h,p+1),v=0;v<m.length;v++){var _=m[v],f=(0,i.__spreadArray)([],(0,i.__read)(_.children),!1);try{for(var y=(a=void 0,(0,i.__values)(f)),b=y.next();!b.done;b=y.next()){var C=b.value;C.hideContent(),u?C.hideRowActionSheet():C.closeRowActionSheet(),0===v&&g.push(parseInt(window.getComputedStyle(C).width))}}catch(e){a={error:e}}finally{try{b&&!b.done&&(n=y.return)&&n.call(y)}finally{if(a)throw a.error}}}var w=r.tableEl.cloneNode(),E=r.bodyEl.cloneNode(),P=[],S=function(e){var t=r.editor.getParagraphById(r.paragraph.children[e]);if(!t)return"continue";for(var a=r.editor.renderParagraph(t),n=(0,i.__spreadArray)([],(0,i.__read)(a.querySelectorAll("[data-table-cell]")),!1),o=function(t){var i=n[t];null===(d=i.getContentEl())||void 0===d||d.setAttribute("contenteditable","false"),requestAnimationFrame((function(){if(r.bodyEl){a.setAttribute("class",r.bodyEl.children[e].classList.value);var n=r.bodyEl.children[e].children[t];if(i.setAttribute("class",""+n.classList),!u){var o=i.getPosition();i.showHighlight(!1,!o.isLast,!1,!o.isFirst,!0)}i.hideAddColumnButton(),i.hideAddRowButton(),i.hideColumnActionSheet(),u&&i.hideRowActionSheet(),i.style.width=g[t]+"px",i.style.minWidth=g[t]+"px"}}))},s=0;s<n.length;s++)o(s);P.push(a)};for(v=h;v<=p;v++)S(v);w.append(E),E.append.apply(E,(0,i.__spreadArray)([],(0,i.__read)(P),!1));try{for(var A=(0,i.__values)(P),I=A.next();!I.done;I=A.next()){var L=I.value;null===(c=L.connectedCallback)||void 0===c||c.call(L)}}catch(e){o={error:e}}finally{try{I&&!I.done&&(s=A.return)&&s.call(A)}finally{if(o)throw o.error}}if(t.append(w),u){var T=r.highlighterWrapper.children[0].cloneNode(!0);T.removeAttribute("style"),t.append(T)}r.tableHighlight&&(r.tableHighlight.hideCellHighlight(),r.tableHighlight.closeRowActionSheet())}},onDrop:function(a,n){var o,s,l,d,c;if(r.el&&r.bodyEl&&r.tableEl){var h=r.selectedRows[0],p=r.selectedRows[r.selectedRows.length-1],u=(0,i.__spreadArray)([],(0,i.__read)(r.bodyEl.children),!1).slice(h,p+1);try{for(var g=(0,i.__values)(u),m=g.next();!m.done;m=g.next()){var v=m.value,_=(0,i.__spreadArray)([],(0,i.__read)(v.querySelectorAll("[data-table-cell]")),!1);try{for(var f=(l=void 0,(0,i.__values)(_)),y=f.next();!y.done;y=f.next()){y.value.showContent()}}catch(e){l={error:e}}finally{try{y&&!y.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}}}catch(e){o={error:e}}finally{try{m&&!m.done&&(s=g.return)&&s.call(g)}finally{if(o)throw o.error}}null===(c=window.getSelection())||void 0===c||c.removeAllRanges(),e&&(r.toggleVisibleBottomRowSeparator(e.getPosition().index,!1),e=null),t&&(r.toggleVisibleTopRowSeparator(t.getPosition().index,!1),t=null);var b,C=a.getPosition().index;if(n){var w=n.getPosition().index;!r.selectedRows.includes(w)&&!r.selectedRows.includes(w+1)&&(b=w<C?w+1:w-r.selectedRows.length+1)}else 0!==h&&(b=0);if("number"==typeof b)r.moveSelectedRows(b);else if(1===r.selectedRows.length){var E=a.querySelector("[data-table-cell]");E&&(E.showRowActionSheet(),E.openRowActionSheet())}else if(r.tableHighlight){var P=r.tableEl.querySelectorAll("[data-table-row]:first-child [data-table-cell]").length;r.tableHighlight.showCellHighlight(0,h,P-1,p),r.tableHighlight.openRowActionSheet()}r.el.classList.remove("ArticleTableWrapper--dragging"),r.isDragging=!1}},onIntersection:function(i,a,n){if(e&&r.toggleVisibleBottomRowSeparator(e.getPosition().index,!1),t&&r.toggleVisibleTopRowSeparator(t.getPosition().index,!1),a){var o=a.getPosition().index;!r.selectedRows.includes(o)&&!r.selectedRows.includes(o+1)&&(r.toggleVisibleBottomRowSeparator(o,!0),e=a)}else if(n){var s=n.getPosition().index;!r.selectedRows.includes(s)&&(r.toggleVisibleTopRowSeparator(s,!0),t=n)}}}))},e.prototype.initColumnDnD=function(){var e=this;if(this.el&&this.container){var t,r,a=this.container.querySelector("[data-table-row]");this.columnDnD=new s.DnD(this.el,{mirrorContainer:this.el,direction:"horizontal",isDraggableHandle:function(e){return e instanceof HTMLElement&&e.hasAttribute("data-draggable-horizontal")},getDraggable:function(t){var r=(0,u.traverseParent)(t,(function(e){if(e instanceof HTMLElement&&e.hasAttribute("data-table-cell"))return e}));if(r&&r instanceof HTMLElement)return e.setSelectedColumns([]),r;var i=a.children[e.selectedColumns[0]];return i&&i instanceof HTMLElement?i:null},onDrag:function(t,r){var a,n,o;if(e.el&&e.tableEl&&e.bodyEl&&e.container&&e.paragraph&&e.highlighterWrapper){e.el.classList.add("ArticleTableWrapper--dragging"),e.isDragging=!0,null===(o=window.getSelection())||void 0===o||o.removeAllRanges(),e.selectedColumns.length||e.setSelectedColumns([t.getPosition().index]);var s=e.selectedColumns[0],l=e.selectedColumns[e.selectedColumns.length-1],d=s!==l,c=(0,i.__spreadArray)([],(0,i.__read)(e.bodyEl.children),!1),h=(0,i.__spreadArray)([],(0,i.__read)(c[0].children),!1).slice(s,l+1).map((function(e){return e.getBoundingClientRect().width})),p=h.reduce((function(e,t){return e+t})),u=[];try{for(var g=(0,i.__values)(c),m=g.next();!m.done;m=g.next())for(var v=m.value,_=(0,i.__spreadArray)([],(0,i.__read)(v.children),!1).slice(s,l+1),f=0;f<_.length;f++){var y=_[f];y.hideContent(),d?y.hideColumnActionSheet():y.closeColumnActionSheet(),0===f&&u.push(parseInt(window.getComputedStyle(y).height))}}catch(e){a={error:e}}finally{try{m&&!m.done&&(n=g.return)&&n.call(g)}finally{if(a)throw a.error}}var b=e.tableEl.cloneNode();b.style.removeProperty("width");var C=e.bodyEl.cloneNode(),w=c.reduce((function(t,r,a){var n;if(!e.paragraph.children)return t;var o=e.editor.getParagraphById(e.paragraph.children[a]);if(!o)return t;var p=r.cloneNode();p.getPosition=function(){return{isLast:a===c.length-1,isFirst:0===a,index:a}};for(var g=s;g<=l;g++){var m=e.editor.getParagraphById(o.children[g]);if(m){var v=e.editor.renderParagraph(m);null===(n=v.getContentEl())||void 0===n||n.setAttribute("contenteditable","false"),p.appendChild(v),v.style.height=u[a]+"px"}}return requestAnimationFrame((function(){for(var e=(0,i.__spreadArray)([],(0,i.__read)(p.children),!1),t=0;t<e.length;t++){var a=e[t];if(a.connectedCallback(),a.style.width=h[t]+"px",a.setAttribute("class",""+r.children[t+s].classList),a.style.removeProperty("min-width"),!d){var n=a.getGridPosition();a.showHighlight(!n.row.isFirst,!n.cell.isLast,!n.row.isLast,!n.cell.isFirst,!0)}a.hideAddColumnButton(),a.hideAddRowButton(),a.hideRowActionSheet(),d&&a.hideColumnActionSheet()}})),(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t),!1),[p],!1)}),[]);if(b.append(C),C.append.apply(C,(0,i.__spreadArray)([],(0,i.__read)(w),!1)),r.append(b),d){var E=e.highlighterWrapper.children[0].cloneNode(!0);E.removeAttribute("style"),r.append(E)}r.style.maxWidth=p+"px",r.style.minWidth=p+"px",e.tableHighlight&&(e.tableHighlight.hideCellHighlight(),e.tableHighlight.closeColumnActionSheet())}},onDrop:function(a,n){var o,s,l,d,c;if(e.el&&e.container&&e.tableEl&&e.bodyEl){var h=e.selectedColumns[0],p=e.selectedColumns[e.selectedColumns.length-1];try{for(var u=(0,i.__values)(e.bodyEl.children),g=u.next();!g.done;g=u.next()){var m=g.value,v=(0,i.__spreadArray)([],(0,i.__read)(m.children),!1).slice(h,p+1);try{for(var _=(l=void 0,(0,i.__values)(v)),f=_.next();!f.done;f=_.next()){f.value.showContent()}}catch(e){l={error:e}}finally{try{f&&!f.done&&(d=_.return)&&d.call(_)}finally{if(l)throw l.error}}}}catch(e){o={error:e}}finally{try{g&&!g.done&&(s=u.return)&&s.call(u)}finally{if(o)throw o.error}}null===(c=window.getSelection())||void 0===c||c.removeAllRanges(),t&&(e.toggleVisibleRightColumnSeparator(t.getPosition().index,!1),t=null),r&&(e.toggleVisibleLeftColumnSeparator(r.getPosition().index,!1),r=null);var y,b=a.getPosition().index;if(n){var C=n.getPosition().index;!e.selectedColumns.includes(C)&&!e.selectedColumns.includes(C+1)&&(y=C<b?C+1:C-e.selectedColumns.length+1)}else 0!==h&&(y=0);if("number"==typeof y)e.moveSelectedColumns(y);else if(1===e.selectedColumns.length)a.showColumnActionSheet(),a.openColumnActionSheet();else if(e.tableHighlight){var w=e.tableEl.querySelectorAll("[data-table-row]").length;e.tableHighlight.showCellHighlight(h,0,p,w-1),e.tableHighlight.openColumnActionSheet()}e.el.classList.remove("ArticleTableWrapper--dragging"),e.isDragging=!1}},onIntersection:function(i,a,n){if(t&&e.toggleVisibleRightColumnSeparator(t.getPosition().index,!1),r&&e.toggleVisibleLeftColumnSeparator(r.getPosition().index,!1),a){var o=a.getPosition().index;!e.selectedColumns.includes(o)&&!e.selectedColumns.includes(o+1)&&(e.toggleVisibleRightColumnSeparator(o,!0),t=a)}else if(n){var s=n.getPosition().index;!e.selectedColumns.includes(s)&&(e.toggleVisibleLeftColumnSeparator(s,!0),r=n)}}})}},e.prototype.setSelectedColumns=function(e){if(this.tableEl){var t=this.tableEl.querySelector("[data-table-row]");if(t){for(var r=t.querySelectorAll("[data-table-cell]").length,i=e.length===r,a=0;a<t.children.length;a++){var n=t.children[a];e.includes(a)&&e.length>1&&!i?n.hideColumnActionSheet():n.showColumnActionSheet()}this.selectedColumns=e}}},e.prototype.setSelectedRows=function(e){if(this.bodyEl){for(var t=this.bodyEl.querySelectorAll("[data-table-row]").length,r=e.length===t,i=0;i<this.bodyEl.children.length;i++){var a=this.bodyEl.children[i].querySelector("[data-table-cell]");a&&(e.includes(i)&&e.length>1&&!r?a.hideRowActionSheet():a.showRowActionSheet())}this.selectedRows=e}},e.prototype.initGridSelection=function(){var e=this;if(this.tableEl){var t=null,r=null,i=function(i){var a;if(i.target instanceof Node){var n=(0,u.traverseParent)(i.target,(function(e){if(e.hasAttribute("data-table-cell"))return!0}));n&&(n!==t?(e.gridSelectionActive||(r=e.editor.cursor.getCursor()||null,null===(a=window.getSelection())||void 0===a||a.removeAllRanges()),i.preventDefault()):e.gridSelectionActive&&(r&&e.editor.cursor.restoreCursor(r),e.gridSelectionActive=!1,i.preventDefault()))}};this.gridSelection=new p.GridSelection(this.tableEl,{isGridItem:function(e){return e instanceof HTMLElement&&e.hasAttribute("data-table-cell")},getGridPosition:function(e){var t=e.getGridPosition();return{rowIndex:t.row.index,columnIndex:t.cell.index}},onStart:function(r){e.el&&(t=r,e.el.classList.add("ArticleTableWrapper--dragging"),e.el.addEventListener("mousemove",i,!0))},onFinish:function(){e.el&&(e.gridSelectionActive=!1,e.el.classList.remove("ArticleTableWrapper--dragging"),e.el.removeEventListener("mousemove",i,!0))},onChange:function(t){var r,i=t.selectedRows,a=t.selectedColumns,n=t.mode,o=t.initialItem;if(!e.isDragging&&!e.resizing&&e.el){if(n){e.gridSelectionActive=!0,null===(r=window.getSelection())||void 0===r||r.removeAllRanges();var s=null==o?void 0:o.querySelector("[data-table-cell-content]");s instanceof HTMLElement&&s.blur()}e.setSelectedRows(i),e.setSelectedColumns(a),requestAnimationFrame((function(){e.highlightCurrentSelectedCells()}))}}})}},e.prototype.initTableHighlight=function(){this.tableEl&&this.container&&(this.highlighterWrapper=(0,l.createElement)('<div class="ArticleTable__highlight '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>'),this.tableHighlight=new h.TableHighlight(this.editor.getEditorEl(),this.tableEl),this.highlighterWrapper.append(this.tableHighlight.render()),this.container.appendChild(this.highlighterWrapper),this.highlighterWrapper.addEventListener("openRowActionSheet",(function(e){return e.stopPropagation()})),this.highlighterWrapper.addEventListener("openColumnActionSheet",(function(e){return e.stopPropagation()})))},e.prototype.highlightCurrentSelectedCells=function(){var e,t,r,i;if(this.container){this.selectedColumns.length||this.selectedRows.length||null===(e=this.tableHighlight)||void 0===e||e.hideCellHighlight();var a=this.container.querySelectorAll("[data-table-row]").length,n=this.container.querySelectorAll("[data-table-row]:first-child [data-table-cell]").length;if((this.selectedColumns.length===n||this.selectedRows.length===a)&&this.el)null===(t=this.tableHighlight)||void 0===t||t.showFullHighlight(),this.setSelectedRows([]),this.setSelectedColumns([]),this.container&&c.SelectionManager.setRange(this.container.parentElement,0,this.container.parentElement,1);else{if(this.selectedColumns.length){var o=this.selectedColumns[0],s=this.selectedColumns[this.selectedColumns.length-1];null===(r=this.tableHighlight)||void 0===r||r.showCellHighlight(o,0,s,a-1)}if(this.selectedRows.length){var l=this.selectedRows[0],d=this.selectedRows[this.selectedRows.length-1];null===(i=this.tableHighlight)||void 0===i||i.showCellHighlight(0,l,n-1,d)}}}},e.prototype.initScroll=function(){var e=this;this.el&&(this.scroll=new d.Scroll(this.el),this.scroll.onDragStart=function(){var t,r;null===(t=e.el)||void 0===t||t.classList.add("no_select"),null===(r=window.getSelection())||void 0===r||r.removeAllRanges()},this.scroll.onDragEnd=function(){var t;return null===(t=e.el)||void 0===t?void 0:t.classList.remove("no_select")},this.scroll.onScrollX=function(t){var r,i;null===(i=null===(r=e.el)||void 0===r?void 0:r.objectTooltip)||void 0===i||i.updatePosition(),e.paragraph._table_current_scroll=t,t>20?e.showLeftFade():e.hideLeftFade()})},e.prototype.updateScrollX=function(){var e,t=this;null===(e=this.scroll)||void 0===e||e.setScrollX(this.paragraph._table_current_scroll),requestAnimationFrame((function(){var e;null===(e=t.scroll)||void 0===e||e.showScrollX()}))},e.prototype.renderAddMultipleColumnsButton=function(){var e=this;this.container&&(this.addMultipleColumnsButton=new g.AddMultipleButton({mode:"horizontal",step:a.TABLE_CELL_DEFAULT_WIDTH,getMinX:function(){var t;if(!e.tableEl)return 0;var r=null===(t=e.tableEl)||void 0===t?void 0:t.getBoundingClientRect();return(r.left+r.right)/2+document.body.scrollLeft}}),this.addMultipleColumnsButton.onStart=function(){var t,r,i;e.editor.history.saveUndoState(),document.body.style.cursor="col-resize",null===(t=e.el)||void 0===t||t.classList.add("ArticleTableWrapper--sizePicker"),null===(r=e.el)||void 0===r||r.classList.add("no_select"),null===(i=e.el)||void 0===i||i.classList.add("no_events")},this.addMultipleColumnsButton.onFinish=function(){var t,r,i;e.editor.history.saveUndoState(),document.body.style.removeProperty("cursor"),null===(t=e.el)||void 0===t||t.classList.remove("ArticleTableWrapper--sizePicker"),null===(r=e.el)||void 0===r||r.classList.remove("no_select"),null===(i=e.el)||void 0===i||i.classList.remove("no_events")},this.addMultipleColumnsButton.onAdd=function(){if(!e.el)return!1;var t=e.el.querySelectorAll("[data-table-row]:first-child [data-table-cell]").length-1;return e.addColumn(t,{setCaret:!1,save:!1}),!0},this.addMultipleColumnsButton.onRemove=function(){if(!e.el)return!1;var t=e.el.querySelectorAll("[data-table-row]:first-child [data-table-cell]").length-1;return!(0===t||!e.isColumnEmpty(t))&&(e.setSelectedColumns([t]),e.removeSelectedColumns({setCaret:!1,save:!1}),!0)},this.addMultipleColumnsButtonWrapper=(0,l.createElement)('<div class="ArticleTable__addMultipleColumns '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>'),this.addMultipleColumnsButtonWrapper.addEventListener("mousedown",(function(){var t,r;e.setSelectedColumns([]),e.setSelectedRows([]),null===(t=e.tableHighlight)||void 0===t||t.hideCellHighlight(),null===(r=e.tableHighlight)||void 0===r||r.hideFullHighlight()})),this.addMultipleColumnsButtonWrapper.append(this.addMultipleColumnsButton.render()),this.container.append(this.addMultipleColumnsButtonWrapper))},e.prototype.renderAddMultipleRowsButton=function(){var e=this;this.container&&(this.addMultipleRowsButton=new g.AddMultipleButton({mode:"vertical",step:a.TABLE_CELL_DEFAULT_HEIGHT,getMinX:function(){var t;if(!e.tableEl)return 0;var r=null===(t=e.tableEl)||void 0===t?void 0:t.getBoundingClientRect();return(r.left+r.right)/2+document.body.scrollLeft}}),this.addMultipleRowsButton.onStart=function(){var t,r,i;e.editor.history.saveUndoState(),document.body.style.cursor="row-resize",null===(t=e.el)||void 0===t||t.classList.add("ArticleTableWrapper--sizePicker"),null===(r=e.el)||void 0===r||r.classList.add("no_select"),null===(i=e.el)||void 0===i||i.classList.add("no_events")},this.addMultipleRowsButton.onFinish=function(){var t,r,i;e.editor.history.saveUndoState(),document.body.style.removeProperty("cursor"),null===(t=e.el)||void 0===t||t.classList.remove("ArticleTableWrapper--sizePicker"),null===(r=e.el)||void 0===r||r.classList.remove("no_select"),null===(i=e.el)||void 0===i||i.classList.remove("no_events")},this.addMultipleRowsButton.onAdd=function(){if(!e.el)return!1;var t=e.el.querySelectorAll("[data-table-row]").length-1;return e.addRow(t,{setCaret:!1,save:!1}),!0},this.addMultipleRowsButton.onRemove=function(){if(!e.el)return!1;var t=e.el.querySelectorAll("[data-table-row]").length-1;return!(0===t||!e.isRowEmpty(t))&&(e.setSelectedRows([t]),e.removeSelectedRows({setCaret:!1,save:!1}),!0)},this.addMultipleRowsButtonWrapper=(0,l.createElement)('<div class="ArticleTable__addMultipleRows '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>'),this.addMultipleRowsButtonWrapper.addEventListener("mousedown",(function(){var t,r;e.setSelectedColumns([]),e.setSelectedRows([]),null===(t=e.tableHighlight)||void 0===t||t.hideCellHighlight(),null===(r=e.tableHighlight)||void 0===r||r.hideFullHighlight()})),this.addMultipleRowsButtonWrapper.append(this.addMultipleRowsButton.render()),this.container.append(this.addMultipleRowsButtonWrapper))},e.prototype.renderLeftFade=function(){this.el&&(this.leftFadeEl=(0,l.createElement)('<div class="ArticleTableLeftFade '+a.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>'),this.el.append(this.leftFadeEl))},e.prototype.showLeftFade=function(){this.leftFadeEl&&this.leftFadeEl.classList.add("ArticleTableLeftFade--active")},e.prototype.hideLeftFade=function(){this.leftFadeEl&&this.leftFadeEl.classList.remove("ArticleTableLeftFade--active")},e.prototype.isColumnEmpty=function(e){var t,r;if(!this.paragraph.children)return!1;try{for(var n=(0,i.__values)(this.paragraph.children),o=n.next();!o.done;o=n.next()){var s=o.value,l=this.editor.getParagraphById(s);if(!l)return!1;var d=this.editor.getParagraphById(l.children[e]);if(!d)return!1;var c=this.editor.getParagraphById(d.children[0]);if(!(1===d.children.length&&(0,a.isParagraphEmpty)(c)))return!1}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return!0},e.prototype.isRowEmpty=function(e){var t,r;if(!this.paragraph.children)return!1;var n=this.editor.getParagraphById(this.paragraph.children[e]);if(!n)return!1;try{for(var o=(0,i.__values)(n.children),s=o.next();!s.done;s=o.next()){var l=s.value,d=this.editor.getParagraphById(l);if(!d)return!1;var c=this.editor.getParagraphById(d.children[0]);if(!(1===d.children.length&&(0,a.isParagraphEmpty)(c)))return!1}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return!0},e.prototype.updateTableScroll=function(){this.scroll&&this.scroll.update()},e.prototype.setCaret=function(e,t,r){void 0===r&&(r=!0);var i=this.editor.getParagraphElById(this.paragraph.id);if(i){e||(e=0),t||(t=0);var a=i.querySelector(" [data-table-row]:nth-child("+(e+1)+") [data-table-cell]:nth-child("+(t+1)+")");if(a){var n=a.querySelector("[data-table-cell-content]");if(n){var o=r?n.lastChild:n.firstChild;c.SelectionManager.setCaretAtElement(o,r)}}}},e.prototype.handlePaste=function(e){var t,r=(0,i.__read)(this.editor.getCurrentParagraphId(),1)[0];if((0,a.isArticleParagraphId)(r)){var n=e.clipboardData||(null===(t=e.originalEvent)||void 0===t?void 0:t.clipboardData),o=null==n?void 0:n.getData("text/plain");o&&!o.startsWith("uuid:")&&(document.execCommand("insertText",!1,o),this.editor.setParagraphDirty(r),this.editor._triggerInputEvent()),e.preventDefault(),e.stopPropagation()}},e.prototype.handleKeyDown=function(e){this.handleArrowKeys(e),this.handleChangeFocus(e)},e.prototype.handleChangeFocus=function(e){if(this.container){var t=(0,i.__read)(this.editor.getCurrentParagraphId(),1)[0],r=this.editor.getParagraphById(t);if(!(0,a.isListParagraph)(r))if(e.keyCode==a.Key.Tab){var n=e.target instanceof HTMLElement?e.target.closest("[data-table-cell]"):null;if(!n)return;var o=n.getGridPosition(),s=o.row.isFirst&&o.cell.isFirst,l=o.row.isLast&&o.cell.isLast,d=this.container.querySelectorAll("[data-table-row]:first-child [data-table-cell]").length,h=o.row.index,p=o.cell.index,u=!1;if(e.shiftKey)s||(o.cell.isFirst?(h-=1,p=d-1,u=!0):(p-=1,u=!0));else if(l){var g=this.editor.getNextParagraphIdById(this.paragraph.id),m=this.editor.getParagraphElById(g||null);m&&(c.SelectionManager.setCaretAtElement(m,!0),e.stopPropagation(),e.preventDefault())}else o.cell.isLast?(h+=1,p=0,u=!0):(p+=1,u=!0);u&&(this.setCaret(h,p,!0),e.stopPropagation(),e.preventDefault())}}},e.prototype.handleArrowKeys=function(e){var t,r=e.keyCode;if([a.Key.Up,a.Key.Down].includes(r)){var n=(0,i.__read)(this.editor.getCurrentParagraphId(),1)[0],o=this.editor.getParagraphById(n),s=this.editor.getParagraphElById(n);if(o&&(0,a.isArticleParagraphId)(n)&&s)if((0,a.isTextParagraph)(o)||(0,a.isListParagraph)(o)){var l=e.target instanceof HTMLElement?null===(t=e.target)||void 0===t?void 0:t.closest("[data-table-cell]"):null;if(!l)return;var d=l.getGridPosition(),h=this.editor.isFirstParagraph(n)&&(c.SelectionManager.atTheFirstTextLineIn(s)||(0,a.isParagraphEmpty)(o))&&r===a.Key.Up,p=this.editor.isLastParagraph(n)&&(c.SelectionManager.atTheLastTextLineIn(s)||(0,a.isParagraphEmpty)(o))&&r===a.Key.Down;if(h){if(d.row.isFirst){var u=this.editor.getPrevParagraphIdById(this.paragraph.id);this.editor.focusParagraph(u,!0)}else this.setCaret(d.row.index-1,d.cell.index);e.preventDefault(),e.stopPropagation()}else if(p){if(d.row.isLast){var g=this.editor.getNextParagraphIdById(this.paragraph.id);this.editor.focusParagraph(g)}else this.setCaret(d.row.index+1,d.cell.index,!1);e.preventDefault(),e.stopPropagation()}}}},e.prototype.handleResize=function(){var e,t,r=Array.from(this.editor.getEditorEl().querySelectorAll("[data-table-wrapper]"));try{for(var a=(0,i.__values)(r),n=a.next();!n.done;n=a.next()){var o=n.value;o.updateTablePosition(),o.updateTableWidth(),o.updateTableScroll()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},e.prototype.handleSelectionChange=function(){var e,t,r,a;if(this.el){var n=(0,i.__read)(c.SelectionManager.getRange(),3),o=n[0],s=n[2];if(o&&s){var l=this.editor.getCanvasEl();if(this.tableEl&&s.containsNode(this.tableEl)||o.startContainer===l&&o.startContainer.children[o.startOffset]===this.el||o.endContainer===l&&o.endContainer.children[o.endOffset]===this.el||o.startContainer!==l&&o.endContainer!==l&&o.commonAncestorContainer!==l&&o.commonAncestorContainer.contains(this.tableEl))(null===(e=this.tableHighlight)||void 0===e?void 0:e.hasFullHighlight)||(null===(t=this.tableHighlight)||void 0===t||t.showFullHighlight(),this.setSelectedRows([]),this.setSelectedColumns([]));else{(null===(r=this.tableHighlight)||void 0===r?void 0:r.hasFullHighlight)&&this.tableHighlight.hideFullHighlight();var d=!!(0,u.traverseParent)(o.commonAncestorContainer,(function(e){return e instanceof HTMLElement&&e.hasAttribute("data-table-cell-content")})),h=!!(0,u.traverseParent)(o.commonAncestorContainer,(function(e){return e instanceof HTMLElement&&e.hasAttribute("data-table-wrapper")}));!d&&h||this.isDragging||this.gridSelectionActive||(this.setSelectedRows([]),this.setSelectedColumns([]),null===(a=this.tableHighlight)||void 0===a||a.hideCellHighlight())}}}},e}()},66737:(e,t,r)=>{"use strict";r.d(t,{TableHighlight:()=>l});var i=r(749140),a=r(598985),n=r(159501),o=r(83178),s=r(530791),l=function(){function e(e,t){this.highlighter=null,this.rowActionSheet=null,this.rowActionSheetWrapper=null,this.columnActionSheet=null,this.columnActionSheetWrapper=null,this.hasFullHighlight=!1,this.editorEl=e,this.tableEl=t}return e.prototype.render=function(){return this.el=(0,i.createElement)('<div class="ArticleTableMultipleHighlight '+o.ArticleEditorInnerComponentsClass+'" contenteditable="false"></div>'),this.highlighter=new a.Highlight,this.el.append(this.highlighter.render()),this.renderRowActionSheet(),this.renderColumnActionSheet(),this.hideRowActionSheet(),this.hideColumnActionSheet(),this.el},e.prototype.renderRowActionSheet=function(){var e=this;this.rowActionSheet=new n.RowActionSheet(this.editorEl,o.TABLE_CELL_DEFAULT_BG,!0),this.rowActionSheet.canSetHeader=function(){return!1},this.rowActionSheet.onClose=function(){return e.dispatchEvent("closeRowActionSheet")},this.rowActionSheet.onAddRow=function(){return e.dispatchEvent("addRow")},this.rowActionSheet.onRemove=function(){return e.dispatchEvent("removeRow")},this.rowActionSheet.onChangeColor=function(t){return e.dispatchEvent("changeRowColor",{color:t})},this.rowActionSheetWrapper=(0,i.createElement)('<div class="ArticleTableMultipleHighlight__actionSheetH" contenteditable="false"></div>'),this.rowActionSheetWrapper.append(this.rowActionSheet.render()),this.el.append(this.rowActionSheetWrapper),this.rowActionSheet.icon.setAttribute("data-draggable-vertical","")},e.prototype.renderColumnActionSheet=function(){var e=this;this.columnActionSheet=new s.ColumnActionSheet(this.editorEl,o.TABLE_CELL_DEFAULT_BG,!0),this.columnActionSheet.onClose=function(){return e.dispatchEvent("closeColumnActionSheet")},this.columnActionSheet.onAddColumn=function(){return e.dispatchEvent("addColumn")},this.columnActionSheet.onRemove=function(){return e.dispatchEvent("removeColumn")},this.columnActionSheet.onChangeColor=function(t){return e.dispatchEvent("changeColumnColor",{color:t})},this.columnActionSheetWrapper=(0,i.createElement)('<div class="ArticleTableMultipleHighlight__actionSheetV" contenteditable="false"></div>'),this.columnActionSheetWrapper.append(this.columnActionSheet.render()),this.el.append(this.columnActionSheetWrapper),this.columnActionSheet.icon.setAttribute("data-draggable-horizontal","")},e.prototype.hideRowActionSheet=function(){this.rowActionSheetWrapper&&this.rowActionSheet&&(this.rowActionSheetWrapper.style.visibility="hidden")},e.prototype.hideColumnActionSheet=function(){this.columnActionSheetWrapper&&this.columnActionSheet&&(this.columnActionSheetWrapper.style.visibility="hidden")},e.prototype.showRowActionSheet=function(){this.rowActionSheetWrapper&&this.rowActionSheet&&(this.rowActionSheetWrapper.style.visibility="visible")},e.prototype.showColumnActionSheet=function(){this.columnActionSheetWrapper&&this.columnActionSheet&&(this.columnActionSheetWrapper.style.visibility="visible")},e.prototype.closeRowActionSheet=function(){this.rowActionSheet&&(this.rowActionSheet.close(),this.rowActionSheet.hide())},e.prototype.closeColumnActionSheet=function(){this.columnActionSheet&&(this.columnActionSheet.close(),this.columnActionSheet.hide())},e.prototype.openRowActionSheet=function(){this.rowActionSheet&&(this.rowActionSheet.open(),this.rowActionSheet.show())},e.prototype.openColumnActionSheet=function(){this.columnActionSheet&&(this.columnActionSheet.open(),this.columnActionSheet.show())},e.prototype.showFullHighlight=function(){this.el&&this.highlighter&&(this.hasFullHighlight=!0,this.tableEl.classList.add("ArticleTableWrapper--highlight"),this.el.removeAttribute("style"),this.highlighter.show(!0),this.highlighter.roundTopLeft(),this.highlighter.roundTopRight(),this.highlighter.roundBottomLeft(),this.highlighter.roundBottomRight(),this.hideColumnActionSheet(),this.hideRowActionSheet())},e.prototype.hideFullHighlight=function(){this.el&&this.highlighter&&this.hasFullHighlight&&(this.hasFullHighlight=!1,this.el.classList.remove("ArticleTableWrapper--highlight"),this.highlighter.hide(),this.hideColumnActionSheet(),this.hideRowActionSheet())},e.prototype.showCellHighlight=function(e,t,r,i){var a=this;if(this.el&&this.highlighter&&this.tableEl&&this.columnActionSheet&&this.rowActionSheet){var n=this.tableEl.querySelectorAll("[data-table-row]").length,o=this.tableEl.querySelectorAll("[data-table-row]:first-child [data-table-cell]").length;if(0!==e||0!==t||r!==o-1||i!==n-1){0===t&&i===n-1&&r-e>0?(this.columnActionSheet.canMoveToLeft=function(){return 0!==e},this.columnActionSheet.canMoveToRight=function(){return r!==o-1},this.columnActionSheet.onMoveToLeft=function(){return a.dispatchEvent("moveColumn",{newIndex:e-1})},this.columnActionSheet.onMoveToRight=function(){return a.dispatchEvent("moveColumn",{newIndex:e+1})},this.showColumnActionSheet()):this.hideColumnActionSheet(),0===e&&r===o-1&&i-t>0?(this.rowActionSheet.canMoveToTop=function(){return 0!==t},this.rowActionSheet.canMoveToBottom=function(){return i!==n-1},this.rowActionSheet.onMoveToTop=function(){return a.dispatchEvent("moveRow",{newIndex:t-1})},this.rowActionSheet.onMoveToBottom=function(){return a.dispatchEvent("moveRow",{newIndex:t+1})},this.showRowActionSheet()):this.hideRowActionSheet(),this.highlighter.show(!0);var s=this.tableEl.querySelector("[data-table-row]:nth-child("+(t+1)+") [data-table-cell]:nth-child("+(e+1)+")"),l=this.tableEl.querySelector("[data-table-row]:nth-child("+(i+1)+") [data-table-cell]:nth-child("+(e+1)+")"),d=this.tableEl.querySelector("[data-table-row]:nth-child("+(t+1)+") [data-table-cell]:nth-child("+(r+1)+")"),c=this.tableEl.querySelector("[data-table-row]:nth-child("+(i+1)+") [data-table-cell]:nth-child("+(r+1)+")");if(s&&l&&d&&c){var h=this.tableEl.getBoundingClientRect(),p=s.getBoundingClientRect(),u=c.getBoundingClientRect();this.el.style.top=p.top-h.top+"px",this.el.style.right=h.right-u.right-1+"px",this.el.style.bottom=h.bottom-u.bottom+"px",this.el.style.left=p.left-h.left-1+"px",s.classList.contains("ArticleTableCell--roundTl")&&this.highlighter.roundTopLeft(),d.classList.contains("ArticleTableCell--roundTr")&&this.highlighter.roundTopRight(),l.classList.contains("ArticleTableCell--roundBl")&&this.highlighter.roundBottomLeft(),c.classList.contains("ArticleTableCell--roundBr")&&this.highlighter.roundBottomRight()}}else this.showFullHighlight()}},e.prototype.hideCellHighlight=function(){this.highlighter&&(this.highlighter.hide(),this.hideColumnActionSheet(),this.hideRowActionSheet())},e.prototype.dispatchEvent=function(e,t){this.el&&this.el.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:t}))},e}()},36534:(e,t,r)=>{"use strict";r.d(t,{clean:()=>n,extractUrls:()=>o,rand:()=>s,clone:()=>l,replaceTemplate:()=>d,replaceSpecialCharsInVkUrl:()=>c});var i=r(570655),a=r(83178);function n(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}function o(e,t){var r=/(?:([!()?@., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9_\-]+\.)+(?:[a-z]{2,10}|xn--p1ai|xn--j1amh|xn--80asehdb|xn--80aswg|xn--90ais))(\/.*?)?(\#.*?)?)(?:[\.!:;,\*\(\)]*(&nbsp;|[ \t\r\n \u00A0]))|([!()?., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9а-яєґї_\-]+\.)+(?:рф|укр|онлайн|сайт|срб|бел))(\/.*?)?(\#.*?)?)(?:[\.!:;,\*\(\)]*(&nbsp;|[ \t\r\n \u00A0])))/i;t&&(r=/(?:([!()?@., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9_\-]+\.)+(?:[a-z]{2,10}|xn--p1ai|xn--j1amh|xn--80asehdb|xn--80aswg|xn--90ais))(\/.*?)?(\#.*?)?)(?:[\.!:;,\*\(\)&]*(&nbsp;|[ \t\r\n \u00A0]|$))|([!()?., \n\r\t \u00A0]|^)((https?:\/\/)?((?:[a-z0-9а-яєґї_\-]+\.)+(?:рф|укр|онлайн|сайт|срб|бел))(\/.*?)?(\#.*?)?)(?:[\.!:;,\*\(\)&]*(&nbsp;|[ \t\r\n \u00A0]|$)))/i);for(var i,a=[];e&&(i=e.match(r))&&void 0!==i.index;)if(e=e.substr(i.index+i[0].length),i&&i.length&&!i[0].startsWith("@")){var n=0;i[4]||(n=7),a.push({url:i[2+n],query:i[5+n]||"",domain:i[4+n]})}return a}var s=function(e,t){return Math.random()*(t-e+1)+e},l=function(e){return JSON.parse(JSON.stringify(e))};function d(e,t){var r,a;try{for(var n=(0,i.__values)(Object.entries(t)),o=n.next();!o.done;o=n.next()){var s=(0,i.__read)(o.value,2),l=s[0],d=s[1];e=e.replace(new RegExp("%"+l+"%","g"),(void 0===d?"":d).toString().replace(/\$/g,"&#036;"))}}catch(e){r={error:e}}finally{try{o&&!o.done&&(a=n.return)&&a.call(n)}finally{if(r)throw r.error}}return e}var c=function(e){if((0,a.isVKUrl)(e)){var t=new URL(e);e=["/search","/feed"].includes(t.pathname)||t.searchParams.get("q")?e.replace("#","%23"):e.replace("%23","#")}return e}},390237:(e,t,r)=>{"use strict";r.d(t,{scrollGetY:()=>i,cancelEvent:()=>a,getXY:()=>n,getSize:()=>s,traverseParent:()=>l,findClosestElementWithSelector:()=>d,createElement:()=>c});var i=function(){return window.scrollY||document.documentElement.scrollTop};function a(e){return!!(e=e||window.event)&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.cancelBubble=!0,e.returnValue=!1,!1)}var n=function(e,t){var r=e.ownerDocument;if(!r)return[0,0];var i=r.documentElement,a=e.getBoundingClientRect();return[a.left+(t?0:window.scrollX||i.scrollLeft)-(i.clientLeft||0),a.top+(t?0:window.scrollY||i.scrollTop)-(i.clientTop||0)]},o=function(e,t){var r=e.getBoundingClientRect(),i=[r.width,r.height];if(!t)return i;var a=window.getComputedStyle(e);return i[0]-=parseFloat(a.paddingLeft)||0,i[0]-=parseFloat(a.borderLeftWidth)||0,i[0]-=parseFloat(a.paddingRight)||0,i[0]-=parseFloat(a.borderRightWidth)||0,i[1]-=parseFloat(a.paddingTop)||0,i[1]-=parseFloat(a.borderTopWidth)||0,i[1]-=parseFloat(a.paddingBottom)||0,i[1]-=parseFloat(a.borderBottomWidth)||0,i},s=function(e,t){void 0===t&&(t=!1);var r=[0,0],i=e instanceof HTMLElement?window.getComputedStyle(e):null;if(t&&"border-box"===(null==i?void 0:i.boxSizing)&&(t=!1),e)if(i&&"none"===i.display){var a=e.style.cssText.includes("!important")?e.style.cssText:"",n={position:e.style.position,visibility:e.style.visibility,display:e.style.display};e.style.position="absolute",e.style.visibility="hidden",e.style.display="block",r=o(e,t),e.style.position=n.position,e.style.visibility=n.visibility,e.style.display=n.display,a&&(e.style.cssText=a)}else r=o(e,t);return r};function l(e,t,r){for(void 0===r&&(r=999);e&&!t(e);){if(0===--r)return!1;try{if(!e.parentNode||e.parentNode===document)return!1;e=e.parentNode}catch(e){return!1}}return e}function d(e,t){var r;return t.nodeType===Node.ELEMENT_NODE?t.closest(e):null===(r=t.parentElement)||void 0===r?void 0:r.closest(e)}var c=function(e,t){void 0===t&&(t="div");var r=document.createElement(t);return r.innerHTML=e.trim(),r.firstElementChild}},455877:(e,t,r)=>{var i=r(423570),a=r(171171),n=a;n.v1=i,n.v4=a,e.exports=n},423570:(e,t,r)=>{var i,a,n=r(685217),o=r(45327),s=0,l=0;e.exports=function(e,t,r){var d=t&&r||0,c=t||[],h=(e=e||{}).node||i,p=void 0!==e.clockseq?e.clockseq:a;if(null==h||null==p){var u=n();null==h&&(h=i=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==p&&(p=a=16383&(u[6]<<8|u[7]))}var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:l+1,v=g-s+(m-l)/1e4;if(v<0&&void 0===e.clockseq&&(p=p+1&16383),(v<0||g>s)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=g,l=m,a=p;var _=(1e4*(268435455&(g+=122192928e5))+m)%4294967296;c[d++]=_>>>24&255,c[d++]=_>>>16&255,c[d++]=_>>>8&255,c[d++]=255&_;var f=g/4294967296*1e4&268435455;c[d++]=f>>>8&255,c[d++]=255&f,c[d++]=f>>>24&15|16,c[d++]=f>>>16&255,c[d++]=p>>>8|128,c[d++]=255&p;for(var y=0;y<6;++y)c[d+y]=h[y];return t||o(c)}}}]);try{stManager.done("dist/26c7804abc36bc7348ed5a4dec71c384.17ecac9d09ef702e0a28.js")}catch(e){}