(self.webpackChunkvk=self.webpackChunkvk||[]).push([[86164],{104022:(e,t,i)=>{"use strict";i.d(t,{default:()=>o});const o=(0,i(28178).makeIcon)("Icon16Videocam","videocam_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16" id="videocam_16"><path fill-rule="evenodd" d="M1.772 4.865C1.5 5.4 1.5 6.1 1.5 7.5v1c0 1.4 0 2.1.272 2.635a2.5 2.5 0 0 0 1.093 1.092C3.4 12.5 4.1 12.5 5.5 12.5h2c1.4 0 2.1 0 2.635-.273a2.5 2.5 0 0 0 1.092-1.092C11.5 10.6 11.5 9.9 11.5 8.5v-1c0-1.4 0-2.1-.273-2.635a2.5 2.5 0 0 0-1.092-1.093C9.6 3.5 8.9 3.5 7.5 3.5h-2c-1.4 0-2.1 0-2.635.272a2.5 2.5 0 0 0-1.093 1.093Zm10.95 1.487 1.876-1.25a.58.58 0 0 1 .902.482v4.832a.58.58 0 0 1-.902.483l-1.875-1.25a.5.5 0 0 1-.223-.417V6.768a.5.5 0 0 1 .223-.416Z" clip-rule="evenodd" /></symbol>',16,16,!1,void 0)},410902:(e,t,i)=>{"use strict";i.d(t,{default:()=>o});const o=(0,i(28178).makeIcon)("Icon24ErrorCircleOutline","error_circle_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="error_circle_outline_24"><path fill-rule="evenodd" d="M4.929 4.929A9.971 9.971 0 0 1 12 2a9.972 9.972 0 0 1 7.071 2.929A9.972 9.972 0 0 1 22 12a9.972 9.972 0 0 1-2.929 7.071A9.972 9.972 0 0 1 12 22a9.972 9.972 0 0 1-7.071-2.929A9.972 9.972 0 0 1 2 12a9.972 9.972 0 0 1 2.929-7.071ZM12 3.8a8.172 8.172 0 0 0-5.798 2.402A8.172 8.172 0 0 0 3.8 12a8.17 8.17 0 0 0 2.402 5.798A8.171 8.171 0 0 0 12 20.2a8.172 8.172 0 0 0 5.798-2.402A8.172 8.172 0 0 0 20.2 12a8.171 8.171 0 0 0-2.402-5.798A8.172 8.172 0 0 0 12 3.8ZM13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm-1-9a.9.9 0 0 1 .9.9v5.2a.9.9 0 0 1-1.8 0V7.9A.9.9 0 0 1 12 7Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},815653:(e,t,i)=>{"use strict";i.d(t,{default:()=>o});const o=(0,i(28178).makeIcon)("Icon24MenuOutline","menu_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="menu_outline_24"><path fill="currentColor" d="M21 11H3a1 1 0 1 0 0 2h18a1 1 0 1 0 0-2zm0-7H3a1 1 0 0 0 0 2h18a1 1 0 1 0 0-2zM3 20h18a1 1 0 1 0 0-2H3a1 1 0 1 0 0 2z" /></symbol>',24,24,!1,void 0)},281536:(e,t,i)=>{"use strict";i.d(t,{default:()=>o});const o=(0,i(28178).makeIcon)("Icon24MoreHorizontal","more_horizontal_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="more_horizontal_24"><g fill="none" fill-rule="evenodd"><path d="M24 0H0v24h24z" /><path fill="currentColor" d="M18 10c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2Zm-6 4c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Zm-6 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2Z" /></g></symbol>',24,24,!1,void 0)},521114:(e,t,i)=>{"use strict";i.d(t,{default:()=>o});const o=(0,i(28178).makeIcon)("Icon24NarrativeActiveOutline","narrative_active_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="narrative_active_outline_24"><path fill="currentColor" d="M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 1 1-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.726 1.726 0 0 0-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119c-.26.243-.43.539-.512.886-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302.244.26.54.43.887.512.401.093.745.076 1.607-.14a1 1 0 1 1 .487 1.94c-1.148.288-1.805.32-2.549.147a3.726 3.726 0 0 1-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.722 3.722 0 0 1 .93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22zM18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.174 4.174 0 0 1 2.036-.653z" /></symbol>',24,24,!1,void 0)},662199:(e,t,i)=>{"use strict";i.d(t,{default:()=>o});const o=(0,i(28178).makeIcon)("Icon24Write","write_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="write_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="m14.188 6.273 3.54 3.54-8.624 8.622a6.674 6.674 0 0 1-2.77 1.664l-2.903.886a.334.334 0 0 1-.416-.416l.886-2.902a6.674 6.674 0 0 1 1.664-2.771l8.623-8.623Zm1.061-1.06 1.769-1.77a1.5 1.5 0 0 1 2.121 0l1.418 1.419a1.5 1.5 0 0 1 0 2.121L18.79 8.752l-3.54-3.54Z" /></g></symbol>',24,24,!1,void 0)},488124:(e,t,i)=>{"use strict";i.d(t,{default:()=>o});const o=(0,i(28178).makeIcon)("Icon36Add","add_36","0 0 36 36",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" id="add_36"><g fill="none" fill-rule="evenodd"><path d="M0 0h36v36H0z" /><path fill="currentColor" d="M19.5 19.5v9a1.5 1.5 0 0 1-3 0v-9h-9a1.5 1.5 0 0 1 0-3h9v-9a1.5 1.5 0 0 1 3 0v9h9a1.5 1.5 0 0 1 0 3h-9Z" /></g></symbol>',36,36,!1,void 0)},622858:(e,t,i)=>{"use strict";i.d(t,{default:()=>d});i(140561);var o=i(927766),r=i(67328),n=i(873589),a=i(342269),s=i(152278);function l(e,t,i){if((0,a.isObject)(t)?i=t:this._dragElClass=t,this.options=(0,a.extend)({dragThreshold:l.DRAG_THRESHOLD_DIST},i),this._contEl=(0,n.ge)(e),this._contEl){this._excludedCount=0;for(var o=0;o<this._contEl.children.length;o++)this._contEl.children[o].getAttribute("nodrag")&&this._excludedCount++;(0,s.addEvent)(this._contEl,"mousedown",this._ev_mousedown_handler=this._onMouseDown.bind(this)),(0,n.setStyle)(this._contEl,"position","relative"),this._inited=!0,this._updateScrollbar=this._initUpdaterScrollbar()}}l.AUTO_SCROLL_DY=10,l.DRAG_THRESHOLD_DIST=0,l.AUTO_SCROLL_DISTANCE_THRESHOLD=300,l.AUTO_SCROLL_GAP=300,l.prototype.destroy=function(){this._inited&&(this._inited=!1,this._deinitEvents(!0))},l.prototype._getParentDragItemEl=function(e){for(var t,i=e;i&&(t=(0,n.domPN)(i))!==this._contEl;)i=t;return i===this._curPlaceholderEl&&(i=null),i},l.prototype._onKey=function(e){e.keyCode===s.KEY.ESC&&this.isCurrentlyDragging()&&this._onMouseUp()},l.prototype._onMouseDown=function(e){if(!(this._disabled||0!=e.button||this._curDragEl||(0,n.attr)(e.target,"nodrag")||this._dragElClass&&!(0,n.domClosest)(this._dragElClass,e.target))){for(var t=e.target;t&&t!==window.document;){if((0,a.intval)((0,n.domData)(t,"nodrag")))return;t=(0,n.domPN)(t)}var i=this._getParentDragItemEl(e.target);if(i&&!(0,n.attr)(i,"nodrag")&&((0,n.re)((0,n.geByClass1)("ui_gridsorter_placeholder"),this._contEl),this._contInfo=this._contInfo||{prevSize:(0,n.getSize)(this._contEl)},this._ensureGridIsActual(),!(this._grid.length<=1))){var o=window.getComputedStyle(i),r=(0,n.getXY)(i);this._initial={candidateEl:i,x:e.clientX,y:e.clientY,itemMargin:{x:parseInt(o.marginLeft),y:parseInt(o.marginTop)},shift:{x:e.pageX-r[0],y:e.pageY-r[1]}},(0,s.addEvent)(document,"mousemove",this._ev_mousemove_handler=this._onMouseMove.bind(this)),(0,s.addEvent)(document,"mouseup",this._ev_mouseup_handler=this._onMouseUp.bind(this)),(0,s.addEvent)(document,"keydown",this._ev_keydown_handler=this._onKey.bind(this)),cur.cancelClick=!1,(0,s.cancelEvent)(e)}}},l.prototype._dist=function(e){return Math.abs(e.clientX-this._initial.x)+Math.abs(e.clientY-this._initial.y)},l.prototype._onMouseUp=function(e){var t=this._curDragEl,i=!e;if(this._curDragEl){this._curDragEl=null,(0,n.removeClass)(t,"ui_gridsorter_moveable_notrans"),this._curOverCell||(this._curOverCell={el:this._curPlaceholderEl,pos:(0,n.getXY)(this._curPlaceholderEl),size:(0,n.getSize)(this._curPlaceholderEl)});var o=this._curOverCell.pos,r=this._curOverCell.el,a=this._grid[this._curDragCellIndex],l=a&&a.size;(0,n.gpeByClass)("_ape_item_list",t)&&(o[0]+=20,o[1]+=20),l&&this._isShiftToLeft&&(o[1]-=l[1]-this._curOverCell.size[1]),setTimeout((()=>{if(i){for(var e=0,r=this._grid.length;e<r;e++){var n=this._grid[e];n.dirty&&this._setPos(n.el,{left:0,top:0})}this._setPos(t,this._initialCurDragPos)}else this._setPos(t,{left:o[0],top:o[1]})})),setTimeout((()=>{if((0,n.re)(this._curPlaceholderEl),(0,n.removeClass)(this._contEl,"ui_gridsorter_cont"),this.options.dragCls&&(0,n.removeClass)(t,this.options.dragCls),this._inited){var e;if(i){for(var o=this._grid.length,a=0;a<o;a++){var s=this._grid[a];s.dirty&&this._setPos(s.el,{left:null,top:null})}this._setPos(t,{left:null,top:null,width:null,height:null})}else{var l;e=this._isShiftToLeft?(0,n.domNS)(r):r,this._contEl.insertBefore(t,e);var d=-1,c=this._initial.hasInlineSize;this._setPos(t,{left:null,top:null}),c||(0,n.setStyle)(t,{width:null,height:null});for(var v=this._grid.length,u=0;u<v;u++){var h=this._grid[u];(h.dirty||h.el===t)&&(this._setPos(h.el,{left:null,top:null}),c||(0,n.setStyle)(h.el,{width:null,height:null}),h.pos=this._calcElementPos(h.el),h.dirty=!1),h.el===t?l=u:h.el===r&&(d=u)}if(d>=0){var _=this._grid.splice(l,1);this._grid.splice(d,0,_[0])}}(0,n.removeClass)(t,"ui_gridsorter_moveable"),this._curOverCell=this._curPlaceholderEl=null,i&&this.update(),this.options.onDragFinish&&this.options.onDragFinish(t),r!==t&&!i&&this.options.onReorder&&this.options.onReorder(t,e,(0,n.domPS)(t))}}),210),e&&this._dist(e)>5&&((0,s.cancelEvent)(e),cur.cancelClick=!0)}this._updateScrollbar(),this._deinitEvents(),t&&this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,t),i||t&&this._overEl&&this.options.onDragDrop&&(i=this.options.onDragDrop(this._overEl,t)),this._overEl=null},l.prototype._deinitEvents=function(e){e&&(this._onMouseUp(),(0,s.removeEvent)(this._contEl,"mousedown",this._ev_mousedown_handler)),clearTimeout(this._autoScrollTO),this._autoScrollTO=!1,this._ev_mousemove_handler&&(0,s.removeEvent)(document,"mousemove",this._ev_mousemove_handler),this._ev_mouseup_handler&&(0,s.removeEvent)(document,"mouseup",this._ev_mouseup_handler),this._ev_keydown_handler&&(0,s.removeEvent)(document,"keydown",this._ev_keydown_handler)},l.prototype._setPos=function(e,t){this.options.noPosTransform||!this._hasTranslateFeauture&&!(this._hasTranslateFeauture=window.getComputedStyle(e).getPropertyValue("transform"))?(0,n.setStyle)(e,(0,a.extend)({transform:null},t)):null===t.left||null===t.top?(0,n.setStyle)(e,{transform:null,top:null,left:null}):(0,n.setStyle)(e,{transform:"translate("+t.left+"px, "+t.top+"px)",top:null,pos:null})},l.prototype._recalc=function(){var e=this._curDragEl,t=this._curOverCell.el;if(this._initGrid(),t!==e){for(var i=0,o=!1,r=!1,n=this._grid.length,a=0;a<n;a++){var s=this._grid[a];if(s.el===e){o=!0;break}if(s.el===t){o=!1;break}}this._isShiftToLeft=o;for(var l=o?0:this._grid.length-1,d=o?this._grid.length:-1,c=o?1:-1,v=[0,0];l!==d;l+=c){var u=this._grid[l];if(2!==i)if(u.el!==e){if(u.el===t&&i++,1===i||2===i){var h=0,_=0;o?(h=r.pos[0]+v[0],_=r.pos[1]+v[1],v[0]+=u.size[0]-r.size[0],v[1]+=u.size[1]-r.size[1]):(v[0]+=r.size[0]-u.size[0],v[1]+=r.size[1]-u.size[1],h=r.pos[0]+v[0],_=r.pos[1]+v[1]),this._setPos(u.el,{left:h-u.pos[0],top:_-u.pos[1]}),u.dirty=!0}else u.dirty&&(this._setPos(u.el,{left:null,top:null}),u.dirty=!1);r=u}else i++,r=u;else u.dirty&&(this._setPos(u.el,{left:null,top:null}),u.dirty=!1),r=u}}else for(var p=this._grid.length,g=0;g<p;g++){var f=this._grid[g];f.el!==e&&f.dirty&&(f.dirty=!1,this._setPos(f.el,{left:null,top:null}))}},l.prototype.disable=function(){this._disabled=!0},l.prototype.enable=function(){this._disabled=!1,this._initGrid(!0)},l.prototype.update=function(){this._disabled||this._initGrid(!0)},l.prototype._ensureGridIsActual=function(){this._initGrid()},l.prototype._needGridUpdate=function(){if(!this._grid)return 1;this._contInfo.prevSize=this._contInfo.prevSize||(0,n.getSize)(this._contEl);var e=0,t=this._contEl.children.length-this._excludedCount-(0,a.intval)(!!this._curPlaceholderEl);if(t!==this._grid.length)e=t>this._grid.length?2:1,this._contInfo.prevSize=(0,n.getSize)(this._contEl);else{var i=(0,n.getSize)(this._contEl),o=this._contInfo.prevSize;(Math.abs(o[0]-i[0])>5||Math.abs(o[1]-i[1])>5)&&(e=1),this._contInfo.prevSize=i}return e},l.prototype._initGrid=function(e){var t=e?1:this._needGridUpdate();if(t){1===t&&(this._grid=[],this._contInfo&&(delete this._contInfo.pos,delete this._contInfo.size));var i=this._grid?this._grid[this._grid.length-1]:null;this._grid=this._grid||[];var o,r=!!i,a=this._contEl.children;if(a.length)for(var s=this._getItemMargins(),l=this._curDragEl?this._grid.length:0,d=a.length;l<d;l++){var c=a[l];i&&c===i.el?r=!1:r||c===this._curPlaceholderEl||c.getAttribute("nodrag")||((o=(0,n.getSize)(c))[0]+=s[0],o[1]+=s[1],this._grid.push({el:c,size:o,pos:this._calcElementPos(c)}))}}},l.prototype._getRelativeMousePos=function(e){var t=this._getContPos(),i=this._getContShift();return{left:e.clientX-t[0]-i[0],top:e.clientY-t[1]-i[1]}},l.prototype._updateDraggablePosition=function(e){if(this._curDragEl){var t=this._getRelativeMousePos(e),i=this._getItemShift(),o=this._getContShift(),r=this._getContSize(),a=t.top-this._initial.shift.y-i[1]+o[1];this.options.limitBottomMove&&(a=Math.min(a,r[1]+30)),(0,n.hasClass)(this._contEl,"_ape_item_list")&&(a+=this._contEl.scrollTop),this._setPos(this._curDragEl,{left:t.left-this._initial.shift.x-i[0]+o[0],top:a}),window.AudioPage&&window.AudioPage.onUpdateDraggablePosition&&window.AudioPage.onUpdateDraggablePosition()}},l.prototype._getContShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.shift){var e=window.getComputedStyle(this._contEl);this._contInfo.shift=[parseFloat(e.paddingLeft),parseFloat(e.paddingTop)]}return this._contInfo.shift},l.prototype._getContSize=function(){return this._contInfo=this._contInfo||{},this._contInfo.size=(0,n.getSize)(this._contEl),this._contInfo.size},l.prototype._getContPos=function(){return this._contInfo=this._contInfo||{},this._contInfo.pos=(0,n.getXY)(this._contEl),this._contInfo.pos[1]-=(0,o.scrollGetY)(),this._contInfo.pos},l.prototype._getItemShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemShift){var e=window.getComputedStyle((0,n.domFC)(this._contEl));this._contInfo.itemShift=[parseFloat(e.marginLeft),parseFloat(e.marginTop)]}return this._contInfo.itemShift},l.prototype._getItemMargins=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemMargins){var e=window.getComputedStyle((0,n.domFC)(this._contEl));this._contInfo.itemMargins=[parseFloat(e.marginLeft)+parseFloat(e.marginRight),parseFloat(e.marginTop)+parseFloat(e.marginBottom)]}return this._contInfo.itemMargins},l.prototype._calcElementPos=function(e){var t=this._getContShift(),i=this._getItemShift();return[e.offsetLeft-t[0]-i[0],e.offsetTop-t[1]-i[1]]},l.prototype.isCurrentlyDragging=function(){return!!this._curDragEl},l.prototype._initUpdaterScrollbar=function(){return(0,r.throttle)((e=>{var t=this.options.wrapNode||e,i=(0,n.data)(t,"sb");i&&i.update(!1,!0)}),500)},l.prototype._onMouseMove=function(e){var t=()=>this.options.wrapNode?this.options.wrapNode.scrollTop:(0,o.scrollGetY)(),i=e=>{this.options.wrapNode?this.options.wrapNode.scrollTop=e:(0,o.scrollToY)(e,0,!1,!0)};if(this._curDragEl){this._ensureGridIsActual(),!e&&(e={clientX:this._lastMousePos.x,clientY:this._lastMousePos.y}),this._lastMousePos={x:e.clientX,y:e.clientY},this._updateDraggablePosition(e);var r=this._getContSize(),a=this._getRelativeMousePos(e),l=!1;if((0,n.hasClass)(this._contEl,"_ape_item_list")&&(a.top+=this._contEl.scrollTop),a.left>0&&a.left<r[0]&&a.top>0&&a.top<r[1])for(var d=0,c=this._grid.length-1,v=50;v;){var u=d+Math.floor((c-d)/2),h=this._grid[u];if(a.left>h.pos[0]&&a.top>h.pos[1]&&a.left<h.pos[0]+h.size[0]&&a.top<h.pos[1]+h.size[1]){l=h;break}if(d===c)break;a.top<h.pos[1]||a.left<h.pos[0]&&a.top<h.pos[1]+h.size[1]?c=c===u?c-1:u:d=d===u?d+1:u,v--}else{for(var _,p,g,f=this._grid.length,m=999999,w=0;w<f;w++){var y=this._grid[w],S=(p=a.left-(y.pos[0]+y.size[0]/2))*p+(g=a.top-(y.pos[1]+y.size[1]/2))*g;m>S&&(m=S,_=y)}l=_}!l||this._curOverCell&&this._curOverCell.el===l.el||(this._curOverCell=l,this._recalc());var C,x,N,b,k=0;if(this.options.wrapNode)C=b=this.options.wrapNode,x=(0,n.getSize)(C),(N=(0,n.getXY)(C))[1]-=(0,o.scrollGetY)(),k=e.clientY;else{var E=window,L=document.documentElement,T=document.body,B=E.innerWidth||L.clientWidth||T.clientWidth,I=E.innerHeight||L.clientHeight||T.clientHeight;b=E.bodyNode,x=[B,I],N=[0,0],k=e.clientY}var D=Math.max(20,x[1]/10),P=N[1]+D-k,j=D-(N[1]+x[1]-k);if(j>0||P>0){var A=Math.min(1,P/D),R=Math.min(1,j/D);this._autoScrollTO||(this._autoScrollTO=setTimeout((()=>{this._autoScrollTO=!1;var e=t();i(e+16*(A>0?-A:R)),e!==b.scrollTop&&(this._updateScrollbar(b),this._onMouseMove())}),20))}if(this.options.onDragOverElClass){var M=e.target;(0,n.hasClass)(M,this.options.onDragOverElClass)||(M=(0,n.gpeByClass)(this.options.onDragOverElClass,M))?this._overEl!==M&&(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this.options.onDragEnter&&this.options.onDragEnter(M,this._curDragEl),this._overEl=M):(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this._overEl=null)}}else if(this._dist(e)>this.options.dragThreshold){this._curDragEl=this._initial.candidateEl;for(var O=this._grid.length,H=0;H<O;H++)if(this._grid[H].el===this._curDragEl){this._curDragCellIndex=H;break}this.options.dragCls&&(0,n.addClass)(this._curDragEl,this.options.dragCls);var U=(0,n.getSize)(this._curDragEl),F=(0,n.getXY)(this._curDragEl),G=window.getComputedStyle(this._curDragEl),z=this._getContPos();this._initial.hasInlineSize=!(!this._curDragEl.style.width&&!this._curDragEl.style.height),(0,n.setStyle)(this._curDragEl,{width:U[0],height:U[1]}),this._initialCurDragPos={left:F[0]-z[0],top:F[1]-z[1]-document.body.scrollTop},this._curPlaceholderEl=(0,n.ce)("div",{className:"ui_gridsorter_placeholder"}),(0,n.setStyle)(this._curPlaceholderEl,{width:U[0]+parseFloat(G.marginLeft)+parseFloat(G.marginRight),height:U[1]+parseFloat(G.marginTop)+parseFloat(G.marginBottom)}),this._contEl.insertBefore(this._curPlaceholderEl,this._curDragEl),(0,n.addClass)(this._curDragEl,"ui_gridsorter_moveable"),(0,n.addClass)(this._curDragEl,"ui_gridsorter_moveable_notrans"),(0,n.addClass)(this._contEl,"ui_gridsorter_cont"),this._onMouseMove(e),this._updateDraggablePosition(e),this.options.onDragStart&&this.options.onDragStart(this._curDragEl)}(0,s.cancelEvent)(e)};const d=l},743469:(e,t,i)=>{"use strict";i.d(t,{ON_BOARDING_BG_RECT_ID:()=>l,default:()=>v});var o=i(873589),r=i(152278),n=i(927766),a=i(499206),s=i(517920),l="onboarding_bg_rect",d="page_header_cont",c="onboarding";class v{constructor(e,t,i){var o;void 0===i&&(i={}),this.el=e,this.text=t,this.hideDarkness=!0,this.oldColor=!1;var r,n,a={autoShow:!1,noAutoHideOnWindowClick:null==(o=i.noAutoHideOnWindowClick)||o,content:t instanceof HTMLElement?t:`${t}`,cls:`feature_intro_tt tutorial_tip_tt ${n=null!=(r=i.class)?r:"",i.tooltipWhite?n:n+" feature_intro_blue_tt"}`,appendToParent:!0,onHide:this.ttOnHide.bind(this),scrollOffset:i.scrollOffset||0,align:i.align||s.ElementTooltip.ALIGN_CENTER};i.side&&(a.forceSide=i.side),i.offset&&(a.offset=i.offset),i.width&&(a.width=i.width),i.shift&&(a.centerShift=i.shift),i.border?this.border=i.border:this.border=[10,10,10,10],i.ttOnHide&&(a.onHide=i.ttOnHide),i.withCloseButton&&(a.withCloseButton=i.withCloseButton,a.onCloseButtonClick=i.onCloseButtonClick),i.align&&(a.align=i.align),this.ttParams=a,this.opts=i,this.initOnboardingBG()}initOnboardingBG(){if(!window.onboardingBG){var e=(0,o.se)('\n<div id="onboarding_layout">\n  <svg id="onboarding_bg_header" width="100%" height="49px">\n    <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="0" width="100%" height="100%" fill-opacity="0.8" fill="#000"></rect>\n  </svg>\n  <svg id="onboarding_bg" width="100%" height="100%">\n  <defs>\n    <mask id="mask" x="0" y="0" width="100%" height="100%">\n      <rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect>\n      <rect id="onboarding_bg_clip" class="GroupOnboardingBgClip" x="0" y="0" width="0" height="0" fill="#000" rx="8" ry="8"></rect>\n    </mask>\n  </defs>\n  <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="42" width="100%" height="100%" mask="url(#mask)" fill-opacity="0.8"></rect>\n  </svg>\n</div>\n      ');(0,o.domInsertBefore)(e,window.layerBG),window.onboardingBGHeader=(0,o.ge)("onboarding_bg_header"),window.onboardingBG=(0,o.ge)("onboarding_bg"),window.onboardingBGRect=(0,o.ge)(l),window.onboardingBGClip=(0,o.ge)("onboarding_bg_clip"),window.cur.destroy.push((()=>{(0,o.hide)(window.onboardingBG),(0,o.hide)(window.onboardingBGHeader),(0,o.removeClass)((0,o.ge)(d),c),this.hideDarkness=!0,this.hideTT(),delete window.onboardingBG,delete window.onboardingBGHeader,delete window.onboardingBGRect,delete window.onboardingBGClip,this.opts.onBGClick&&(0,r.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick)}))}this.opts.onBGClick&&(0,r.addEvent)(window.onboardingBG,"click",this.opts.onBGClick)}showTT(){var e=(0,o.getXY)(this.el)[1];this.tt=new s.ElementTooltip(this.el,this.ttParams),this.opts.highlight&&(this.addDarkness(),this.addHighlight()),this.tt.show();var t=this.tt.getContent();(0,a.isElementInViewport)(this.el)&&(0,a.isElementInViewport)(t)||(0,n.scrollToY)(e-42-this.ttParams.scrollOffset)}hideTT(){this.tt&&(this.tt.destroy(),this.removeDarkens(),this.hideDarkness&&((0,r.removeEvent)(window,"scroll"),(0,r.removeEvent)(window,"resize")),this.opts.onBGClick&&window.onboardingBG&&(0,r.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick),this.opts.onHide&&this.opts.onHide())}addHighlight(){window.onboardingBGClip&&(this.highlightElement(),(0,r.addEvent)(window,"scroll",this.onScrollTT.bind(this)),(0,r.addEvent)(window,"resize",this.onResizeTT.bind(this)))}highlightElement(){var e=this.el.offsetWidth,t=this.el.offsetHeight,i=(0,o.getXY)(this.el);(0,o.attr)(window.onboardingBGClip,"width",e+this.border[1]+this.border[3]),(0,o.attr)(window.onboardingBGClip,"height",t+this.border[0]+this.border[2]),(0,o.attr)(window.onboardingBGClip,"x",i[0]-this.border[1]),(0,o.attr)(window.onboardingBGClip,"y",i[1]-this.border[0])}onResizeTT(){this.setDartToFullWidth(),this.highlightElement()}onScrollTT(){var e=this.getPageHeight();window.onboardingBG.height!=e&&this.setDartToFullHeight()}setDartToFullHeight(){(0,o.attr)(window.onboardingBG,"height",this.getPageHeight())}setDartToFullWidth(){(0,o.attr)(window.onboardingBG,"width",this.getPageWidth()),(0,o.attr)(window.onboardingBGHeader,"width",this.getPageWidth())}addDarkness(){(0,o.isVisible)(window.onboardingBG)||(this.setDartToFullHeight(),this.setDartToFullWidth(),(0,o.show)(window.onboardingBG),(0,o.isVisible)(window.onboardingBGHeader)||((0,o.show)(window.onboardingBGHeader),(0,o.addClass)((0,o.ge)(d),c)))}removeDarkens(){this.hideDarkness&&((0,o.hide)(window.onboardingBG),(0,o.hide)(window.onboardingBGHeader),(0,o.removeClass)((0,o.ge)(d),c))}ttOnHide(){this.hideTT()}show(){setTimeout(this.showTT.bind(this),1e3)}getPageWidth(){var e=document.documentElement,t=document.body;return Math.max(t.scrollWidth,e.scrollWidth,t.offsetWidth,e.offsetWidth,t.clientWidth,e.clientWidth)}getPageHeight(){var e=document.documentElement,t=document.body;return Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,t.clientHeight,e.clientHeight)}}},499206:(e,t,i)=>{"use strict";function o(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}i.d(t,{isElementInViewport:()=>o})},719711:(e,t,i)=>{"use strict";i.d(t,{addDelegateEvent:()=>s,removeDelegateEvent:()=>l});i(57327),i(66992),i(821249),i(651532),i(241539),i(323123),i(454747),i(333948);var o=i(873589),r=i(152278),n=new window.Map;function a(e){var t=n.get(e.currentTarget);if(t){var i=t[e.type];if(i)for(var r,a=0;a<i.length;a++){var s=i[a],l=s[0],d=s[1],c=void 0;if((0,o.hasClass)(e.target,l)?c=d(e,e.target):(r=(0,o.gpeByClass)(l,e.target,e.currentTarget))&&(c=d(e,r)),!1===c)break}}}function s(e,t,i,o,s){var l=n.get(e);l||(n.set(e,{}),l=n.get(e));for(var d=t.split(" "),c=0;c<d.length;c++){var v=d[c];l[v]||(l[v]=[],s?(0,r.addEvent)(e,v,a,!1,!1,s):(0,r.addEvent)(e,v,a)),l[v].push([i,o])}}function l(e,t,i,o){var s=n.get(e);s&&(t.split(" ").forEach((t=>{s[t]&&(s[t]=s[t].filter((e=>e[0]!==i||e[1]!==o)),0===s[t].length&&(0,r.removeEvent)(e,t,a))})),0===Object.keys(s).map((e=>s[e].length)).reduce(((e,t)=>e+t))&&n.delete(e))}},934103:(e,t,i)=>{"use strict";i.d(t,{getNativeOption:()=>n,createScroll:()=>d});var o=i(610124),r=i(927766);function n(e,t){return document.body[e]||document.documentElement[e]}class a{constructor(e,t){this.el=e,this.opts=t,this.module=(0,o.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return n("scrollTop",this.el);!function(e,t,i){"scrollTop"===e&&window.scrollTo(0,t)}("scrollTop",e,this.el)}contHeight(){return n("scrollHeight")}smoothScroll(e){(0,r.scrollToY)(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=Date.now(),i=()=>{Date.now()-t<500&&this.scrollBottom(e),window.removeEventListener("scroll",i)};window.addEventListener("scroll",i),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),i=t-this.prevScroll,o=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-i,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&o-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){(0,o.destroyModule)(this.module)}}class s{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var i=this.scrollTop(),o=this.prevTop-i;this.prevTop=i,t.scrollChange&&t.scrollChange(i),t.onScroll&&t.onScroll(o,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",(()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)})),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class l{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function d(e,t){return t.noScroll?new l(e):t.nativeScroll?new a(e,t):new s(e,t)}},554846:(e,t,i)=>{"use strict";i.d(t,{Scroll:()=>s});i(682772);var o=i(785893),r=(i(667294),i(102957)),n=i(934103);function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},a.apply(this,arguments)}var s=e=>{var t=e.children,i=function(e,t){if(null==e)return{};var i,o,r={},n=Object.keys(e);for(o=0;o<n.length;o++)i=n[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,["children"]);return(0,o.jsx)(r.ScrollContext.Provider,{value:{createScroll:n.createScroll},children:(0,o.jsx)(r.Scroll,a({},i,{children:t}))})};s.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},700069:(e,t,i)=>{"use strict";i.d(t,{Likes:()=>y});i(682772),i(319601),i(426833),i(804723),i(115306);var o=i(873589),r=i(152278),n=i(290846),a=i(342269),s=i(631351),l=i(274642),d=i(733164),c=i(146143),v=i(70162),u=i(465864),h=i(325698),_=i(95146),p=i(908706),g=i(107337),f=i(576772),m=i(210277);function w(){return w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},w.apply(this,arguments)}var y={toggle(e,t,i,n){if((0,r.cancelEvent)(t),(0,d.isObject)(window.cur)&&(0,d.isFunction)(cur.viewAsBox))return cur.viewAsBox();if(vk.widget&&!vk.id)return window.Widgets.oauth();var a=(0,o.hasClass)(e,"active");(0,o.addClass)(e,"animate"),this.clientUpdate(i,h.LikeButtonTypes.like,a?-1:1,!a);var s={act:a?"a_do_unlike":"a_do_like",object:i,hash:n,list:cur.pvListId,wall:2,from:this._getReference(i),from_widget:vk.widget?1:0},l=()=>((0,o.toggleClass)(e,"active",a),this.clientUpdate(i,h.LikeButtonTypes.like,a?1:-1,a),!1);window.ajax.post("like.php",s,{onDone:t=>{if(t.unauth_action_box)return l(),void f.UnauthActionBox.show(t.unauth_action_box);this.update(i,t);var o=i.match(/^(wall|market)(.*)/);o&&cur.onLike&&cur.onLike(e,o[1],o[2],a)},onFail:l}),(0,d.intval)((0,o.domData)(e,"count"))>0?y.showLikes(e,i,{fast:!0}):e.tt&&e.tt.destroy&&e.tt.destroy()},_getReference:e=>cur.pvShown?"photo_viewer":e===cur.wallLayer?"wkview":window.mvcur&&window.mvcur.mvShown?"videoview":cur.wallType?"feed"===cur.wallType?"news"===cur.section?`feed_${cur.subsection?cur.subsection:cur.section}`:"recommended"===cur.section?"feed_recommended"+("recent"!==cur.subsection?"_"+cur.subsection:""):(0,a.inArray)(cur.section,["friends","groups","videos","photos"])?"feed_"+(cur.subsection?"_"+cur.subsection:""):`feed_${cur.section}`:"top"===cur.wallType?"wall_top":"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full"):cur.module,share(e,t){if(void 0===t&&(t={}),vk.widget&&!vk.id)return window.Widgets.oauth();if((0,d.isObject)(window.cur)&&(0,d.isFunction)(cur.viewAsBox))return cur.viewAsBox();var i=(0,u.parseLikeObjectId)(e),o=i.objectType,r=i.objectId;(vk.widget?window.showBox:c.showBox)("like.php",w({act:"publish_box",object:e,from_widget:vk.widget?1:0},t),{onDone:(e,t)=>{t.unauth_action_box&&(e.hide(),f.UnauthActionBox.show(t.unauth_action_box))},stat:["page.js","page.css","wide_dd.js","wide_dd.css",window.jsc("web/sharebox.js")]}),"wall"===o&&window.Wall&&window.Wall.triggerAdPostStat(r,"share_post"),cur.RpcMethods&&(cur.RpcMethods.likeFullUpdate=t=>y.update(e,window.cleanObj(t)))},clientUpdate(e,t,i,r){var n=this._getButtonsByType(e,t);if(n.length){var a=(0,d.intval)((0,o.domData)(n[0],"count"))+i;this._updateDom(e,t,a,r),this.updateExternalIndex(e,{type:t,count:a,isActive:r})}},update(e,t){if(!isNaN(parseInt(t.like_num))){var i=(0,d.isUndefined)(t.like_my)?void 0:!!(0,d.intval)(t.like_my);this._updateDom(e,h.LikeButtonTypes.like,t.like_num,i,t.like_title),this.updateExternalIndex(e,{type:h.LikeButtonTypes.like,count:t.like_num,isActive:i})}if(!isNaN(parseInt(t.share_num))){var o=(0,d.isUndefined)(t.share_my)?void 0:!!(0,d.intval)(t.share_my);this._updateDom(e,h.LikeButtonTypes.share,t.share_num,o,t.share_title),this.updateExternalIndex(e,{type:h.LikeButtonTypes.share,count:t.share_num})}if((0,a.isNumeric)(t.views_num)&&this._updateDom(e,h.LikeButtonTypes.views,t.views_num,void 0,t.views_title),(0,a.isNumeric)(t.comment_num)&&this._updateDom(e,h.LikeButtonTypes.comment,t.comment_num),t[_.REACTIONS_COUNTS_RESPONSE_FIELD]){var r=!!t.isQueueUpdate;(0,g.triggerReactionsUpdate)(e,t[_.REACTIONS_COUNTS_RESPONSE_FIELD],void 0,{isQueueUpdate:r,isUserAction:!1,previewVisibility:p.previewVisibilityUseCurrent})}},updateComments(e,t){this.update(e,{comment_num:t})},_updateDom(e,t,i,r,n){var l=this._getButtonsByType(e,t),c=t===h.LikeButtonTypes.views;if(null==l?void 0:l.length){var _="";c?_=i:i>0&&(_=vk.widget?(0,a.formatCount)(i):(0,v.langNumeric)(i,"%s",!0)),c||(i=(0,d.intval)(i));for(var p=0;p<l.length;p++){var g=l[p];if(!(0,o.hasClass)(g,"no_counter")){var f,w=c?l[p]:(0,u.getElementLikeButtonCount)(l[p]);if((0,s.animateCount)(w,_,{str:"auto",noWrapWidth:!c,noSpaceIfEmpty:!0}),(0,o.toggleClass)(g,"empty",i<=0),"boolean"==typeof r&&(0,o.toggleClass)(g,"active",r),(0,o.attr)(l[p],"data-count",i),(0,m.updateAriaLabelCounter)(g,i,t),c)null==g||null==g.closest||null==(f=g.closest(".like_views"))||f.setAttribute("title",n||"");var y=l[p].tt;if(y){var S=(0,o.domByClass)(y.container,"_content"),C=(0,o.domByClass)(y.container,"_value"),x=(0,o.domByClass)(y.container,"_title"),N=(0,d.intval)((0,o.val)(C));(0,o.val)(C,i),n&&(0,o.val)(x,n),(0,d.isObject)(y)&&(y.likeInvalidated=!0),(N!==i&&N<7||!1===n)&&(t===h.LikeButtonTypes.like?g.needReinitLikesTT=!0:t===h.LikeButtonTypes.share&&(g.needReinitShareTT=!0)),t===h.LikeButtonTypes.like&&(0,o.toggleClass)(S,"me_hidden",!r),!1===n&&y.destroy&&y.destroy()}}}}},_getButtonsByType:(e,t)=>(0,o.domQuery)(`._like_${e} ._${t}, ._like_${e} [data-like-button-type="${t}"]`),showLikes(e,t,i){var r;if(void 0===i&&(i={}),e&&e instanceof HTMLElement&&!e.postDontShowLikes&&(!vk.widget||!vk.show_external_auth_box)){var s=i.views?{views:1}:i.share?{published:1}:{};i.listId&&(s.list=i.listId),i.like_hash&&(s.like_hash=i.like_hash),i.like_stats_params&&Object.assign(s,i.like_stats_params);var l=!!(0,o.geByClass1)("share",(0,o.gpeByClass)("like_wrap",e)),c=document.body,v=!1,h=getComputedStyle(e),_=(0,d.intval)(h.getPropertyValue("padding-left").replace("px","")),p=(0,d.intval)(h.getPropertyValue("padding-top").replace("px","")),g=(0,u.getElementLikeButtonIcon)(e),f=40;"wpost"===i.from&&(f=24);var m,w,S=[f-(0,o.getSize)(g)[0]/2-_,10-p],C=i.cl||"";if(i.share)C+="likes_tt_share";else if(C+="likes_tt_like","widget_community"===i.from)S[0]=6;else if("wcomments"===i.from||"widget_comments"===cur.wallType){S[0]=(0,o.getSize)(e)[0]+16-(0,o.getSize)(g)[0]/2-10}else"photo_carousel"===i.from&&(S[1]=10);if(!!(null==(r=i)?void 0:r.isFromReactionsPreview)){var x=e.querySelector("._ReactionsPreview__itemsContainer");if(x){var N=x.querySelector(".ReactionsPreviewItem"),b=(0,o.getXYRect)(N,!1),k=(b.width||0)/2,E=k;c=x,b.left+b.width/2>window.innerWidth/2&&(v=!0,E=x.offsetWidth-k),S[0]=-E+f}}i.share?(m="needReinitLikesTT",w="resetLikesTTTimer"):(m="needReinitShareTT",w="resetShareTTTimer"),clearTimeout(e[w]),(0,n.showTooltip)(e,{url:"/like.php",params:(0,a.extend)({act:"a_get_stats",object:t,has_share:l?1:""},s),appendEl:c,slide:15,shift:S,ajaxdt:i.fast?0:100,showdt:i.fast?0:400,hidedt:200,dir:"auto",checkLeft:!0,needLeft:v,reverseOffset:80,noZIndex:!0,hasover:!0,tip:{over:()=>{y.showLikes(e,t,i)}},typeClass:"like_tt",className:C,onHide:()=>{clearTimeout(e[w]),e[m]&&(e[w]=setTimeout((()=>{delete e[m],e.tt&&e.tt.destroy&&e.tt.destroy()}),200))}})}},showShare:function(e,t,i){y.showLikes(e,t,(0,a.extend)(i,{share:1}))},updateViews:(e,t)=>{vk.widget&&vk.show_external_auth_box||window.ajax.post("like.php",{act:"a_get_stats",object:e,views:1},{cache:1,onDone(t,i){var r=(0,o.ce)("div",{innerHTML:i});y._updateDom(e,h.LikeButtonTypes.views,t,void 0,r.innerText||r.textContent)}})},makeTemplate(e,t){if(!e)return"";(t=(0,a.extend)({buttons_prepend:"",object_raw:"",likes_count:"",liked:!1,share_count:"",shared:"",views_count:"",share_opts:{},like_opts:{},class_name:"",like_cont_class:"",like_class_name:"",[_.REACTIONS_COUNTS_RESPONSE_FIELD]:"",reactions_class_name:""},t)).like_active=t.liked?"active":"",t.share_active=t.shared?"active":"",t.comment_active="",t.likes_formatted_count=t.likes_count>0?(0,v.langNumeric)(t.likes_count,"%s",!0):"",t.share_formatted_count=t.share_count>0?(0,v.langNumeric)(t.share_count,"%s",!0):"",t.share_opts=this._convertOptsToString(t.share_opts),t.like_opts=this._convertOptsToString(t.like_opts),t.like_class_name+=t.likes_count>0?"":" empty",t.share_class_name=t.share_count>0?"":"empty";var i=t[_.REACTIONS_COUNTS_RESPONSE_FIELD],r=!!i&&Object.values(i).some((e=>!!e));return t.reactions_class_name+=r?"":" PostBottomAction--empty",(0,o.rs)(e,t)},_convertOptsToString:e=>JSON.stringify(e).replace(/\"/g,"'"),updateExternalIndex(e,t){void 0===t&&(t={});var i=(0,u.parseLikeObjectId)(e),o=i.objectType,r=i.objectId;switch(o){case"photo":if(!cur.pvShown||!cur.pvCurPhoto||cur.pvCurPhoto.id!==r)return;var n=cur.pvListId,a=cur.pvIndex,s=cur.pvData[n][a];t.type===h.LikeButtonTypes.like?(s.likes=t.count,s.liked=t.isActive,cur.pvCommsLikes[s.id][1]=t.count):t.type===h.LikeButtonTypes.share&&(s.shares=t.count);break;case"video":if(window.mvcur&&window.mvcur.mvShown&&window.mvcur.videoRaw===r&&t.type===h.LikeButtonTypes.like){var l=window.Videoview.getMvData();l.likes=t.count,void 0!==t.isActive&&(l.liked=t.isActive,window.Videoview.playerOnLiked(t.isActive),window.Videoview.recache())}break;case"clip":t.type===h.LikeButtonTypes.like&&window.Videoview.playerOnLiked(t.isActive)}},showLikesList(e,t){cur.viewAsBox||(0,o.hasClass)((0,o.gpeByClass)("like_btn",e),"no_counter")||(0,l.showWiki)({w:"likes/"+(0,a.clean)(t)},!1,!1,{queue:1})},showSharesList(e,t){cur.viewAsBox||(0,o.hasClass)((0,o.gpeByClass)("like_btn",e),"no_counter")||(0,l.showWiki)({w:"shares/"+(0,a.clean)(t)},!1,!1,{queue:1})}}},738046:(e,t,i)=>{"use strict";var o;i.d(t,{BatchOperationType:()=>o}),function(e){e.Add="add",e.Delete="delete"}(o||(o={}))},41929:(e,t,i)=>{"use strict";i.d(t,{BoxModal:()=>l});var o=i(570655),r=i(785893),n=i(667294),a=i(483295),s=i(781402),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,i=e.appearance,n=e.title,l=e.actionButtons,d=e.onClose,c=e.children,v=e.hint,u=e.hasScroll;return(0,r.jsx)("div",(0,o.__assign)({className:"BoxModal"},{children:(0,r.jsxs)("div",(0,o.__assign)({className:(0,a.classNames)("Modal","Modal--"+i,t)},{children:[(0,r.jsx)(s.default.Header,{title:n,onClose:d},void 0),Boolean(c)&&(0,r.jsx)(s.default.Body,(0,o.__assign)({hasScroll:u},{children:c}),void 0),Boolean(l)&&(0,r.jsx)(s.default.Footer,{actionButtons:l,hint:v},void 0)]}),void 0)}),void 0)},t.defaultProps={appearance:"white",hasScroll:!0},t}(n.Component)},610124:(e,t,i)=>{"use strict";i.d(t,{createMutations:()=>a,createModule:()=>d,destroyModule:()=>c});var o=i(570655),r=i(719711),n=i(152278);function a(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,(0,o.__spreadArray)([],(0,o.__read)(t),!1))}}}function s(e,t,i,o){(0,n.addEvent)(t,i,o),e._registeredHandlers.push({handlerType:"bind",elem:t,types:i,handler:o})}function l(e,t,i,o,n,a){(0,r.addDelegateEvent)(t,i,o,n,a),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:i,selector:o,handler:n})}function d(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return s.apply(void 0,(0,o.__spreadArray)([t],(0,o.__read)(e),!1))}),(function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return l.apply(void 0,(0,o.__spreadArray)([t],(0,o.__read)(e),!1))})),t}function c(e){e._registeredHandlers.forEach((function(e){var t=e.handlerType,i=e.elem,o=e.types,a=e.handler;"delegate"===t?(0,r.removeDelegateEvent)(i,o,e.selector,a):(0,n.removeEvent)(i,o,a)})),e._registeredHandlers=[]}},465864:(e,t,i)=>{"use strict";i.d(t,{parseLikeObjectId:()=>r,likePostObjectId:()=>n,likeReplyObjectId:()=>a,getElementLikeButtonCount:()=>s,getElementLikeButtonIcon:()=>l,getElementLikeButtonLabel:()=>d});var o=i(570655);function r(e){var t=e.match(/^([a-z_]+)([0-9\-_]+)$/);if(!t)return null;var i=(0,o.__read)(t,3);return{objectType:i[1],objectId:i[2]}}var n=function(e){return"wall"+e},a=function(e){return"wall_reply"+e},s=function(e){var t;return null!==(t=null==e?void 0:e.querySelector(".like_button_count, ._like_button_count"))&&void 0!==t?t:void 0},l=function(e){var t;return null!==(t=null==e?void 0:e.querySelector(".like_button_icon, ._like_button_icon"))&&void 0!==t?t:void 0},d=function(e){var t;return null!==(t=e.querySelector(".like_button_label, ._like_button_label"))&&void 0!==t?t:void 0}},325698:(e,t,i)=>{"use strict";i.d(t,{LikeButtonTypes:()=>o});var o={like:"like",share:"share",views:"views",comment:"comment"}},560717:(e,t,i)=>{"use strict";i.d(t,{highlightModule:()=>c});var o,r,n=i(743469),a=i(549357),s=i(927766),l=i(873589),d=i(997109);function c(e){var t=document.getElementById(e.module);if(t&&t.classList.contains("module")){window.cur.__narrowBarForceNotFixed=!0;var i=e.speed?e.speed:300;(0,s.scrollToY)((0,l.getXY)(t)[1]-100,i);var c=function(){o&&(o.hideTT(),(0,s.enableBodyScroll)(),delete window.cur.__narrowBarForceNotFixed,(0,a.updateNarrow)(),e.onClose&&e.onClose())};(o=new n.default(t,e.text,{highlight:!0,width:250,offset:[0,-17],side:"bottom",withCloseButton:!0,onBGClick:c,onCloseButtonClick:c})).show(),(0,s.disableBodyScroll)(),e.autoCancelDelay&&(r=setTimeout((function(){c(),r=null}),e.autoCancelDelay),(0,d.pushNavDestroy)((function(){r&&clearTimeout(r)})))}}},856901:(e,t,i)=>{"use strict";i.d(t,{PROFILE_MEDIA_NARROW_BLOCK_ID:()=>o});var o="profile_media_narrow_block"},908706:(e,t,i)=>{"use strict";i.d(t,{isVariantInActionStatusBar:()=>r,isVariantHidden:()=>n,previewVisibilityUseCurrent:()=>a,isIntentPreviewInActionStatusBar:()=>s,isIntentPreviewHidden:()=>l,isIntentPreviewUseCurrent:()=>d,previewVisibilityIntentForVariant:()=>c,parsePreviewVariant:()=>v});var o=i(404608),r=function(e){return e===o.PreviewVariantActionStatusBar},n=function(e){return e===o.PreviewVariantHidden},a={kind:"useCurrent"},s=function(e){return e.kind===o.PreviewVariantActionStatusBar},l=function(e){return e.kind===o.PreviewVariantHidden},d=function(e){return"useCurrent"===e.kind},c=function(e){return e?{kind:e}:a},v=function(e){return o.PreviewVariants.includes(e)?e:void 0}},404608:(e,t,i)=>{"use strict";i.d(t,{PreviewVariantActionStatusBar:()=>o,PreviewVariantHidden:()=>r,PreviewVariants:()=>n});var o="action_status_bar",r="hidden",n=[o,r]},95146:(e,t,i)=>{"use strict";i.d(t,{SUPPORTED_OBJECT_TYPES:()=>o,SIZE_32:()=>r,SIZE_40:()=>n,SIZE_96:()=>a,SIZE_128:()=>s,REACTIONS_COUNTS_RESPONSE_FIELD:()=>l,WK_SECTION_PREFIX_REACTIONS:()=>d});var o={wall:"wall",wall_reply:"wall_reply"},r={width:32,height:32},n={width:40,height:40},a={width:96,height:96},s={width:128,height:128},l="reactions_counts",d="reactions"},665872:(e,t,i)=>{"use strict";i.d(t,{reactionsCountsUpdatePayload:()=>n,isReactionsFullUpdatePayload:()=>a,reactionsCountsOnlyUpdatePayload:()=>s});var o=i(570655),r=i(571904),n=function(e,t){return(0,o.__assign)((0,o.__assign)({kind:r.PayloadKindFull},e),{reactionIdState:{reactionId:t.id}})},a=function(e){return e.kind===r.PayloadKindFull},s=function(e){return(0,o.__assign)({kind:r.PayloadKindCountsOnly},e)}},571904:(e,t,i)=>{"use strict";i.d(t,{PayloadKindCountsOnly:()=>o,PayloadKindFull:()=>r});var o="counts_only",r="counts_with_current_reaction"},107337:(e,t,i)=>{"use strict";i.d(t,{triggerReactionsUpdate:()=>s});var o=i(465864),r=i(95146),n=i(453580),a=i(665872),s=function(e,t,i,s){var l=(0,o.parseLikeObjectId)(e);l&&l.objectType===r.SUPPORTED_OBJECT_TYPES.wall&&l.objectId?(0,n.emitEvent)(n.WallDataEvents.post_reactions_counts_update,function(e,t,i,o){var r={counts:e,isFromWkLayer:null==t?void 0:t.isFromWkLayer,isPrimaryLikeButtonClick:null==t?void 0:t.isPrimaryLikeButtonClick,isQueueUpdate:null==t?void 0:t.isQueueUpdate,isUserAction:t.isUserAction,postFullId:i.objectId,previewVisibility:t.previewVisibility,reactionIdState:o?{reactionId:o.id}:void 0,suggestSubscribe:t.suggestSubscribe};return o?(0,a.reactionsCountsUpdatePayload)(r,o):(0,a.reactionsCountsOnlyUpdatePayload)(r)}(t,s,l,i)):l&&l.objectType===r.SUPPORTED_OBJECT_TYPES.wall_reply&&l.objectId?(0,n.emitEvent)(n.WallDataEvents.reply_reactions_counts_update,{counts:t,replyFullId:l.objectId,reactionIdState:i?{reactionId:i.id}:void 0}):console.warn("Unsupported reactions object update",e)}},115985:(e,t,i)=>{"use strict";i.d(t,{NarrativeBox:()=>L});var o=i(570655),r=i(785893),n=i(667294),a=i(41929),s=i(288420),l=i(70162),d=i(902119),c=i(709652),v=i(173471),u=i(385597),h=i(622858),_=i(740733),p=i(241926),g=i(501389),f=i(733164),m=i(91574),w=i(258668),y=i(274642),S=i(700069),C=i(109542),x=i(117173),N=i(281536),b=i(815653),k=i(849464),E=i(844142),L=function(e){function t(t){var i=e.call(this,t)||this;return i.getBoxActionButtons=function(){var e=i.props,t=e.onClose,n=e.boxData,a=e.type,d=[(0,r.jsx)(s.default,(0,o.__assign)({appearance:"primary",onClick:function(){return t()}},{children:(0,l.getLang)("global_close")}),"close")];if(a===c.BoxType.edit&&n.userId===n.ownerId){var v=n.ownerDomain||"id"+n.userId;d.unshift((0,r.jsx)(m.default,(0,o.__assign)({href:v+"?w=stories",onClick:function(){t(),(0,y.showWiki)({w:"stories"})},className:"NarrativeBox__additionalFooterButton"},{children:(0,l.getLang)("stories_archive")}),"archive"))}return d},i.onNarrativeClick=function(e,t){if(!e.ctrlKey&&!e.metaKey){e.preventDefault(),e.stopPropagation();var o=i.props.list?i.props.list:"narrative"+t.ownerId+"_"+t.id;(0,v.showNarrative)(t.ownerId,t.id,0,o,{trackCode:i.props.trackCode,source:i.props.source})}},i.onCreateNarrativeClick=function(){var e=i.props,t=e.boxData,o=e.navScreen,r=t.ownerId;if((0,k.sendNarrativeAnalytic)(k.NarrativeAnalyticEventType.createNarrative,{ownerId:r},o),E.Ranges.isUserId(r))i.openNarrativeEditorBox();else{var n=t.ownerDomain?t.ownerDomain:"club"+-r;window.open("https://"+location.hostname+"/"+n+"?act=narrative_create")}},i.openNarrativeEditorBox=function(e){var t=i.props,r=t.onSave,n=t.boxData,a=t.onClose,s=t.navScreen;if(r){var l=[];(null==e?void 0:e.stories.length)&&(l=(0,o.__spreadArray)([],(0,o.__read)(e.stories),!1));var d={narrative:e,selectedStories:l,publishHash:n.publishHash,onSave:function(e){r(e),a()},navScreen:s};(0,p.showNarrativeEditorBox)(n.ownerId,d)}},i.getNarrativeItemActions=function(e){var t=[];if(i.canEdit())t.push({text:(0,l.getLang)("global_edit"),onClick:function(){return i.editNarrative(e)}}),t.push({text:(0,l.getLang)("stories_share"),onClick:function(){return i.shareNarrative(e)}}),t.push({separator:!0}),t.push({text:(0,l.getLang)("global_delete"),onClick:function(){return i.removeNarrative(e)}});else{var o=e.isBookmarked?(0,l.getLang)("global_remove_from_bookmarks"):(0,l.getLang)("global_add_to_bookmarks");t.push({text:o,onClick:function(){return i.bookmarkNarrative(e)}}),t.push({text:(0,l.getLang)("stories_share"),onClick:function(){return i.shareNarrative(e)}})}return t},i.state={isLoad:!1,draggingNarrativeRawId:""},i.scrollContainerRef=(0,n.createRef)(),i.gridRef=(0,n.createRef)(),i.sentinelRef=(0,n.createRef)(),i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,i=t.narratives,s=t.onClose,l=t.boxData,d=this.state,c=d.isLoad,v=d.draggingNarrativeRawId,h=i.length<l.count,p=this.canEdit();return(0,r.jsx)(a.BoxModal,(0,o.__assign)({className:"NarrativeBox",title:this.getTitle(),actionButtons:this.getBoxActionButtons(),onClose:s,hasScroll:!1},{children:(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeBox__scrollContainer",ref:this.scrollContainerRef},{children:(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeBox__scrollInner"},{children:[(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeBox__list",ref:this.gridRef},{children:[p&&(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(u.NarrativeRowCreation,{onClick:this.onCreateNarrativeClick},"create"),i.map((function(t){return(0,r.jsx)(C.NarrativeRow,{className:x.BOX_ITEM_DRAGGABLE_CLASS,narrative:t,onClick:function(i){return e.onNarrativeClick(i,t)},aside:(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeBox__aside"},{children:[t.rawId===v&&(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,r.jsx)(N.default,{},void 0)}),void 0),t.rawId!==v&&(0,r.jsx)(w.default,(0,o.__assign)({position:"b",align:"center",trigger:"hover",data:e.getNarrativeItemActions(t)},{children:(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,r.jsx)(N.default,{},void 0)}),void 0)}),void 0),(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeBox__action NarrativeBox__action--burger"},{children:(0,r.jsx)(b.default,{},void 0)}),void 0)]}),void 0)},t.rawId)}))]},void 0),!p&&(0,r.jsx)(n.Fragment,{children:i.map((function(t){return(0,r.jsx)(C.NarrativeRow,{narrative:t,onClick:function(i){return e.onNarrativeClick(i,t)},aside:(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeBox__aside"},{children:(0,r.jsx)(w.default,(0,o.__assign)({position:"b",align:"right",trigger:"hover",data:e.getNarrativeItemActions(t)},{children:(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeBox__action NarrativeBox__action--more"},{children:(0,r.jsx)(N.default,{},void 0)}),void 0)}),void 0)}),void 0)},t.rawId)}))},void 0)]}),void 0),c&&(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeBox__loader"},{children:(0,r.jsx)(_.default,{},void 0)}),"loader"),h&&(0,r.jsx)("div",{className:"NarrativeBox__sentinel",ref:this.sentinelRef},void 0)]}),void 0)}),void 0)}),void 0)},t.prototype.canEdit=function(){var e=this.props,t=e.type,i=e.onSave,o=e.onReorder,r=e.onRemove;return t===c.BoxType.edit&&Boolean(i)&&Boolean(o)&&Boolean(r)},t.prototype.componentDidMount=function(){this.initSorter(),this.observeNarrativeScrollIfNeeded()},t.prototype.componentWillUnmount=function(){this.deInitSorter(),this.unObserveNarrativeScrollIfNeeded()},t.prototype.editNarrative=function(e){var t=this.props.boxData;(0,k.sendNarrativeAnalytic)(k.NarrativeAnalyticEventType.clickToEditNarrative,e,this.props.navScreen),E.Ranges.isUserId(t.ownerId)?this.openNarrativeEditorBox(e):window.open("https://"+location.hostname+location.pathname+"?act=narrative_edit&nid="+e.id)},t.prototype.shareNarrative=function(e){S.Likes.share("narrative"+e.rawId),(0,k.sendNarrativeAnalytic)(k.NarrativeAnalyticEventType.shareNarrative,e,this.props.navScreen)},t.prototype.bookmarkNarrative=function(e){var t=this.props.onBookmark;(0,y.bookmark)(e.ownerId,e.id,"narrative",e.bookmarkHash,e.isBookmarked),(0,k.sendNarrativeAnalytic)(k.NarrativeAnalyticEventType.addToBookmarks,e,this.props.navScreen),t(e)},t.prototype.removeNarrative=function(e){var t,i;null===(i=(t=this.props).onRemove)||void 0===i||i.call(t,e)},t.prototype.observeNarrativeScrollIfNeeded=function(){var e=this,t=this.props,i=t.narratives,o=t.boxData;if(i.length<o.count){var r=this.scrollContainerRef.current,n=this.sentinelRef.current;if(!n)return;this.observer=new IntersectionObserver((function(t){t.forEach((function(t){t.intersectionRatio>0&&e.loadViewers()}))}),{threshold:[0],root:r,rootMargin:"0px 0px 480px 0px"}),this.observer.observe(n)}},t.prototype.unObserveNarrativeScrollIfNeeded=function(){this.observer&&this.observer.disconnect()},t.prototype.loadViewers=function(){var e=this,t=this.props.loadMore;this.state.isLoad||(this.setState({isLoad:!0}),t().finally((function(){e.setState({isLoad:!1})})))},t.prototype.initSorter=function(){var e,t,i=this,o=this.props.boxData;if(this.canEdit()){var r=null===(e=this.scrollContainerRef)||void 0===e?void 0:e.current,n=null===(t=this.gridRef)||void 0===t?void 0:t.current;if(n&&r){var a={dragThreshold:0,wrapNode:r,onDragFinish:function(){i.setState({draggingNarrativeRawId:""})},onDragStart:function(e){var t=i.getNarrativeIdByEl(e);i.setState({draggingNarrativeRawId:o.ownerId+"_"+t})},onReorder:function(e){var t=i.getNarrativeIdByEl(e),o=Array.from(n.querySelectorAll("."+x.BOX_ITEM_DRAGGABLE_CLASS));if(1!==o.length){var r=0,a=0,s=o.findIndex((function(e){return i.getNarrativeIdByEl(e)===t}));o[s-1]&&(r=i.getNarrativeIdByEl(o[s-1])),o[s+1]&&(a=i.getNarrativeIdByEl(o[s+1])),i.saveReorder(t,a,r)}}};this.sorter=new h.default(n,"",a)}}},t.prototype.saveReorder=function(e,t,i){var o=this,r=this.props,n=r.boxData,a=r.onReorder;if(a){var s=n.ownerId;window.ajax.post("al_stories.php",{act:"narratives_reorder",narrative_id:e,before_narrative_id:t,after_narrative_id:i,hash:n.reorderHash,owner_id:s},{onDone:function(){var t,i=o.props.narratives,r=null===(t=o.gridRef)||void 0===t?void 0:t.current;if(r){var n=Array.from(r.querySelectorAll("."+x.BOX_ITEM_DRAGGABLE_CLASS)),l=[];n.forEach((function(e){var t=o.getNarrativeIdByEl(e),r=i.find((function(e){return e.id===t}));r&&l.push(r)})),(0,k.sendNarrativeAnalytic)(k.NarrativeAnalyticEventType.changeSort,{ownerId:s,id:e},o.props.navScreen),a(l)}},onFail:function(e){return(0,g.showDoneBox)(e||(0,l.getLang)("global_error")),!0}})}},t.prototype.getNarrativeIdByEl=function(e){return(0,f.intval)(e.getAttribute("data-id"))},t.prototype.getTitle=function(){var e=this.props,t=e.title,i=e.boxData,o=e.showNarrativeNumber;return(0,r.jsx)(d.NarrativeBoxTitle,{title:t||(0,l.getLang)("stories_narratives_title"),count:i.count,showNarrativeNumber:o},void 0)},t.prototype.deInitSorter=function(){this.sorter&&this.sorter.destroy()},t.defaultProps={type:c.BoxType.view,showNarrativeNumber:!0},t}(n.Component)},709652:(e,t,i)=>{"use strict";var o;i.d(t,{BoxType:()=>o}),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(o||(o={}))},902119:(e,t,i)=>{"use strict";i.d(t,{NarrativeBoxTitle:()=>n});var o=i(570655),r=i(785893),n=function(e){var t=e.title,i=e.count,n=void 0===i?0:i,a=e.showNarrativeNumber,s=void 0===a||a;return(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeBoxTitle"},{children:[t,s&&n>0&&(0,r.jsx)("span",(0,o.__assign)({className:"NarrativeBoxTitle__count"},{children:n}),void 0)]}),void 0)}},744451:(e,t,i)=>{"use strict";i.d(t,{NarrativeChooseBox:()=>y});var o=i(570655),r=i(785893),n=i(667294),a=i(41929),s=i(288420),l=i(70162),d=i(118690),c=i(483295),v=i(468916),u=i(385597),h=i(109542),_=i(501389),p=i(241926),g=i(173471),f=i(738046),m=i(849464),w=i(844142),y=function(e){function t(t){var i=e.call(this,t)||this;return i.loadMore=function(){var e=i.props,t=e.loadMore,r=e.story,n=i.state.selectedNarrativeIds;return t().then((function(e){void 0===e&&(e=[]),i.setState({selectedNarrativeIds:(0,o.__assign)((0,o.__assign)({},n),i.getSelectedNarrativeIdsMap(r.id,e))})}))},i.onCheckboxClick=function(e){var t=i.state.selectedNarrativeIds,r=(0,o.__assign)({},t);r[e.id]?delete r[e.id]:r[e.id]=!0,i.setState({selectedNarrativeIds:r})},i.getBoxActionButtons=function(){var e=i.props,t=e.onClose,n=e.story,a=e.narratives,c=i.state,v=c.isLoad,u=c.selectedNarrativeIds,h=i.getSelectedNarrativeIdsMap(n.id,a),_=i.getDiffOperations(n.id,u,h);return[(0,r.jsx)(s.default,(0,o.__assign)({appearance:"tertiary",onClick:function(){return t()}},{children:(0,l.getLang)("global_close")}),"close"),(0,r.jsx)(d.default,(0,o.__assign)({appearance:"primary",disabled:!_.length,onClick:i.save,loading:v},{children:(0,l.getLang)("global_save")}),"save")]},i.save=function(){var e=i.props,t=e.story,o=e.narratives,r=e.boxData,n=e.onClose,a=e.onSave,s=e.navScreen,d=i.state.selectedNarrativeIds,c=i.getSelectedNarrativeIdsMap(t.id,o),v=i.getDiffOperations(t.id,d,c),u=Boolean(Object.keys(d).length),h=r.ownerId;i.setState({isLoad:!0}),window.ajax.post("al_stories.php",{act:"batch_edit",owner_id:h,operations:JSON.stringify(v),hash:r.editHash},{onDone:function(){a(u),n(),(0,m.sendNarrativeAnalytic)(m.NarrativeAnalyticEventType.addStoryToNarrative,{ownerId:h},s),(0,_.showDoneBox)(i.getDoneText(v))},onFail:function(e){return(0,_.showDoneBox)(e||(0,l.getLang)("global_error")),!0},hideProgress:function(){i.setState({isLoad:!1})}})},i.onCreateNarrativeClick=function(){var e=i.props,t=e.story,o=e.narratives,r=e.onSave,n=e.onClose,a=e.boxData,s=e.navScreen,l=a.ownerId;if(w.Ranges.isUserId(l)){var d=i.getSelectedNarrativeIdsMap(t.id,o),c=Boolean(Object.keys(d).length),v={selectedStories:[t],onSave:function(){c=!0},onClose:function(){r(c),n()},navScreen:s};return(0,p.showNarrativeEditorBox)(l,v),void(0,m.sendNarrativeAnalytic)(m.NarrativeAnalyticEventType.createNarrative,{ownerId:l},s)}var u=a.ownerDomain?a.ownerDomain:"club"+-a.ownerId;window.nav.go(u+"?act=narrative_create&story_id="+t.id)},i.onNarrativeClick=function(e,t){e.ctrlKey||e.metaKey||((0,g.showNarrative)(t.ownerId,t.id,0,"narrative"+t.ownerId+"_"+t.id),e.preventDefault(),e.stopPropagation())},i.state={isLoad:!1,selectedNarrativeIds:i.getSelectedNarrativeIdsMap(t.story.id,t.narratives)},i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,i=t.onClose,n=t.narratives,s=t.boxData,d=this.state.selectedNarrativeIds,_=n.length<s.count;return(0,r.jsx)(a.BoxModal,(0,o.__assign)({className:"NarrativeChooseBox",title:(0,l.getLang)("stories_narrative_choosing"),actionButtons:this.getBoxActionButtons(),onClose:i,hasScroll:!1,appearance:"blue"},{children:(0,r.jsxs)(v.default,(0,o.__assign)({className:"NarrativeChooseBox__list",itemHeight:80,loadMore:this.loadMore,hasMore:_},{children:[(0,r.jsx)(u.NarrativeRowCreation,{onClick:this.onCreateNarrativeClick,clickable:!0,size:50},"create"),n.map((function(t){return(0,r.jsx)(h.NarrativeRow,{narrative:t,onClick:function(){return e.onCheckboxClick(t)},size:50,noBorder:!0,clickable:!0,aside:(0,r.jsx)("div",{className:(0,c.classNames)("NarrativeChooseBox__checkbox",{"NarrativeChooseBox__checkbox--checked":d[t.id]})},void 0)},t.rawId)}))]}),void 0)}),void 0)},t.prototype.getDoneText=function(e){var t=e.filter((function(e){return e.op===f.BatchOperationType.Add})).length;if(t>1)return(0,l.getLang)("stories_saved_in_narratives_text");if(1===t)return(0,l.getLang)("stories_saved_in_narrative_text");var i=e.filter((function(e){return e.op===f.BatchOperationType.Delete})).length;return i>1?(0,l.getLang)("stories_deleted_in_narratives_text"):1===i?(0,l.getLang)("stories_deleted_in_narrative_text"):(0,l.getLang)("stories_settings_saved")},t.prototype.getDiffOperations=function(e,t,i){var o=[];return Object.keys(t).forEach((function(t){i[t]||o.push({op:f.BatchOperationType.Add,story_id:e,narrative_id:Number(t)})})),Object.keys(i).forEach((function(i){t[i]||o.push({op:f.BatchOperationType.Delete,story_id:e,narrative_id:Number(i)})})),o},t.prototype.getSelectedNarrativeIdsMap=function(e,t){return t.reduce((function(t,i){return i.stories.find((function(t){return t.id===e}))&&(t[i.id]=!0),t}),{})},t}(n.Component)},833623:(e,t,i)=>{"use strict";i.d(t,{MAX_THUMB_HEIGHT:()=>_,MAX_THUMB_WIDTH:()=>p,NarrativeCoverCropper:()=>g});var o=i(570655),r=i(785893),n=i(667294),a=i(41929),s=i(288420),l=i(70162),d=i(343390),c=i(146143),v=i(66433),u=i(118690),h=i(620145),_=604,p=468,g=function(e){function t(t){var i=e.call(this,t)||this;return i.onSaveCrop=function(){var e=i.props,t=e.onSave,o=e.onClose,r=e.coverUrl,n=i.crop;n&&(i.setState({isLoading:!0}),(0,h.getCroppedImage)(r,n.left,n.top,n.width,n.height).then((function(e){return t(i.getCropForSaving(n),e.src)})).then(o).catch((function(e){i.setState({isLoading:!1}),(0,c.showFastBox)((0,l.getLang)("global_error"),e||(0,l.getLang)("global_unknown_error")),console.error(e),(0,v.logError)(new Error("error with onSaveCrop"+(e?": "+e:"")))})))},i.onCropUpdate=function(e){i.crop=e},i.state={isLoading:!1},i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,i=e.coverUrl,n=e.coverHeight,c=e.coverWidth,v=e.thumbHeight,h=e.thumbWidth,_=e.crop,p=this.state.isLoading;return(0,r.jsx)(a.BoxModal,(0,o.__assign)({className:"NarrativeCoverCropper",appearance:"white",title:(0,l.getLang)("stories_cover_cropper_title"),onClose:t,hasScroll:!1},{children:(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeCoverCropper__inner"},{children:[(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeCoverCropper__info"},{children:[(0,r.jsx)("div",{children:(0,l.getLang)("stories_cover_cropper_info_1")},void 0),(0,r.jsx)("div",{children:(0,l.getLang)("stories_cover_cropper_info_2")},void 0)]}),void 0),(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeCoverCropper__frame"},{children:(0,r.jsx)(d.PhotoAreaSelector,{className:"NarrativeCoverCropper__tagger",imgSrc:i,imgHeight:n,imgWidth:c,previewHeight:v,previewWidth:h,minHeight:75,minWidth:75,isSquare:!0,preview100:!0,cropRect:this.getCropForTagger(_),onCropUpdated:this.onCropUpdate},void 0)}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeCoverCropper__footer"},{children:[(0,r.jsx)(u.default,(0,o.__assign)({loading:p,onClick:this.onSaveCrop},{children:(0,l.getLang)("stories_cover_next")}),void 0),(0,r.jsx)(s.default,(0,o.__assign)({disabled:p,appearance:"secondary",onClick:t},{children:(0,l.getLang)("stories_cover_back")}),void 0)]}),void 0)]}),void 0)}),void 0)},t.prototype.getCropForTagger=function(e){var t,i=this.props,o=i.coverWidth,r=i.coverHeight;if(e){var n=Math.round(e.width*o),a=Math.round(e.height*r);if(Math.abs(a-n)>1)return t;a=n,t={top:Math.round(e.y*r),left:Math.round(e.x*o),width:n,height:a}}return t},t.prototype.getCropForSaving=function(e){var t=this.props,i=t.coverWidth,o=t.coverHeight;return{y:e.top/o,x:e.left/i,width:e.width/i,height:e.height/o}},t}(n.Component)},884215:(e,t,i)=>{"use strict";i.d(t,{NarrativeCreateLiteBox:()=>_});var o=i(570655),r=i(785893),n=i(667294),a=i(70162),s=i(118690),l=i(41929),d=i(342269),c=i(117173),v=i(349062),u=i(551907),h=i(897449),_=function(e){function t(t){var i=e.call(this,t)||this;return i.onNameChange=function(e){var t=e.target.value,o=(0,d.trim)(t)?t:"";i.setState({name:o})},i.getBoxActionButtons=function(){var e=i.state.isLoad;return[(0,r.jsx)(s.default,(0,o.__assign)({appearance:"primary",onClick:i.save,loading:e},{children:(0,a.getLang)("groups_edit_narrative_publish")}),"publish")]},i.save=function(){var e=i.state.isLoad,t=i.state.name,o=void 0===t?"":t;e||((o=(0,d.trim)(o))?(i.setState({isLoad:!0}),i.props.onSave(o).catch((function(){i.setState({isLoad:!1})}))):(0,h.notaBene)(i.nameInputRef.current))},i.state={isLoad:!1,name:"",coverStory:t.stories[0]},i.nameInputRef=(0,n.createRef)(),i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,i=e.ownerName,n=e.stories,s=this.state,d=s.name,h=s.coverStory,_=null==h?void 0:h.preview;return(0,r.jsx)(l.BoxModal,(0,o.__assign)({className:"NarrativeCreateLiteBox",title:(0,a.getLang)("stories_creating_narrative"),actionButtons:this.getBoxActionButtons(),onClose:t,hasScroll:!1,appearance:"blue"},{children:(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__inner"},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__title"},{children:(0,a.getLang)("groups_edit_narrative_title")}),void 0),(0,r.jsx)("input",{type:"text",className:"NarrativeCreateLiteBox__nameInput",value:d,onChange:this.onNameChange,placeholder:(0,a.getLang)("stories_enter_name"),maxLength:c.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0},void 0),(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__title"},{children:(0,a.getLang)("groups_edit_narrative_preview")}),void 0),(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__text"},{children:(0,a.getLang)("groups_edit_narrative_pin_text")}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__previews"},{children:[(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__previewWrapper"},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__previewTitle"},{children:(0,a.getLang)("stories_narrative_preview_block_title")}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__smallPreview"},{children:[(0,r.jsx)(v.NarrativeItemPreviewCover,{cover:_},void 0),(0,r.jsx)("span",(0,o.__assign)({className:"NarrativeCreateLiteBox__smallPreviewName"},{children:d||(0,a.getLang)("stories_narrative_name_full")}),void 0)]}),void 0)]}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__previewWrapper NarrativeCreateLiteBox__previewWrapper--snippet"},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeCreateLiteBox__previewTitle"},{children:(0,a.getLang)("stories_narrative_preview_feed_title")}),void 0),(0,r.jsx)(u.NarrativeSnippet,{className:"NarrativeCreateLiteBox__snippet",ownerName:i,coverUrl:_,title:d,storyCount:n.length},void 0)]}),void 0)]}),void 0)]}),void 0)}),void 0)},t}(n.Component)},111898:(e,t,i)=>{"use strict";i.d(t,{NarrativeEditor:()=>S});var o=i(570655),r=i(785893),n=i(667294),a=i(70162),s=i(887157),l=i(288420),d=i(897449),c=i(501389),v=i(118690),u=i(720516),h=i(956252),_=i(342269),p=i(41929),g=i(652745),f=i(495893),m=i(405101),w=i(849464),y=i(303562),S=function(e){function t(t){var i=e.call(this,t)||this;i.onSelectedStoriesUpdate=function(e){void 0===e&&(e=[]);var t=i.props.storyMap,o=i.state.cover,r=null==o?void 0:o.coverStoryId,n={selectedStoryIds:e};if((null==o?void 0:o.customPhotoId)||r&&e.includes(r))e.length||(n.cover=null);else{var a=e[0];e[0]?n.cover={url:t[a].preview,coverStoryId:a}:n.cover=null}i.setState(n)},i.openCoverSelection=function(){var e=i.state.cover;((null==e?void 0:e.coverStoryId)||(null==e?void 0:e.customPhotoId))&&i.setState({section:s.EditorSectionType.cover})},i.confirmCover=function(e){var t=i.state.cover;i.setState({cover:e||t,section:s.EditorSectionType.main})},i.onNameChange=function(e){var t=e.target.value,o=(0,_.trim)(t)?t:"";i.setState({name:o})},i.close=function(e,t){var r=i.props,n=r.ownerId,a=r.narrativeRawId,s=r.navScreen;if(!e){var l="";a&&(l=(0,o.__read)(a.split("_"),2)[1]),(0,w.sendNarrativeAnalytic)(w.NarrativeAnalyticEventType.close,{ownerId:n,id:Number(l)},s)}i.props.close(t)},i.onSave=function(e){i.props.onSave(e)},i.getFooterButtons=function(){var e=i.props.type,t=i.state,n=t.selectedStoryIds,d=t.loading;return[(0,r.jsx)(l.default,(0,o.__assign)({appearance:"tertiary",onClick:function(){return i.close(!1)},disabled:d},{children:(0,a.getLang)("global_cancel")}),"close"),(0,r.jsx)(v.default,(0,o.__assign)({loading:d,onClick:i.save,disabled:0===n.length},{children:e===s.EditorModeType.edit?(0,a.getLang)("global_save"):(0,a.getLang)("stories_create_narrative")}),"save")]},i.save=function(){var e=i.props,t=e.publishHash,r=e.editHash,n=e.type,l=e.navScreen,v=e.ownerId,u=i.state,h=u.cover,p=u.loading,f=i.getSelectedStories(),m=i.state.name,y=void 0===m?"":m,S=i.props.narrativeRawId;if(!p)if(y=(0,_.trim)(y)){if((null==h?void 0:h.coverStoryId)||(null==h?void 0:h.customPhotoId)){var C="publish_narrative",x=t;n===s.EditorModeType.edit&&(C="edit_narrative",x=r);var N={act:C,owner_id:v,title:y,hash:x,story_ids:(0,g.prepareStoriesForPublishing)(f)};if(S){var b=(0,o.__read)(S.split("_"),2)[1];N.narrative_id=b}h.customPhotoId&&(N.custom_cover_photo_id=h.customPhotoId),h.coverStoryId&&(N.cover_story_id=h.coverStoryId),h.crop&&(N.crop_y=h.crop.y,N.crop_x=h.crop.x,N.crop_height=h.crop.height,N.crop_width=h.crop.width),window.ajax.post("al_stories.php",N,{onDone:function(e){S||(S=v+"_"+e);var t=i.getPublishDoneHtml(S,y,n);i.onSave(S),i.close(!0,(function(){return(0,c.showDoneBox)(t)})),(0,w.sendNarrativeAnalytic)(n===s.EditorModeType.edit?w.NarrativeAnalyticEventType.editNarrative:w.NarrativeAnalyticEventType.publishNarrative,{ownerId:Number(v),id:Number(e)},l)},onFail:function(e){return(0,c.showDoneBox)(e||(0,a.getLang)("global_error")),!0},hideProgress:function(){i.setState({loading:!1})}}),i.setState({loading:!0})}}else i.dataPanelRef.current&&(0,d.notaBene)(i.dataPanelRef.current.getInputEl())};var u=t.cover,h=t.selectedStoryIds[0];return!u&&h&&(u={url:t.storyMap[h].preview,coverStoryId:h}),i.state={tabKey:t.activeTabKey,name:t.name,selectedStoryIds:t.selectedStoryIds,cover:u,loading:!1,section:s.EditorSectionType.main},i.dataPanelRef=(0,n.createRef)(),i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this;return this.props.appearance===s.EditorViewType.box?(0,r.jsx)(p.BoxModal,(0,o.__assign)({className:"NarrativeEditor NarrativeEditor--box",appearance:"blue",title:this.getBoxTitle(),onClose:function(){return e.close()},hasScroll:!1},{children:this.renderInner()}),void 0):(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditor NarrativeEditor--page"},{children:this.renderInner()}),void 0)},t.prototype.renderInner=function(){var e=this.props,t=e.storyIds,i=e.storyMap,n=e.onStoryLinkUpdate,a=e.isEditingLinksAvailable,l=e.linkData,d=e.appearance,c=e.loadMore,v=e.hasMore,_=e.coverUploadConfig,p=e.ownerId,g=this.state,w=g.name,y=g.selectedStoryIds,S=g.cover,C=g.section,x=this.getSelectedStories(),N=(null==S?void 0:S.url)||"";return(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeEditor__inner"},{children:[C===s.EditorSectionType.main&&(0,r.jsxs)(m.NarrativeEditorSection,(0,o.__assign)({appearance:d,actionFooterButtons:this.getFooterButtons()},{children:[(0,r.jsx)(h.NarrativeEditorDataPanel,{className:"NarrativeEditor__dataPanel",coverUrl:N,name:w,selectedStoriesCount:y.length,onNameChange:this.onNameChange,onSubmit:this.save,onCoverClick:this.openCoverSelection,ref:this.dataPanelRef},void 0),(0,r.jsx)(u.NarrativeEditorStoriesTabPanel,{appearance:d,onSelectedStoriesUpdate:this.onSelectedStoriesUpdate,storyIds:t,loadMore:c,hasMore:v,selectedStoryIds:y,storyMap:i,linkData:l,isEditingLinksAvailable:a,onStoryLinkUpdate:n},void 0)]}),void 0),C===s.EditorSectionType.cover&&(0,r.jsx)(f.NarrativeEditorCoverSection,{ownerId:p,appearance:d,cover:S,stories:x,onSave:this.confirmCover,coverUploadConfig:_,storyMap:i},void 0)]}),void 0)},t.prototype.getBoxTitle=function(){var e=this.props.type;return this.state.section===s.EditorSectionType.cover?(0,a.getLang)("stories_choose_cover_title"):e===s.EditorModeType.create?(0,a.getLang)("stories_creating_narrative"):(0,a.getLang)("stories_editing_narrative")},t.prototype.getPublishDoneHtml=function(e,t,i){var r=this.props.getPublishDoneHTML;if(r)return r(e,t,i);var n=(0,o.__read)(e.split("_"),2),l=n[0],d=n[1],c="if (!event.metaKey && !event.ctrlKey) { showNarrative("+Number(l)+", "+Number(d)+", 0, 'narrative"+e+"'); return false; }";return'\n      <div class="top_result_header">\n        '+(i===s.EditorModeType.create?(0,a.getLang)("stories_narrative_created"):(0,a.getLang)("stories_narrative_edited")).replace("{name}",'<a href="/narrative'+e+'" onclick="'+c+'">'+(0,_.clean)(t)+"</a>")+'\n      </div>\n      <a href="#" class="link" onclick="window.Likes.share(\'narrative'+e+"'); return false;\">"+(0,a.getLang)("stories_manage_share_narrative")+"</a>\n    "},t.prototype.getSelectedStories=function(){var e=this;return this.state.selectedStoryIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.componentWillUnmount=function(){this.revokeCustomUrls()},t.prototype.revokeCustomUrls=function(){var e=this.state.cover;e&&(0,y.isCustomCover)(e)&&[e.url,e.customPhotoOriginalUrl].forEach((function(e){(null==e?void 0:e.startsWith("blob:"))&&URL.revokeObjectURL(e)}))},t.defaultProps={name:"",type:s.EditorModeType.create,activeTabKey:s.EditorTabKey.selected,isEditingLinksAvailable:!1,appearance:s.EditorViewType.page},t}(n.Component)},887157:(e,t,i)=>{"use strict";var o,r,n,a;i.d(t,{EditorModeType:()=>o,EditorTabKey:()=>r,EditorViewType:()=>n,EditorSectionType:()=>a}),function(e){e[e.create=0]="create",e[e.edit=1]="edit"}(o||(o={})),function(e){e.all="all",e.selected="selected"}(r||(r={})),function(e){e.box="box",e.page="page"}(n||(n={})),function(e){e.main="main",e.cover="cover"}(a||(a={}))},888551:(e,t,i)=>{"use strict";i.d(t,{NarrativeEditorAllTab:()=>h});var o=i(570655),r=i(785893),n=i(667294),a=i(887157),s=i(780528),l=i(98529),d=i(117173),c=i(659397),v=i(66433),u=i(740733),h=function(e){function t(t){var i=e.call(this,t)||this;return i.tabRef=(0,n.createRef)(),i.onScroll=function(){i.props.hasMore&&i.checkLoading()},i.checkLoading=(0,c.throttle)((function(){var e=i.props,t=e.loadMore,o=e.hasMore,r=i.state.isLoading,n=i.getScrollContainer(),a=i.getTabEl();o&&a&&(!r&&i.isMount&&(n instanceof HTMLElement?a.scrollTop+a.clientHeight>=a.scrollHeight-d.SCROLL_LOADING_MORE_GAP:window.innerHeight+d.SCROLL_LOADING_MORE_GAP>=a.getBoundingClientRect().bottom)&&(i.setState({isLoading:!0}),t().catch((function(e){console.error(e),(0,v.logError)(e)})).finally((function(){i.setState({isLoading:!1})}))))}),d.SCROLL_THROTTLE_DELAY),i.state={isLoading:!1},i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e,t=this,i=this.props,n=i.stories,a=i.selectedStoriesMap,d=i.className,v=i.onToggleCheck,h=i.isEditingLinksAvailable,_=i.onStoryLinkUpdate,p=i.linkData,g=this.state.isLoading;return(0,r.jsxs)("div",(0,o.__assign)({className:(0,c.classNames)("NarrativeEditorAllTab ScrollContainer",d),ref:this.tabRef},{children:[(0,r.jsx)(s.StoryArchivePreviewGrid,(0,o.__assign)({className:"NarrativeEditorAllTab__grid"},{children:n.map((function(i){var n=!1,s=new Date(1e3*i.time).toDateString();return e&&s===e||(e=s,n=!0),(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditorAllTab__story"},{children:(0,r.jsx)(l.StoryArchivePreview,{story:i,checked:!!a[i.id],selectable:t.isSelectable(i),onToggleCheck:v,onStoryLinkUpdate:_,isEditingLinksAvailable:h,linkData:p,needShowDate:n},void 0)}),i.rawId)}))}),void 0),g&&(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditorAllTab__loader"},{children:(0,r.jsx)(u.default,{},void 0)}),void 0)]}),void 0)},t.prototype.isSelectable=function(e){var t=this.props.selectedStoriesMap,i=Object.keys(t).length;return!e.isUnavailable&&!!(i<d.MAX_NARRATIVE_STORIES||t[e.id])},t.prototype.componentDidMount=function(){this.isMount=!0,this.initScrollListener()},t.prototype.componentWillUnmount=function(){this.isMount=!1,this.deInitScrollContainer()},t.prototype.initScrollListener=function(){var e=this.getScrollContainer(),t=this.getTabEl();e&&t&&e.addEventListener("scroll",this.onScroll,!0)},t.prototype.deInitScrollContainer=function(){var e;null===(e=this.getScrollContainer())||void 0===e||e.removeEventListener("scroll",this.onScroll)},t.prototype.getScrollContainer=function(){return this.props.appearance===a.EditorViewType.box?this.getTabEl():window},t.prototype.getTabEl=function(){var e;return null===(e=this.tabRef)||void 0===e?void 0:e.current},t.defaultProps={isEditingLinksAvailable:!1,hasMore:!1},t}(n.Component)},495893:(e,t,i)=>{"use strict";i.d(t,{NarrativeEditorCoverSection:()=>k});var o=i(570655),r=i(785893),n=i(667294),a=i(887157),s=i(659397),l=i(780528),d=i(98529),c=i(70162),v=i(288420),u=i(118690),h=i(405101),_=i(604192),p=i(152278),g=i(274123),f=i(111143),m=i(694292),w=i(673023),y=i(146143),S=i(241926),C=i(961540),x=i(66433),N=i(833623),b=i(303562),k=function(e){function t(t){var i,a=e.call(this,t)||this;a.scrollContainerRef=(0,n.createRef)(),a.isMount=!1,a.isCropSubmitted=!1,a.onFilesLoad=function(e){a.file=e[0],a.file&&a.uploadCover()},a.uploadCover=function(){if(a.file){var e=a.file,t=a.props.coverUploadConfig,i=new w.UploadPhoto(t,a.onUploadCoverProgress);i.validate(e).then((function(){if(a.isMount){var t=URL.createObjectURL(e),r={id:b.CustomCoverId,url:t,customPhotoOriginalUrl:t,percent:0,status:b.CoverUploadStatus.uploading};return a.setState({customCover:r}),i.upload(e).then((function(e){if(a.isMount){var t=JSON.stringify(e);a.setState({customCover:(0,o.__assign)((0,o.__assign)({},r),{percent:100,status:b.CoverUploadStatus.uploaded,uploadResponse:t}),checkedCoverId:b.CustomCoverId})}}))}})).catch((function(e){if(a.isMount){var t=a.state.customCover;t&&(t=(0,o.__assign)((0,o.__assign)({},t),{percent:0,status:b.CoverUploadStatus.failed})),console.error(e),e=(0,s.isObject)(e)?e.text:String(e),(0,y.showFastBox)((0,c.getLang)("global_error"),e||(0,c.getLang)("global_unknown_error")),(0,x.logError)(new Error("error with uploadCover"+(e?": "+e:""))),a.setState({customCover:t})}}))}},a.onUploadCoverProgress=function(e,t){var i=Math.min(e/t*100,90);a.setState((function(e){var t=e.customCover;return t?{customCover:(0,o.__assign)((0,o.__assign)({},t),{percent:i})}:null}))},a.selectCustomCover=function(){a.setState({checkedCoverId:b.CustomCoverId})},a.toggleCheck=function(e){a.setState({checkedCoverId:e.rawId})},a.openCropper=function(){var e=a.state.checkedCoverId,t=a.getCoverById(e);if(t){var i=a.getCoverOriginalUrl(t);i&&(0,C.loadImage)(i).then((function(e){if(a.isMount){var r=e.width,n=e.height,s=(0,o.__read)(a.getThumbSizes(r,n),2),l=s[0],d=s[1];a.setState({isModalOpen:!0}),(0,S.showNarrativeCropCoverBox)({coverUrl:i,coverHeight:n,coverWidth:r,thumbHeight:d,thumbWidth:l,crop:t.crop,onSave:a.onCropSave,onClose:a.onCropClose})}})).catch((function(e){console.error(e),e=String(e),(0,y.showFastBox)((0,c.getLang)("global_error"),e||(0,c.getLang)("global_unknown_error")),(0,x.logError)(new Error("error with cover openCropper"+(e?": "+e:"")))}))}},a.onCropSave=function(e,t){return a.saveCustomPhotoIfNeeded().then((function(i){a.isCropSubmitted=!0;var r=a.state.covers;(0,b.isSelectableCustomCover)(i)?a.setState({customCover:(0,o.__assign)((0,o.__assign)({},i),{url:t,crop:e})}):a.setState({covers:r.map((function(r){return r.id===i.id?(0,o.__assign)((0,o.__assign)({},i),{url:t,crop:e}):r}))})}))},a.onCropClose=function(){var e=a.props.onSave,t=a.state.checkedCoverId;a.setState({isModalOpen:!1});var i=a.getCoverById(t);i&&a.isCropSubmitted&&e({url:i.url,coverStoryId:i.coverStoryId,customPhotoOriginalUrl:i.customPhotoOriginalUrl,customPhotoId:i.customPhotoId,crop:i.crop})},a.getFooterButtons=function(){var e=a.props.onSave,t=a.state.customCover;return[(0,r.jsx)(v.default,(0,o.__assign)({appearance:"tertiary",onClick:function(){return e()}},{children:(0,c.getLang)("global_cancel")}),"close"),(0,r.jsx)(u.default,(0,o.__assign)({onClick:a.openCropper,disabled:(null==t?void 0:t.status)===b.CoverUploadStatus.uploading},{children:(0,c.getLang)("stories_narrative_cover_next_step")}),"save")]},a.onDragEnter=function(e){var t,i,o,r;("file"===(null===(i=null===(t=null==e?void 0:e.dataTransfer)||void 0===t?void 0:t.items[0])||void 0===i?void 0:i.kind)||(null===(r=null===(o=null==e?void 0:e.dataTransfer)||void 0===o?void 0:o.types)||void 0===r?void 0:r.includes("Files")))&&(clearTimeout(a.dragLeaveTimeout),delete a.dragLeaveTimeout,a.setState({showDropArea:!0})),(0,p.cancelEvent)(e)},a.onDragLeave=function(e){clearTimeout(a.dragLeaveTimeout),a.dragLeaveTimeout=setTimeout((function(){delete a.dragLeaveTimeout,a.setState({showDropArea:!1})}),100),(0,p.cancelEvent)(e)},a.onDragDrop=function(e){var t,i;a.onDragLeave(e),(null===(i=null===(t=null==e?void 0:e.dataTransfer)||void 0===t?void 0:t.files)||void 0===i?void 0:i.length)&&a.onFilesLoad(Array.from(e.dataTransfer.files));var o=a.getScrollContainer();o&&o.scrollTo({top:0,behavior:"smooth"}),(0,p.cancelEvent)(e)};var l=(0,o.__read)(a.buildCovers(t),2),d=l[0],h=l[1],_=null===(i=d[0])||void 0===i?void 0:i.id;if(t.cover){var g=t.cover.customPhotoId,f=t.cover.coverStoryId;_=g?b.CustomCoverId:f?t.storyMap[f].rawId:t.stories[0].rawId}return a.state={showDropArea:!1,covers:d,customCover:h,checkedCoverId:_,isModalOpen:!1},a}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,i=t.className,n=t.appearance,v=t.stories,u=this.state,p=u.customCover,w=u.checkedCoverId,y=u.showDropArea,S=u.isModalOpen;return(0,r.jsxs)(h.NarrativeEditorSection,(0,o.__assign)({className:(0,s.classNames)("NarrativeEditorCoverSection",i),appearance:n,actionFooterButtons:this.getFooterButtons()},{children:[(0,r.jsxs)("div",(0,o.__assign)({className:"ScrollContainer",ref:this.scrollContainerRef},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditorCoverSection__hint StoryGridHint"},{children:(0,c.getLang)("stories_choose_cover_hint")}),void 0),(0,r.jsxs)(l.StoryArchivePreviewGrid,(0,o.__assign)({className:"NarrativeEditorCoverSection__grid"},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditorCoverSection__create"},{children:(0,r.jsx)(_.StoryLoadFile,{text:(0,c.getLang)("stories_upload_narrative_cover"),onFilesLoad:this.onFilesLoad},void 0)}),void 0),p&&(0,r.jsx)(m.StoryCustomCoverPreview,{uploadingStatus:p.status,coverUrl:p.customPhotoOriginalUrl,checked:p.id===w,uploadingPercent:p.percent,onToggleCheck:this.selectCustomCover,retryUpload:this.uploadCover},void 0),v.map((function(t){return(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditorCoverSection__story"},{children:(0,r.jsx)(d.StoryArchivePreview,{story:t,checked:w===t.rawId,selectable:!0,onToggleCheck:e.toggleCheck},void 0)}),t.rawId)}))]}),void 0)]}),void 0),y&&!S&&n===a.EditorViewType.box&&(0,r.jsx)(g.UploadDropBoxArea,{},void 0),y&&!S&&n===a.EditorViewType.page&&(0,r.jsx)(f.UploadDropPageArea,{},void 0)]}),void 0)},t.prototype.getThumbSizes=function(e,t){var i,o,r=e/t;return e>=t?(i=Math.min(e,N.MAX_THUMB_WIDTH),(o=Math.floor(i/r))>N.MAX_THUMB_HEIGHT&&(o=N.MAX_THUMB_HEIGHT,i=Math.floor(o*r))):(o=Math.min(t,N.MAX_THUMB_HEIGHT),(i=Math.floor(o*r))>N.MAX_THUMB_WIDTH&&(i=N.MAX_THUMB_WIDTH,o=Math.floor(i/r))),[i,o]},t.prototype.saveCustomPhotoIfNeeded=function(){var e=this,t=this.props,i=t.ownerId,r=t.coverUploadConfig,n=this.state.checkedCoverId,a=this.getCoverById(n);return a?(0,b.needSavePhoto)(a)?new Promise((function(t,n){window.ajax.post("al_stories.php",{act:"save_narrative_cover",owner_id:i,upload_response:a.uploadResponse,hash:r.hash},{onDone:function(i){var r=e.state.customCover;if(e.isMount&&r){var a=(0,o.__assign)((0,o.__assign)({},r),{customPhotoId:i});t(a)}else n()},onFail:function(e){return console.error(e),n(e),!0}})})):Promise.resolve(a):Promise.reject()},t.prototype.componentDidMount=function(){this.isMount=!0;var e=this.getDragAndDropContainer();e&&(e.addEventListener("drop",this.onDragDrop),e.addEventListener("dragenter",this.onDragEnter),e.addEventListener("dragover",this.onDragEnter),e.addEventListener("dragleave",this.onDragLeave))},t.prototype.componentWillUnmount=function(){this.isMount=!1,null!=this.dragLeaveTimeout&&clearTimeout(this.dragLeaveTimeout);var e=this.getDragAndDropContainer();e&&(e.removeEventListener("drop",this.onDragDrop),e.removeEventListener("dragenter",this.onDragEnter),e.removeEventListener("dragover",this.onDragEnter),e.removeEventListener("dragleave",this.onDragLeave))},t.prototype.getDragAndDropContainer=function(){return this.props.appearance===a.EditorViewType.box?window.boxLayerWrap:document.body},t.prototype.getScrollContainer=function(){return this.props.appearance===a.EditorViewType.box?this.scrollContainerRef.current:document.documentElement},t.prototype.buildCovers=function(e){var t,i=e.cover,r=e.stories;return i&&(0,b.isCustomCover)(i)&&(t=(0,o.__assign)({id:b.CustomCoverId},i)),[r.map((function(e){return(null==i?void 0:i.coverStoryId)===e.id?(0,o.__assign)({id:e.rawId},i):{id:e.rawId,url:e.preview,coverStoryId:e.id}})),t]},t.prototype.getCoverById=function(e){return e===b.CustomCoverId?this.state.customCover:this.state.covers.find((function(t){return t.id===e}))},t.prototype.getCoverOriginalUrl=function(e){var t,i=this.props.storyMap,o="";return(0,b.isSelectableCustomCover)(e)?o=e.customPhotoOriginalUrl:e.coverStoryId&&(o=null===(t=i[e.coverStoryId])||void 0===t?void 0:t.originalPreviewUrl),o},t}(n.Component)},303562:(e,t,i)=>{"use strict";var o;function r(e){return Boolean(e.customPhotoId||e.uploadResponse)}function n(e){return Boolean(e.customPhotoId)}function a(e){return e.uploadResponse&&!e.customPhotoId}function s(e){var t={url:e.coverUrl,crop:e.coverCrop};return e.customCover?(t.customPhotoId=e.customCover.photoId,t.customPhotoOriginalUrl=e.customCover.originalPhotoUrl):t.coverStoryId=e.coverStoryId,t}i.d(t,{CoverUploadStatus:()=>o,isSelectableCustomCover:()=>r,isCustomCover:()=>n,needSavePhoto:()=>a,getPreparedCover:()=>s,CustomCoverId:()=>l}),function(e){e[e.uploaded=0]="uploaded",e[e.uploading=1]="uploading",e[e.failed=2]="failed"}(o||(o={}));var l="custom"},956252:(e,t,i)=>{"use strict";i.d(t,{NarrativeEditorDataPanel:()=>h});var o=i(570655),r=i(785893),n=i(667294),a=i(70162),s=i(659397),l=i(349062),d=i(117173),c=i(152278),v=i(840060),u=i(662199),h=function(e){function t(t){var i=e.call(this,t)||this;return i.getInputEl=function(){return i.nameInputRef&&i.nameInputRef.current},i.onKeyDown=function(e){e.keyCode===c.KEY.ENTER&&(e.ctrlKey||e.metaKey&&v.browser.mac)&&i.props.onSubmit()},i.nameInputRef=(0,n.createRef)(),i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.name,i=e.onNameChange,n=e.selectedStoriesCount,c=e.coverUrl,v=e.onCoverClick,h=e.className,_=0===n,p="";return _||(p=(0,a.getLang)("stories_choose_cover")),(0,r.jsxs)("div",(0,o.__assign)({className:(0,s.classNames)("NarrativeEditorDataPanel",h)},{children:[(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeEditorDataPanel__preview"},{children:[(0,r.jsx)(l.NarrativeItemPreviewCover,{className:(0,s.classNames)("NarrativeEditorDataPanel__cover",{"NarrativeEditorDataPanel__cover--active":!_}),onClick:v,cover:c,title:p,extra:!_&&(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditorDataPanel__pencil"},{children:(0,r.jsx)(u.default,{},void 0)}),void 0)},void 0),(0,r.jsx)("span",(0,o.__assign)({className:(0,s.classNames)("NarrativeEditorDataPanel__name",{"NarrativeEditorDataPanel__name--empty":!t})},{children:t||(0,a.getLang)("stories_narrative_name_full")}),void 0)]}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeEditorDataPanel__form"},{children:[(0,r.jsx)("span",(0,o.__assign)({className:"NarrativeEditorDataPanel__nameLabel"},{children:(0,a.getLang)("stories_narrative_name")}),void 0),(0,r.jsx)("input",{className:"NarrativeEditorDataPanel__nameInput",value:t,onChange:i,onKeyDown:this.onKeyDown,type:"text",placeholder:(0,a.getLang)("stories_enter_name"),maxLength:d.NARRATIVE_MAX_TITLE_LENGTH,ref:this.nameInputRef,autoFocus:!0},void 0),n>0&&(0,r.jsx)("span",(0,o.__assign)({className:"NarrativeEditorDataPanel__selectedStoryCount"},{children:(0,a.getLang)("stories_selected_count",n)}),void 0)]}),void 0)]}),void 0)},t}(n.Component)},743188:(e,t,i)=>{"use strict";i.d(t,{NarrativeEditorFooter:()=>s});var o=i(570655),r=i(785893),n=i(483295),a=i(150382),s=function(e){var t=e.appearance,i=e.actionButtons;return(0,r.jsx)("div",(0,o.__assign)({className:(0,n.classNames)("NarrativeEditorFooter","NarrativeEditorFooter--"+t)},{children:(0,r.jsx)(a.ModalFooter,{actionButtons:i},void 0)}),void 0)}},405101:(e,t,i)=>{"use strict";i.d(t,{NarrativeEditorSection:()=>l});var o=i(570655),r=i(785893),n=i(667294),a=i(743188),s=i(483295),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scrollContainerRef=(0,n.createRef)(),t}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,i=e.children,n=e.appearance,l=e.actionFooterButtons;return(0,r.jsxs)("div",(0,o.__assign)({className:(0,s.classNames)("NarrativeEditorSection",t),ref:this.scrollContainerRef},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditorSection__body"},{children:i}),void 0),Boolean(l)&&(0,r.jsx)(a.NarrativeEditorFooter,{appearance:n,actionButtons:l},void 0)]}),void 0)},t.prototype.getSectionEl=function(){var e;return null===(e=this.scrollContainerRef)||void 0===e?void 0:e.current},t}(n.Component)},417139:(e,t,i)=>{"use strict";i.d(t,{NarrativeEditorSelectedTab:()=>h});var o=i(570655),r=i(785893),n=i(667294),a=i(887157),s=i(780528),l=i(98529),d=i(483295),c=i(117173),v=i(622858),u="NarrativeEditorSelectedTab__storyPreview",h=function(e){function t(t){var i=e.call(this,t)||this;return i.gridContainerRef=(0,n.createRef)(),i.tabRef=(0,n.createRef)(),i.state={draggingStoryRawId:""},i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,i=t.stories,n=t.selectedStoriesMap,a=t.className,c=t.isEditingLinksAvailable,v=t.onStoryLinkUpdate,h=t.linkData,_=t.onToggleCheck,p=this.state.draggingStoryRawId;return(0,r.jsx)("div",(0,o.__assign)({className:(0,d.classNames)("NarrativeEditorSelectedTab ScrollContainer",a),ref:this.tabRef},{children:(0,r.jsx)(s.StoryArchivePreviewGrid,(0,o.__assign)({ref:this.gridContainerRef},{children:i.map((function(t){return(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeEditorSelectedTab__story"},{children:(0,r.jsx)(l.StoryArchivePreview,{className:u,story:t,draggable:!0,isDragged:t.rawId===p,checked:!!n[t.id],selectable:e.isSelectable(t),onToggleCheck:_,onStoryLinkUpdate:v,isEditingLinksAvailable:c,linkData:h},void 0)}),t.rawId)}))}),void 0)}),void 0)},t.prototype.isSelectable=function(e){var t=this.props.selectedStoriesMap,i=Object.keys(t).length;return!e.isUnavailable&&!!(i<c.MAX_NARRATIVE_STORIES||t[e.rawId])},t.prototype.componentDidMount=function(){var e=this,t=this.props,i=t.onReorder,o=t.appearance,r=this.getGridContainer(),n={dragThreshold:0,onDragFinish:function(){e.setState({draggingStoryRawId:""})},onDragStart:function(t){var i=t.querySelector("."+u);if(i){var o=i.dataset.id;e.setState({draggingStoryRawId:o})}},onReorder:function(){var t=e.props.stories,o=document.querySelectorAll("."+u),r=[];o.forEach((function(e){var i=e.getAttribute("data-id"),o=t.find((function(e){return e.rawId===i}));o&&r.push(o.id)})),i(r)}};r&&(o===a.EditorViewType.box&&(n.wrapNode=this.getTabEl()),this.sorter=new v.default(r,"",n))},t.prototype.componentWillUnmount=function(){this.sorter&&this.sorter.destroy()},t.prototype.getTabEl=function(){var e;return null===(e=this.tabRef)||void 0===e?void 0:e.current},t.prototype.getGridContainer=function(){var e,t;return null===(t=null===(e=this.gridContainerRef)||void 0===e?void 0:e.current)||void 0===t?void 0:t.getGridContainer()},t}(n.Component)},720516:(e,t,i)=>{"use strict";i.d(t,{NarrativeEditorStoriesTabPanel:()=>h});var o=i(570655),r=i(785893),n=i(667294),a=i(887157),s=i(70162),l=i(641388),d=i(417139),c=i(888551),v=i(483295),u=i(117173),h=function(e){function t(t){var i=e.call(this,t)||this;return i.onTabClick=function(e,t){i.setState({tabKey:t,selectedTabStoryIds:(0,o.__spreadArray)([],(0,o.__read)(i.props.selectedStoryIds),!1)})},i.onReorder=function(e){var t=i.props.onSelectedStoriesUpdate,o=i.getSelectedStoriesMap(),r=e.filter((function(e){return o[e]}));i.setState({selectedTabStoryIds:e}),t(r)},i.onStorySelectToggle=function(e){var t,r=i.props,n=r.selectedStoryIds,s=r.onSelectedStoriesUpdate,l=i.state,d=l.tabKey,c=l.selectedTabStoryIds,v=i.getSelectedStoriesMap();if(!(Object.keys(v).length>=u.MAX_NARRATIVE_STORIES)||v[e.id]){if(!c.length)return i.setState({selectedTabStoryIds:[e.id]}),void s([e.id]);if(v[e.id]){s(n.filter((function(t){return t!==e.id})))}else{var h=[],_=(0,o.__assign)((0,o.__assign)({},v),((t={})[e.id]=e,t));if(d===a.EditorTabKey.selected)h=c.filter((function(e){return _[e]}));else if(d===a.EditorTabKey.all){if(c.includes(e.id))h=c.filter((function(e){return _[e]}));else h=(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(c),!1),[e.id],!1).filter((function(e){return _[e]})),i.setState({selectedTabStoryIds:(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(c),!1),[e.id],!1)})}s(h)}}},i.state={tabKey:t.selectedStoryIds.length?a.EditorTabKey.selected:a.EditorTabKey.all,selectedTabStoryIds:(0,o.__spreadArray)([],(0,o.__read)(t.selectedStoryIds),!1)},i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e,t=this.props,i=t.selectedStoryIds,n=t.appearance,u=t.isEditingLinksAvailable,h=t.linkData,_=t.onStoryLinkUpdate,p=t.loadMore,g=t.hasMore,f=this.state.tabKey,m=this.getSelectedStoriesMap(),w=this.getAllStories();return(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeEditorStoriesTabPanel"},{children:[(0,r.jsxs)(l.default,(0,o.__assign)({className:"NarrativeEditorStoriesTabPanel__tabs",onTabClick:this.onTabClick,active:f,disabledTabMap:(e={},e[a.EditorTabKey.selected]=!i.length,e)},{children:[(0,r.jsxs)("span",{children:[(0,s.getLang)("stories_narrative_editor_selected_tab"),i.length>0&&(0,r.jsx)("span",(0,o.__assign)({className:"Tabs__desc"},{children:i.length}),void 0)]},a.EditorTabKey.selected),(0,r.jsx)("span",{children:(0,s.getLang)("stories_narrative_editor_all_tab")},a.EditorTabKey.all)]}),void 0),f===a.EditorTabKey.selected&&(0,r.jsx)(d.NarrativeEditorSelectedTab,{className:(0,v.classNames)("NarrativeEditorSelectPanel__grid","NarrativeEditorSelectPanel__grid--"+n),appearance:n,stories:this.getSelectedTabStories(),onReorder:this.onReorder,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:m,onStoryLinkUpdate:_,isEditingLinksAvailable:u,linkData:h},void 0),f===a.EditorTabKey.all&&(0,r.jsx)(c.NarrativeEditorAllTab,{className:(0,v.classNames)("NarrativeEditorSelectPanel__grid","NarrativeEditorSelectPanel__grid--"+n),appearance:n,stories:w,loadMore:p,hasMore:g,onToggleCheck:this.onStorySelectToggle,selectedStoriesMap:m,onStoryLinkUpdate:_,isEditingLinksAvailable:u,linkData:h},void 0)]}),void 0)},t.prototype.getSelectedTabStories=function(){var e=this;return this.state.selectedTabStoryIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.getAllStories=function(){var e=this;return this.props.storyIds.map((function(t){return e.props.storyMap[t]}))},t.prototype.getSelectedStoriesMap=function(){var e=this;return this.props.selectedStoryIds.reduce((function(t,i){return t[i]=e.props.storyMap[i],t}),{})},t.defaultProps={isEditingLinksAvailable:!1},t}(n.Component)},349062:(e,t,i)=>{"use strict";i.d(t,{NarrativeItemPreviewCover:()=>s});var o=i(570655),r=i(785893),n=i(667294),a=i(483295),s=(0,n.memo)((function(e){var t=e.title,i=e.onClick,s=e.cover,l=e.href,d=e.className,c=void 0===d?"":d,v=e.extra,u=e.noBorder,h=void 0!==u&&u,_=e.isDraft,p=void 0!==_&&_,g=e.size,f=void 0===g?58:g,m=s?{backgroundImage:"url("+s+")"}:{},w=(0,a.classNames)("NarrativeItemPreviewCover","NarrativeItemPreviewCover--size"+f,c,{"NarrativeItemPreviewCover--noBorder":h,"NarrativeItemPreviewCover--isDraft":p}),y=(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeItemPreviewCover__image",style:m,title:t||void 0},{children:v}),void 0);return(0,r.jsxs)(n.Fragment,{children:[l&&(0,r.jsx)("a",(0,o.__assign)({href:l,className:w,onClick:i},{children:y}),void 0),!l&&(0,r.jsx)("div",(0,o.__assign)({className:w,onClick:i},{children:y}),void 0)]},void 0)}))},109542:(e,t,i)=>{"use strict";i.d(t,{NarrativeRow:()=>v});var o=i(570655),r=i(785893),n=i(667294),a=i(349062),s=i(167625),l=i(659397),d=i(70162),c=i(521114),v=(0,n.memo)((function(e){var t,i,v,u,h=e.narrative,_=e.aside,p=e.onClick,g=e.className,f=e.clickable,m=e.size,w=e.noBorder,y=!h.storiesCount,S=y?"":"/narrative"+h.ownerId+"_"+h.id;return y?(t=(0,r.jsx)(a.NarrativeItemPreviewCover,{isDraft:!0,extra:(0,r.jsx)(c.default,{},void 0),size:m},void 0),i=(0,r.jsxs)(n.Fragment,{children:[(0,d.getLang)("groups_narrative_box_stories_count",h.storiesCount),(0,r.jsx)("span",{className:"dvd"},void 0),(0,r.jsx)("span",{children:(0,d.getLang)("stories_narratives_draft")},void 0)]},void 0)):(t=(0,r.jsx)(a.NarrativeItemPreviewCover,{onClick:p,size:m,cover:h.coverUrl,href:S,noBorder:w},void 0),i=(0,r.jsx)("span",{children:(0,d.getLang)("groups_narrative_box_stories_count",h.storiesCount)},void 0)),f?v=p:y||(u=p),(0,r.jsx)("div",(0,o.__assign)({className:(0,l.classNames)("NarrativeRow NarrativeListItem",g,{"NarrativeRow--clickable":f}),"data-id":h.id,onClick:v},{children:(0,r.jsx)(s.NarrativeRowBase,{className:"NarrativeRow__inner",href:S,onClick:u,preview:t,id:h.id,title:h.title,subtitle:i,size:m,aside:_},void 0)}),void 0)}))},167625:(e,t,i)=>{"use strict";i.d(t,{NarrativeRowBase:()=>s});var o=i(570655),r=i(785893),n=i(667294),a=i(659397),s=(0,n.memo)((function(e){e.id;var t,i=e.title,n=e.subtitle,s=e.preview,l=e.aside,d=e.href,c=e.onClick,v=e.className,u=void 0===v?"":v,h=e.size,_=void 0===h?58:h,p=(0,o.__rest)(e,["id","title","subtitle","preview","aside","href","onClick","className","size"]),g=Boolean(c||d);return i=(0,a.decodeHTMLEntities)(i),t=d?(0,r.jsx)("a",(0,o.__assign)({href:d,className:"NarrativeRowBase__title",onClick:c},{children:i}),void 0):(0,r.jsx)("span",(0,o.__assign)({className:"NarrativeRowBase__title",onClick:c},{children:i}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:(0,a.classNames)("NarrativeRowBase","NarrativeRowBase--previewSize"+_,u,{"NarrativeRowBase--clickable":g})},p,{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeRowBase__preview"},{children:s}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeRowBase__inner"},{children:[(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeRowBase__main"},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeRowBase__title"},{children:t}),void 0),n&&(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeRowBase__subtitle"},{children:n}),void 0)]}),void 0),l&&(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeRowBase__aside"},{children:l}),void 0)]}),void 0)]}),void 0)}))},385597:(e,t,i)=>{"use strict";i.d(t,{NarrativeRowCreation:()=>c});var o=i(570655),r=i(785893),n=i(667294),a=i(167625),s=i(70162),l=i(659397),d=i(587083),c=(0,n.memo)((function(e){var t=e.onClick,i=e.clickable,n=void 0!==i&&i,c=e.size,v=void 0===c?58:c,u=(0,s.getLang)("stories_create_new_narrative"),h=(0,r.jsx)("div",(0,o.__assign)({className:(0,l.classNames)("NarrativeRowCreation__preview","NarrativeRowCreation__preview--size"+v)},{children:(0,r.jsx)(d.default,{},void 0)}),void 0);return(0,r.jsx)("div",(0,o.__assign)({className:(0,l.classNames)("NarrativeRowCreation NarrativeListItem",{"NarrativeRowCreation--clickable":n})},{nodrag:"true"},{children:(0,r.jsx)(a.NarrativeRowBase,{className:"NarrativeRowCreation__inner",title:u,onClick:t,preview:h,size:v},void 0)}),void 0)}))},551907:(e,t,i)=>{"use strict";i.d(t,{NarrativeSnippet:()=>s});var o=i(570655),r=i(785893),n=i(70162),a=i(659397),s=function(e){var t=e.className,i=e.coverUrl,s=e.title,l=e.ownerName,d=e.storyCount;return(0,r.jsx)("div",(0,o.__assign)({className:(0,a.classNames)("NarrativeSnippet",t)},{children:(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeSnippet__inner"},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"NarrativeSnippet__cover"},{children:(0,r.jsx)("div",{className:"NarrativeSnippet__image",style:{backgroundImage:"url("+i+")"}},void 0)}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:"NarrativeSnippet__info"},{children:[(0,r.jsx)("div",(0,o.__assign)({className:(0,a.classNames)("NarrativeSnippet__title",{"NarrativeSnippet__title--empty":!s})},{children:s||(0,n.getLang)("stories_narrative_name_full")}),void 0),(0,r.jsx)("span",(0,o.__assign)({className:"NarrativeSnippet__author"},{children:l}),void 0),(0,r.jsxs)("span",(0,o.__assign)({className:"NarrativeSnippet__description"},{children:[(0,r.jsx)("span",{children:(0,n.getLang)("global_type_narrative")},void 0),(0,r.jsx)("span",{className:"dvd"},void 0),(0,r.jsx)("span",{children:(0,n.getLang)("global_narrative_stories_count",d)},void 0)]}),void 0)]}),void 0)]}),void 0)}),void 0)}},98529:(e,t,i)=>{"use strict";i.d(t,{StoryArchivePreview:()=>_});var o=i(570655),r=i(785893),n=i(667294),a=i(483295),s=i(70162),l=i(241926),d=i(66433),c=i(679740),v=i(213984),u=i(104022),h=i(740733),_=function(e){function t(t){var i=e.call(this,t)||this;return i.videoRef=(0,n.createRef)(),i.needPauseAfterLoading=!1,i.onLinkButtonClick=function(e){var t=i.props,o=t.story,r=t.onStoryLinkUpdate,n=t.linkData;t.isDragged||((0,l.showStoryLinkEditorBox)({story:o,onStoryLinkUpdate:r,linkData:n}),e.stopPropagation())},i.onMouseEnter=function(){i.setState({isHovered:!0})},i.onMouseLeave=function(){i.setState({isHovered:!1})},i.onToggleCheck=function(){var e=i.props,t=e.onToggleCheck,o=e.story;!e.isDragged&&t&&t(o)},i.state={isHovered:!1,preloadVideo:!1,canPlayVideo:!1,isLoading:!1},i}return(0,o.__extends)(t,e),t.prototype.componentDidUpdate=function(e,t){var i=this.props,o=i.story,r=i.isDragged,n=this.state.isHovered;o.videoUrl&&(r||(!t.isHovered&&n?this.playVideo():t.isHovered&&!n&&this.pauseVideo()),!e.isDragged&&r&&this.pauseVideo(),e.isDragged&&!r&&n&&this.playVideo())},t.prototype.componentWillUnmount=function(){this.cleanVideoPlayTimeout(),this.cleanVideoPauseTimeout(),this.cleanVideoLoaderTimeout()},t.prototype.playVideo=function(e){var t=this;void 0===e&&(e=!1),null!=this.videoPauseDelayTimeout&&this.cleanVideoPauseTimeout();var i=function(){delete t.videoPlayDelayTimeout,t.videoRef.current&&(t.videoRef.current.muted=!0,t.videoRef.current.play().then((function(){var e;if(t.hideLoader(),t.setState({canPlayVideo:!0}),t.needPauseAfterLoading)return null===(e=t.videoRef.current)||void 0===e||e.pause(),void(t.needPauseAfterLoading=!1)})).catch((function(e){t.hideLoader(),console.error(e),(0,d.logError)(e)})))};e?i():null==this.videoPlayDelayTimeout&&(this.videoLoaderTimeout=setTimeout((function(){t.setState({isLoading:!0})}),800),this.setState({preloadVideo:!0}),this.videoPlayDelayTimeout=setTimeout((function(){i()}),200))},t.prototype.pauseVideo=function(e){var t=this;void 0===e&&(e=!1),null!=this.videoPlayDelayTimeout&&this.cleanVideoPlayTimeout();var i=function(){var e;if(delete t.videoPauseDelayTimeout,t.hideLoader(),t.state.canPlayVideo){var i=null===(e=t.videoRef)||void 0===e?void 0:e.current;null==i||i.pause()}else t.needPauseAfterLoading=!0};e?i():null==this.videoPauseDelayTimeout&&(this.videoPauseDelayTimeout=setTimeout((function(){i()}),200))},t.prototype.cleanVideoPlayTimeout=function(){this.videoPlayDelayTimeout&&(clearTimeout(this.videoPlayDelayTimeout),delete this.videoPlayDelayTimeout)},t.prototype.cleanVideoPauseTimeout=function(){this.videoPauseDelayTimeout&&(clearTimeout(this.videoPauseDelayTimeout),delete this.videoPauseDelayTimeout)},t.prototype.cleanVideoLoaderTimeout=function(){this.videoLoaderTimeout&&(clearTimeout(this.videoLoaderTimeout),delete this.videoLoaderTimeout)},t.prototype.hideLoader=function(){this.state.isLoading&&this.setState({isLoading:!1}),this.cleanVideoLoaderTimeout()},t.prototype.render=function(){var e=this,t=this.props,i=t.story,n=t.checked,l=t.selectable,d=t.draggable,_=t.className,p=t.isEditingLinksAvailable,g=t.needShowDate,f=this.state,m=f.preloadVideo,w=f.canPlayVideo,y=f.isLoading,S=Boolean(i.videoUrl),C=new Date(1e3*i.time);return(0,r.jsx)("div",(0,o.__assign)({className:(0,a.classNames)("StoryArchivePreview","StoryPreviewContainer",_,{"StoryArchivePreview--video":S,"StoryArchivePreview--checked":n}),onClick:this.onToggleCheck,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,"data-id":i.rawId},{children:(0,r.jsxs)("div",(0,o.__assign)({className:"StoryArchivePreview__wrapper"},{children:[S&&(0,r.jsxs)(r.Fragment,{children:[m&&(0,r.jsx)("video",{className:(0,a.classNames)("StoryArchivePreview__media",{"StoryArchivePreview__media--hidden":!w}),src:i.videoUrl,ref:this.videoRef,controls:!1,preload:"metadata",loop:!0,playsInline:!0},void 0),!w&&(0,r.jsx)("img",{className:"StoryArchivePreview__media",src:i.preview,alt:""},void 0)]},void 0),!S&&(0,r.jsx)("img",{className:"StoryArchivePreview__media",src:i.preview,alt:""},void 0),g&&(0,r.jsxs)("div",(0,o.__assign)({className:"StoryArchivePreview__date"},{children:[(0,r.jsx)("div",(0,o.__assign)({className:"StoryArchivePreview__day"},{children:C.getDate()}),void 0),(0,r.jsx)("div",(0,o.__assign)({className:"StoryArchivePreview__month"},{children:(0,r.jsx)(v.default,{children:(0,s.getLang)("months_sm_of")[C.getMonth()+1]},void 0)}),void 0)]}),void 0),d&&!g&&(0,r.jsx)("div",{className:"StoryArchivePreview__draggableIcon"},void 0),l&&(0,r.jsx)("div",{className:(0,a.classNames)("StoryArchivePreview__select",{"StoryArchivePreview__select--on":n})},void 0),(p||i.videoUrl)&&(0,r.jsx)("div",(0,o.__assign)({className:"StoryArchivePreview__footer"},{children:(0,r.jsxs)("div",(0,o.__assign)({className:"StoryArchivePreview__footerInner"},{children:[i.videoUrl&&(0,r.jsxs)("div",(0,o.__assign)({className:"StoryArchivePreview__play"},{children:[(0,r.jsx)(u.default,{},void 0),(0,r.jsx)("span",(0,o.__assign)({className:"StoryArchivePreview__playTime"},{children:(0,c.formatTime)(i.duration||0)}),void 0)]}),void 0),p&&(0,r.jsx)("div",(0,o.__assign)({className:"StoryArchivePreview__linkBtn",onClick:function(t){return e.onLinkButtonClick(t)}},{children:i.linkUrl?(0,s.getLang)("stories_edit_link"):(0,s.getLang)("stories_add_link")}),void 0)]}),void 0)}),void 0),y&&(0,r.jsx)("div",(0,o.__assign)({className:"StoryArchivePreview__loader"},{children:(0,r.jsx)(h.default,{size:24,strokeWidth:3,color:"#fff"},void 0)}),void 0)]}),void 0)}),void 0)},t.defaultProps={checked:!1,selectable:!1,draggable:!1,isDragged:!1,className:"",isEditingLinksAvailable:!1,onToggleCheck:function(){},onStoryLinkUpdate:function(){},linkData:[]},t}(n.PureComponent)},780528:(e,t,i)=>{"use strict";i.d(t,{StoryArchivePreviewGrid:()=>s});var o=i(570655),r=i(785893),n=i(667294),a=i(483295),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gridContainerRef=(0,n.createRef)(),t}return(0,o.__extends)(t,e),t.prototype.getGridContainer=function(){return this.gridContainerRef.current},t.prototype.render=function(){var e=this.props,t=e.className,i=e.children,n=e.isScrolling;return(0,r.jsx)("div",(0,o.__assign)({className:(0,a.classNames)("StoryArchivePreviewGrid",t,{"StoryArchivePreviewGrid--scrolling":n})},{children:(0,r.jsx)("div",(0,o.__assign)({className:"StoryArchivePreviewGrid__inner",ref:this.gridContainerRef},{children:i}),void 0)}),void 0)},t.defaultProps={className:""},t}(n.Component)},694292:(e,t,i)=>{"use strict";i.d(t,{StoryCustomCoverPreview:()=>v});var o=i(570655),r=i(785893),n=i(667294),a=i(659397),s=i(786427),l=i(410902),d=i(70162),c=i(303562),v=function(e){function t(t){return e.call(this,t)||this}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.checked,i=e.coverUrl,n=e.onToggleCheck,v=e.uploadingStatus,u=e.uploadingPercent,h=e.retryUpload,_=v===c.CoverUploadStatus.uploaded,p=v===c.CoverUploadStatus.uploading,g=v===c.CoverUploadStatus.failed,f=_;return(0,r.jsxs)("div",(0,o.__assign)({className:(0,a.classNames)("StoryCustomCoverPreview StoryPreviewContainer",{"StoryCustomCoverPreview--empty":p||g}),onClick:function(){f&&n()}},{children:[_&&(0,r.jsx)("div",(0,o.__assign)({className:"StoryCustomCoverPreview__coverFrame"},{children:(0,r.jsx)("div",(0,o.__assign)({className:"StoryCustomCoverPreview__coverWrap"},{children:(0,r.jsx)("img",{src:i,className:"StoryCustomCoverPreview__cover",alt:""},void 0)}),void 0)}),void 0),p&&(0,r.jsx)(s.StoryProgressSpinner,{percent:u},void 0),g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.default,{},void 0),(0,r.jsx)("span",(0,o.__assign)({className:"StoryCustomCoverPreview__errorText"},{children:(0,d.getLang)("stories_upload_error_text")}),void 0),(0,r.jsx)("div",(0,o.__assign)({className:"StoryCustomCoverPreview__repeat",onClick:h},{children:(0,d.getLang)("stories_upload_repeat")}),void 0)]},void 0),f&&(0,r.jsx)("div",{className:(0,a.classNames)("StoryCustomCoverPreview__select",{"StoryCustomCoverPreview__select--on":t})},void 0)]}),void 0)},t.defaultProps={uploadingStatus:c.CoverUploadStatus.uploaded},t}(n.PureComponent)},730095:(e,t,i)=>{"use strict";i.d(t,{StoryLinkEditorBox:()=>f});var o=i(570655),r=i(785893),n=i(667294),a=i(70162),s=i(288420),l=i(41929),d=i(156589),c=i(870078),v=i(342269),u=i(146143),h=i(897449),_=i(66433),p=i(118690),g=i(501389),f=function(e){function t(t){var i=e.call(this,t)||this;return i.inputRef=(0,n.createRef)(),i.onChangeLink=function(e){var t=(0,v.trim)(e.target.value);i.setState({link:t,needShowHint:!i.isLinkValid(t)})},i.onKeyUpLink=function(){var e=i.state.link;i.setState({needShowHint:!i.isLinkValid(e)})},i.onChangeLinkType=function(e){i.setState({linkType:String(e.selected.value)})},i.onSave=function(){var e,t,o,r=i.props.linkData,n=i.state.linkType,s=i.state.link;if(s=(0,v.trim)(s),!i.isLinkValid(s))return null===(t=null===(e=i.inputRef)||void 0===e?void 0:e.current)||void 0===t||t.focus(),(0,h.notaBene)(null===(o=i.inputRef)||void 0===o?void 0:o.current),void i.setState({needShowHint:!0});r.needShowHint?(0,u.showFastBox)((0,a.getLang)("stories_saving_link"),(0,a.getLang)("stories_link_editing_warning"),(0,a.getLang)("global_save"),(function(e){i.edit(s,n,!0,e)}),(0,a.getLang)("global_cancel")):i.edit(s,n)},i.onDelete=function(){i.props.linkData.needShowHint?(0,u.showFastBox)((0,a.getLang)("stories_deleting_link"),(0,a.getLang)("stories_link_deleting_warning"),(0,a.getLang)("global_delete"),(function(e){i.delete(e)}),(0,a.getLang)("global_cancel")):i.delete()},i.state={link:t.story.linkUrl||"",linkType:t.story.linkType||t.linkData.items[0].value,needShowHint:!1,isSaving:!1,isDeleting:!1},i}return(0,o.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,i=e.linkData,n=this.state,s=n.linkType,v=n.link,u=n.needShowHint,h=this.isEditMode()?(0,a.getLang)("stories_edit_link_title"):(0,a.getLang)("stories_add_link_title");return(0,r.jsx)(l.BoxModal,(0,o.__assign)({className:"StoryLinkEditorBox",appearance:"blue",onClose:t,title:h,actionButtons:this.getActionButtons(),hasScroll:!1},{children:(0,r.jsxs)("div",(0,o.__assign)({className:"StoryLinkEditorBox__inner"},{children:[(0,r.jsxs)("div",(0,o.__assign)({className:"StoryLinkEditorBox__row"},{children:[(0,r.jsx)("span",(0,o.__assign)({className:"StoryLinkEditorBox__label"},{children:(0,a.getLang)("stories_link_label_url")}),void 0),(0,r.jsx)("div",(0,o.__assign)({className:"StoryLinkEditorBox__control"},{children:(0,r.jsx)(c.StoryLinkHint,(0,o.__assign)({open:u,text:(0,a.getLang)("stories_upload_link_format")},{children:(0,r.jsx)("div",(0,o.__assign)({className:"StoryLinkHint__input"},{children:(0,r.jsx)("input",{className:"StoryLinkEditorBox__link",value:v,onChange:this.onChangeLink,onKeyUp:this.onKeyUpLink,autoFocus:!0,ref:this.inputRef},void 0)}),void 0)}),void 0)}),void 0)]}),void 0),(0,r.jsxs)("div",(0,o.__assign)({className:"StoryLinkEditorBox__row"},{children:[(0,r.jsx)("span",(0,o.__assign)({className:"StoryLinkEditorBox__label"},{children:(0,a.getLang)("stories_link_label_text")}),void 0),(0,r.jsx)("div",(0,o.__assign)({className:"StoryLinkEditorBox__control"},{children:(0,r.jsx)(d.default,{className:"StoryLinkEditorBox__select",appearance:"secondary",options:i.items,value:s,onChange:this.onChangeLinkType},void 0)}),void 0)]}),void 0)]}),void 0)}),void 0)},t.prototype.isEditMode=function(){return Boolean(this.props.story.linkUrl)},t.prototype.isLinkValid=function(e){if(e.length<2)return!1;if(!e.startsWith("http://")&&!e.startsWith("https://"))return!1;if(!e.match(/^[a-z0-9\/\-._:%=?&@#]+$/i))return!1;try{new URL(e)}catch(e){return!1}return!0},t.prototype.edit=function(e,t,i,o){var r=this;void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=!0);var n=this.props,s=n.onStoryLinkUpdate,l=n.onClose,d=n.story,c=n.linkData;window.ajax.post("al_stories.php",{act:"edit_link",story_raw_id:d.rawId,link_url:e,link_text:t,hash:c.editHash},{onDone:function(){l(),s(d.rawId,e,t)},onFail:function(e){(0,g.showDoneBox)(e||(0,a.getLang)("global_unknown_error"));var t="Link saving error in StoryLinkEditor"+(e?": "+e:"");return(0,_.logError)(new Error(t)),!0},showProgress:function(){i?r.setState({isSaving:!0}):r.setState({isDeleting:!0}),(0,h.lockButton)(o)},hideProgress:function(){var e;o&&(null===(e=(0,g.curBox)())||void 0===e||e.hide(),(0,h.unlockButton)(o)),i?r.setState({isSaving:!1}):r.setState({isDeleting:!1})}})},t.prototype.delete=function(e){this.edit("","",!1,e)},t.prototype.getActionButtons=function(){var e=this.props.onClose,t=this.state,i=t.isSaving,n=t.isDeleting,l=[(0,r.jsx)(s.default,(0,o.__assign)({appearance:"tertiary",onClick:function(){return e()}},{children:(0,a.getLang)("global_cancel")}),"close"),(0,r.jsx)(p.default,(0,o.__assign)({loading:i,appearance:"primary",onClick:this.onSave},{children:this.isEditMode()?(0,a.getLang)("global_save"):(0,a.getLang)("stories_add_link")}),"save")];return this.isEditMode()&&l.unshift((0,r.jsx)(p.default,(0,o.__assign)({loading:n,appearance:"link",className:"StoryLinkEditorBox__extraFooterBtn",onClick:this.onDelete},{children:(0,a.getLang)("stories_delete_link")}),"delete")),l},t}(n.Component)},870078:(e,t,i)=>{"use strict";i.d(t,{StoryLinkHint:()=>a});var o=i(570655),r=i(785893),n=i(814217),a=function(e){var t=e.text,i=e.children,a=e.open,s=void 0!==a&&a,l=(0,r.jsx)("div",(0,o.__assign)({className:"StoryLinkHint"},{children:(0,r.jsx)("div",(0,o.__assign)({className:"StoryLinkHint__inner"},{children:t}),void 0)}),void 0);return(0,r.jsx)(n.Popper,(0,o.__assign)({open:s,position:"t",align:"left",content:l},{children:i}),void 0)}},604192:(e,t,i)=>{"use strict";i.d(t,{StoryLoadFile:()=>a});var o=i(570655),r=i(785893),n=i(488124),a=function(e){var t=e.text,i=e.multiple,a=void 0!==i&&i,s=e.onFilesLoad;return(0,r.jsxs)("div",(0,o.__assign)({className:"StoryLoadFile StoryPreviewContainer"},{children:[(0,r.jsx)(n.default,{},void 0),(0,r.jsx)("span",(0,o.__assign)({className:"StoryLoadFile__text"},{children:t}),void 0),(0,r.jsx)("input",{type:"file",className:"StoryLoadFile__input",multiple:a,onChange:function(e){var t=e.currentTarget.files;t&&s(Array.from(t))}},void 0)]}),void 0)}},786427:(e,t,i)=>{"use strict";i.d(t,{StoryProgressSpinner:()=>l});var o=i(570655),r=i(785893),n=i(667294),a=3,s=2*Math.PI*22,l=(0,n.memo)((function(e){var t=e.percent,i=void 0===t?60:t,n=e.width,l=void 0===n?24:n,d=e.height,c=void 0===d?24:d,v=(s-a)*i/100+a;return(0,r.jsx)("svg",(0,o.__assign)({className:"StoryProgressSpinner",width:l,height:c,viewBox:"0 0 50 50"},{children:(0,r.jsx)("circle",{cx:"25",cy:"25",r:22,stroke:"#fff",fill:"none",strokeWidth:"6",strokeMiterlimit:"10",strokeDashoffset:"0",strokeDasharray:v+","+s,strokeLinecap:"round"},void 0)}),void 0)}))},274123:(e,t,i)=>{"use strict";i.d(t,{UploadDropBoxArea:()=>a});var o=i(570655),r=i(785893),n=i(70162),a=function(){return(0,r.jsx)("div",(0,o.__assign)({className:"UploadDropBoxArea"},{children:(0,r.jsx)("div",(0,o.__assign)({className:"UploadDropBoxArea__inner"},{children:(0,r.jsx)("div",(0,o.__assign)({className:"UploadDropBoxArea__text"},{children:(0,n.getLang)("stories_narrative_cover_drop_hint")}),void 0)}),void 0)}),void 0)}},111143:(e,t,i)=>{"use strict";i.d(t,{UploadDropPageArea:()=>s});var o=i(570655),r=i(785893),n=i(70162),a=i(394021),s=function(){return(0,r.jsx)(a.WithPortal,{children:(0,r.jsx)("div",(0,o.__assign)({className:"UploadDropPageArea"},{children:(0,r.jsxs)("div",(0,o.__assign)({className:"UploadDropPageArea__inner"},{children:[(0,r.jsx)("div",{className:"UploadDropPageArea__image"},void 0),(0,r.jsx)("div",(0,o.__assign)({className:"UploadDropPageArea__text"},{children:(0,n.getLang)("stories_drop_page_area_label")}),void 0)]}),void 0)}),void 0)},void 0)}},117173:(e,t,i)=>{"use strict";i.d(t,{STORIES_MANAGE_MODULE:()=>o,LONG_PRESS_DELAY_MS:()=>r,ADMIN_STORY_VIEW_MODULE:()=>n,StickerTypes:()=>a,EMOJI_REACTIONS_ARR:()=>s,QUESTION_SELECT_MODE:()=>l,MAX_FEEDBACK_STORIES_SLICE_COUNT:()=>d,INIT_MAX_FEEDBACK_STORIES_COUNT:()=>c,MAX_NARRATIVE_STORIES:()=>v,NARRATIVE_MAX_TITLE_LENGTH:()=>u,BOX_ITEM_DRAGGABLE_CLASS:()=>h,SCROLL_THROTTLE_DELAY:()=>_,SCROLL_LOADING_MORE_GAP:()=>p});var o="stories_manage",r=200,n="admin_story_view",a={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,sticker:12,app:13,situationalTheme:14,playlist:15},s=[{code:"f09f9882",name:"face_with_tears_of_happiness"},{code:"f09f988d",name:"smiling_face_with_heart_eyes"},{code:"f09f918df09f8fbf",name:"thumbs_up"},{code:"f09f98ad",name:"loud_crying_face"},{code:"f09f98b1",name:"face_screaming_in_fear"},{code:"e298ba",name:"smiling_face"}],l={PUBLIC:0,AUTHOR_ONLY:1,ANONYMOUS:3},d=50,c=10,v=100,u=23,h="NarrativeBox__draggable",_=34,p=400},652745:(e,t,i)=>{"use strict";i.d(t,{prepareStoriesForPublishing:()=>h,updateNarrativeBlock:()=>_,highlightNarrativeBlock:()=>p,updateNarrativeSnippetsFromQueueByPost:()=>g});var o=i(873589),r=i(501389),n=i(560717),a=i(70162),s=i(733164),l=i(856901),d=i(533228),c=i(66433),v=i(506770),u=i(844142);function h(e){return e.map((function(e){return e.id})).join(",")}function _(e){void 0===e&&(e=!1);var t=(0,s.intval)(window.cur.oid);if(window.cur.narrativeBlock)window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t},{onDone:function(e){var t=(0,s.intval)(window.cur.oid),i=document.getElementById("narratives_module"+t+"_wrapper");if(i)if(e)(0,o.domReplaceEl)(i,e),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new window.NarrativeBlock);else{var r=i.parentElement;(null==r?void 0:r.children.length)&&(null==r?void 0:r.children.length)>1?i.remove():null==r||r.remove(),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),delete window.cur.narrativeBlock}(0,d.removeStoryList)("narratives"+t)}});else if(u.Ranges.isUserId(t)&&"profile"===window.cur.module){var i=document.getElementById(l.PROFILE_MEDIA_NARROW_BLOCK_ID),n=!i;window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t,need_wrap_block:(0,s.intval)(n)},{onDone:function(e){if(i)i.insertAdjacentHTML("afterbegin",e);else{var o=document.getElementById("narrow_column");if(!o)return;o.insertAdjacentHTML("beforeend",e)}window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new window.NarrativeBlock,window.cur.narrativeBlock.showOnboardTooltipIfNeeded()),(0,d.removeStoryList)("narratives"+t)}})}else e&&function(e){window.boxQueue.hideAll();var t=document.querySelector("#box_layer_wrap"),i=document.querySelector("#box_loader");window.nav.reload({onDone:function(){e&&e()},showProgress:function(){(0,o.show)(t),(0,o.show)(i),(0,r.boxRefreshCoords)(i)},hideProgress:function(){(0,o.hide)(t),(0,o.hide)(i)}})}((function(){window.cur.needNarrativeOnboard=!0}))}function p(e){if(e){var t="narratives_module"+window.vk.id;(0,n.highlightModule)({module:t,text:(0,a.getLang)("stories_narrative_block_onboarding_text"),onClose:function(){delete window.cur.needNarrativeOnboard,window.ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"profile_narrative"})},autoCancelDelay:1e4,speed:600})}}function g(e){if(window.vk.id&&(0,v.partConfigEnabled)("update_private_snippets_by_queue")){var t=Array.from(e.querySelectorAll(".NarrativeSnippet"));if(t.length){var i=[];t.forEach((function(e){if(window.vk.id&&e.dataset.needUpdate){var t=e.dataset.narrativeRawId;t&&i.push({narrative_raw_id:t,snippet_type:e.dataset.snippetType,from:e.dataset.from})}})),i.length&&window.ajax.post("al_stories.php",{act:"get_narrative_snippets",narrative_snippets:JSON.stringify(i)},{onDone:function(e){t.forEach((function(t){t.dataset.narrativeRawId&&e[t.dataset.narrativeRawId]&&(t.outerHTML=e[t.dataset.narrativeRawId])}))},onFail:function(){return(0,c.logError)(new Error("Fail: updateNarrativeSnippetFromQueueByPost")),!0}})}}}},241926:(e,t,i)=>{"use strict";i.r(t),i.d(t,{showNarrativeEditorBox:()=>x,showNarrativeBox:()=>N,showRecommendedNarrativesBox:()=>b,fetchRecommendedNarrativesBoxData:()=>k,showNarrativeChooseBox:()=>L,showNarrativeCreateLiteBox:()=>T,showStoryLinkEditorBox:()=>B,showNarrativeCropCoverBox:()=>I});var o=i(570655),r=i(785893),n=i(887157),a=i(659397),s=i(261508),l=i(115985),d=i(709652),c=i(501389),v=i(70162),u=i(897449),h=i(146143),_=i(744451),p=i(884215),g=i(730095),f=i(66433),m=i(111898),w=i(849464),y=i(833623),S=i(303562),C=560;function x(e,t){void 0===t&&(t={});var i={},l=t.narrative,d=t.onClose,u=t.onSave,h=t.navScreen,_=t.stories,p=t.selectedStories,g=void 0===p?[]:p,w=t.publishHash,y=t.editHash,C=t.linkData,x=t.isEditingLinksAvailable,N=t.storiesCount,b=t.coverUploadConfig,k=t.getPublishDoneHTML,E=!1;function L(){window.stManager.add(["NarrativeEditor.css"]).then((function(){i.box=(0,s.showComponentInBox)(j(),{width:638,onDestroy:function(e){(0,s.destroyComponentInBox)(e),d&&d(E)}})})).catch((function(e){console.error(e),(0,f.logError)(e)}))}function T(){return(null==_?void 0:_.length)?new Promise((function(t,i){if(!(null==_?void 0:_.length))return i("empty stories");window.ajax.post("al_stories.php",{act:"get_archive_stories",owner_id:e,offset:_.length},{onDone:function(e,r){if(_){_=(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(_),!1),(0,o.__read)(e),!1);var n=(N=r)>_.length;t(n),D()}else i("empty stories after loading")},onFail:function(e){return i(e),!0}})})):Promise.reject("empty stories")}function B(e){E=!0,u&&u(e)}function I(e){i.box&&i.box.hide(),e&&e()}function D(){(null==_?void 0:_.length)&&w&&y&&(0,s.updateCurrentComponentInBox)(j())}function P(e,t,i){if(null==_?void 0:_.length){var r=function(r){return null==r?void 0:r.map((function(r){return r.rawId===e?(0,o.__assign)((0,o.__assign)({},r),{linkUrl:t,linkType:i}):r}))};_=r(_),g=r(g)||[],D()}}function j(){if((null==_?void 0:_.length)&&w&&y&&N&&b){var t=_.reduce((function(e,t){return e[t.id]=t,e}),{});t=g.reduce((function(e,t){return e[t.id]=t,e}),t);var i=_.map((function(e){return e.id})),o=g.map((function(e){return e.id})),s=l?n.EditorModeType.edit:n.EditorModeType.create,d=(null==l?void 0:l.title)?(0,a.decodeHTMLEntities)(l.title):"",c=N>_.length,v=l?(0,S.getPreparedCover)(l):void 0;return(0,r.jsx)(m.NarrativeEditor,{ownerId:e,type:s,name:d,narrativeRawId:null==l?void 0:l.rawId,cover:v,selectedStoryIds:o,storyIds:i,hasMore:c,storyMap:t,close:I,loadMore:T,onSave:B,publishHash:w,editHash:y,linkData:C,isEditingLinksAvailable:x,onStoryLinkUpdate:P,appearance:n.EditorViewType.box,navScreen:h,coverUploadConfig:b,getPublishDoneHTML:k},void 0)}}_&&w&&y&&N&&b?L():new Promise((function(t,i){window.ajax.post("al_stories.php",{act:"get_narrative_editor_data",owner_id:e},{loader:!0,onDone:function(e){_=e.stories,N=e.storiesCount,w=e.publishHash,y=e.editHash,C=e.linkData,x=e.isEditingLinksAvailable,b=e.coverUploadConfig,t([_,N,w,y,C,x,b])},onFail:function(e){return i(e),!0}})})).then((function(){L()})).catch((function(e){(0,c.showDoneBox)(e||(0,v.getLang)("global_error")),(0,f.logError)(e)}))}function N(e){var t=e.ownerId,i=e.onClose,n=e.onSave,a=e.onRemove,_=e.onReorder,p=e.navScreen,g={narratives:[],ownerId:t,boxAct:"get_narrative_box_data"},f=!1;function m(){return P(g).then((function(){y()})).catch((function(e){(0,c.showDoneBox)(e||(0,v.getLang)("global_error"))}))}function y(){if(g.boxData){var e=g.boxData.canEdit?d.BoxType.edit:d.BoxType.view;(0,s.updateCurrentComponentInBox)((0,r.jsx)(l.NarrativeBox,{type:e,boxData:g.boxData,narratives:g.narratives,onClose:b,onSave:S,onRemove:x,onBookmark:E,onReorder:k,loadMore:m,navScreen:p},void 0))}}function S(e){n&&n(e),f=!0}function x(e){var t,i,o;t=e,i={title:(0,v.getLang)("global_warning")},o=function(e){var i=g.boxData;i&&window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:t.rawId,hash:i.removeHash},{onDone:function(){i.count-=1,(0,w.sendNarrativeAnalytic)(w.NarrativeAnalyticEventType.deleteNarrative,t,p),g.narratives=g.narratives.filter((function(e){return e.rawId!==t.rawId})),y(),(0,c.showDoneBox)((0,v.getLang)("stories_deleted_narrative")),a&&a()},onFail:function(e){return(0,c.showDoneBox)(e||(0,v.getLang)("global_error")),!0},showProgress:function(){return(0,u.lockButton)(e)},hideProgress:function(){(0,c.curBox)().hide(),(0,u.unlockButton)(e)}})},(0,h.showFastBox)(i,(0,v.getLang)("stories_narrative_remove_warning"),(0,v.getLang)("stories_remove_confirm"),o,(0,v.getLang)("global_cancel"))}function N(){f&&b()}function b(){g.box&&g.box.hide()}function k(e){g.narratives=e,y(),_&&_()}function E(e){e.isBookmarked=!e.isBookmarked,y()}D(g).then((function(e){var t=(0,o.__read)(e,3),n=t[0],a=t[1],c=t[2];g.narratives=n,g.boxData=a,g.startFrom=c,g.box=function(e,t){var o=t.canEdit?d.BoxType.edit:d.BoxType.view;return(0,s.showComponentInBox)((0,r.jsx)(l.NarrativeBox,{type:o,boxData:t,narratives:e,loadMore:m,onClose:b,onSave:S,onReorder:k,onBookmark:E,onRemove:x,navScreen:p},void 0),{width:C,onShow:N,onDestroy:function(e){(0,s.destroyComponentInBox)(e),i&&i()}})}(n,a)})).catch((function(e){(0,c.showDoneBox)(e||(0,v.getLang)("global_error")),i&&i()}))}function b(e){var t;void 0===e&&(e={});var i=E(e);function n(){return P(i).then((function(){d()})).catch((function(e){(0,c.showDoneBox)(e||(0,v.getLang)("global_error"))}))}function a(){return(0,s.showComponentInBox)(u(),{width:C,onDestroy:function(e){(0,s.destroyComponentInBox)(e)}})}function d(){i.boxData&&(0,s.updateCurrentComponentInBox)(u())}function u(){if(i.boxData)return(0,r.jsx)(l.NarrativeBox,{title:(0,v.getLang)("news_fb_block_recommend_narratives"),showNarrativeNumber:!1,boxData:i.boxData,narratives:i.narratives,loadMore:n,onClose:h,onBookmark:_,trackCode:i.trackCode,list:i.list,source:i.source},void 0)}function h(){i.box&&i.box.hide()}function _(e){e.isBookmarked=!e.isBookmarked,d()}(null===(t=i.narratives)||void 0===t?void 0:t.length)&&i.boxData?i.box=a():D(i).then((function(e){var t=(0,o.__read)(e,2),r=t[0],n=t[1];i.narratives=r,i.boxData=n,i.box=a()})).catch((function(e){(0,c.showDoneBox)(e||(0,v.getLang)("global_error"))}))}function k(e){return void 0===e&&(e={}),D(E(e),!0)}function E(e){return void 0===e&&(e={}),{narratives:e.narratives?e.narratives:[],boxData:e.boxData,boxAct:"get_recommended_narratives",trackCode:e.trackCode,list:e.list,source:e.source}}function L(e){var t=e.ownerId,i=e.story,n=e.onClose,a=e.onSave,l=e.navScreen,d={narratives:[],ownerId:t,boxAct:"get_narrative_choose_box_data"},u=!1;function h(){return P(d).then((function(e){return function(){if(!d.boxData)return;(0,s.updateCurrentComponentInBox)((0,r.jsx)(_.NarrativeChooseBox,{story:i,narratives:d.narratives,onClose:f,onSave:p,boxData:d.boxData,loadMore:h,navScreen:l},void 0))}(),e})).catch((function(e){return(0,c.showDoneBox)(e||(0,v.getLang)("global_error")),[]}))}function p(e){u=!0,a&&a(e)}function g(){u&&f()}function f(){d.box&&d.box.hide()}D(d).then((function(e){var t=(0,o.__read)(e,3),a=t[0],c=t[1],v=t[2];d.narratives=a,d.boxData=c,d.startFrom=v,d.box=function(e,t){return(0,s.showComponentInBox)((0,r.jsx)(_.NarrativeChooseBox,{story:i,narratives:e,boxData:t,loadMore:h,onClose:f,onSave:p,navScreen:l},void 0),{width:C,onShow:g,onDestroy:function(e){(0,s.destroyComponentInBox)(e),n&&n(u)}})}(a,c)})).catch((function(e){(0,c.showDoneBox)(e||(0,v.getLang)("global_error")),n&&n()}))}function T(e){var t=e.onSave,i=e.onClose,o=e.ownerId,n=e.ownerName,a=e.stories,l=e.publishNarrativeHash,d=(0,s.showComponentInBox)((0,r.jsx)(p.NarrativeCreateLiteBox,{stories:a,ownerId:o,ownerName:n,publishNarrativeHash:l,onSave:t,onClose:function(){d&&d.hide()}},void 0),{width:C,onDestroy:function(e){(0,s.destroyComponentInBox)(e),i&&i()}})}function B(e){var t=e.story,i=e.onClose,n=e.onStoryLinkUpdate,l=e.linkData;t.linkType&&t.linkText&&(l.items.find((function(e){return e.value===t.linkType}))||(l=(0,o.__assign)((0,o.__assign)({},l),{items:(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(l.items),!1),[{value:t.linkType,label:t.linkText}],!1)})));var d=(0,s.showComponentInBox)((0,r.jsx)(g.StoryLinkEditorBox,{story:t,onClose:function(){d&&d.hide()},onStoryLinkUpdate:n,linkData:(0,a.decodeHTMLEntitiesDeep)(l)},void 0),{width:450,onDestroy:function(e){(0,s.destroyComponentInBox)(e),i&&i()}})}function I(e){var t=e.coverUrl,i=e.coverHeight,o=e.coverWidth,n=e.thumbHeight,a=e.thumbWidth,l=e.onClose,d=e.onSave,c=e.crop,v=(0,s.showComponentInBox)((0,r.jsx)(y.NarrativeCoverCropper,{coverUrl:t,coverHeight:i,coverWidth:o,thumbHeight:n,thumbWidth:a,onClose:function(){v&&v.hide()},onSave:d,crop:c},void 0),{width:638,onDestroy:function(e){(0,s.destroyComponentInBox)(e),l&&l()}})}function D(e,t){return void 0===t&&(t=!1),new Promise((function(i,o){window.ajax.post("al_stories.php",{act:e.boxAct,owner_id:e.ownerId,start_from:e.startFrom,track_code:e.trackCode},{loader:!e.narratives.length&&!t,onDone:function(e,t,o){i([e,t,o])},onFail:function(e){return o(e),!0}})}))}function P(e){return D(e).then((function(t){var i,r=(0,o.__read)(t,3),n=r[0],a=r[2];return e.narratives=(null===(i=e.narratives)||void 0===i?void 0:i.concat(n))||n,e.startFrom=a,n}))}},453580:(e,t,i)=>{"use strict";i.d(t,{WallDataEvents:()=>a,registerUniqueListener:()=>d,registerNonGlobalNonUniqueListener:()=>c,emitEvent:()=>v});var o=i(570655),r=i(480816),n=i(419223),a={post_reactions_counts_update:"wall/post_reactions_counts_update",reply_reactions_counts_update:"wall/reply_reactions_counts_update",post_subscribe_update:"wall/post_subscribe_update"},s=(0,n.makeSharedState)("wall-data",(function(){return{emitter:new r.default,keyedListeners:Object.create(null)}}),{version:0}),l=function(e,t,i){var r,n,a=s(),l=null===(n=null===(r=a.keyedListeners)||void 0===r?void 0:r[e])||void 0===n?void 0:n[t];return l&&a.emitter.removeListener(e,l),function(e,t,i){var r,n=s();return n.emitter.addListener(e,i),n.keyedListeners[e]=(0,o.__assign)((0,o.__assign)({},n.keyedListeners[e]),((r={})[t]=i,r)),function(){var o,r;n.emitter.removeListener(e,i),(null===(o=n.keyedListeners[e])||void 0===o?void 0:o[t])===i&&(null===(r=n.keyedListeners[e])||void 0===r||delete r[t])}}(e,t,i)},d=function(e,t,i){return l(t,e,i)},c=function(e,t){return function(e,t){var i=s();return i.emitter.addListener(e,t),function(){i.emitter.removeListener(e,t)}}(e,t)},v=function(e,t){s().emitter.emit(e,t)}},210277:(e,t,i)=>{"use strict";i.d(t,{updateAriaLabelCounter:()=>n});var o=i(70162),r=i(325698),n=function(e,t,i){if("number"==typeof t&&e instanceof HTMLElement&&e.classList.contains("PostBottomAction")){var n=function(e){var t=void 0;switch(e){case r.LikeButtonTypes.comment:t=(0,o.getLang)("likes_comments_N_aria_short","raw");break;case r.LikeButtonTypes.like:t=(0,o.getLang)("likes_likes_N_aria_short","raw");break;case r.LikeButtonTypes.share:t=(0,o.getLang)("likes_shares_N_aria_short","raw")}return t}(i);if(n){var a=(0,o.langNumeric)(t,n,!1);e.setAttribute("aria-label",a)}}}}}]);try{stManager.done("dist/042057405aa14bdcd56cdbc164d834ff.df36c3637ea7ab0573d1.js")}catch(e){}