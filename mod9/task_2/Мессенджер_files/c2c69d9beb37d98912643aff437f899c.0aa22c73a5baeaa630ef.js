(self.webpackChunkvk=self.webpackChunkvk||[]).push([[38004],{594941:(e,t,n)=>{"use strict";n.d(t,{default:()=>o});const o=(0,n(951201).makeIcon)("Icon20MessagesOutline","messages_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="messages_outline_20"><path fill-rule="evenodd" d="M8 2C4.44 2 1.5 4.518 1.5 7.754c0 1.084.336 2.12.954 3.014-.094.407-.361 1.038-.82 1.877a1.08 1.08 0 0 0 .46 1.483c.167.086.352.127.538.121 1.426-.041 2.563-.365 3.366-1.015.64.18 1.313.274 2.002.274 3.56 0 6.5-2.518 6.5-5.754C14.5 4.518 11.56 2 8 2Zm0 1.5c-2.917 0-5 2.02-5 4.254 0 .788.25 1.55.726 2.216l.134.188a.75.75 0 0 1 .128.572l-.042.226c-.09.49-.324 1.087-.648 1.742.873-.107 1.438-.357 1.795-.662l.24-.206a.75.75 0 0 1 .701-.15l.308.092c.523.155 1.08.236 1.658.236 2.917 0 5-2.02 5-4.254C13 5.52 10.917 3.5 8 3.5Zm8.157 5.075a.75.75 0 1 1 1.187-.916 5.455 5.455 0 0 1 1.156 3.345 5.42 5.42 0 0 1-.914 3.008c.088.411.346 1.049.789 1.895a1.089 1.089 0 0 1-.992 1.593c-1.363-.042-2.456-.363-3.231-1.01a6.808 6.808 0 0 1-1.902.268 6.733 6.733 0 0 1-2.57-.5.75.75 0 0 1 .572-1.388 5.22 5.22 0 0 0 1.998.388c.546 0 1.073-.08 1.568-.233l.294-.092a.75.75 0 0 1 .722.158l.23.206c.33.294.85.538 1.652.646-.311-.657-.535-1.253-.622-1.743l-.04-.225a.75.75 0 0 1 .12-.554l.129-.188a3.925 3.925 0 0 0 .697-2.23c0-.894-.306-1.733-.843-2.429Z" /></symbol>',20,20,!1,void 0)},877942:(e,t,n)=>{"use strict";n.d(t,{default:()=>o});const o=(0,n(951201).makeIcon)("Icon20More","more_20","0 0 20 20",'<symbol fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="more_20"><path d="M15 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3z" fill="currentColor" /></symbol>',20,20,!1,void 0)},753273:(e,t,n)=>{"use strict";n.d(t,{default:()=>o});const o=(0,n(951201).makeIcon)("Icon24ChevronCompactLeft","chevron_compact_left_24","0 0 16 24",'<symbol fill="none" viewBox="0 0 16 24" xmlns="http://www.w3.org/2000/svg" id="chevron_compact_left_24"><path d="M11.293 7.706a1 1 0 0 0 0-1.412l-.088-.088a.997.997 0 0 0-1.414.002l-5.084 5.084a.998.998 0 0 0 0 1.416l5.084 5.084c.39.391 1.026.39 1.414.002l.088-.088a.995.995 0 0 0 0-1.412L7 12z" fill="currentColor" /></symbol>',16,24,!1,void 0)},84343:(e,t,n)=>{"use strict";n.d(t,{default:()=>o});const o=(0,n(951201).makeIcon)("Icon24MessageArrowRightOutline","message_arrow_right_outline_24","0 0 24 24",'<symbol fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="message_arrow_right_outline_24"><g clip-rule="evenodd" fill="currentColor" fill-rule="evenodd"><path d="M12.016 4.9c-3.077 0-5.702 1.444-7.065 3.5a.9.9 0 0 1-1.5-.995C5.178 4.799 8.395 3.1 12.016 3.1c5.324 0 9.884 3.729 9.884 8.607 0 4.878-4.56 8.607-9.884 8.607-1.173 0-2.3-.178-3.348-.506C7.42 20.961 5.616 21.513 3.42 21.6c-.927.036-1.598-.927-1.209-1.792.529-1.183 1.197-2.403 1.298-3.72a8.205 8.205 0 0 1-.34-.54.9.9 0 0 1 1.56-.898c.124.216.262.426.413.629a.9.9 0 0 1 .177.537c0 1.38-.54 2.684-1.099 3.92 1.714-.194 2.835-.75 3.513-1.547a.9.9 0 0 1 1.002-.26c1 .376 2.11.586 3.28.586 4.6 0 8.085-3.172 8.085-6.807 0-3.635-3.485-6.807-8.084-6.807z" /><path d="M10.864 8.264a.9.9 0 0 1 1.272 0l2.6 2.6a.9.9 0 0 1 0 1.272l-2.6 2.6a.9.9 0 0 1-1.272-1.272l1.063-1.064H2.9a.9.9 0 1 1 0-1.8h9.027l-1.063-1.064a.9.9 0 0 1 0-1.272z" /></g></symbol>',24,24,!1,void 0)},497538:()=>{},335106:()=>{},704107:()=>{},128831:()=>{},402752:()=>{},659309:(e,t,n)=>{"use strict";n.d(t,{useConvoAttaches:()=>m});var o=n(896156),s=n(28991),a=n(692137),i=n(334738),c=n(887757),r=n.n(c),l=n(784970),d=n(303460),u=n(667294),h=n(21705),v=n(837021);function m(e){var t=(0,u.useState)(null),n=(0,i.default)(t,2),o=n[0],c=n[1],d=(0,l.useInsertIntoCache)(),h=(0,l.useBrowserEnv)().api,v=(0,l.useOwner)();(0,u.useLayoutEffect)((function(){return function(){c(null)}}),[e]);var m=(0,u.useCallback)(function(){var t=(0,a.default)(r().mark((function t(n){var a,i,l,u,m;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null!==(a=(u=o||{})[n])&&void 0!==a&&a.isLoading||null!==(i=u[n])&&void 0!==i&&i.isAllLoaded)){t.next=3;break}return t.abrupt("return");case 3:return x(u,!0,n),c((0,s.default)({},u)),t.next=7,f(h,e,v.id,n,d,(null===(l=u[n])||void 0===l?void 0:l.cursorNextLoad)||void 0);case 7:m=t.sent,g(u,m),x(u,!1,n),c((0,s.default)({},u));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[h,o,v.id,e,d]);return{attaches:o,getNextPage:m}}function f(e,t,n,o,s,a){return _.apply(this,arguments)}function _(){return(_=(0,a.default)(r().mark((function e(t,n,s,a,i,c){var l,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetch("messages.getHistoryAttachments",{peer_id:n,media_type:p(a),count:30,start_from:c,extended:1,group_id:(0,v.getOwnerGroupId)(s)},{retries:5});case 3:if((l=e.sent).items&&0!==l.items.length){e.next=6;break}return e.abrupt("return",(0,o.default)({},a,{items:[],isAllLoaded:!0,cursorNextLoad:null}));case 6:return i({profiles:l.profiles,groups:l.groups,contacts:l.contacts}),u=(0,d.fromApiConvoAttach)(l.items)[a]||[],e.abrupt("return",(0,o.default)({},a,{items:u,isAllLoaded:0===u.length||u.length<30,cursorNextLoad:l.next_from}));case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",{});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}var p=function(e){return{audios:"audio",videos:"video",docs:"doc",links:"link",photos:"photo"}[e]};function x(e,t,n){e[n]||function(e,t){switch(t){case"audios":case"videos":case"docs":case"links":case"photos":e[t]={items:[],cursorNextLoad:null,isAllLoaded:!1};break;default:(0,h.exhaustivenessCheck)(t)}}(e,n);var o=e[n];o&&(o.isLoading=t)}function g(e,t){var n,o,s,a,i;t.audios&&(e.audios={items:((null===(n=e.audios)||void 0===n?void 0:n.items)||[]).concat(t.audios.items),cursorNextLoad:t.audios.cursorNextLoad||null,isAllLoaded:t.audios.isAllLoaded});t.docs&&(e.docs={items:((null===(o=e.docs)||void 0===o?void 0:o.items)||[]).concat(t.docs.items),cursorNextLoad:t.docs.cursorNextLoad||null,isAllLoaded:t.docs.isAllLoaded});t.links&&(e.links={items:((null===(s=e.links)||void 0===s?void 0:s.items)||[]).concat(t.links.items),cursorNextLoad:t.links.cursorNextLoad||null,isAllLoaded:t.links.isAllLoaded});t.photos&&(e.photos={items:((null===(a=e.photos)||void 0===a?void 0:a.items)||[]).concat(t.photos.items),cursorNextLoad:t.photos.cursorNextLoad||null,isAllLoaded:t.photos.isAllLoaded});t.videos&&(e.videos={items:((null===(i=e.videos)||void 0===i?void 0:i.items)||[]).concat(t.videos.items),cursorNextLoad:t.videos.cursorNextLoad||null,isAllLoaded:t.videos.isAllLoaded})}},872578:(e,t,n)=>{"use strict";n.d(t,{AdaptiveScroll:()=>d});var o=n(334738),s=n(667294),a=n(20700),i=n.n(a),c=(n(497538),n(753273)),r=n(27346),l=n(785893),d=function(e){var t=e.children,n=e.initialPosition,a=void 0===n?0:n,d=e.step,u=e.className,h=(0,s.useRef)(null),v=(0,s.useRef)(null),m=(0,s.useState)(!1),f=(0,o.default)(m,2),_=f[0],p=f[1],x=(0,s.useState)(!1),g=(0,o.default)(x,2),A=g[0],C=g[1],w=(0,s.useCallback)((function(e){return e.clientWidth<e.scrollWidth}),[]),j=function(){if(d)return d;var e=h.current;return e?e.clientWidth/2:100},k=(0,s.useCallback)((function(){var e=h.current;return e?e.scrollWidth-e.clientWidth:null}),[h]),b=function(e){var t;null===(t=h.current)||void 0===t||t.scrollTo({left:e,behavior:"smooth"})},N=(0,s.useCallback)((function(){var e=h.current,t=k();if(e&&w(e)&&null!==t){var n=Math.ceil(e.scrollLeft);p(0!==n),C(n<t)}}),[h,w,p,C,k]);return(0,s.useLayoutEffect)((function(){var e=h.current;e&&(e.scrollLeft=a)}),[h,a]),(0,s.useLayoutEffect)((function(){return N(),window.addEventListener("resize",N),function(){return window.removeEventListener("resize",N)}}),[N]),(0,l.jsxs)("div",{className:i()("AdaptiveScroll",u),children:[(0,l.jsx)("div",{ref:h,className:"AdaptiveScroll__wrapper",onScroll:N,children:(0,l.jsx)("div",{ref:v,className:"AdaptiveScroll__scrollable",children:t})}),(0,l.jsx)("button",{className:i()("AdaptiveScroll__button AdaptiveScroll__button--backwards",{"AdaptiveScroll__button--visible":_}),onClick:function(){var e=h.current;if(e){var t=e.scrollLeft;if(0!==t){var n=Math.max(t-j(),0);n<50&&(n=0),b(n)}}},children:(0,l.jsx)(c.default,{})}),(0,l.jsx)("button",{className:i()("AdaptiveScroll__button AdaptiveScroll__button--forward",{"AdaptiveScroll__button--visible":A}),onClick:function(){var e=h.current;if(e){var t=e.scrollLeft,n=k();if(null!==n&&t!==n){var o=Math.min(t+j(),n);n-o<50&&(o=n),b(o)}}},children:(0,l.jsx)(r.default,{})})]})}},995627:(e,t,n)=>{"use strict";n.d(t,{ConvoAttachAudioActionsMenu:()=>l});var o=n(667294),s=n(368455),a=n(21705),i=n(784970),c=n(84343),r=n(785893),l=function(e){e.audio;var t=e.messageId,n=e.goToMessage,l=(0,i.useBrowserEnv)().lang,d=(0,o.useCallback)((function(e){switch(e){case"share":return;case"go_to_message":return void n(t);default:return(0,a.exhaustivenessCheck)(e)}}),[t,n]);return(0,r.jsx)(s.ActionsMenu,{children:(0,r.jsx)(s.ActionsMenuAction,{onClick:function(){return d("go_to_message")},title:l.use("me_attach_action_go_to_message"),leftIcon:(0,r.jsx)(c.default,{}),type:"primary"})})}},941801:(e,t,n)=>{"use strict";n.d(t,{ConvoAttachDocActionsMenu:()=>l});var o=n(667294),s=n(368455),a=n(84343),i=n(784970),c=n(21705),r=n(785893),l=function(e){e.document;var t=e.messageId,n=e.goToMessage,l=(0,i.useBrowserEnv)().lang,d=(0,o.useCallback)((function(e){switch(e){case"share":return;case"go_to_message":return void n(t);default:return(0,c.exhaustivenessCheck)(e)}}),[t,n]);return(0,r.jsx)(s.ActionsMenu,{children:(0,r.jsx)(s.ActionsMenuAction,{title:l.use("me_attach_action_go_to_message"),leftIcon:(0,r.jsx)(a.default,{}),onClick:function(){return d("go_to_message")},type:"primary"})})}},773459:(e,t,n)=>{"use strict";n.d(t,{ConvoAttachesLinks:()=>l});n(667294);var o=n(151225),s=n(708787),a=n(671269),i=n(784970),c=n(940637),r=(n(335106),n(785893)),l=function(e){var t,n=e.links,l=e.tailWatchBind,d=e.goToMessage,u=(0,i.useBrowserEnv)().lang,h=function(e){var t="";if(e.image){var n=(0,o.preview)(e,48,48,!0);n&&(t=n.url)}return t?(0,r.jsx)("img",{alt:e.title,src:t,className:"ConvoAttachesLink__image"}):(0,r.jsx)("div",{className:"ConvoAttachesLink__image"})};return t=new Set,(0,r.jsx)("ul",{children:n.map((function(e,o){var i=o===n.length-1,v="".concat(e.cmid,"_").concat(e.attach.url),m=t.has(v)?"".concat(v,"_").concat(o):v;return t.add(v),(0,r.jsxs)("li",{children:[i&&l&&(0,r.jsx)("div",{ref:l}),(0,r.jsxs)(c.ExternalLink,{href:e.attach.url,className:"ConvoAttachesLink",children:[(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"ConvoAttachesLink__image-container",children:h(e.attach)})}),(0,r.jsxs)("div",{className:"ConvoAttachesLink__content",children:[(0,r.jsx)("div",{className:"ConvoAttachesLink__name",children:e.attach.title}),(0,r.jsx)("div",{className:"ConvoAttachesLink__url",children:e.attach.url})]}),(0,r.jsx)("div",{className:"ConvoAttachesLink__actions",children:(0,r.jsx)(s.Tooltip,{content:u.use("me_convo_attaches_to_message"),position:"top",align:"center",delay:500,children:(0,r.jsx)("div",{className:"ConvoAttachesLink__button",onClick:function(t){t.stopPropagation(),t.preventDefault(),d(e.messageId)},children:(0,r.jsx)(a.default,{})})})})]})]},m)}))})}},796595:(e,t,n)=>{"use strict";n.d(t,{ConvoAttachesPhotos:()=>x});var o=n(28991),s=n(678927),a=n(334738),i=(n(704107),n(667294)),c=n(151225),r=n(940637),l=n(760562),d=n(594941),u=n(585561),h=n(650485),v=n(784970),m=n(21705),f=n(368455),_=n(417388),p=n(785893),x=function(e){var t=e.photos,n=e.tailWatchBind,o=e.goToMessage,c=e.isCasper,r=e.withDateSeparator,l=(0,v.useNow)(),d=(0,v.useBrowserEnv)(),u=d.api,h=d.lang,f=(0,i.useState)(0),_=(0,a.default)(f,2),x=_[0],C=_[1],w=(0,i.useRef)(null),j=(0,i.useState)([]),k=(0,a.default)(j,2),b=k[0],N=k[1];(0,i.useLayoutEffect)((function(){if(window.IntersectionObserver&&0===x&&w.current){var e=new ResizeObserver((function(t){var n;t[0]&&C(t[0].contentRect.width),0===(null===(n=t[0])||void 0===n?void 0:n.contentRect.width)&&e.disconnect()}));return e.observe(w.current),function(){e.disconnect()}}}),[]);var L=(0,i.useCallback)((function(e,t){switch(e){case"set_as_avatar":case"copy_link":case"download":case"tag_item":case"tag_service":break;case"delete":u.fetch("photos.delete",{photo_id:t.attach.id,owner_id:t.attach.ownerId}).then((function(){N([].concat((0,s.default)(b),[t.attach.id]))}));break;case"restore":u.fetch("photos.restore",{photo_id:t.attach.id,owner_id:t.attach.ownerId}).then((function(){N(b.filter((function(e){return e!==t.attach.id})))}));break;case"go_to_message":o(t.messageId);break;default:(0,m.exhaustivenessCheck)(e)}}),[o,u,b]);if(!r)return(0,p.jsx)("ul",{className:"ConvoAttachesPhotos",children:t.map((function(e,t,o){var s=0===t,a=t===o.length-1,i=0!==x?A(e.attach,x):void 0;return(0,p.jsx)(g,{isDeleted:b.includes(e.attach.id),isCasper:c,photo:e,photoSource:i||void 0,tailWatchBind:a?n:void 0,measuredElRef:s?w:void 0,onActionClick:L},"".concat(e.cmid,"-").concat(e.attach.id,"-").concat(t))}))});var I=t.reduce((function(e,n,o){var s,a=0===o,i=t[o-1];return(a||i&&!(0,m.isSameMonth)(1e3*i.date,1e3*n.date))&&e.push([]),null===(s=e[e.length-1])||void 0===s||s.push(n),e}),[]);return(0,p.jsx)(p.Fragment,{children:I.map((function(e,t,o){var s,a=(null===(s=e[0])||void 0===s?void 0:s.date)||0;return(0,p.jsxs)(i.Fragment,{children:[(0,p.jsx)("div",{className:"ConvoAttachesPhotos__dateSeparator",children:h.formatDate(1e3*a,{now:l,variant:"month-year"})}),(0,p.jsx)("ul",{className:"ConvoAttachesPhotos--separated",children:e.map((function(e,s,a){var i=0===t&&0===s,r=t===o.length-1&&s===a.length-1,l=0!==x?A(e.attach,x):void 0;return(0,p.jsx)(g,{isDeleted:b.includes(e.attach.id),isCasper:c,photo:e,photoSource:l||void 0,tailWatchBind:r?n:void 0,measuredElRef:i?w:void 0,onActionClick:L},"".concat(e.cmid,"-").concat(e.attach.id,"-").concat(s))}))})]},t)}))})},g=function(e){var t=e.photo,n=(e.isCasper,e.measuredElRef),s=e.tailWatchBind,a=e.photoSource,c=e.isDeleted,m=e.onActionClick,x=(0,_.useDeviceData)().isTouchOnly,g=(0,v.useBrowserEnv)().lang,A=(0,v.useOwner)(),C=(0,i.useMemo)((function(){return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(f.ActionsMenuAction,{onClick:function(){return m("go_to_message",t)},title:g.use("me_attach_action_go_to_message"),leftIcon:(0,p.jsx)(d.default,{}),type:"primary"},"action_go_to_message"),t.attach.ownerId===A.id&&(0,p.jsx)(f.ActionsMenuAction,{onClick:function(){return m("delete",t)},title:g.use("me_attach_action_delete_photo"),leftIcon:(0,p.jsx)(u.default,{}),type:"danger"},"action_delete")]})}),[g,t,A.id,m]),w={kind:"message",peerId:t.peerId,cmid:t.cmid};return(0,p.jsxs)("li",{className:"ConvoAttachesPhotos__item",ref:n,children:[s&&(0,p.jsx)("div",{className:"ConvoAttachesPhotos__tail",ref:s}),a&&!c&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(r.Link,{to:{kind:"AttachMediaProxyRoute",attach:t.attach,source:w},className:"ConvoAttachesPhotos__link",children:(0,p.jsx)("img",(0,o.default)((0,o.default)({},a),{},{alt:"",className:"ConvoAttachPhoto__img"}))},t.attach.id),(0,p.jsx)(l.Dropdown,(0,o.default)((0,o.default)({classNames:{wrapper:"ConvoAttachPhoto__dropdown"},content:(0,p.jsx)(f.ActionsMenu,{className:"ConvoActionsMenu",children:C}),align:"center"},x?{adaptation:"horizontal"}:{}),{},{position:x?"bottom":"left",hideOnClick:!0,children:(0,p.jsx)("button",{className:"ConvoAttachPhoto__action","aria-label":g.use("me_actions_more"),children:(0,p.jsx)(h.default,{})})}))]}),a&&c&&(0,p.jsx)("div",{className:"ConvoAttachesPhotos__restore",children:(0,p.jsx)("div",{className:"ConvoAttachesPhoto__restore-button",onClick:function(){return m("restore",t)},children:g.use("me_attach_action_restore")})})]})};function A(e,t){var n=c.preview(e,t,t,!1),o=c.preview(e,2*t,2*t,!1);return n||o?n&&o?{srcSet:"".concat(n.url,", ").concat(o.url," 2x"),src:o.url}:{src:n?n.url:o?o.url:""}:null}},871486:(e,t,n)=>{"use strict";n.d(t,{ConvoAttachesVideos:()=>A});var o=n(678927),s=n(334738),a=(n(128831),n(667294)),i=n(151225),c=n(314432),r=n(21705),l=n(784970),d=n(760562),u=n(594941),h=n(877942),v=n(940637),m=n(368455),f=n(20700),_=n.n(f),p=n(211929),x=n(417388),g=n(785893),A=function(e){var t=e.videos,n=e.tailWatchBind,c=e.goToMessage,d=(0,a.useState)(0),u=(0,s.default)(d,2),h=u[0],v=u[1],m=(0,l.useBrowserEnv)(),f=m.api,_=m.lang,p=(0,a.useRef)(null),x=(0,a.useState)([]),A=(0,s.default)(x,2),w=A[0],j=A[1],k=(0,l.useViewer)().viewer;(0,a.useLayoutEffect)((function(){if(window.IntersectionObserver&&0===h&&p.current){var e=new ResizeObserver((function(t){var n;t[0]&&v(t[0].contentRect.width),0===(null===(n=t[0])||void 0===n?void 0:n.contentRect.width)&&e.disconnect()}));return e.observe(p.current),function(){e.disconnect()}}}),[]);var b=(0,a.useCallback)((function(e,t){switch(e){case"go_to_message":c(t.messageId);break;case"delete_from_own":f.fetch("video.delete",{video_id:t.attach.id,owner_id:t.attach.ownerId,target_id:k.id}).then((function(){j([].concat((0,o.default)(w),[t.attach.id]))}));break;case"restore":f.fetch("video.restore",{video_id:t.attach.id,owner_id:t.attach.ownerId}).then((function(){j(w.filter((function(e){return e!==t.attach.id})))}));break;case"copy_link":case"download":case"report":case"share":case"add":case"add_to_playlist":break;default:(0,r.exhaustivenessCheck)(e)}}),[c,f,w,k.id]),N=Date.now(),L=null;return(0,g.jsx)("ul",{className:"ConvoAttachesVideos",children:t.map((function(e,t,o){var s=0===t,a=t===o.length-1,c=new Date(1e3*e.date).getMonth(),r=null===L||c!==L;L=c;var l=0!==h?function(e,t){var n=i.preview(e,t),o=i.preview(e,2*t);if(!n&&!o)return null;if(!n||!o)return{src:n?n.url:o?o.url:""};return{srcSet:"".concat(n.url,", ").concat(o.url," 2x"),src:o.url}}(e.attach,h):void 0;return(0,g.jsxs)(g.Fragment,{children:[r&&(0,g.jsx)("div",{className:"ConvoAttachesVideos__separator",children:_.formatDate(1e3*e.date,{now:N,variant:"month-year"})}),(0,g.jsx)(C,{measuredElRef:s?p:void 0,tailWatchBind:a?n:void 0,isDeleted:w.includes(e.attach.id),onActionClick:b,video:e,videoSource:l||void 0},"".concat(e.cmid,"-").concat(e.attach.id))]})}))})},C=function(e){var t,n,o,s=e.video,i=e.tailWatchBind,r=e.videoSource,f=e.isDeleted,A=e.measuredElRef,C=e.onActionClick,w=(0,x.useDeviceData)().isTouchOnly,j=(0,l.useBrowserEnv)().lang,k=(0,l.usePeers)(),b=c.safeGet(k,s.peerId),N=(0,p.getDuration)(s.attach.duration,!(null===(t=s.attach.files)||void 0===t||!t.external))||s.attach.platform,L=(0,a.useMemo)((function(){return(0,g.jsx)(m.ActionsMenuAction,{onClick:function(){return C("go_to_message",s)},title:j.use("me_attach_action_go_to_message"),leftIcon:(0,g.jsx)(u.default,{}),type:"primary"},"action_go_to_message")}),[j,s,C]);return(0,g.jsxs)("li",{ref:A,children:[i&&(0,g.jsx)("div",{className:"ConvoAttachesVideoItem__tail",ref:i}),(n=!!r&&!f,o=(0,g.jsxs)(g.Fragment,{children:[n&&(0,g.jsxs)("div",{className:"ConvoAttachesVideoItem__preview",children:[N&&(0,g.jsx)("div",{className:"ConvoAttachesVideos__previewInfo",children:N}),(0,g.jsx)("img",{src:r.src,srcSet:r.srcSet,alt:""})]}),(0,g.jsxs)("div",{className:"ConvoAttachesVideoItem__content",children:[(0,g.jsx)("div",{className:"ConvoAttachesVideoItem__title",children:s.attach.title}),(0,g.jsxs)("div",{className:"ConvoAttachesVideoItem__info",children:[(0,g.jsxs)("div",{className:"ConvoAttachesVideoItem__infoSide",children:[(0,g.jsx)(v.Link,{to:{kind:"PeerModalRoute",peerId:s.peerId},className:"ConvoAttachesVideoItem__peer",children:c.name(b)}),(0,g.jsx)("div",{className:"ConvoAttachesVideo__views",children:j.use("me_convo_attaches_video_views",{num:s.attach.views,values:{count:j.formatNumber(s.attach.views,"short")}})})]}),n&&(0,g.jsx)(d.Dropdown,{classNames:{wrapper:_()("ConvoAttachVideo__dropdown",{"ConvoAttachVideo__dropdown--open":w}),wrapperOpened:"ConvoAttachVideo__dropdown--open"},content:(0,g.jsx)(m.ActionsMenu,{className:"ConvoActionsMenu",children:L}),align:"center",position:"bottom",openType:w?"click":"hover",children:(0,g.jsx)("button",{className:"ConvoAttachVideo__action","aria-label":j.use("me_actions_more"),children:(0,g.jsx)(h.default,{})})})]})]})]}),n?(0,g.jsx)(v.Link,{to:{kind:"AttachMediaProxyRoute",attach:s.attach},className:"ConvoAttachesVideoItem",children:o}):(0,g.jsx)("div",{className:"ConvoAttachesVideoItem",children:o}))]})}},162667:(e,t,n)=>{"use strict";n.d(t,{ConvoAttachments:()=>y});var o=n(692137),s=n(334738),a=n(887757),i=n.n(a),c=(n(402752),n(667294)),r=n(86894),l=n(14646),d=n(55011),u=n(509727),h=n(980662),v=n(314432),m=n(838851),f=n(659309),_=n(784970),p=n(796595),x=n(871486),g=n(760562),A=n(941801),C=n(650485),w=n(995627),j=n(773459),k=n(20700),b=n.n(k),N=n(837021),L=n(872578),I=n(785893),y=function(e){var t=e.convo,n=e.goToMessage,a=e.className,k=(0,c.useState)("photos"),y=(0,s.default)(k,2),M=y[0],S=y[1],B=(0,f.useConvoAttaches)(t.peerId),D=B.attaches,E=B.getNextPage,T=(0,c.useRef)(),P=(0,_.useBrowserEnv)(),R=P.lang,V=P.api,O=(0,_.useOwner)(),W=(0,c.useCallback)((function(e){if(e)return T.current=new IntersectionObserver(function(){var e=(0,o.default)(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=t[0])||void 0===n||!n.isIntersecting){e.next=3;break}return e.next=3,E(M);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),T.current.observe(e),function(){var e;return null===(e=T.current)||void 0===e?void 0:e.disconnect()}}),[M,E]),z=function(e){e!==M&&(D&&!D[e]&&E(e),S(e))},F=(0,c.useRef)(null),G=function(){var e=(0,o.default)(i().mark((function e(t){var o,a,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,F.current=t,e.next=4,V.fetch("messages.getById",{message_ids:t.toString(),group_id:(0,N.getOwnerGroupId)(O.id),extended:0});case 4:if(o=e.sent,a=(0,s.default)(o.items,1),c=a[0]){e.next=9;break}throw new Error("Неожиданный ответ сервера");case 9:if(h.resolveId(c.id)===F.current){e.next=11;break}return e.abrupt("return");case 11:n(h.resolveCmid(c.conversation_message_id),v.resolveId(c.peer_id)),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(0);case 16:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}();if((0,c.useEffect)((function(){null===D&&E(M)})),!D)return null;var Z=D[M];return(0,I.jsxs)("div",{className:b()("ConvoAttachments",a),children:[(0,I.jsx)(L.AdaptiveScroll,{className:"ConvoAttachments__tabsScroll",children:(0,I.jsxs)(r.Tabs,{className:"ConvoAttachments_tabs",children:[(0,I.jsx)(r.TabsItem,{onClick:function(){return z("photos")},selected:"photos"===M,children:R.use("me_convo_attaches_type_photo")}),(0,I.jsx)(r.TabsItem,{onClick:function(){return z("videos")},selected:"videos"===M,children:R.use("me_convo_attaches_type_video")}),(0,I.jsx)(r.TabsItem,{onClick:function(){return z("audios")},selected:"audios"===M,children:R.use("me_convo_attaches_type_music")}),(0,I.jsx)(r.TabsItem,{onClick:function(){return z("docs")},selected:"docs"===M,children:R.use("me_convo_attaches_type_doc")}),(0,I.jsx)(r.TabsItem,{onClick:function(){return z("links")},selected:"links"===M,children:R.use("me_convo_attaches_type_links")})]})}),D&&(0,I.jsxs)("div",{className:"ConvoAttachments__block",children:[function(){var e,n;if(null==Z||!Z.items||0===(null==Z?void 0:Z.items.length))return null;switch(M){case"audios":return(0,I.jsx)("ul",{className:"ConvoAttachments__list",children:null==Z?void 0:Z.items.map((function(e,t,n){var o=e.attach,s=n.length===t+1&&!(null!=Z&&Z.isLoading)&&!(null!=Z&&Z.isAllLoaded);return"Audio"!==o.kind?null:(0,I.jsxs)("li",{children:[s&&(0,I.jsx)("div",{ref:W}),(0,I.jsxs)("div",{className:"ConvoAttachments__itemContainer",children:[(0,I.jsx)("div",{className:"ConvoAttachments__item",children:(0,I.jsx)(l.AttachAudio,{audio:o})}),(0,I.jsx)(g.Dropdown,{hideOnClick:!0,content:(0,I.jsx)(w.ConvoAttachAudioActionsMenu,{audio:o,messageId:e.messageId,goToMessage:G}),align:"right",position:"bottom",children:(0,I.jsx)("button",{className:"ConvoAttachments__itemMenuButton",children:(0,I.jsx)(C.default,{})})})]})]},"".concat(e.cmid,"-").concat(o.id))}))});case"docs":return(0,I.jsx)("ul",{className:"ConvoAttachments__list",children:null==Z?void 0:Z.items.map((function(e,t,n){var o=e.attach,s=n.length===t+1&&!(null!=Z&&Z.isLoading)&&!(null!=Z&&Z.isAllLoaded);return"Doc"!==o.kind?null:(0,I.jsxs)("li",{className:"ConvoAttachments__listItem ConvoAtachments__docItem",children:[s&&(0,I.jsx)("div",{ref:W}),(0,I.jsxs)("div",{className:"ConvoAttachments__itemContainer",children:[(0,I.jsx)("div",{className:"ConvoAttachments__item",children:(0,I.jsx)(d.AttachDoc,{doc:o})}),(0,I.jsx)(g.Dropdown,{hideOnClick:!0,content:(0,I.jsx)(A.ConvoAttachDocActionsMenu,{document:o,messageId:e.messageId,goToMessage:G}),align:"center",position:"left",children:(0,I.jsx)("button",{className:"ConvoAttachments__itemMenuButton",children:(0,I.jsx)(C.default,{})})})]})]},"".concat(e.cmid,"-").concat(o.id))}))});case"links":var o=D[M];if(!o)return null;var s=!o.isAllLoaded&&!o.isLoading;return(0,I.jsx)(j.ConvoAttachesLinks,{links:o.items,goToMessage:G,tailWatchBind:s?W:void 0});case"photos":var a=null===(e=D[M])||void 0===e?void 0:e.items;if(!a)return null;var i=!(null!=Z&&Z.isLoading||null!=Z&&Z.isAllLoaded);return(0,I.jsx)(p.ConvoAttachesPhotos,{photos:a,tailWatchBind:i?W:void 0,isCasper:u.isCasper(t),goToMessage:G,children:(0,I.jsx)("div",{ref:W})});case"videos":var c=null===(n=D[M])||void 0===n?void 0:n.items;if(!c)return null;var r=!(null!=Z&&Z.isLoading||null!=Z&&Z.isAllLoaded);return(0,I.jsx)(x.ConvoAttachesVideos,{videos:c,tailWatchBind:r?W:void 0,goToMessage:G,children:(0,I.jsx)("div",{ref:W})});default:return null}}(),(!Z||Z.isLoading)&&(0,I.jsx)(m.OptimizedSpinner,{className:"ConvoAttachments__loader"}),Z&&!Z.isLoading&&0===Z.items.length&&(0,I.jsx)("div",{className:"ConvoAttachments__empty",children:R.use("me_convo_attaches_empty_type")})]})]})}}}]);try{stManager.done("dist/c2c69d9beb37d98912643aff437f899c.0aa22c73a5baeaa630ef.js")}catch(e){}